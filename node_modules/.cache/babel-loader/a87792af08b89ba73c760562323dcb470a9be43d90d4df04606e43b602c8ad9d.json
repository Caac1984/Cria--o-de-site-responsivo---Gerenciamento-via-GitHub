{"ast":null,"code":"var _jsxFileName = \"/home/nomade00/\\xC1rea de Trabalho/Trabalho James/trabcar/src/pages/CadHorario.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction CadastroHorario() {\n  _s();\n  const [selectedProfessor, setSelectedProfessor] = useState('');\n  const [selectedSala, setSelectedSala] = useState('');\n  const [selectedNomeDesafio, setSelectedNomeDesafio] = useState('');\n  const [setSelectedCurso] = useState('');\n  const [professores, setProfessores] = useState([]);\n  const [salas, setSalas] = useState([]);\n  const [nomeDesafios, setNomeDesafios] = useState([]);\n  const [horarios, setHorarios] = useState([]);\n  const [horaInicial, setHoraInicial] = useState([]);\n  const [horaFinal, setHoraFinal] = useState([]);\n  useEffect(() => {\n    const storedHorarios = JSON.parse(localStorage.getItem('Horarios')) || [];\n    setHorarios(storedHorarios);\n    const storedProfessores = JSON.parse(localStorage.getItem('Professores')) || [];\n    setProfessores(storedProfessores);\n    const storedSalas = JSON.parse(localStorage.getItem('Salas')) || [];\n    setSalas(storedSalas);\n    const storedDesafios = JSON.parse(localStorage.getItem('Desafios')) || [];\n    setNomeDesafios(storedDesafios);\n  }, []);\n  const adicionarHorarios = () => {\n    if (selectedProfessor.trim() && horaFinal.trim() && horaInicial.trim() && selectedSala.trim()) {\n      const novoHorario = {\n        id: new Date().getTime(),\n        professor: selectedProfessor,\n        sala: selectedSala,\n        desafio: selectedNomeDesafio,\n        horaInicial: horaInicial,\n        horaFinal: horaFinal\n      };\n      console.log(novoHorario);\n      setHorarios(prevHorarios => {\n        const newHorarios = [...prevHorarios, novoHorario];\n        localStorage.setItem('Horarios', JSON.stringify(newHorarios));\n        return newHorarios;\n      });\n\n      // Limpa os campos após adicionar\n      setSelectedProfessor('');\n      setSelectedCurso('');\n      setHoraInicial('');\n      setHoraFinal('');\n      setSelectedSala('');\n    }\n  };\n  const excluirHorario = index => {\n    const novoHorario = [...horarios];\n    novoHorario.splice(index, 1);\n    setHorarios(novoHorario);\n    localStorage.setItem('Horario', JSON.stringify(novoHorario));\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"Cad\",\n      className: \"form-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Selecione um Professor: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        id: \"professor\",\n        value: selectedProfessor,\n        onChange: e => setSelectedProfessor(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          disabled: true,\n          children: \"Selecione um professor\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 11\n        }, this), professores.map((professor, index) => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: professor.nomeProfessor,\n          children: professor.nomeProfessor\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Selecione uma Sala: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        id: \"sala\",\n        value: selectedSala,\n        onChange: e => setSelectedSala(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          disabled: true,\n          children: \"Selecione uma Sala\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this), salas.map((sala, index) => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: sala.numeroSala,\n          children: sala.numeroSala\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Selecione um Desafio: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        id: \"desafio\",\n        value: selectedNomeDesafio,\n        onChange: e => setSelectedNomeDesafio(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          disabled: true,\n          children: \"Selecione um Desafio\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 11\n        }, this), nomeDesafios.map((desafio, index) => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: desafio.nomeDesafio,\n          children: desafio.nomeDesafio\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"Hor\\xE1rio Inicio: \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"home-container\",\n          type: \"time\",\n          value: horaInicial,\n          onChange: e => setHoraInicial(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"Hor\\xE1rio Final: \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"home-container\",\n          type: \"time\",\n          value: horaFinal,\n          onChange: e => setHoraFinal(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: adicionarHorarios,\n        children: \"Adicionar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"table-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Horario\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n        id: \"tabelaPessoas\",\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"ID\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Professor\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 149,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Sala\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 150,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Curso\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 151,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Horario\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 152,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: horarios.map((horario, index) => /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: horario.id\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: horario.professor\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: horario.sala\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 161,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: horario.desafio\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 162,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: [horario.horaInicial, \" a\", ' ', horario.horaFinal]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 163,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"excluir-btn\",\n                onClick: () => excluirHorario(horario.id),\n                children: \"Excluir\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 167,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 166,\n              columnNumber: 17\n            }, this)]\n          }, horario.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 5\n  }, this);\n}\n\n/*!\n * FullCalendar v1.6.4\n * Docs & License: http://arshaw.com/fullcalendar/\n * (c) 2013 Adam Shaw\n */\n\n/*\n * Use fullcalendar.css for basic styling.\n * For event drag & drop, requires jQuery UI draggable.\n * For event resizing, requires jQuery UI resizable.\n */\n_s(CadastroHorario, \"OM/F5oLZLQYUln0NEAUCCRV6GYY=\");\n_c = CadastroHorario;\n(function ($, undefined) {\n  ;\n  ;\n  var defaults = {\n    // display\n    defaultView: 'month',\n    aspectRatio: 1.35,\n    header: {\n      left: 'title',\n      center: '',\n      right: 'today prev,next'\n    },\n    weekends: true,\n    weekNumbers: false,\n    weekNumberCalculation: 'iso',\n    weekNumberTitle: 'W',\n    // editing\n    //editable: false,\n    //disableDragging: false,\n    //disableResizing: false,\n\n    allDayDefault: true,\n    ignoreTimezone: true,\n    // event ajax\n    lazyFetching: true,\n    startParam: 'start',\n    endParam: 'end',\n    // time formats\n    titleFormat: {\n      month: 'MMMM yyyy',\n      week: \"MMM d[ yyyy]{ '—'[ MMM] d yyyy}\",\n      day: 'dddd, MMM d, yyyy'\n    },\n    columnFormat: {\n      month: 'ddd',\n      week: 'ddd M/d',\n      day: 'dddd M/d'\n    },\n    timeFormat: {\n      // for event elements\n      '': 'h(:mm)t' // default\n    },\n\n    // locale\n    isRTL: false,\n    firstDay: 0,\n    monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n    dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\n    dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],\n    buttonText: {\n      prev: \"<span class='fc-text-arrow'>‹</span>\",\n      next: \"<span class='fc-text-arrow'>›</span>\",\n      prevYear: \"<span class='fc-text-arrow'>«</span>\",\n      nextYear: \"<span class='fc-text-arrow'>»</span>\",\n      today: 'today',\n      month: 'month',\n      week: 'week',\n      day: 'day'\n    },\n    // jquery-ui theming\n    theme: false,\n    buttonIcons: {\n      prev: 'circle-triangle-w',\n      next: 'circle-triangle-e'\n    },\n    //selectable: false,\n    unselectAuto: true,\n    dropAccept: '*',\n    handleWindowResize: true\n  };\n\n  // right-to-left defaults\n  var rtlDefaults = {\n    header: {\n      left: 'next,prev today',\n      center: '',\n      right: 'title'\n    },\n    buttonText: {\n      prev: \"<span class='fc-text-arrow'>›</span>\",\n      next: \"<span class='fc-text-arrow'>‹</span>\",\n      prevYear: \"<span class='fc-text-arrow'>»</span>\",\n      nextYear: \"<span class='fc-text-arrow'>«</span>\"\n    },\n    buttonIcons: {\n      prev: 'circle-triangle-e',\n      next: 'circle-triangle-w'\n    }\n  };\n  ;\n  ;\n  var fc = $.fullCalendar = {\n    version: \"1.6.4\"\n  };\n  var fcViews = fc.views = {};\n  $.fn.fullCalendar = function (options) {\n    // method calling\n    if (typeof options == 'string') {\n      var args = Array.prototype.slice.call(arguments, 1);\n      var res;\n      this.each(function () {\n        var calendar = $.data(this, 'fullCalendar');\n        if (calendar && $.isFunction(calendar[options])) {\n          var r = calendar[options].apply(calendar, args);\n          if (res === undefined) {\n            res = r;\n          }\n          if (options == 'destroy') {\n            $.removeData(this, 'fullCalendar');\n          }\n        }\n      });\n      if (res !== undefined) {\n        return res;\n      }\n      return this;\n    }\n    options = options || {};\n\n    // would like to have this logic in EventManager, but needs to happen before options are recursively extended\n    var eventSources = options.eventSources || [];\n    delete options.eventSources;\n    if (options.events) {\n      eventSources.push(options.events);\n      delete options.events;\n    }\n    options = $.extend(true, {}, defaults, options.isRTL || options.isRTL === undefined && defaults.isRTL ? rtlDefaults : {}, options);\n    this.each(function (i, _element) {\n      var element = $(_element);\n      var calendar = new Calendar(element, options, eventSources);\n      element.data('fullCalendar', calendar); // TODO: look into memory leak implications\n      calendar.render();\n    });\n    return this;\n  };\n\n  // function for adding/overriding defaults\n  function setDefaults(d) {\n    $.extend(true, defaults, d);\n  }\n  ;\n  ;\n  function Calendar(element, options, eventSources) {\n    var t = this;\n\n    // exports\n    t.options = options;\n    t.render = render;\n    t.destroy = destroy;\n    t.refetchEvents = refetchEvents;\n    t.reportEvents = reportEvents;\n    t.reportEventChange = reportEventChange;\n    t.rerenderEvents = rerenderEvents;\n    t.changeView = changeView;\n    t.select = select;\n    t.unselect = unselect;\n    t.prev = prev;\n    t.next = next;\n    t.prevYear = prevYear;\n    t.nextYear = nextYear;\n    t.today = today;\n    t.gotoDate = gotoDate;\n    t.incrementDate = incrementDate;\n    t.formatDate = function (format, date) {\n      return formatDate(format, date, options);\n    };\n    t.formatDates = function (format, date1, date2) {\n      return formatDates(format, date1, date2, options);\n    };\n    t.getDate = getDate;\n    t.getView = getView;\n    t.option = option;\n    t.trigger = trigger;\n\n    // imports\n    EventManager.call(t, options, eventSources);\n    var isFetchNeeded = t.isFetchNeeded;\n    var fetchEvents = t.fetchEvents;\n\n    // locals\n    var _element = element[0];\n    var header;\n    var headerElement;\n    var content;\n    var tm; // for making theme classes\n    var currentView;\n    var elementOuterWidth;\n    var suggestedViewHeight;\n    var resizeUID = 0;\n    var ignoreWindowResize = 0;\n    var date = new Date();\n    var events = [];\n    var _dragElement;\n\n    /* Main Rendering\n    -----------------------------------------------------------------------------*/\n\n    setYMD(date, options.year, options.month, options.date);\n    function render(inc) {\n      if (!content) {\n        initialRender();\n      } else if (elementVisible()) {\n        // mainly for the public API\n        calcSize();\n        _renderView(inc);\n      }\n    }\n    function initialRender() {\n      tm = options.theme ? 'ui' : 'fc';\n      element.addClass('fc');\n      if (options.isRTL) {\n        element.addClass('fc-rtl');\n      } else {\n        element.addClass('fc-ltr');\n      }\n      if (options.theme) {\n        element.addClass('ui-widget');\n      }\n      content = $(\"<div class='fc-content' style='position:relative'/>\").prependTo(element);\n      header = new Header(t, options);\n      headerElement = header.render();\n      if (headerElement) {\n        element.prepend(headerElement);\n      }\n      changeView(options.defaultView);\n      if (options.handleWindowResize) {\n        $(window).resize(windowResize);\n      }\n\n      // needed for IE in a 0x0 iframe, b/c when it is resized, never triggers a windowResize\n      if (!bodyVisible()) {\n        lateRender();\n      }\n    }\n\n    // called when we know the calendar couldn't be rendered when it was initialized,\n    // but we think it's ready now\n    function lateRender() {\n      setTimeout(function () {\n        // IE7 needs this so dimensions are calculated correctly\n        if (!currentView.start && bodyVisible()) {\n          // !currentView.start makes sure this never happens more than once\n          renderView();\n        }\n      }, 0);\n    }\n    function destroy() {\n      if (currentView) {\n        trigger('viewDestroy', currentView, currentView, currentView.element);\n        currentView.triggerEventDestroy();\n      }\n      $(window).unbind('resize', windowResize);\n      header.destroy();\n      content.remove();\n      element.removeClass('fc fc-rtl ui-widget');\n    }\n    function elementVisible() {\n      return element.is(':visible');\n    }\n    function bodyVisible() {\n      return $('body').is(':visible');\n    }\n\n    /* View Rendering\n    -----------------------------------------------------------------------------*/\n\n    function changeView(newViewName) {\n      if (!currentView || newViewName != currentView.name) {\n        _changeView(newViewName);\n      }\n    }\n    function _changeView(newViewName) {\n      ignoreWindowResize++;\n      if (currentView) {\n        trigger('viewDestroy', currentView, currentView, currentView.element);\n        unselect();\n        currentView.triggerEventDestroy(); // trigger 'eventDestroy' for each event\n        freezeContentHeight();\n        currentView.element.remove();\n        header.deactivateButton(currentView.name);\n      }\n      header.activateButton(newViewName);\n      currentView = new fcViews[newViewName]($(\"<div class='fc-view fc-view-\" + newViewName + \"' style='position:relative'/>\").appendTo(content), t // the calendar object\n      );\n\n      renderView();\n      unfreezeContentHeight();\n      ignoreWindowResize--;\n    }\n    function renderView(inc) {\n      if (!currentView.start ||\n      // never rendered before\n      inc || date < currentView.start || date >= currentView.end // or new date range\n      ) {\n        if (elementVisible()) {\n          _renderView(inc);\n        }\n      }\n    }\n    function _renderView(inc) {\n      // assumes elementVisible\n      ignoreWindowResize++;\n      if (currentView.start) {\n        // already been rendered?\n        trigger('viewDestroy', currentView, currentView, currentView.element);\n        unselect();\n        clearEvents();\n      }\n      freezeContentHeight();\n      currentView.render(date, inc || 0); // the view's render method ONLY renders the skeleton, nothing else\n      setSize();\n      unfreezeContentHeight();\n      (currentView.afterRender || noop)();\n      updateTitle();\n      updateTodayButton();\n      trigger('viewRender', currentView, currentView, currentView.element);\n      currentView.trigger('viewDisplay', _element); // deprecated\n\n      ignoreWindowResize--;\n      getAndRenderEvents();\n    }\n\n    /* Resizing\n    -----------------------------------------------------------------------------*/\n\n    function updateSize() {\n      if (elementVisible()) {\n        unselect();\n        clearEvents();\n        calcSize();\n        setSize();\n        renderEvents();\n      }\n    }\n    function calcSize() {\n      // assumes elementVisible\n      if (options.contentHeight) {\n        suggestedViewHeight = options.contentHeight;\n      } else if (options.height) {\n        suggestedViewHeight = options.height - (headerElement ? headerElement.height() : 0) - vsides(content);\n      } else {\n        suggestedViewHeight = Math.round(content.width() / Math.max(options.aspectRatio, .5));\n      }\n    }\n    function setSize() {\n      // assumes elementVisible\n\n      if (suggestedViewHeight === undefined) {\n        calcSize(); // for first time\n        // NOTE: we don't want to recalculate on every renderView because\n        // it could result in oscillating heights due to scrollbars.\n      }\n\n      ignoreWindowResize++;\n      currentView.setHeight(suggestedViewHeight);\n      currentView.setWidth(content.width());\n      ignoreWindowResize--;\n      elementOuterWidth = element.outerWidth();\n    }\n    function windowResize() {\n      if (!ignoreWindowResize) {\n        if (currentView.start) {\n          // view has already been rendered\n          var uid = ++resizeUID;\n          setTimeout(function () {\n            // add a delay\n            if (uid == resizeUID && !ignoreWindowResize && elementVisible()) {\n              if (elementOuterWidth != (elementOuterWidth = element.outerWidth())) {\n                ignoreWindowResize++; // in case the windowResize callback changes the height\n                updateSize();\n                currentView.trigger('windowResize', _element);\n                ignoreWindowResize--;\n              }\n            }\n          }, 200);\n        } else {\n          // calendar must have been initialized in a 0x0 iframe that has just been resized\n          lateRender();\n        }\n      }\n    }\n\n    /* Event Fetching/Rendering\n    -----------------------------------------------------------------------------*/\n    // TODO: going forward, most of this stuff should be directly handled by the view\n\n    function refetchEvents() {\n      // can be called as an API method\n      clearEvents();\n      fetchAndRenderEvents();\n    }\n    function rerenderEvents(modifiedEventID) {\n      // can be called as an API method\n      clearEvents();\n      renderEvents(modifiedEventID);\n    }\n    function renderEvents(modifiedEventID) {\n      // TODO: remove modifiedEventID hack\n      if (elementVisible()) {\n        currentView.setEventData(events); // for View.js, TODO: unify with renderEvents\n        currentView.renderEvents(events, modifiedEventID); // actually render the DOM elements\n        currentView.trigger('eventAfterAllRender');\n      }\n    }\n    function clearEvents() {\n      currentView.triggerEventDestroy(); // trigger 'eventDestroy' for each event\n      currentView.clearEvents(); // actually remove the DOM elements\n      currentView.clearEventData(); // for View.js, TODO: unify with clearEvents\n    }\n\n    function getAndRenderEvents() {\n      if (!options.lazyFetching || isFetchNeeded(currentView.visStart, currentView.visEnd)) {\n        fetchAndRenderEvents();\n      } else {\n        renderEvents();\n      }\n    }\n    function fetchAndRenderEvents() {\n      fetchEvents(currentView.visStart, currentView.visEnd);\n      // ... will call reportEvents\n      // ... which will call renderEvents\n    }\n\n    // called when event data arrives\n    function reportEvents(_events) {\n      events = _events;\n      renderEvents();\n    }\n\n    // called when a single event's data has been changed\n    function reportEventChange(eventID) {\n      rerenderEvents(eventID);\n    }\n\n    /* Header Updating\n    -----------------------------------------------------------------------------*/\n\n    function updateTitle() {\n      header.updateTitle(currentView.title);\n    }\n    function updateTodayButton() {\n      var today = new Date();\n      if (today >= currentView.start && today < currentView.end) {\n        header.disableButton('today');\n      } else {\n        header.enableButton('today');\n      }\n    }\n\n    /* Selection\n    -----------------------------------------------------------------------------*/\n\n    function select(start, end, allDay) {\n      currentView.select(start, end, allDay === undefined ? true : allDay);\n    }\n    function unselect() {\n      // safe to be called before renderView\n      if (currentView) {\n        currentView.unselect();\n      }\n    }\n\n    /* Date\n    -----------------------------------------------------------------------------*/\n\n    function prev() {\n      renderView(-1);\n    }\n    function next() {\n      renderView(1);\n    }\n    function prevYear() {\n      addYears(date, -1);\n      renderView();\n    }\n    function nextYear() {\n      addYears(date, 1);\n      renderView();\n    }\n    function today() {\n      date = new Date();\n      renderView();\n    }\n    function gotoDate(year, month, dateOfMonth) {\n      if (year instanceof Date) {\n        date = cloneDate(year); // provided 1 argument, a Date\n      } else {\n        setYMD(date, year, month, dateOfMonth);\n      }\n      renderView();\n    }\n    function incrementDate(years, months, days) {\n      if (years !== undefined) {\n        addYears(date, years);\n      }\n      if (months !== undefined) {\n        addMonths(date, months);\n      }\n      if (days !== undefined) {\n        addDays(date, days);\n      }\n      renderView();\n    }\n    function getDate() {\n      return cloneDate(date);\n    }\n\n    /* Height \"Freezing\"\n    -----------------------------------------------------------------------------*/\n\n    function freezeContentHeight() {\n      content.css({\n        width: '100%',\n        height: content.height(),\n        overflow: 'hidden'\n      });\n    }\n    function unfreezeContentHeight() {\n      content.css({\n        width: '',\n        height: '',\n        overflow: ''\n      });\n    }\n\n    /* Misc\n    -----------------------------------------------------------------------------*/\n\n    function getView() {\n      return currentView;\n    }\n    function option(name, value) {\n      if (value === undefined) {\n        return options[name];\n      }\n      if (name == 'height' || name == 'contentHeight' || name == 'aspectRatio') {\n        options[name] = value;\n        updateSize();\n      }\n    }\n    function trigger(name, thisObj) {\n      if (options[name]) {\n        return options[name].apply(thisObj || _element, Array.prototype.slice.call(arguments, 2));\n      }\n    }\n\n    /* External Dragging\n    ------------------------------------------------------------------------*/\n\n    if (options.droppable) {\n      $(document).bind('dragstart', function (ev, ui) {\n        var _e = ev.target;\n        var e = $(_e);\n        if (!e.parents('.fc').length) {\n          // not already inside a calendar\n          var accept = options.dropAccept;\n          if ($.isFunction(accept) ? accept.call(_e, e) : e.is(accept)) {\n            _dragElement = _e;\n            currentView.dragStart(_dragElement, ev, ui);\n          }\n        }\n      }).bind('dragstop', function (ev, ui) {\n        if (_dragElement) {\n          currentView.dragStop(_dragElement, ev, ui);\n          _dragElement = null;\n        }\n      });\n    }\n  }\n  ;\n  ;\n  function Header(calendar, options) {\n    var t = this;\n\n    // exports\n    t.render = render;\n    t.destroy = destroy;\n    t.updateTitle = updateTitle;\n    t.activateButton = activateButton;\n    t.deactivateButton = deactivateButton;\n    t.disableButton = disableButton;\n    t.enableButton = enableButton;\n\n    // locals\n    var element = $([]);\n    var tm;\n    function render() {\n      tm = options.theme ? 'ui' : 'fc';\n      var sections = options.header;\n      if (sections) {\n        element = $(\"<table class='fc-header' style='width:100%'/>\").append($(\"<tr/>\").append(renderSection('left')).append(renderSection('center')).append(renderSection('right')));\n        return element;\n      }\n    }\n    function destroy() {\n      element.remove();\n    }\n    function renderSection(position) {\n      var e = $(\"<td class='fc-header-\" + position + \"'/>\");\n      var buttonStr = options.header[position];\n      if (buttonStr) {\n        $.each(buttonStr.split(' '), function (i) {\n          if (i > 0) {\n            e.append(\"<span class='fc-header-space'/>\");\n          }\n          var prevButton;\n          $.each(this.split(','), function (j, buttonName) {\n            if (buttonName == 'title') {\n              e.append(\"<span class='fc-header-title'><h2> </h2></span>\");\n              if (prevButton) {\n                prevButton.addClass(tm + '-corner-right');\n              }\n              prevButton = null;\n            } else {\n              var buttonClick;\n              if (calendar[buttonName]) {\n                buttonClick = calendar[buttonName]; // calendar method\n              } else if (fcViews[buttonName]) {\n                buttonClick = function () {\n                  button.removeClass(tm + '-state-hover'); // forget why\n                  calendar.changeView(buttonName);\n                };\n              }\n              if (buttonClick) {\n                var icon = options.theme ? smartProperty(options.buttonIcons, buttonName) : null; // why are we using smartProperty here?\n                var text = smartProperty(options.buttonText, buttonName); // why are we using smartProperty here?\n                var button = $(\"<span class='fc-button fc-button-\" + buttonName + \" \" + tm + \"-state-default'>\" + (icon ? \"<span class='fc-icon-wrap'>\" + \"<span class='ui-icon ui-icon-\" + icon + \"'/>\" + \"</span>\" : text) + \"</span>\").click(function () {\n                  if (!button.hasClass(tm + '-state-disabled')) {\n                    buttonClick();\n                  }\n                }).mousedown(function () {\n                  button.not('.' + tm + '-state-active').not('.' + tm + '-state-disabled').addClass(tm + '-state-down');\n                }).mouseup(function () {\n                  button.removeClass(tm + '-state-down');\n                }).hover(function () {\n                  button.not('.' + tm + '-state-active').not('.' + tm + '-state-disabled').addClass(tm + '-state-hover');\n                }, function () {\n                  button.removeClass(tm + '-state-hover').removeClass(tm + '-state-down');\n                }).appendTo(e);\n                disableTextSelection(button);\n                if (!prevButton) {\n                  button.addClass(tm + '-corner-left');\n                }\n                prevButton = button;\n              }\n            }\n          });\n          if (prevButton) {\n            prevButton.addClass(tm + '-corner-right');\n          }\n        });\n      }\n      return e;\n    }\n    function updateTitle(html) {\n      element.find('h2').html(html);\n    }\n    function activateButton(buttonName) {\n      element.find('span.fc-button-' + buttonName).addClass(tm + '-state-active');\n    }\n    function deactivateButton(buttonName) {\n      element.find('span.fc-button-' + buttonName).removeClass(tm + '-state-active');\n    }\n    function disableButton(buttonName) {\n      element.find('span.fc-button-' + buttonName).addClass(tm + '-state-disabled');\n    }\n    function enableButton(buttonName) {\n      element.find('span.fc-button-' + buttonName).removeClass(tm + '-state-disabled');\n    }\n  }\n  ;\n  ;\n  fc.sourceNormalizers = [];\n  fc.sourceFetchers = [];\n  var ajaxDefaults = {\n    dataType: 'json',\n    cache: false\n  };\n  var eventGUID = 1;\n  function EventManager(options, _sources) {\n    var t = this;\n\n    // exports\n    t.isFetchNeeded = isFetchNeeded;\n    t.fetchEvents = fetchEvents;\n    t.addEventSource = addEventSource;\n    t.removeEventSource = removeEventSource;\n    t.updateEvent = updateEvent;\n    t.renderEvent = renderEvent;\n    t.removeEvents = removeEvents;\n    t.clientEvents = clientEvents;\n    t.normalizeEvent = normalizeEvent;\n\n    // imports\n    var trigger = t.trigger;\n    var getView = t.getView;\n    var reportEvents = t.reportEvents;\n\n    // locals\n    var stickySource = {\n      events: []\n    };\n    var sources = [stickySource];\n    var rangeStart, rangeEnd;\n    var currentFetchID = 0;\n    var pendingSourceCnt = 0;\n    var loadingLevel = 0;\n    var cache = [];\n    for (var i = 0; i < _sources.length; i++) {\n      _addEventSource(_sources[i]);\n    }\n\n    /* Fetching\n    -----------------------------------------------------------------------------*/\n\n    function isFetchNeeded(start, end) {\n      return !rangeStart || start < rangeStart || end > rangeEnd;\n    }\n    function fetchEvents(start, end) {\n      rangeStart = start;\n      rangeEnd = end;\n      cache = [];\n      var fetchID = ++currentFetchID;\n      var len = sources.length;\n      pendingSourceCnt = len;\n      for (var i = 0; i < len; i++) {\n        fetchEventSource(sources[i], fetchID);\n      }\n    }\n    function fetchEventSource(source, fetchID) {\n      _fetchEventSource(source, function (events) {\n        if (fetchID == currentFetchID) {\n          if (events) {\n            if (options.eventDataTransform) {\n              events = $.map(events, options.eventDataTransform);\n            }\n            if (source.eventDataTransform) {\n              events = $.map(events, source.eventDataTransform);\n            }\n            // TODO: this technique is not ideal for static array event sources.\n            //  For arrays, we'll want to process all events right in the beginning, then never again.\n\n            for (var i = 0; i < events.length; i++) {\n              events[i].source = source;\n              normalizeEvent(events[i]);\n            }\n            cache = cache.concat(events);\n          }\n          pendingSourceCnt--;\n          if (!pendingSourceCnt) {\n            reportEvents(cache);\n          }\n        }\n      });\n    }\n    function _fetchEventSource(source, callback) {\n      var i;\n      var fetchers = fc.sourceFetchers;\n      var res;\n      for (i = 0; i < fetchers.length; i++) {\n        res = fetchers[i](source, rangeStart, rangeEnd, callback);\n        if (res === true) {\n          // the fetcher is in charge. made its own async request\n          return;\n        } else if (typeof res == 'object') {\n          // the fetcher returned a new source. process it\n          _fetchEventSource(res, callback);\n          return;\n        }\n      }\n      var events = source.events;\n      if (events) {\n        if ($.isFunction(events)) {\n          pushLoading();\n          events(cloneDate(rangeStart), cloneDate(rangeEnd), function (events) {\n            callback(events);\n            popLoading();\n          });\n        } else if ($.isArray(events)) {\n          callback(events);\n        } else {\n          callback();\n        }\n      } else {\n        var url = source.url;\n        if (url) {\n          var success = source.success;\n          var error = source.error;\n          var complete = source.complete;\n\n          // retrieve any outbound GET/POST $.ajax data from the options\n          var customData;\n          if ($.isFunction(source.data)) {\n            // supplied as a function that returns a key/value object\n            customData = source.data();\n          } else {\n            // supplied as a straight key/value object\n            customData = source.data;\n          }\n\n          // use a copy of the custom data so we can modify the parameters\n          // and not affect the passed-in object.\n          var data = $.extend({}, customData || {});\n          var startParam = firstDefined(source.startParam, options.startParam);\n          var endParam = firstDefined(source.endParam, options.endParam);\n          if (startParam) {\n            data[startParam] = Math.round(+rangeStart / 1000);\n          }\n          if (endParam) {\n            data[endParam] = Math.round(+rangeEnd / 1000);\n          }\n          pushLoading();\n          $.ajax($.extend({}, ajaxDefaults, source, {\n            data: data,\n            success: function (events) {\n              events = events || [];\n              var res = applyAll(success, this, arguments);\n              if ($.isArray(res)) {\n                events = res;\n              }\n              callback(events);\n            },\n            error: function () {\n              applyAll(error, this, arguments);\n              callback();\n            },\n            complete: function () {\n              applyAll(complete, this, arguments);\n              popLoading();\n            }\n          }));\n        } else {\n          callback();\n        }\n      }\n    }\n\n    /* Sources\n    -----------------------------------------------------------------------------*/\n\n    function addEventSource(source) {\n      source = _addEventSource(source);\n      if (source) {\n        pendingSourceCnt++;\n        fetchEventSource(source, currentFetchID); // will eventually call reportEvents\n      }\n    }\n\n    function _addEventSource(source) {\n      if ($.isFunction(source) || $.isArray(source)) {\n        source = {\n          events: source\n        };\n      } else if (typeof source == 'string') {\n        source = {\n          url: source\n        };\n      }\n      if (typeof source == 'object') {\n        normalizeSource(source);\n        sources.push(source);\n        return source;\n      }\n    }\n    function removeEventSource(source) {\n      sources = $.grep(sources, function (src) {\n        return !isSourcesEqual(src, source);\n      });\n      // remove all client events from that source\n      cache = $.grep(cache, function (e) {\n        return !isSourcesEqual(e.source, source);\n      });\n      reportEvents(cache);\n    }\n\n    /* Manipulation\n    -----------------------------------------------------------------------------*/\n\n    function updateEvent(event) {\n      // update an existing event\n      var i,\n        len = cache.length,\n        e,\n        defaultEventEnd = getView().defaultEventEnd,\n        // getView???\n        startDelta = event.start - event._start,\n        endDelta = event.end ? event.end - (event._end || defaultEventEnd(event)) // event._end would be null if event.end\n        : 0; // was null and event was just resized\n      for (i = 0; i < len; i++) {\n        e = cache[i];\n        if (e._id == event._id && e != event) {\n          e.start = new Date(+e.start + startDelta);\n          if (event.end) {\n            if (e.end) {\n              e.end = new Date(+e.end + endDelta);\n            } else {\n              e.end = new Date(+defaultEventEnd(e) + endDelta);\n            }\n          } else {\n            e.end = null;\n          }\n          e.title = event.title;\n          e.url = event.url;\n          e.allDay = event.allDay;\n          e.className = event.className;\n          e.editable = event.editable;\n          e.color = event.color;\n          e.backgroundColor = event.backgroundColor;\n          e.borderColor = event.borderColor;\n          e.textColor = event.textColor;\n          normalizeEvent(e);\n        }\n      }\n      normalizeEvent(event);\n      reportEvents(cache);\n    }\n    function renderEvent(event, stick) {\n      normalizeEvent(event);\n      if (!event.source) {\n        if (stick) {\n          stickySource.events.push(event);\n          event.source = stickySource;\n        }\n        cache.push(event);\n      }\n      reportEvents(cache);\n    }\n    function removeEvents(filter) {\n      if (!filter) {\n        // remove all\n        cache = [];\n        // clear all array sources\n        for (var i = 0; i < sources.length; i++) {\n          if ($.isArray(sources[i].events)) {\n            sources[i].events = [];\n          }\n        }\n      } else {\n        if (!$.isFunction(filter)) {\n          // an event ID\n          var id = filter + '';\n          filter = function (e) {\n            return e._id == id;\n          };\n        }\n        cache = $.grep(cache, filter, true);\n        // remove events from array sources\n        for (var i = 0; i < sources.length; i++) {\n          if ($.isArray(sources[i].events)) {\n            sources[i].events = $.grep(sources[i].events, filter, true);\n          }\n        }\n      }\n      reportEvents(cache);\n    }\n    function clientEvents(filter) {\n      if ($.isFunction(filter)) {\n        return $.grep(cache, filter);\n      } else if (filter) {\n        // an event ID\n        filter += '';\n        return $.grep(cache, function (e) {\n          return e._id == filter;\n        });\n      }\n      return cache; // else, return all\n    }\n\n    /* Loading State\n    -----------------------------------------------------------------------------*/\n\n    function pushLoading() {\n      if (!loadingLevel++) {\n        trigger('loading', null, true, getView());\n      }\n    }\n    function popLoading() {\n      if (! --loadingLevel) {\n        trigger('loading', null, false, getView());\n      }\n    }\n\n    /* Event Normalization\n    -----------------------------------------------------------------------------*/\n\n    function normalizeEvent(event) {\n      var source = event.source || {};\n      var ignoreTimezone = firstDefined(source.ignoreTimezone, options.ignoreTimezone);\n      event._id = event._id || (event.id === undefined ? '_fc' + eventGUID++ : event.id + '');\n      if (event.date) {\n        if (!event.start) {\n          event.start = event.date;\n        }\n        delete event.date;\n      }\n      event._start = cloneDate(event.start = parseDate(event.start, ignoreTimezone));\n      event.end = parseDate(event.end, ignoreTimezone);\n      if (event.end && event.end <= event.start) {\n        event.end = null;\n      }\n      event._end = event.end ? cloneDate(event.end) : null;\n      if (event.allDay === undefined) {\n        event.allDay = firstDefined(source.allDayDefault, options.allDayDefault);\n      }\n      if (event.className) {\n        if (typeof event.className == 'string') {\n          event.className = event.className.split(/\\s+/);\n        }\n      } else {\n        event.className = [];\n      }\n      // TODO: if there is no start date, return false to indicate an invalid event\n    }\n\n    /* Utils\n    ------------------------------------------------------------------------------*/\n\n    function normalizeSource(source) {\n      if (source.className) {\n        // TODO: repeat code, same code for event classNames\n        if (typeof source.className == 'string') {\n          source.className = source.className.split(/\\s+/);\n        }\n      } else {\n        source.className = [];\n      }\n      var normalizers = fc.sourceNormalizers;\n      for (var i = 0; i < normalizers.length; i++) {\n        normalizers[i](source);\n      }\n    }\n    function isSourcesEqual(source1, source2) {\n      return source1 && source2 && getSourcePrimitive(source1) == getSourcePrimitive(source2);\n    }\n    function getSourcePrimitive(source) {\n      return (typeof source == 'object' ? source.events || source.url : '') || source;\n    }\n  }\n  ;\n  ;\n  fc.addDays = addDays;\n  fc.cloneDate = cloneDate;\n  fc.parseDate = parseDate;\n  fc.parseISO8601 = parseISO8601;\n  fc.parseTime = parseTime;\n  fc.formatDate = formatDate;\n  fc.formatDates = formatDates;\n\n  /* Date Math\n  -----------------------------------------------------------------------------*/\n\n  var dayIDs = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'],\n    DAY_MS = 86400000,\n    HOUR_MS = 3600000,\n    MINUTE_MS = 60000;\n  function addYears(d, n, keepTime) {\n    d.setFullYear(d.getFullYear() + n);\n    if (!keepTime) {\n      clearTime(d);\n    }\n    return d;\n  }\n  function addMonths(d, n, keepTime) {\n    // prevents day overflow/underflow\n    if (+d) {\n      // prevent infinite looping on invalid dates\n      var m = d.getMonth() + n,\n        check = cloneDate(d);\n      check.setDate(1);\n      check.setMonth(m);\n      d.setMonth(m);\n      if (!keepTime) {\n        clearTime(d);\n      }\n      while (d.getMonth() != check.getMonth()) {\n        d.setDate(d.getDate() + (d < check ? 1 : -1));\n      }\n    }\n    return d;\n  }\n  function addDays(d, n, keepTime) {\n    // deals with daylight savings\n    if (+d) {\n      var dd = d.getDate() + n,\n        check = cloneDate(d);\n      check.setHours(9); // set to middle of day\n      check.setDate(dd);\n      d.setDate(dd);\n      if (!keepTime) {\n        clearTime(d);\n      }\n      fixDate(d, check);\n    }\n    return d;\n  }\n  function fixDate(d, check) {\n    // force d to be on check's YMD, for daylight savings purposes\n    if (+d) {\n      // prevent infinite looping on invalid dates\n      while (d.getDate() != check.getDate()) {\n        d.setTime(+d + (d < check ? 1 : -1) * HOUR_MS);\n      }\n    }\n  }\n  function addMinutes(d, n) {\n    d.setMinutes(d.getMinutes() + n);\n    return d;\n  }\n  function clearTime(d) {\n    d.setHours(0);\n    d.setMinutes(0);\n    d.setSeconds(0);\n    d.setMilliseconds(0);\n    return d;\n  }\n  function cloneDate(d, dontKeepTime) {\n    if (dontKeepTime) {\n      return clearTime(new Date(+d));\n    }\n    return new Date(+d);\n  }\n  function zeroDate() {\n    // returns a Date with time 00:00:00 and dateOfMonth=1\n    var i = 0,\n      d;\n    do {\n      d = new Date(1970, i++, 1);\n    } while (d.getHours()); // != 0\n    return d;\n  }\n  function dayDiff(d1, d2) {\n    // d1 - d2\n    return Math.round((cloneDate(d1, true) - cloneDate(d2, true)) / DAY_MS);\n  }\n  function setYMD(date, y, m, d) {\n    if (y !== undefined && y != date.getFullYear()) {\n      date.setDate(1);\n      date.setMonth(0);\n      date.setFullYear(y);\n    }\n    if (m !== undefined && m != date.getMonth()) {\n      date.setDate(1);\n      date.setMonth(m);\n    }\n    if (d !== undefined) {\n      date.setDate(d);\n    }\n  }\n\n  /* Date Parsing\n  -----------------------------------------------------------------------------*/\n\n  function parseDate(s, ignoreTimezone) {\n    // ignoreTimezone defaults to true\n    if (typeof s == 'object') {\n      // already a Date object\n      return s;\n    }\n    if (typeof s == 'number') {\n      // a UNIX timestamp\n      return new Date(s * 1000);\n    }\n    if (typeof s == 'string') {\n      if (s.match(/^\\d+(\\.\\d+)?$/)) {\n        // a UNIX timestamp\n        return new Date(parseFloat(s) * 1000);\n      }\n      if (ignoreTimezone === undefined) {\n        ignoreTimezone = true;\n      }\n      return parseISO8601(s, ignoreTimezone) || (s ? new Date(s) : null);\n    }\n    // TODO: never return invalid dates (like from new Date(<string>)), return null instead\n    return null;\n  }\n  function parseISO8601(s, ignoreTimezone) {\n    // ignoreTimezone defaults to false\n    // derived from http://delete.me.uk/2005/03/iso8601.html\n    // TODO: for a know glitch/feature, read tests/issue_206_parseDate_dst.html\n    var m = s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);\n    if (!m) {\n      return null;\n    }\n    var date = new Date(m[1], 0, 1);\n    if (ignoreTimezone || !m[13]) {\n      var check = new Date(m[1], 0, 1, 9, 0);\n      if (m[3]) {\n        date.setMonth(m[3] - 1);\n        check.setMonth(m[3] - 1);\n      }\n      if (m[5]) {\n        date.setDate(m[5]);\n        check.setDate(m[5]);\n      }\n      fixDate(date, check);\n      if (m[7]) {\n        date.setHours(m[7]);\n      }\n      if (m[8]) {\n        date.setMinutes(m[8]);\n      }\n      if (m[10]) {\n        date.setSeconds(m[10]);\n      }\n      if (m[12]) {\n        date.setMilliseconds(Number(\"0.\" + m[12]) * 1000);\n      }\n      fixDate(date, check);\n    } else {\n      date.setUTCFullYear(m[1], m[3] ? m[3] - 1 : 0, m[5] || 1);\n      date.setUTCHours(m[7] || 0, m[8] || 0, m[10] || 0, m[12] ? Number(\"0.\" + m[12]) * 1000 : 0);\n      if (m[14]) {\n        var offset = Number(m[16]) * 60 + (m[18] ? Number(m[18]) : 0);\n        offset *= m[15] == '-' ? 1 : -1;\n        date = new Date(+date + offset * 60 * 1000);\n      }\n    }\n    return date;\n  }\n  function parseTime(s) {\n    // returns minutes since start of day\n    if (typeof s == 'number') {\n      // an hour\n      return s * 60;\n    }\n    if (typeof s == 'object') {\n      // a Date object\n      return s.getHours() * 60 + s.getMinutes();\n    }\n    var m = s.match(/(\\d+)(?::(\\d+))?\\s*(\\w+)?/);\n    if (m) {\n      var h = parseInt(m[1], 10);\n      if (m[3]) {\n        h %= 12;\n        if (m[3].toLowerCase().charAt(0) == 'p') {\n          h += 12;\n        }\n      }\n      return h * 60 + (m[2] ? parseInt(m[2], 10) : 0);\n    }\n  }\n\n  /* Date Formatting\n  -----------------------------------------------------------------------------*/\n  // TODO: use same function formatDate(date, [date2], format, [options])\n\n  function formatDate(date, format, options) {\n    return formatDates(date, null, format, options);\n  }\n  function formatDates(date1, date2, format, options) {\n    options = options || defaults;\n    var date = date1,\n      otherDate = date2,\n      i,\n      len = format.length,\n      c,\n      i2,\n      formatter,\n      res = '';\n    for (i = 0; i < len; i++) {\n      c = format.charAt(i);\n      if (c == \"'\") {\n        for (i2 = i + 1; i2 < len; i2++) {\n          if (format.charAt(i2) == \"'\") {\n            if (date) {\n              if (i2 == i + 1) {\n                res += \"'\";\n              } else {\n                res += format.substring(i + 1, i2);\n              }\n              i = i2;\n            }\n            break;\n          }\n        }\n      } else if (c == '(') {\n        for (i2 = i + 1; i2 < len; i2++) {\n          if (format.charAt(i2) == ')') {\n            var subres = formatDate(date, format.substring(i + 1, i2), options);\n            if (parseInt(subres.replace(/\\D/, ''), 10)) {\n              res += subres;\n            }\n            i = i2;\n            break;\n          }\n        }\n      } else if (c == '[') {\n        for (i2 = i + 1; i2 < len; i2++) {\n          if (format.charAt(i2) == ']') {\n            var subformat = format.substring(i + 1, i2);\n            var subres = formatDate(date, subformat, options);\n            if (subres != formatDate(otherDate, subformat, options)) {\n              res += subres;\n            }\n            i = i2;\n            break;\n          }\n        }\n      } else if (c == '{') {\n        date = date2;\n        otherDate = date1;\n      } else if (c == '}') {\n        date = date1;\n        otherDate = date2;\n      } else {\n        for (i2 = len; i2 > i; i2--) {\n          if (formatter = dateFormatters[format.substring(i, i2)]) {\n            if (date) {\n              res += formatter(date, options);\n            }\n            i = i2 - 1;\n            break;\n          }\n        }\n        if (i2 == i) {\n          if (date) {\n            res += c;\n          }\n        }\n      }\n    }\n    return res;\n  }\n  ;\n  var dateFormatters = {\n    s: function (d) {\n      return d.getSeconds();\n    },\n    ss: function (d) {\n      return zeroPad(d.getSeconds());\n    },\n    m: function (d) {\n      return d.getMinutes();\n    },\n    mm: function (d) {\n      return zeroPad(d.getMinutes());\n    },\n    h: function (d) {\n      return d.getHours() % 12 || 12;\n    },\n    hh: function (d) {\n      return zeroPad(d.getHours() % 12 || 12);\n    },\n    H: function (d) {\n      return d.getHours();\n    },\n    HH: function (d) {\n      return zeroPad(d.getHours());\n    },\n    d: function (d) {\n      return d.getDate();\n    },\n    dd: function (d) {\n      return zeroPad(d.getDate());\n    },\n    ddd: function (d, o) {\n      return o.dayNamesShort[d.getDay()];\n    },\n    dddd: function (d, o) {\n      return o.dayNames[d.getDay()];\n    },\n    M: function (d) {\n      return d.getMonth() + 1;\n    },\n    MM: function (d) {\n      return zeroPad(d.getMonth() + 1);\n    },\n    MMM: function (d, o) {\n      return o.monthNamesShort[d.getMonth()];\n    },\n    MMMM: function (d, o) {\n      return o.monthNames[d.getMonth()];\n    },\n    yy: function (d) {\n      return (d.getFullYear() + '').substring(2);\n    },\n    yyyy: function (d) {\n      return d.getFullYear();\n    },\n    t: function (d) {\n      return d.getHours() < 12 ? 'a' : 'p';\n    },\n    tt: function (d) {\n      return d.getHours() < 12 ? 'am' : 'pm';\n    },\n    T: function (d) {\n      return d.getHours() < 12 ? 'A' : 'P';\n    },\n    TT: function (d) {\n      return d.getHours() < 12 ? 'AM' : 'PM';\n    },\n    u: function (d) {\n      return formatDate(d, \"yyyy-MM-dd'T'HH:mm:ss'Z'\");\n    },\n    S: function (d) {\n      var date = d.getDate();\n      if (date > 10 && date < 20) {\n        return 'th';\n      }\n      return ['st', 'nd', 'rd'][date % 10 - 1] || 'th';\n    },\n    w: function (d, o) {\n      // local\n      return o.weekNumberCalculation(d);\n    },\n    W: function (d) {\n      // ISO\n      return iso8601Week(d);\n    }\n  };\n  fc.dateFormatters = dateFormatters;\n\n  /* thanks jQuery UI (https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js)\n   * \n   * Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.\n   * `date` - the date to get the week for\n   * `number` - the number of the week within the year that contains this date\n   */\n  function iso8601Week(date) {\n    var time;\n    var checkDate = new Date(date.getTime());\n\n    // Find Thursday of this week starting on Monday\n    checkDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));\n    time = checkDate.getTime();\n    checkDate.setMonth(0); // Compare with Jan 1\n    checkDate.setDate(1);\n    return Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;\n  }\n  ;\n  ;\n  fc.applyAll = applyAll;\n\n  /* Event Date Math\n  -----------------------------------------------------------------------------*/\n\n  function exclEndDay(event) {\n    if (event.end) {\n      return _exclEndDay(event.end, event.allDay);\n    } else {\n      return addDays(cloneDate(event.start), 1);\n    }\n  }\n  function _exclEndDay(end, allDay) {\n    end = cloneDate(end);\n    return allDay || end.getHours() || end.getMinutes() ? addDays(end, 1) : clearTime(end);\n    // why don't we check for seconds/ms too?\n  }\n\n  /* Event Element Binding\n  -----------------------------------------------------------------------------*/\n\n  function lazySegBind(container, segs, bindHandlers) {\n    container.unbind('mouseover').mouseover(function (ev) {\n      var parent = ev.target,\n        e,\n        i,\n        seg;\n      while (parent != this) {\n        e = parent;\n        parent = parent.parentNode;\n      }\n      if ((i = e._fci) !== undefined) {\n        e._fci = undefined;\n        seg = segs[i];\n        bindHandlers(seg.event, seg.element, seg);\n        $(ev.target).trigger(ev);\n      }\n      ev.stopPropagation();\n    });\n  }\n\n  /* Element Dimensions\n  -----------------------------------------------------------------------------*/\n\n  function setOuterWidth(element, width, includeMargins) {\n    for (var i = 0, e; i < element.length; i++) {\n      e = $(element[i]);\n      e.width(Math.max(0, width - hsides(e, includeMargins)));\n    }\n  }\n  function setOuterHeight(element, height, includeMargins) {\n    for (var i = 0, e; i < element.length; i++) {\n      e = $(element[i]);\n      e.height(Math.max(0, height - vsides(e, includeMargins)));\n    }\n  }\n  function hsides(element, includeMargins) {\n    return hpadding(element) + hborders(element) + (includeMargins ? hmargins(element) : 0);\n  }\n  function hpadding(element) {\n    return (parseFloat($.css(element[0], 'paddingLeft', true)) || 0) + (parseFloat($.css(element[0], 'paddingRight', true)) || 0);\n  }\n  function hmargins(element) {\n    return (parseFloat($.css(element[0], 'marginLeft', true)) || 0) + (parseFloat($.css(element[0], 'marginRight', true)) || 0);\n  }\n  function hborders(element) {\n    return (parseFloat($.css(element[0], 'borderLeftWidth', true)) || 0) + (parseFloat($.css(element[0], 'borderRightWidth', true)) || 0);\n  }\n  function vsides(element, includeMargins) {\n    return vpadding(element) + vborders(element) + (includeMargins ? vmargins(element) : 0);\n  }\n  function vpadding(element) {\n    return (parseFloat($.css(element[0], 'paddingTop', true)) || 0) + (parseFloat($.css(element[0], 'paddingBottom', true)) || 0);\n  }\n  function vmargins(element) {\n    return (parseFloat($.css(element[0], 'marginTop', true)) || 0) + (parseFloat($.css(element[0], 'marginBottom', true)) || 0);\n  }\n  function vborders(element) {\n    return (parseFloat($.css(element[0], 'borderTopWidth', true)) || 0) + (parseFloat($.css(element[0], 'borderBottomWidth', true)) || 0);\n  }\n\n  /* Misc Utils\n  -----------------------------------------------------------------------------*/\n\n  //TODO: arraySlice\n  //TODO: isFunction, grep ?\n\n  function noop() {}\n  function dateCompare(a, b) {\n    return a - b;\n  }\n  function arrayMax(a) {\n    return Math.max.apply(Math, a);\n  }\n  function zeroPad(n) {\n    return (n < 10 ? '0' : '') + n;\n  }\n  function smartProperty(obj, name) {\n    // get a camel-cased/namespaced property of an object\n    if (obj[name] !== undefined) {\n      return obj[name];\n    }\n    var parts = name.split(/(?=[A-Z])/),\n      i = parts.length - 1,\n      res;\n    for (; i >= 0; i--) {\n      res = obj[parts[i].toLowerCase()];\n      if (res !== undefined) {\n        return res;\n      }\n    }\n    return obj[''];\n  }\n  function htmlEscape(s) {\n    return s.replace(/&/g, '&').replace(/</g, '<').replace(/>/g, '>').replace(/'/g, '\\'').replace(/\"/g, '\"').replace(/\\n/g, '<br />');\n  }\n  function disableTextSelection(element) {\n    element.attr('unselectable', 'on').css('MozUserSelect', 'none').bind('selectstart.ui', function () {\n      return false;\n    });\n  }\n\n  /*\n  function enableTextSelection(element) {\n  \telement\n  \t\t.attr('unselectable', 'off')\n  \t\t.css('MozUserSelect', '')\n  \t\t.unbind('selectstart.ui');\n  }\n  */\n\n  function markFirstLast(e) {\n    e.children().removeClass('fc-first fc-last').filter(':first-child').addClass('fc-first').end().filter(':last-child').addClass('fc-last');\n  }\n  function setDayID(cell, date) {\n    cell.each(function (i, _cell) {\n      _cell.className = _cell.className.replace(/^fc-\\w*/, 'fc-' + dayIDs[date.getDay()]);\n      // TODO: make a way that doesn't rely on order of classes\n    });\n  }\n\n  function getSkinCss(event, opt) {\n    var source = event.source || {};\n    var eventColor = event.color;\n    var sourceColor = source.color;\n    var optionColor = opt('eventColor');\n    var backgroundColor = event.backgroundColor || eventColor || source.backgroundColor || sourceColor || opt('eventBackgroundColor') || optionColor;\n    var borderColor = event.borderColor || eventColor || source.borderColor || sourceColor || opt('eventBorderColor') || optionColor;\n    var textColor = event.textColor || source.textColor || opt('eventTextColor');\n    var statements = [];\n    if (backgroundColor) {\n      statements.push('background-color:' + backgroundColor);\n    }\n    if (borderColor) {\n      statements.push('border-color:' + borderColor);\n    }\n    if (textColor) {\n      statements.push('color:' + textColor);\n    }\n    return statements.join(';');\n  }\n  function applyAll(functions, thisObj, args) {\n    if ($.isFunction(functions)) {\n      functions = [functions];\n    }\n    if (functions) {\n      var i;\n      var ret;\n      for (i = 0; i < functions.length; i++) {\n        ret = functions[i].apply(thisObj, args) || ret;\n      }\n      return ret;\n    }\n  }\n  function firstDefined() {\n    for (var i = 0; i < arguments.length; i++) {\n      if (arguments[i] !== undefined) {\n        return arguments[i];\n      }\n    }\n  }\n  ;\n  ;\n  fcViews.month = MonthView;\n  function MonthView(element, calendar) {\n    var t = this;\n\n    // exports\n    t.render = render;\n\n    // imports\n    BasicView.call(t, element, calendar, 'month');\n    var opt = t.opt;\n    var renderBasic = t.renderBasic;\n    var skipHiddenDays = t.skipHiddenDays;\n    var getCellsPerWeek = t.getCellsPerWeek;\n    var formatDate = calendar.formatDate;\n    function render(date, delta) {\n      if (delta) {\n        addMonths(date, delta);\n        date.setDate(1);\n      }\n      var firstDay = opt('firstDay');\n      var start = cloneDate(date, true);\n      start.setDate(1);\n      var end = addMonths(cloneDate(start), 1);\n      var visStart = cloneDate(start);\n      addDays(visStart, -((visStart.getDay() - firstDay + 7) % 7));\n      skipHiddenDays(visStart);\n      var visEnd = cloneDate(end);\n      addDays(visEnd, (7 - visEnd.getDay() + firstDay) % 7);\n      skipHiddenDays(visEnd, -1, true);\n      var colCnt = getCellsPerWeek();\n      var rowCnt = Math.round(dayDiff(visEnd, visStart) / 7); // should be no need for Math.round\n\n      if (opt('weekMode') == 'fixed') {\n        addDays(visEnd, (6 - rowCnt) * 7); // add weeks to make up for it\n        rowCnt = 6;\n      }\n      t.title = formatDate(start, opt('titleFormat'));\n      t.start = start;\n      t.end = end;\n      t.visStart = visStart;\n      t.visEnd = visEnd;\n      renderBasic(rowCnt, colCnt, true);\n    }\n  }\n  ;\n  ;\n  fcViews.basicWeek = BasicWeekView;\n  function BasicWeekView(element, calendar) {\n    var t = this;\n\n    // exports\n    t.render = render;\n\n    // imports\n    BasicView.call(t, element, calendar, 'basicWeek');\n    var opt = t.opt;\n    var renderBasic = t.renderBasic;\n    var skipHiddenDays = t.skipHiddenDays;\n    var getCellsPerWeek = t.getCellsPerWeek;\n    var formatDates = calendar.formatDates;\n    function render(date, delta) {\n      if (delta) {\n        addDays(date, delta * 7);\n      }\n      var start = addDays(cloneDate(date), -((date.getDay() - opt('firstDay') + 7) % 7));\n      var end = addDays(cloneDate(start), 7);\n      var visStart = cloneDate(start);\n      skipHiddenDays(visStart);\n      var visEnd = cloneDate(end);\n      skipHiddenDays(visEnd, -1, true);\n      var colCnt = getCellsPerWeek();\n      t.start = start;\n      t.end = end;\n      t.visStart = visStart;\n      t.visEnd = visEnd;\n      t.title = formatDates(visStart, addDays(cloneDate(visEnd), -1), opt('titleFormat'));\n      renderBasic(1, colCnt, false);\n    }\n  }\n  ;\n  ;\n  fcViews.basicDay = BasicDayView;\n  function BasicDayView(element, calendar) {\n    var t = this;\n\n    // exports\n    t.render = render;\n\n    // imports\n    BasicView.call(t, element, calendar, 'basicDay');\n    var opt = t.opt;\n    var renderBasic = t.renderBasic;\n    var skipHiddenDays = t.skipHiddenDays;\n    var formatDate = calendar.formatDate;\n    function render(date, delta) {\n      if (delta) {\n        addDays(date, delta);\n      }\n      skipHiddenDays(date, delta < 0 ? -1 : 1);\n      var start = cloneDate(date, true);\n      var end = addDays(cloneDate(start), 1);\n      t.title = formatDate(date, opt('titleFormat'));\n      t.start = t.visStart = start;\n      t.end = t.visEnd = end;\n      renderBasic(1, 1, false);\n    }\n  }\n  ;\n  ;\n  setDefaults({\n    weekMode: 'fixed'\n  });\n  function BasicView(element, calendar, viewName) {\n    var t = this;\n\n    // exports\n    t.renderBasic = renderBasic;\n    t.setHeight = setHeight;\n    t.setWidth = setWidth;\n    t.renderDayOverlay = renderDayOverlay;\n    t.defaultSelectionEnd = defaultSelectionEnd;\n    t.renderSelection = renderSelection;\n    t.clearSelection = clearSelection;\n    t.reportDayClick = reportDayClick; // for selection (kinda hacky)\n    t.dragStart = dragStart;\n    t.dragStop = dragStop;\n    t.defaultEventEnd = defaultEventEnd;\n    t.getHoverListener = function () {\n      return hoverListener;\n    };\n    t.colLeft = colLeft;\n    t.colRight = colRight;\n    t.colContentLeft = colContentLeft;\n    t.colContentRight = colContentRight;\n    t.getIsCellAllDay = function () {\n      return true;\n    };\n    t.allDayRow = allDayRow;\n    t.getRowCnt = function () {\n      return rowCnt;\n    };\n    t.getColCnt = function () {\n      return colCnt;\n    };\n    t.getColWidth = function () {\n      return colWidth;\n    };\n    t.getDaySegmentContainer = function () {\n      return daySegmentContainer;\n    };\n\n    // imports\n    View.call(t, element, calendar, viewName);\n    OverlayManager.call(t);\n    SelectionManager.call(t);\n    BasicEventRenderer.call(t);\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var renderOverlay = t.renderOverlay;\n    var clearOverlays = t.clearOverlays;\n    var daySelectionMousedown = t.daySelectionMousedown;\n    var cellToDate = t.cellToDate;\n    var dateToCell = t.dateToCell;\n    var rangeToSegments = t.rangeToSegments;\n    var formatDate = calendar.formatDate;\n\n    // locals\n\n    var table;\n    var head;\n    var headCells;\n    var body;\n    var bodyRows;\n    var bodyCells;\n    var bodyFirstCells;\n    var firstRowCellInners;\n    var firstRowCellContentInners;\n    var daySegmentContainer;\n    var viewWidth;\n    var viewHeight;\n    var colWidth;\n    var weekNumberWidth;\n    var rowCnt, colCnt;\n    var showNumbers;\n    var coordinateGrid;\n    var hoverListener;\n    var colPositions;\n    var colContentPositions;\n    var tm;\n    var colFormat;\n    var showWeekNumbers;\n    var weekNumberTitle;\n    var weekNumberFormat;\n\n    /* Rendering\n    ------------------------------------------------------------*/\n\n    disableTextSelection(element.addClass('fc-grid'));\n    function renderBasic(_rowCnt, _colCnt, _showNumbers) {\n      rowCnt = _rowCnt;\n      colCnt = _colCnt;\n      showNumbers = _showNumbers;\n      updateOptions();\n      if (!body) {\n        buildEventContainer();\n      }\n      buildTable();\n    }\n    function updateOptions() {\n      tm = opt('theme') ? 'ui' : 'fc';\n      colFormat = opt('columnFormat');\n\n      // week # options. (TODO: bad, logic also in other views)\n      showWeekNumbers = opt('weekNumbers');\n      weekNumberTitle = opt('weekNumberTitle');\n      if (opt('weekNumberCalculation') != 'iso') {\n        weekNumberFormat = \"w\";\n      } else {\n        weekNumberFormat = \"W\";\n      }\n    }\n    function buildEventContainer() {\n      daySegmentContainer = $(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\").appendTo(element);\n    }\n    function buildTable() {\n      var html = buildTableHTML();\n      if (table) {\n        table.remove();\n      }\n      table = $(html).appendTo(element);\n      head = table.find('thead');\n      headCells = head.find('.fc-day-header');\n      body = table.find('tbody');\n      bodyRows = body.find('tr');\n      bodyCells = body.find('.fc-day');\n      bodyFirstCells = bodyRows.find('td:first-child');\n      firstRowCellInners = bodyRows.eq(0).find('.fc-day > div');\n      firstRowCellContentInners = bodyRows.eq(0).find('.fc-day-content > div');\n      markFirstLast(head.add(head.find('tr'))); // marks first+last tr/th's\n      markFirstLast(bodyRows); // marks first+last td's\n      bodyRows.eq(0).addClass('fc-first');\n      bodyRows.filter(':last').addClass('fc-last');\n      bodyCells.each(function (i, _cell) {\n        var date = cellToDate(Math.floor(i / colCnt), i % colCnt);\n        trigger('dayRender', t, date, $(_cell));\n      });\n      dayBind(bodyCells);\n    }\n\n    /* HTML Building\n    -----------------------------------------------------------*/\n\n    function buildTableHTML() {\n      var html = \"<table class='fc-border-separate' style='width:100%' cellspacing='0'>\" + buildHeadHTML() + buildBodyHTML() + \"</table>\";\n      return html;\n    }\n    function buildHeadHTML() {\n      var headerClass = tm + \"-widget-header\";\n      var html = '';\n      var col;\n      var date;\n      html += \"<thead><tr>\";\n      if (showWeekNumbers) {\n        html += \"<th class='fc-week-number \" + headerClass + \"'>\" + htmlEscape(weekNumberTitle) + \"</th>\";\n      }\n      for (col = 0; col < colCnt; col++) {\n        date = cellToDate(0, col);\n        html += \"<th class='fc-day-header fc-\" + dayIDs[date.getDay()] + \" \" + headerClass + \"'>\" + htmlEscape(formatDate(date, colFormat)) + \"</th>\";\n      }\n      html += \"</tr></thead>\";\n      return html;\n    }\n    function buildBodyHTML() {\n      var contentClass = tm + \"-widget-content\";\n      var html = '';\n      var row;\n      var col;\n      var date;\n      html += \"<tbody>\";\n      for (row = 0; row < rowCnt; row++) {\n        html += \"<tr class='fc-week'>\";\n        if (showWeekNumbers) {\n          date = cellToDate(row, 0);\n          html += \"<td class='fc-week-number \" + contentClass + \"'>\" + \"<div>\" + htmlEscape(formatDate(date, weekNumberFormat)) + \"</div>\" + \"</td>\";\n        }\n        for (col = 0; col < colCnt; col++) {\n          date = cellToDate(row, col);\n          html += buildCellHTML(date);\n        }\n        html += \"</tr>\";\n      }\n      html += \"</tbody>\";\n      return html;\n    }\n    function buildCellHTML(date) {\n      var contentClass = tm + \"-widget-content\";\n      var month = t.start.getMonth();\n      var today = clearTime(new Date());\n      var html = '';\n      var classNames = ['fc-day', 'fc-' + dayIDs[date.getDay()], contentClass];\n      if (date.getMonth() != month) {\n        classNames.push('fc-other-month');\n      }\n      if (+date == +today) {\n        classNames.push('fc-today', tm + '-state-highlight');\n      } else if (date < today) {\n        classNames.push('fc-past');\n      } else {\n        classNames.push('fc-future');\n      }\n      html += \"<td\" + \" class='\" + classNames.join(' ') + \"'\" + \" data-date='\" + formatDate(date, 'yyyy-MM-dd') + \"'\" + \">\" + \"<div>\";\n      if (showNumbers) {\n        html += \"<div class='fc-day-number'>\" + date.getDate() + \"</div>\";\n      }\n      html += \"<div class='fc-day-content'>\" + \"<div style='position:relative'> </div>\" + \"</div>\" + \"</div>\" + \"</td>\";\n      return html;\n    }\n\n    /* Dimensions\n    -----------------------------------------------------------*/\n\n    function setHeight(height) {\n      viewHeight = height;\n      var bodyHeight = viewHeight - head.height();\n      var rowHeight;\n      var rowHeightLast;\n      var cell;\n      if (opt('weekMode') == 'variable') {\n        rowHeight = rowHeightLast = Math.floor(bodyHeight / (rowCnt == 1 ? 2 : 6));\n      } else {\n        rowHeight = Math.floor(bodyHeight / rowCnt);\n        rowHeightLast = bodyHeight - rowHeight * (rowCnt - 1);\n      }\n      bodyFirstCells.each(function (i, _cell) {\n        if (i < rowCnt) {\n          cell = $(_cell);\n          cell.find('> div').css('min-height', (i == rowCnt - 1 ? rowHeightLast : rowHeight) - vsides(cell));\n        }\n      });\n    }\n    function setWidth(width) {\n      viewWidth = width;\n      colPositions.clear();\n      colContentPositions.clear();\n      weekNumberWidth = 0;\n      if (showWeekNumbers) {\n        weekNumberWidth = head.find('th.fc-week-number').outerWidth();\n      }\n      colWidth = Math.floor((viewWidth - weekNumberWidth) / colCnt);\n      setOuterWidth(headCells.slice(0, -1), colWidth);\n    }\n\n    /* Day clicking and binding\n    -----------------------------------------------------------*/\n\n    function dayBind(days) {\n      days.click(dayClick).mousedown(daySelectionMousedown);\n    }\n    function dayClick(ev) {\n      if (!opt('selectable')) {\n        // if selectable, SelectionManager will worry about dayClick\n        var date = parseISO8601($(this).data('date'));\n        trigger('dayClick', this, date, true, ev);\n      }\n    }\n\n    /* Semi-transparent Overlay Helpers\n    ------------------------------------------------------*/\n    // TODO: should be consolidated with AgendaView's methods\n\n    function renderDayOverlay(overlayStart, overlayEnd, refreshCoordinateGrid) {\n      // overlayEnd is exclusive\n\n      if (refreshCoordinateGrid) {\n        coordinateGrid.build();\n      }\n      var segments = rangeToSegments(overlayStart, overlayEnd);\n      for (var i = 0; i < segments.length; i++) {\n        var segment = segments[i];\n        dayBind(renderCellOverlay(segment.row, segment.leftCol, segment.row, segment.rightCol));\n      }\n    }\n    function renderCellOverlay(row0, col0, row1, col1) {\n      // row1,col1 is inclusive\n      var rect = coordinateGrid.rect(row0, col0, row1, col1, element);\n      return renderOverlay(rect, element);\n    }\n\n    /* Selection\n    -----------------------------------------------------------------------*/\n\n    function defaultSelectionEnd(startDate, allDay) {\n      return cloneDate(startDate);\n    }\n    function renderSelection(startDate, endDate, allDay) {\n      renderDayOverlay(startDate, addDays(cloneDate(endDate), 1), true); // rebuild every time???\n    }\n\n    function clearSelection() {\n      clearOverlays();\n    }\n    function reportDayClick(date, allDay, ev) {\n      var cell = dateToCell(date);\n      var _element = bodyCells[cell.row * colCnt + cell.col];\n      trigger('dayClick', _element, date, allDay, ev);\n    }\n\n    /* External Dragging\n    -----------------------------------------------------------------------*/\n\n    function dragStart(_dragElement, ev, ui) {\n      hoverListener.start(function (cell) {\n        clearOverlays();\n        if (cell) {\n          renderCellOverlay(cell.row, cell.col, cell.row, cell.col);\n        }\n      }, ev);\n    }\n    function dragStop(_dragElement, ev, ui) {\n      var cell = hoverListener.stop();\n      clearOverlays();\n      if (cell) {\n        var d = cellToDate(cell);\n        trigger('drop', _dragElement, d, true, ev, ui);\n      }\n    }\n\n    /* Utilities\n    --------------------------------------------------------*/\n\n    function defaultEventEnd(event) {\n      return cloneDate(event.start);\n    }\n    coordinateGrid = new CoordinateGrid(function (rows, cols) {\n      var e, n, p;\n      headCells.each(function (i, _e) {\n        e = $(_e);\n        n = e.offset().left;\n        if (i) {\n          p[1] = n;\n        }\n        p = [n];\n        cols[i] = p;\n      });\n      p[1] = n + e.outerWidth();\n      bodyRows.each(function (i, _e) {\n        if (i < rowCnt) {\n          e = $(_e);\n          n = e.offset().top;\n          if (i) {\n            p[1] = n;\n          }\n          p = [n];\n          rows[i] = p;\n        }\n      });\n      p[1] = n + e.outerHeight();\n    });\n    hoverListener = new HoverListener(coordinateGrid);\n    colPositions = new HorizontalPositionCache(function (col) {\n      return firstRowCellInners.eq(col);\n    });\n    colContentPositions = new HorizontalPositionCache(function (col) {\n      return firstRowCellContentInners.eq(col);\n    });\n    function colLeft(col) {\n      return colPositions.left(col);\n    }\n    function colRight(col) {\n      return colPositions.right(col);\n    }\n    function colContentLeft(col) {\n      return colContentPositions.left(col);\n    }\n    function colContentRight(col) {\n      return colContentPositions.right(col);\n    }\n    function allDayRow(i) {\n      return bodyRows.eq(i);\n    }\n  }\n  ;\n  ;\n  function BasicEventRenderer() {\n    var t = this;\n\n    // exports\n    t.renderEvents = renderEvents;\n    t.clearEvents = clearEvents;\n\n    // imports\n    DayEventRenderer.call(t);\n    function renderEvents(events, modifiedEventId) {\n      t.renderDayEvents(events, modifiedEventId);\n    }\n    function clearEvents() {\n      t.getDaySegmentContainer().empty();\n    }\n\n    // TODO: have this class (and AgendaEventRenderer) be responsible for creating the event container div\n  }\n\n  ;\n  ;\n  fcViews.agendaWeek = AgendaWeekView;\n  function AgendaWeekView(element, calendar) {\n    var t = this;\n\n    // exports\n    t.render = render;\n\n    // imports\n    AgendaView.call(t, element, calendar, 'agendaWeek');\n    var opt = t.opt;\n    var renderAgenda = t.renderAgenda;\n    var skipHiddenDays = t.skipHiddenDays;\n    var getCellsPerWeek = t.getCellsPerWeek;\n    var formatDates = calendar.formatDates;\n    function render(date, delta) {\n      if (delta) {\n        addDays(date, delta * 7);\n      }\n      var start = addDays(cloneDate(date), -((date.getDay() - opt('firstDay') + 7) % 7));\n      var end = addDays(cloneDate(start), 7);\n      var visStart = cloneDate(start);\n      skipHiddenDays(visStart);\n      var visEnd = cloneDate(end);\n      skipHiddenDays(visEnd, -1, true);\n      var colCnt = getCellsPerWeek();\n      t.title = formatDates(visStart, addDays(cloneDate(visEnd), -1), opt('titleFormat'));\n      t.start = start;\n      t.end = end;\n      t.visStart = visStart;\n      t.visEnd = visEnd;\n      renderAgenda(colCnt);\n    }\n  }\n  ;\n  ;\n  fcViews.agendaDay = AgendaDayView;\n  function AgendaDayView(element, calendar) {\n    var t = this;\n\n    // exports\n    t.render = render;\n\n    // imports\n    AgendaView.call(t, element, calendar, 'agendaDay');\n    var opt = t.opt;\n    var renderAgenda = t.renderAgenda;\n    var skipHiddenDays = t.skipHiddenDays;\n    var formatDate = calendar.formatDate;\n    function render(date, delta) {\n      if (delta) {\n        addDays(date, delta);\n      }\n      skipHiddenDays(date, delta < 0 ? -1 : 1);\n      var start = cloneDate(date, true);\n      var end = addDays(cloneDate(start), 1);\n      t.title = formatDate(date, opt('titleFormat'));\n      t.start = t.visStart = start;\n      t.end = t.visEnd = end;\n      renderAgenda(1);\n    }\n  }\n  ;\n  ;\n  setDefaults({\n    allDaySlot: true,\n    allDayText: 'all-day',\n    firstHour: 6,\n    slotMinutes: 30,\n    defaultEventMinutes: 120,\n    axisFormat: 'h(:mm)tt',\n    timeFormat: {\n      agenda: 'h:mm{ - h:mm}'\n    },\n    dragOpacity: {\n      agenda: .5\n    },\n    minTime: 0,\n    maxTime: 24,\n    slotEventOverlap: true\n  });\n\n  // TODO: make it work in quirks mode (event corners, all-day height)\n  // TODO: test liquid width, especially in IE6\n\n  function AgendaView(element, calendar, viewName) {\n    var t = this;\n\n    // exports\n    t.renderAgenda = renderAgenda;\n    t.setWidth = setWidth;\n    t.setHeight = setHeight;\n    t.afterRender = afterRender;\n    t.defaultEventEnd = defaultEventEnd;\n    t.timePosition = timePosition;\n    t.getIsCellAllDay = getIsCellAllDay;\n    t.allDayRow = getAllDayRow;\n    t.getCoordinateGrid = function () {\n      return coordinateGrid;\n    }; // specifically for AgendaEventRenderer\n    t.getHoverListener = function () {\n      return hoverListener;\n    };\n    t.colLeft = colLeft;\n    t.colRight = colRight;\n    t.colContentLeft = colContentLeft;\n    t.colContentRight = colContentRight;\n    t.getDaySegmentContainer = function () {\n      return daySegmentContainer;\n    };\n    t.getSlotSegmentContainer = function () {\n      return slotSegmentContainer;\n    };\n    t.getMinMinute = function () {\n      return minMinute;\n    };\n    t.getMaxMinute = function () {\n      return maxMinute;\n    };\n    t.getSlotContainer = function () {\n      return slotContainer;\n    };\n    t.getRowCnt = function () {\n      return 1;\n    };\n    t.getColCnt = function () {\n      return colCnt;\n    };\n    t.getColWidth = function () {\n      return colWidth;\n    };\n    t.getSnapHeight = function () {\n      return snapHeight;\n    };\n    t.getSnapMinutes = function () {\n      return snapMinutes;\n    };\n    t.defaultSelectionEnd = defaultSelectionEnd;\n    t.renderDayOverlay = renderDayOverlay;\n    t.renderSelection = renderSelection;\n    t.clearSelection = clearSelection;\n    t.reportDayClick = reportDayClick; // selection mousedown hack\n    t.dragStart = dragStart;\n    t.dragStop = dragStop;\n\n    // imports\n    View.call(t, element, calendar, viewName);\n    OverlayManager.call(t);\n    SelectionManager.call(t);\n    AgendaEventRenderer.call(t);\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var renderOverlay = t.renderOverlay;\n    var clearOverlays = t.clearOverlays;\n    var reportSelection = t.reportSelection;\n    var unselect = t.unselect;\n    var daySelectionMousedown = t.daySelectionMousedown;\n    var slotSegHtml = t.slotSegHtml;\n    var cellToDate = t.cellToDate;\n    var dateToCell = t.dateToCell;\n    var rangeToSegments = t.rangeToSegments;\n    var formatDate = calendar.formatDate;\n\n    // locals\n\n    var dayTable;\n    var dayHead;\n    var dayHeadCells;\n    var dayBody;\n    var dayBodyCells;\n    var dayBodyCellInners;\n    var dayBodyCellContentInners;\n    var dayBodyFirstCell;\n    var dayBodyFirstCellStretcher;\n    var slotLayer;\n    var daySegmentContainer;\n    var allDayTable;\n    var allDayRow;\n    var slotScroller;\n    var slotContainer;\n    var slotSegmentContainer;\n    var slotTable;\n    var selectionHelper;\n    var viewWidth;\n    var viewHeight;\n    var axisWidth;\n    var colWidth;\n    var gutterWidth;\n    var slotHeight; // TODO: what if slotHeight changes? (see issue 650)\n\n    var snapMinutes;\n    var snapRatio; // ratio of number of \"selection\" slots to normal slots. (ex: 1, 2, 4)\n    var snapHeight; // holds the pixel hight of a \"selection\" slot\n\n    var colCnt;\n    var slotCnt;\n    var coordinateGrid;\n    var hoverListener;\n    var colPositions;\n    var colContentPositions;\n    var slotTopCache = {};\n    var tm;\n    var rtl;\n    var minMinute, maxMinute;\n    var colFormat;\n    var showWeekNumbers;\n    var weekNumberTitle;\n    var weekNumberFormat;\n\n    /* Rendering\n    -----------------------------------------------------------------------------*/\n\n    disableTextSelection(element.addClass('fc-agenda'));\n    function renderAgenda(c) {\n      colCnt = c;\n      updateOptions();\n      if (!dayTable) {\n        // first time rendering?\n        buildSkeleton(); // builds day table, slot area, events containers\n      } else {\n        buildDayTable(); // rebuilds day table\n      }\n    }\n\n    function updateOptions() {\n      tm = opt('theme') ? 'ui' : 'fc';\n      rtl = opt('isRTL');\n      minMinute = parseTime(opt('minTime'));\n      maxMinute = parseTime(opt('maxTime'));\n      colFormat = opt('columnFormat');\n\n      // week # options. (TODO: bad, logic also in other views)\n      showWeekNumbers = opt('weekNumbers');\n      weekNumberTitle = opt('weekNumberTitle');\n      if (opt('weekNumberCalculation') != 'iso') {\n        weekNumberFormat = \"w\";\n      } else {\n        weekNumberFormat = \"W\";\n      }\n      snapMinutes = opt('snapMinutes') || opt('slotMinutes');\n    }\n\n    /* Build DOM\n    -----------------------------------------------------------------------*/\n\n    function buildSkeleton() {\n      var headerClass = tm + \"-widget-header\";\n      var contentClass = tm + \"-widget-content\";\n      var s;\n      var d;\n      var i;\n      var maxd;\n      var minutes;\n      var slotNormal = opt('slotMinutes') % 15 == 0;\n      buildDayTable();\n      slotLayer = $(\"<div style='position:absolute;z-index:2;left:0;width:100%'/>\").appendTo(element);\n      if (opt('allDaySlot')) {\n        daySegmentContainer = $(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\").appendTo(slotLayer);\n        s = \"<table style='width:100%' class='fc-agenda-allday' cellspacing='0'>\" + \"<tr>\" + \"<th class='\" + headerClass + \" fc-agenda-axis'>\" + opt('allDayText') + \"</th>\" + \"<td>\" + \"<div class='fc-day-content'><div style='position:relative'/></div>\" + \"</td>\" + \"<th class='\" + headerClass + \" fc-agenda-gutter'> </th>\" + \"</tr>\" + \"</table>\";\n        allDayTable = $(s).appendTo(slotLayer);\n        allDayRow = allDayTable.find('tr');\n        dayBind(allDayRow.find('td'));\n        slotLayer.append(\"<div class='fc-agenda-divider \" + headerClass + \"'>\" + \"<div class='fc-agenda-divider-inner'/>\" + \"</div>\");\n      } else {\n        daySegmentContainer = $([]); // in jQuery 1.4, we can just do $()\n      }\n\n      slotScroller = $(\"<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>\").appendTo(slotLayer);\n      slotContainer = $(\"<div style='position:relative;width:100%;overflow:hidden'/>\").appendTo(slotScroller);\n      slotSegmentContainer = $(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\").appendTo(slotContainer);\n      s = \"<table class='fc-agenda-slots' style='width:100%' cellspacing='0'>\" + \"<tbody>\";\n      d = zeroDate();\n      maxd = addMinutes(cloneDate(d), maxMinute);\n      addMinutes(d, minMinute);\n      slotCnt = 0;\n      for (i = 0; d < maxd; i++) {\n        minutes = d.getMinutes();\n        s += \"<tr class='fc-slot\" + i + ' ' + (!minutes ? '' : 'fc-minor') + \"'>\" + \"<th class='fc-agenda-axis \" + headerClass + \"'>\" + (!slotNormal || !minutes ? formatDate(d, opt('axisFormat')) : ' ') + \"</th>\" + \"<td class='\" + contentClass + \"'>\" + \"<div style='position:relative'> </div>\" + \"</td>\" + \"</tr>\";\n        addMinutes(d, opt('slotMinutes'));\n        slotCnt++;\n      }\n      s += \"</tbody>\" + \"</table>\";\n      slotTable = $(s).appendTo(slotContainer);\n      slotBind(slotTable.find('td'));\n    }\n\n    /* Build Day Table\n    -----------------------------------------------------------------------*/\n\n    function buildDayTable() {\n      var html = buildDayTableHTML();\n      if (dayTable) {\n        dayTable.remove();\n      }\n      dayTable = $(html).appendTo(element);\n      dayHead = dayTable.find('thead');\n      dayHeadCells = dayHead.find('th').slice(1, -1); // exclude gutter\n      dayBody = dayTable.find('tbody');\n      dayBodyCells = dayBody.find('td').slice(0, -1); // exclude gutter\n      dayBodyCellInners = dayBodyCells.find('> div');\n      dayBodyCellContentInners = dayBodyCells.find('.fc-day-content > div');\n      dayBodyFirstCell = dayBodyCells.eq(0);\n      dayBodyFirstCellStretcher = dayBodyCellInners.eq(0);\n      markFirstLast(dayHead.add(dayHead.find('tr')));\n      markFirstLast(dayBody.add(dayBody.find('tr')));\n\n      // TODO: now that we rebuild the cells every time, we should call dayRender\n    }\n\n    function buildDayTableHTML() {\n      var html = \"<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>\" + buildDayTableHeadHTML() + buildDayTableBodyHTML() + \"</table>\";\n      return html;\n    }\n    function buildDayTableHeadHTML() {\n      var headerClass = tm + \"-widget-header\";\n      var date;\n      var html = '';\n      var weekText;\n      var col;\n      html += \"<thead>\" + \"<tr>\";\n      if (showWeekNumbers) {\n        date = cellToDate(0, 0);\n        weekText = formatDate(date, weekNumberFormat);\n        if (rtl) {\n          weekText += weekNumberTitle;\n        } else {\n          weekText = weekNumberTitle + weekText;\n        }\n        html += \"<th class='fc-agenda-axis fc-week-number \" + headerClass + \"'>\" + htmlEscape(weekText) + \"</th>\";\n      } else {\n        html += \"<th class='fc-agenda-axis \" + headerClass + \"'> </th>\";\n      }\n      for (col = 0; col < colCnt; col++) {\n        date = cellToDate(0, col);\n        html += \"<th class='fc-\" + dayIDs[date.getDay()] + \" fc-col\" + col + ' ' + headerClass + \"'>\" + htmlEscape(formatDate(date, colFormat)) + \"</th>\";\n      }\n      html += \"<th class='fc-agenda-gutter \" + headerClass + \"'> </th>\" + \"</tr>\" + \"</thead>\";\n      return html;\n    }\n    function buildDayTableBodyHTML() {\n      var headerClass = tm + \"-widget-header\"; // TODO: make these when updateOptions() called\n      var contentClass = tm + \"-widget-content\";\n      var date;\n      var today = clearTime(new Date());\n      var col;\n      var cellsHTML;\n      var cellHTML;\n      var classNames;\n      var html = '';\n      html += \"<tbody>\" + \"<tr>\" + \"<th class='fc-agenda-axis \" + headerClass + \"'> </th>\";\n      cellsHTML = '';\n      for (col = 0; col < colCnt; col++) {\n        date = cellToDate(0, col);\n        classNames = ['fc-col' + col, 'fc-' + dayIDs[date.getDay()], contentClass];\n        if (+date == +today) {\n          classNames.push(tm + '-state-highlight', 'fc-today');\n        } else if (date < today) {\n          classNames.push('fc-past');\n        } else {\n          classNames.push('fc-future');\n        }\n        cellHTML = \"<td class='\" + classNames.join(' ') + \"'>\" + \"<div>\" + \"<div class='fc-day-content'>\" + \"<div style='position:relative'> </div>\" + \"</div>\" + \"</div>\" + \"</td>\";\n        cellsHTML += cellHTML;\n      }\n      html += cellsHTML;\n      html += \"<td class='fc-agenda-gutter \" + contentClass + \"'> </td>\" + \"</tr>\" + \"</tbody>\";\n      return html;\n    }\n\n    // TODO: data-date on the cells\n\n    /* Dimensions\n    -----------------------------------------------------------------------*/\n\n    function setHeight(height) {\n      if (height === undefined) {\n        height = viewHeight;\n      }\n      viewHeight = height;\n      slotTopCache = {};\n      var headHeight = dayBody.position().top;\n      var allDayHeight = slotScroller.position().top; // including divider\n      var bodyHeight = Math.min(\n      // total body height, including borders\n      height - headHeight,\n      // when scrollbars\n      slotTable.height() + allDayHeight + 1 // when no scrollbars. +1 for bottom border\n      );\n\n      dayBodyFirstCellStretcher.height(bodyHeight - vsides(dayBodyFirstCell));\n      slotLayer.css('top', headHeight);\n      slotScroller.height(bodyHeight - allDayHeight - 1);\n\n      // the stylesheet guarantees that the first row has no border.\n      // this allows .height() to work well cross-browser.\n      slotHeight = slotTable.find('tr:first').height() + 1; // +1 for bottom border\n\n      snapRatio = opt('slotMinutes') / snapMinutes;\n      snapHeight = slotHeight / snapRatio;\n    }\n    function setWidth(width) {\n      viewWidth = width;\n      colPositions.clear();\n      colContentPositions.clear();\n      var axisFirstCells = dayHead.find('th:first');\n      if (allDayTable) {\n        axisFirstCells = axisFirstCells.add(allDayTable.find('th:first'));\n      }\n      axisFirstCells = axisFirstCells.add(slotTable.find('th:first'));\n      axisWidth = 0;\n      setOuterWidth(axisFirstCells.width('').each(function (i, _cell) {\n        axisWidth = Math.max(axisWidth, $(_cell).outerWidth());\n      }), axisWidth);\n      var gutterCells = dayTable.find('.fc-agenda-gutter');\n      if (allDayTable) {\n        gutterCells = gutterCells.add(allDayTable.find('th.fc-agenda-gutter'));\n      }\n      var slotTableWidth = slotScroller[0].clientWidth; // needs to be done after axisWidth (for IE7)\n\n      gutterWidth = slotScroller.width() - slotTableWidth;\n      if (gutterWidth) {\n        setOuterWidth(gutterCells, gutterWidth);\n        gutterCells.show().prev().removeClass('fc-last');\n      } else {\n        gutterCells.hide().prev().addClass('fc-last');\n      }\n      colWidth = Math.floor((slotTableWidth - axisWidth) / colCnt);\n      setOuterWidth(dayHeadCells.slice(0, -1), colWidth);\n    }\n\n    /* Scrolling\n    -----------------------------------------------------------------------*/\n\n    function resetScroll() {\n      var d0 = zeroDate();\n      var scrollDate = cloneDate(d0);\n      scrollDate.setHours(opt('firstHour'));\n      var top = timePosition(d0, scrollDate) + 1; // +1 for the border\n      function scroll() {\n        slotScroller.scrollTop(top);\n      }\n      scroll();\n      setTimeout(scroll, 0); // overrides any previous scroll state made by the browser\n    }\n\n    function afterRender() {\n      // after the view has been freshly rendered and sized\n      resetScroll();\n    }\n\n    /* Slot/Day clicking and binding\n    -----------------------------------------------------------------------*/\n\n    function dayBind(cells) {\n      cells.click(slotClick).mousedown(daySelectionMousedown);\n    }\n    function slotBind(cells) {\n      cells.click(slotClick).mousedown(slotSelectionMousedown);\n    }\n    function slotClick(ev) {\n      if (!opt('selectable')) {\n        // if selectable, SelectionManager will worry about dayClick\n        var col = Math.min(colCnt - 1, Math.floor((ev.pageX - dayTable.offset().left - axisWidth) / colWidth));\n        var date = cellToDate(0, col);\n        var rowMatch = this.parentNode.className.match(/fc-slot(\\d+)/); // TODO: maybe use data\n        if (rowMatch) {\n          var mins = parseInt(rowMatch[1]) * opt('slotMinutes');\n          var hours = Math.floor(mins / 60);\n          date.setHours(hours);\n          date.setMinutes(mins % 60 + minMinute);\n          trigger('dayClick', dayBodyCells[col], date, false, ev);\n        } else {\n          trigger('dayClick', dayBodyCells[col], date, true, ev);\n        }\n      }\n    }\n\n    /* Semi-transparent Overlay Helpers\n    -----------------------------------------------------*/\n    // TODO: should be consolidated with BasicView's methods\n\n    function renderDayOverlay(overlayStart, overlayEnd, refreshCoordinateGrid) {\n      // overlayEnd is exclusive\n\n      if (refreshCoordinateGrid) {\n        coordinateGrid.build();\n      }\n      var segments = rangeToSegments(overlayStart, overlayEnd);\n      for (var i = 0; i < segments.length; i++) {\n        var segment = segments[i];\n        dayBind(renderCellOverlay(segment.row, segment.leftCol, segment.row, segment.rightCol));\n      }\n    }\n    function renderCellOverlay(row0, col0, row1, col1) {\n      // only for all-day?\n      var rect = coordinateGrid.rect(row0, col0, row1, col1, slotLayer);\n      return renderOverlay(rect, slotLayer);\n    }\n    function renderSlotOverlay(overlayStart, overlayEnd) {\n      for (var i = 0; i < colCnt; i++) {\n        var dayStart = cellToDate(0, i);\n        var dayEnd = addDays(cloneDate(dayStart), 1);\n        var stretchStart = new Date(Math.max(dayStart, overlayStart));\n        var stretchEnd = new Date(Math.min(dayEnd, overlayEnd));\n        if (stretchStart < stretchEnd) {\n          var rect = coordinateGrid.rect(0, i, 0, i, slotContainer); // only use it for horizontal coords\n          var top = timePosition(dayStart, stretchStart);\n          var bottom = timePosition(dayStart, stretchEnd);\n          rect.top = top;\n          rect.height = bottom - top;\n          slotBind(renderOverlay(rect, slotContainer));\n        }\n      }\n    }\n\n    /* Coordinate Utilities\n    -----------------------------------------------------------------------------*/\n\n    coordinateGrid = new CoordinateGrid(function (rows, cols) {\n      var e, n, p;\n      dayHeadCells.each(function (i, _e) {\n        e = $(_e);\n        n = e.offset().left;\n        if (i) {\n          p[1] = n;\n        }\n        p = [n];\n        cols[i] = p;\n      });\n      p[1] = n + e.outerWidth();\n      if (opt('allDaySlot')) {\n        e = allDayRow;\n        n = e.offset().top;\n        rows[0] = [n, n + e.outerHeight()];\n      }\n      var slotTableTop = slotContainer.offset().top;\n      var slotScrollerTop = slotScroller.offset().top;\n      var slotScrollerBottom = slotScrollerTop + slotScroller.outerHeight();\n      function constrain(n) {\n        return Math.max(slotScrollerTop, Math.min(slotScrollerBottom, n));\n      }\n      for (var i = 0; i < slotCnt * snapRatio; i++) {\n        // adapt slot count to increased/decreased selection slot count\n        rows.push([constrain(slotTableTop + snapHeight * i), constrain(slotTableTop + snapHeight * (i + 1))]);\n      }\n    });\n    hoverListener = new HoverListener(coordinateGrid);\n    colPositions = new HorizontalPositionCache(function (col) {\n      return dayBodyCellInners.eq(col);\n    });\n    colContentPositions = new HorizontalPositionCache(function (col) {\n      return dayBodyCellContentInners.eq(col);\n    });\n    function colLeft(col) {\n      return colPositions.left(col);\n    }\n    function colContentLeft(col) {\n      return colContentPositions.left(col);\n    }\n    function colRight(col) {\n      return colPositions.right(col);\n    }\n    function colContentRight(col) {\n      return colContentPositions.right(col);\n    }\n    function getIsCellAllDay(cell) {\n      return opt('allDaySlot') && !cell.row;\n    }\n    function realCellToDate(cell) {\n      // ugh \"real\" ... but blame it on our abuse of the \"cell\" system\n      var d = cellToDate(0, cell.col);\n      var slotIndex = cell.row;\n      if (opt('allDaySlot')) {\n        slotIndex--;\n      }\n      if (slotIndex >= 0) {\n        addMinutes(d, minMinute + slotIndex * snapMinutes);\n      }\n      return d;\n    }\n\n    // get the Y coordinate of the given time on the given day (both Date objects)\n    function timePosition(day, time) {\n      // both date objects. day holds 00:00 of current day\n      day = cloneDate(day, true);\n      if (time < addMinutes(cloneDate(day), minMinute)) {\n        return 0;\n      }\n      if (time >= addMinutes(cloneDate(day), maxMinute)) {\n        return slotTable.height();\n      }\n      var slotMinutes = opt('slotMinutes'),\n        minutes = time.getHours() * 60 + time.getMinutes() - minMinute,\n        slotI = Math.floor(minutes / slotMinutes),\n        slotTop = slotTopCache[slotI];\n      if (slotTop === undefined) {\n        slotTop = slotTopCache[slotI] = slotTable.find('tr').eq(slotI).find('td div')[0].offsetTop;\n        // .eq() is faster than \":eq()\" selector\n        // [0].offsetTop is faster than .position().top (do we really need this optimization?)\n        // a better optimization would be to cache all these divs\n      }\n\n      return Math.max(0, Math.round(slotTop - 1 + slotHeight * (minutes % slotMinutes / slotMinutes)));\n    }\n    function getAllDayRow(index) {\n      return allDayRow;\n    }\n    function defaultEventEnd(event) {\n      var start = cloneDate(event.start);\n      if (event.allDay) {\n        return start;\n      }\n      return addMinutes(start, opt('defaultEventMinutes'));\n    }\n\n    /* Selection\n    ---------------------------------------------------------------------------------*/\n\n    function defaultSelectionEnd(startDate, allDay) {\n      if (allDay) {\n        return cloneDate(startDate);\n      }\n      return addMinutes(cloneDate(startDate), opt('slotMinutes'));\n    }\n    function renderSelection(startDate, endDate, allDay) {\n      // only for all-day\n      if (allDay) {\n        if (opt('allDaySlot')) {\n          renderDayOverlay(startDate, addDays(cloneDate(endDate), 1), true);\n        }\n      } else {\n        renderSlotSelection(startDate, endDate);\n      }\n    }\n    function renderSlotSelection(startDate, endDate) {\n      var helperOption = opt('selectHelper');\n      coordinateGrid.build();\n      if (helperOption) {\n        var col = dateToCell(startDate).col;\n        if (col >= 0 && col < colCnt) {\n          // only works when times are on same day\n          var rect = coordinateGrid.rect(0, col, 0, col, slotContainer); // only for horizontal coords\n          var top = timePosition(startDate, startDate);\n          var bottom = timePosition(startDate, endDate);\n          if (bottom > top) {\n            // protect against selections that are entirely before or after visible range\n            rect.top = top;\n            rect.height = bottom - top;\n            rect.left += 2;\n            rect.width -= 5;\n            if ($.isFunction(helperOption)) {\n              var helperRes = helperOption(startDate, endDate);\n              if (helperRes) {\n                rect.position = 'absolute';\n                selectionHelper = $(helperRes).css(rect).appendTo(slotContainer);\n              }\n            } else {\n              rect.isStart = true; // conside rect a \"seg\" now\n              rect.isEnd = true; //\n              selectionHelper = $(slotSegHtml({\n                title: '',\n                start: startDate,\n                end: endDate,\n                className: ['fc-select-helper'],\n                editable: false\n              }, rect));\n              selectionHelper.css('opacity', opt('dragOpacity'));\n            }\n            if (selectionHelper) {\n              slotBind(selectionHelper);\n              slotContainer.append(selectionHelper);\n              setOuterWidth(selectionHelper, rect.width, true); // needs to be after appended\n              setOuterHeight(selectionHelper, rect.height, true);\n            }\n          }\n        }\n      } else {\n        renderSlotOverlay(startDate, endDate);\n      }\n    }\n    function clearSelection() {\n      clearOverlays();\n      if (selectionHelper) {\n        selectionHelper.remove();\n        selectionHelper = null;\n      }\n    }\n    function slotSelectionMousedown(ev) {\n      if (ev.which == 1 && opt('selectable')) {\n        // ev.which==1 means left mouse button\n        unselect(ev);\n        var dates;\n        hoverListener.start(function (cell, origCell) {\n          clearSelection();\n          if (cell && cell.col == origCell.col && !getIsCellAllDay(cell)) {\n            var d1 = realCellToDate(origCell);\n            var d2 = realCellToDate(cell);\n            dates = [d1, addMinutes(cloneDate(d1), snapMinutes),\n            // calculate minutes depending on selection slot minutes \n            d2, addMinutes(cloneDate(d2), snapMinutes)].sort(dateCompare);\n            renderSlotSelection(dates[0], dates[3]);\n          } else {\n            dates = null;\n          }\n        }, ev);\n        $(document).one('mouseup', function (ev) {\n          hoverListener.stop();\n          if (dates) {\n            if (+dates[0] == +dates[1]) {\n              reportDayClick(dates[0], false, ev);\n            }\n            reportSelection(dates[0], dates[3], false, ev);\n          }\n        });\n      }\n    }\n    function reportDayClick(date, allDay, ev) {\n      trigger('dayClick', dayBodyCells[dateToCell(date).col], date, allDay, ev);\n    }\n\n    /* External Dragging\n    --------------------------------------------------------------------------------*/\n\n    function dragStart(_dragElement, ev, ui) {\n      hoverListener.start(function (cell) {\n        clearOverlays();\n        if (cell) {\n          if (getIsCellAllDay(cell)) {\n            renderCellOverlay(cell.row, cell.col, cell.row, cell.col);\n          } else {\n            var d1 = realCellToDate(cell);\n            var d2 = addMinutes(cloneDate(d1), opt('defaultEventMinutes'));\n            renderSlotOverlay(d1, d2);\n          }\n        }\n      }, ev);\n    }\n    function dragStop(_dragElement, ev, ui) {\n      var cell = hoverListener.stop();\n      clearOverlays();\n      if (cell) {\n        trigger('drop', _dragElement, realCellToDate(cell), getIsCellAllDay(cell), ev, ui);\n      }\n    }\n  }\n  ;\n  ;\n  function AgendaEventRenderer() {\n    var t = this;\n\n    // exports\n    t.renderEvents = renderEvents;\n    t.clearEvents = clearEvents;\n    t.slotSegHtml = slotSegHtml;\n\n    // imports\n    DayEventRenderer.call(t);\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var isEventDraggable = t.isEventDraggable;\n    var isEventResizable = t.isEventResizable;\n    var eventEnd = t.eventEnd;\n    var eventElementHandlers = t.eventElementHandlers;\n    var setHeight = t.setHeight;\n    var getDaySegmentContainer = t.getDaySegmentContainer;\n    var getSlotSegmentContainer = t.getSlotSegmentContainer;\n    var getHoverListener = t.getHoverListener;\n    var getMaxMinute = t.getMaxMinute;\n    var getMinMinute = t.getMinMinute;\n    var timePosition = t.timePosition;\n    var getIsCellAllDay = t.getIsCellAllDay;\n    var colContentLeft = t.colContentLeft;\n    var colContentRight = t.colContentRight;\n    var cellToDate = t.cellToDate;\n    var getColCnt = t.getColCnt;\n    var getColWidth = t.getColWidth;\n    var getSnapHeight = t.getSnapHeight;\n    var getSnapMinutes = t.getSnapMinutes;\n    var getSlotContainer = t.getSlotContainer;\n    var reportEventElement = t.reportEventElement;\n    var showEvents = t.showEvents;\n    var hideEvents = t.hideEvents;\n    var eventDrop = t.eventDrop;\n    var eventResize = t.eventResize;\n    var renderDayOverlay = t.renderDayOverlay;\n    var clearOverlays = t.clearOverlays;\n    var renderDayEvents = t.renderDayEvents;\n    var calendar = t.calendar;\n    var formatDate = calendar.formatDate;\n    var formatDates = calendar.formatDates;\n\n    // overrides\n    t.draggableDayEvent = draggableDayEvent;\n\n    /* Rendering\n    ----------------------------------------------------------------------------*/\n\n    function renderEvents(events, modifiedEventId) {\n      var i,\n        len = events.length,\n        dayEvents = [],\n        slotEvents = [];\n      for (i = 0; i < len; i++) {\n        if (events[i].allDay) {\n          dayEvents.push(events[i]);\n        } else {\n          slotEvents.push(events[i]);\n        }\n      }\n      if (opt('allDaySlot')) {\n        renderDayEvents(dayEvents, modifiedEventId);\n        setHeight(); // no params means set to viewHeight\n      }\n\n      renderSlotSegs(compileSlotSegs(slotEvents), modifiedEventId);\n    }\n    function clearEvents() {\n      getDaySegmentContainer().empty();\n      getSlotSegmentContainer().empty();\n    }\n    function compileSlotSegs(events) {\n      var colCnt = getColCnt(),\n        minMinute = getMinMinute(),\n        maxMinute = getMaxMinute(),\n        d,\n        visEventEnds = $.map(events, slotEventEnd),\n        i,\n        j,\n        seg,\n        colSegs,\n        segs = [];\n      for (i = 0; i < colCnt; i++) {\n        d = cellToDate(0, i);\n        addMinutes(d, minMinute);\n        colSegs = sliceSegs(events, visEventEnds, d, addMinutes(cloneDate(d), maxMinute - minMinute));\n        colSegs = placeSlotSegs(colSegs); // returns a new order\n\n        for (j = 0; j < colSegs.length; j++) {\n          seg = colSegs[j];\n          seg.col = i;\n          segs.push(seg);\n        }\n      }\n      return segs;\n    }\n    function sliceSegs(events, visEventEnds, start, end) {\n      var segs = [],\n        i,\n        len = events.length,\n        event,\n        eventStart,\n        eventEnd,\n        segStart,\n        segEnd,\n        isStart,\n        isEnd;\n      for (i = 0; i < len; i++) {\n        event = events[i];\n        eventStart = event.start;\n        eventEnd = visEventEnds[i];\n        if (eventEnd > start && eventStart < end) {\n          if (eventStart < start) {\n            segStart = cloneDate(start);\n            isStart = false;\n          } else {\n            segStart = eventStart;\n            isStart = true;\n          }\n          if (eventEnd > end) {\n            segEnd = cloneDate(end);\n            isEnd = false;\n          } else {\n            segEnd = eventEnd;\n            isEnd = true;\n          }\n          segs.push({\n            event: event,\n            start: segStart,\n            end: segEnd,\n            isStart: isStart,\n            isEnd: isEnd\n          });\n        }\n      }\n      return segs.sort(compareSlotSegs);\n    }\n    function slotEventEnd(event) {\n      if (event.end) {\n        return cloneDate(event.end);\n      } else {\n        return addMinutes(cloneDate(event.start), opt('defaultEventMinutes'));\n      }\n    }\n\n    // renders events in the 'time slots' at the bottom\n    // TODO: when we refactor this, when user returns `false` eventRender, don't have empty space\n    // TODO: refactor will include using pixels to detect collisions instead of dates (handy for seg cmp)\n\n    function renderSlotSegs(segs, modifiedEventId) {\n      var i,\n        segCnt = segs.length,\n        seg,\n        event,\n        top,\n        bottom,\n        columnLeft,\n        columnRight,\n        columnWidth,\n        width,\n        left,\n        right,\n        html = '',\n        eventElements,\n        eventElement,\n        triggerRes,\n        titleElement,\n        height,\n        slotSegmentContainer = getSlotSegmentContainer(),\n        isRTL = opt('isRTL');\n\n      // calculate position/dimensions, create html\n      for (i = 0; i < segCnt; i++) {\n        seg = segs[i];\n        event = seg.event;\n        top = timePosition(seg.start, seg.start);\n        bottom = timePosition(seg.start, seg.end);\n        columnLeft = colContentLeft(seg.col);\n        columnRight = colContentRight(seg.col);\n        columnWidth = columnRight - columnLeft;\n\n        // shave off space on right near scrollbars (2.5%)\n        // TODO: move this to CSS somehow\n        columnRight -= columnWidth * .025;\n        columnWidth = columnRight - columnLeft;\n        width = columnWidth * (seg.forwardCoord - seg.backwardCoord);\n        if (opt('slotEventOverlap')) {\n          // double the width while making sure resize handle is visible\n          // (assumed to be 20px wide)\n          width = Math.max((width - 20 / 2) * 2, width // narrow columns will want to make the segment smaller than\n          // the natural width. don't allow it\n          );\n        }\n\n        if (isRTL) {\n          right = columnRight - seg.backwardCoord * columnWidth;\n          left = right - width;\n        } else {\n          left = columnLeft + seg.backwardCoord * columnWidth;\n          right = left + width;\n        }\n\n        // make sure horizontal coordinates are in bounds\n        left = Math.max(left, columnLeft);\n        right = Math.min(right, columnRight);\n        width = right - left;\n        seg.top = top;\n        seg.left = left;\n        seg.outerWidth = width;\n        seg.outerHeight = bottom - top;\n        html += slotSegHtml(event, seg);\n      }\n      slotSegmentContainer[0].innerHTML = html; // faster than html()\n      eventElements = slotSegmentContainer.children();\n\n      // retrieve elements, run through eventRender callback, bind event handlers\n      for (i = 0; i < segCnt; i++) {\n        seg = segs[i];\n        event = seg.event;\n        eventElement = $(eventElements[i]); // faster than eq()\n        triggerRes = trigger('eventRender', event, event, eventElement);\n        if (triggerRes === false) {\n          eventElement.remove();\n        } else {\n          if (triggerRes && triggerRes !== true) {\n            eventElement.remove();\n            eventElement = $(triggerRes).css({\n              position: 'absolute',\n              top: seg.top,\n              left: seg.left\n            }).appendTo(slotSegmentContainer);\n          }\n          seg.element = eventElement;\n          if (event._id === modifiedEventId) {\n            bindSlotSeg(event, eventElement, seg);\n          } else {\n            eventElement[0]._fci = i; // for lazySegBind\n          }\n\n          reportEventElement(event, eventElement);\n        }\n      }\n      lazySegBind(slotSegmentContainer, segs, bindSlotSeg);\n\n      // record event sides and title positions\n      for (i = 0; i < segCnt; i++) {\n        seg = segs[i];\n        if (eventElement = seg.element) {\n          seg.vsides = vsides(eventElement, true);\n          seg.hsides = hsides(eventElement, true);\n          titleElement = eventElement.find('.fc-event-title');\n          if (titleElement.length) {\n            seg.contentTop = titleElement[0].offsetTop;\n          }\n        }\n      }\n\n      // set all positions/dimensions at once\n      for (i = 0; i < segCnt; i++) {\n        seg = segs[i];\n        if (eventElement = seg.element) {\n          eventElement[0].style.width = Math.max(0, seg.outerWidth - seg.hsides) + 'px';\n          height = Math.max(0, seg.outerHeight - seg.vsides);\n          eventElement[0].style.height = height + 'px';\n          event = seg.event;\n          if (seg.contentTop !== undefined && height - seg.contentTop < 10) {\n            // not enough room for title, put it in the time (TODO: maybe make both display:inline instead)\n            eventElement.find('div.fc-event-time').text(formatDate(event.start, opt('timeFormat')) + ' - ' + event.title);\n            eventElement.find('div.fc-event-title').remove();\n          }\n          trigger('eventAfterRender', event, event, eventElement);\n        }\n      }\n    }\n    function slotSegHtml(event, seg) {\n      var html = \"<\";\n      var url = event.url;\n      var skinCss = getSkinCss(event, opt);\n      var classes = ['fc-event', 'fc-event-vert'];\n      if (isEventDraggable(event)) {\n        classes.push('fc-event-draggable');\n      }\n      if (seg.isStart) {\n        classes.push('fc-event-start');\n      }\n      if (seg.isEnd) {\n        classes.push('fc-event-end');\n      }\n      classes = classes.concat(event.className);\n      if (event.source) {\n        classes = classes.concat(event.source.className || []);\n      }\n      if (url) {\n        html += \"a href='\" + htmlEscape(event.url) + \"'\";\n      } else {\n        html += \"div\";\n      }\n      html += \" class='\" + classes.join(' ') + \"'\" + \" style=\" + \"'\" + \"position:absolute;\" + \"top:\" + seg.top + \"px;\" + \"left:\" + seg.left + \"px;\" + skinCss + \"'\" + \">\" + \"<div class='fc-event-inner'>\" + \"<div class='fc-event-time'>\" + htmlEscape(formatDates(event.start, event.end, opt('timeFormat'))) + \"</div>\" + \"<div class='fc-event-title'>\" + htmlEscape(event.title || '') + \"</div>\" + \"</div>\" + \"<div class='fc-event-bg'></div>\";\n      if (seg.isEnd && isEventResizable(event)) {\n        html += \"<div class='ui-resizable-handle ui-resizable-s'>=</div>\";\n      }\n      html += \"</\" + (url ? \"a\" : \"div\") + \">\";\n      return html;\n    }\n    function bindSlotSeg(event, eventElement, seg) {\n      var timeElement = eventElement.find('div.fc-event-time');\n      if (isEventDraggable(event)) {\n        draggableSlotEvent(event, eventElement, timeElement);\n      }\n      if (seg.isEnd && isEventResizable(event)) {\n        resizableSlotEvent(event, eventElement, timeElement);\n      }\n      eventElementHandlers(event, eventElement);\n    }\n\n    /* Dragging\n    -----------------------------------------------------------------------------------*/\n\n    // when event starts out FULL-DAY\n    // overrides DayEventRenderer's version because it needs to account for dragging elements\n    // to and from the slot area.\n\n    function draggableDayEvent(event, eventElement, seg) {\n      var isStart = seg.isStart;\n      var origWidth;\n      var revert;\n      var allDay = true;\n      var dayDelta;\n      var hoverListener = getHoverListener();\n      var colWidth = getColWidth();\n      var snapHeight = getSnapHeight();\n      var snapMinutes = getSnapMinutes();\n      var minMinute = getMinMinute();\n      eventElement.draggable({\n        opacity: opt('dragOpacity', 'month'),\n        // use whatever the month view was using\n        revertDuration: opt('dragRevertDuration'),\n        start: function (ev, ui) {\n          trigger('eventDragStart', eventElement, event, ev, ui);\n          hideEvents(event, eventElement);\n          origWidth = eventElement.width();\n          hoverListener.start(function (cell, origCell) {\n            clearOverlays();\n            if (cell) {\n              revert = false;\n              var origDate = cellToDate(0, origCell.col);\n              var date = cellToDate(0, cell.col);\n              dayDelta = dayDiff(date, origDate);\n              if (!cell.row) {\n                // on full-days\n                renderDayOverlay(addDays(cloneDate(event.start), dayDelta), addDays(exclEndDay(event), dayDelta));\n                resetElement();\n              } else {\n                // mouse is over bottom slots\n                if (isStart) {\n                  if (allDay) {\n                    // convert event to temporary slot-event\n                    eventElement.width(colWidth - 10); // don't use entire width\n                    setOuterHeight(eventElement, snapHeight * Math.round((event.end ? (event.end - event.start) / MINUTE_MS : opt('defaultEventMinutes')) / snapMinutes));\n                    eventElement.draggable('option', 'grid', [colWidth, 1]);\n                    allDay = false;\n                  }\n                } else {\n                  revert = true;\n                }\n              }\n              revert = revert || allDay && !dayDelta;\n            } else {\n              resetElement();\n              revert = true;\n            }\n            eventElement.draggable('option', 'revert', revert);\n          }, ev, 'drag');\n        },\n        stop: function (ev, ui) {\n          hoverListener.stop();\n          clearOverlays();\n          trigger('eventDragStop', eventElement, event, ev, ui);\n          if (revert) {\n            // hasn't moved or is out of bounds (draggable has already reverted)\n            resetElement();\n            eventElement.css('filter', ''); // clear IE opacity side-effects\n            showEvents(event, eventElement);\n          } else {\n            // changed!\n            var minuteDelta = 0;\n            if (!allDay) {\n              minuteDelta = Math.round((eventElement.offset().top - getSlotContainer().offset().top) / snapHeight) * snapMinutes + minMinute - (event.start.getHours() * 60 + event.start.getMinutes());\n            }\n            eventDrop(this, event, dayDelta, minuteDelta, allDay, ev, ui);\n          }\n        }\n      });\n      function resetElement() {\n        if (!allDay) {\n          eventElement.width(origWidth).height('').draggable('option', 'grid', null);\n          allDay = true;\n        }\n      }\n    }\n\n    // when event starts out IN TIMESLOTS\n\n    function draggableSlotEvent(event, eventElement, timeElement) {\n      var coordinateGrid = t.getCoordinateGrid();\n      var colCnt = getColCnt();\n      var colWidth = getColWidth();\n      var snapHeight = getSnapHeight();\n      var snapMinutes = getSnapMinutes();\n\n      // states\n      var origPosition; // original position of the element, not the mouse\n      var origCell;\n      var isInBounds, prevIsInBounds;\n      var isAllDay, prevIsAllDay;\n      var colDelta, prevColDelta;\n      var dayDelta; // derived from colDelta\n      var minuteDelta, prevMinuteDelta;\n      eventElement.draggable({\n        scroll: false,\n        grid: [colWidth, snapHeight],\n        axis: colCnt == 1 ? 'y' : false,\n        opacity: opt('dragOpacity'),\n        revertDuration: opt('dragRevertDuration'),\n        start: function (ev, ui) {\n          trigger('eventDragStart', eventElement, event, ev, ui);\n          hideEvents(event, eventElement);\n          coordinateGrid.build();\n\n          // initialize states\n          origPosition = eventElement.position();\n          origCell = coordinateGrid.cell(ev.pageX, ev.pageY);\n          isInBounds = prevIsInBounds = true;\n          isAllDay = prevIsAllDay = getIsCellAllDay(origCell);\n          colDelta = prevColDelta = 0;\n          dayDelta = 0;\n          minuteDelta = prevMinuteDelta = 0;\n        },\n        drag: function (ev, ui) {\n          // NOTE: this `cell` value is only useful for determining in-bounds and all-day.\n          // Bad for anything else due to the discrepancy between the mouse position and the\n          // element position while snapping. (problem revealed in PR #55)\n          //\n          // PS- the problem exists for draggableDayEvent() when dragging an all-day event to a slot event.\n          // We should overhaul the dragging system and stop relying on jQuery UI.\n          var cell = coordinateGrid.cell(ev.pageX, ev.pageY);\n\n          // update states\n          isInBounds = !!cell;\n          if (isInBounds) {\n            isAllDay = getIsCellAllDay(cell);\n\n            // calculate column delta\n            colDelta = Math.round((ui.position.left - origPosition.left) / colWidth);\n            if (colDelta != prevColDelta) {\n              // calculate the day delta based off of the original clicked column and the column delta\n              var origDate = cellToDate(0, origCell.col);\n              var col = origCell.col + colDelta;\n              col = Math.max(0, col);\n              col = Math.min(colCnt - 1, col);\n              var date = cellToDate(0, col);\n              dayDelta = dayDiff(date, origDate);\n            }\n\n            // calculate minute delta (only if over slots)\n            if (!isAllDay) {\n              minuteDelta = Math.round((ui.position.top - origPosition.top) / snapHeight) * snapMinutes;\n            }\n          }\n\n          // any state changes?\n          if (isInBounds != prevIsInBounds || isAllDay != prevIsAllDay || colDelta != prevColDelta || minuteDelta != prevMinuteDelta) {\n            updateUI();\n\n            // update previous states for next time\n            prevIsInBounds = isInBounds;\n            prevIsAllDay = isAllDay;\n            prevColDelta = colDelta;\n            prevMinuteDelta = minuteDelta;\n          }\n\n          // if out-of-bounds, revert when done, and vice versa.\n          eventElement.draggable('option', 'revert', !isInBounds);\n        },\n        stop: function (ev, ui) {\n          clearOverlays();\n          trigger('eventDragStop', eventElement, event, ev, ui);\n          if (isInBounds && (isAllDay || dayDelta || minuteDelta)) {\n            // changed!\n            eventDrop(this, event, dayDelta, isAllDay ? 0 : minuteDelta, isAllDay, ev, ui);\n          } else {\n            // either no change or out-of-bounds (draggable has already reverted)\n\n            // reset states for next time, and for updateUI()\n            isInBounds = true;\n            isAllDay = false;\n            colDelta = 0;\n            dayDelta = 0;\n            minuteDelta = 0;\n            updateUI();\n            eventElement.css('filter', ''); // clear IE opacity side-effects\n\n            // sometimes fast drags make event revert to wrong position, so reset.\n            // also, if we dragged the element out of the area because of snapping,\n            // but the *mouse* is still in bounds, we need to reset the position.\n            eventElement.css(origPosition);\n            showEvents(event, eventElement);\n          }\n        }\n      });\n      function updateUI() {\n        clearOverlays();\n        if (isInBounds) {\n          if (isAllDay) {\n            timeElement.hide();\n            eventElement.draggable('option', 'grid', null); // disable grid snapping\n            renderDayOverlay(addDays(cloneDate(event.start), dayDelta), addDays(exclEndDay(event), dayDelta));\n          } else {\n            updateTimeText(minuteDelta);\n            timeElement.css('display', ''); // show() was causing display=inline\n            eventElement.draggable('option', 'grid', [colWidth, snapHeight]); // re-enable grid snapping\n          }\n        }\n      }\n\n      function updateTimeText(minuteDelta) {\n        var newStart = addMinutes(cloneDate(event.start), minuteDelta);\n        var newEnd;\n        if (event.end) {\n          newEnd = addMinutes(cloneDate(event.end), minuteDelta);\n        }\n        timeElement.text(formatDates(newStart, newEnd, opt('timeFormat')));\n      }\n    }\n\n    /* Resizing\n    --------------------------------------------------------------------------------------*/\n\n    function resizableSlotEvent(event, eventElement, timeElement) {\n      var snapDelta, prevSnapDelta;\n      var snapHeight = getSnapHeight();\n      var snapMinutes = getSnapMinutes();\n      eventElement.resizable({\n        handles: {\n          s: '.ui-resizable-handle'\n        },\n        grid: snapHeight,\n        start: function (ev, ui) {\n          snapDelta = prevSnapDelta = 0;\n          hideEvents(event, eventElement);\n          trigger('eventResizeStart', this, event, ev, ui);\n        },\n        resize: function (ev, ui) {\n          // don't rely on ui.size.height, doesn't take grid into account\n          snapDelta = Math.round((Math.max(snapHeight, eventElement.height()) - ui.originalSize.height) / snapHeight);\n          if (snapDelta != prevSnapDelta) {\n            timeElement.text(formatDates(event.start, !snapDelta && !event.end ? null :\n            // no change, so don't display time range\n            addMinutes(eventEnd(event), snapMinutes * snapDelta), opt('timeFormat')));\n            prevSnapDelta = snapDelta;\n          }\n        },\n        stop: function (ev, ui) {\n          trigger('eventResizeStop', this, event, ev, ui);\n          if (snapDelta) {\n            eventResize(this, event, 0, snapMinutes * snapDelta, ev, ui);\n          } else {\n            showEvents(event, eventElement);\n            // BUG: if event was really short, need to put title back in span\n          }\n        }\n      });\n    }\n  }\n\n  /* Agenda Event Segment Utilities\n  -----------------------------------------------------------------------------*/\n\n  // Sets the seg.backwardCoord and seg.forwardCoord on each segment and returns a new\n  // list in the order they should be placed into the DOM (an implicit z-index).\n  function placeSlotSegs(segs) {\n    var levels = buildSlotSegLevels(segs);\n    var level0 = levels[0];\n    var i;\n    computeForwardSlotSegs(levels);\n    if (level0) {\n      for (i = 0; i < level0.length; i++) {\n        computeSlotSegPressures(level0[i]);\n      }\n      for (i = 0; i < level0.length; i++) {\n        computeSlotSegCoords(level0[i], 0, 0);\n      }\n    }\n    return flattenSlotSegLevels(levels);\n  }\n\n  // Builds an array of segments \"levels\". The first level will be the leftmost tier of segments\n  // if the calendar is left-to-right, or the rightmost if the calendar is right-to-left.\n  function buildSlotSegLevels(segs) {\n    var levels = [];\n    var i, seg;\n    var j;\n    for (i = 0; i < segs.length; i++) {\n      seg = segs[i];\n\n      // go through all the levels and stop on the first level where there are no collisions\n      for (j = 0; j < levels.length; j++) {\n        if (!computeSlotSegCollisions(seg, levels[j]).length) {\n          break;\n        }\n      }\n      (levels[j] || (levels[j] = [])).push(seg);\n    }\n    return levels;\n  }\n\n  // For every segment, figure out the other segments that are in subsequent\n  // levels that also occupy the same vertical space. Accumulate in seg.forwardSegs\n  function computeForwardSlotSegs(levels) {\n    var i, level;\n    var j, seg;\n    var k;\n    for (i = 0; i < levels.length; i++) {\n      level = levels[i];\n      for (j = 0; j < level.length; j++) {\n        seg = level[j];\n        seg.forwardSegs = [];\n        for (k = i + 1; k < levels.length; k++) {\n          computeSlotSegCollisions(seg, levels[k], seg.forwardSegs);\n        }\n      }\n    }\n  }\n\n  // Figure out which path forward (via seg.forwardSegs) results in the longest path until\n  // the furthest edge is reached. The number of segments in this path will be seg.forwardPressure\n  function computeSlotSegPressures(seg) {\n    var forwardSegs = seg.forwardSegs;\n    var forwardPressure = 0;\n    var i, forwardSeg;\n    if (seg.forwardPressure === undefined) {\n      // not already computed\n\n      for (i = 0; i < forwardSegs.length; i++) {\n        forwardSeg = forwardSegs[i];\n\n        // figure out the child's maximum forward path\n        computeSlotSegPressures(forwardSeg);\n\n        // either use the existing maximum, or use the child's forward pressure\n        // plus one (for the forwardSeg itself)\n        forwardPressure = Math.max(forwardPressure, 1 + forwardSeg.forwardPressure);\n      }\n      seg.forwardPressure = forwardPressure;\n    }\n  }\n\n  // Calculate seg.forwardCoord and seg.backwardCoord for the segment, where both values range\n  // from 0 to 1. If the calendar is left-to-right, the seg.backwardCoord maps to \"left\" and\n  // seg.forwardCoord maps to \"right\" (via percentage). Vice-versa if the calendar is right-to-left.\n  //\n  // The segment might be part of a \"series\", which means consecutive segments with the same pressure\n  // who's width is unknown until an edge has been hit. `seriesBackwardPressure` is the number of\n  // segments behind this one in the current series, and `seriesBackwardCoord` is the starting\n  // coordinate of the first segment in the series.\n  function computeSlotSegCoords(seg, seriesBackwardPressure, seriesBackwardCoord) {\n    var forwardSegs = seg.forwardSegs;\n    var i;\n    if (seg.forwardCoord === undefined) {\n      // not already computed\n\n      if (!forwardSegs.length) {\n        // if there are no forward segments, this segment should butt up against the edge\n        seg.forwardCoord = 1;\n      } else {\n        // sort highest pressure first\n        forwardSegs.sort(compareForwardSlotSegs);\n\n        // this segment's forwardCoord will be calculated from the backwardCoord of the\n        // highest-pressure forward segment.\n        computeSlotSegCoords(forwardSegs[0], seriesBackwardPressure + 1, seriesBackwardCoord);\n        seg.forwardCoord = forwardSegs[0].backwardCoord;\n      }\n\n      // calculate the backwardCoord from the forwardCoord. consider the series\n      seg.backwardCoord = seg.forwardCoord - (seg.forwardCoord - seriesBackwardCoord) / (\n      // available width for series\n      seriesBackwardPressure + 1); // # of segments in the series\n\n      // use this segment's coordinates to computed the coordinates of the less-pressurized\n      // forward segments\n      for (i = 0; i < forwardSegs.length; i++) {\n        computeSlotSegCoords(forwardSegs[i], 0, seg.forwardCoord);\n      }\n    }\n  }\n\n  // Outputs a flat array of segments, from lowest to highest level\n  function flattenSlotSegLevels(levels) {\n    var segs = [];\n    var i, level;\n    var j;\n    for (i = 0; i < levels.length; i++) {\n      level = levels[i];\n      for (j = 0; j < level.length; j++) {\n        segs.push(level[j]);\n      }\n    }\n    return segs;\n  }\n\n  // Find all the segments in `otherSegs` that vertically collide with `seg`.\n  // Append into an optionally-supplied `results` array and return.\n  function computeSlotSegCollisions(seg, otherSegs, results) {\n    results = results || [];\n    for (var i = 0; i < otherSegs.length; i++) {\n      if (isSlotSegCollision(seg, otherSegs[i])) {\n        results.push(otherSegs[i]);\n      }\n    }\n    return results;\n  }\n\n  // Do these segments occupy the same vertical space?\n  function isSlotSegCollision(seg1, seg2) {\n    return seg1.end > seg2.start && seg1.start < seg2.end;\n  }\n\n  // A cmp function for determining which forward segment to rely on more when computing coordinates.\n  function compareForwardSlotSegs(seg1, seg2) {\n    // put higher-pressure first\n    return seg2.forwardPressure - seg1.forwardPressure ||\n    // put segments that are closer to initial edge first (and favor ones with no coords yet)\n    (seg1.backwardCoord || 0) - (seg2.backwardCoord || 0) ||\n    // do normal sorting...\n    compareSlotSegs(seg1, seg2);\n  }\n\n  // A cmp function for determining which segment should be closer to the initial edge\n  // (the left edge on a left-to-right calendar).\n  function compareSlotSegs(seg1, seg2) {\n    return seg1.start - seg2.start ||\n    // earlier start time goes first\n    seg2.end - seg2.start - (seg1.end - seg1.start) ||\n    // tie? longer-duration goes first\n    (seg1.event.title || '').localeCompare(seg2.event.title); // tie? alphabetically by title\n  }\n\n  ;\n  ;\n  function View(element, calendar, viewName) {\n    var t = this;\n\n    // exports\n    t.element = element;\n    t.calendar = calendar;\n    t.name = viewName;\n    t.opt = opt;\n    t.trigger = trigger;\n    t.isEventDraggable = isEventDraggable;\n    t.isEventResizable = isEventResizable;\n    t.setEventData = setEventData;\n    t.clearEventData = clearEventData;\n    t.eventEnd = eventEnd;\n    t.reportEventElement = reportEventElement;\n    t.triggerEventDestroy = triggerEventDestroy;\n    t.eventElementHandlers = eventElementHandlers;\n    t.showEvents = showEvents;\n    t.hideEvents = hideEvents;\n    t.eventDrop = eventDrop;\n    t.eventResize = eventResize;\n    // t.title\n    // t.start, t.end\n    // t.visStart, t.visEnd\n\n    // imports\n    var defaultEventEnd = t.defaultEventEnd;\n    var normalizeEvent = calendar.normalizeEvent; // in EventManager\n    var reportEventChange = calendar.reportEventChange;\n\n    // locals\n    var eventsByID = {}; // eventID mapped to array of events (there can be multiple b/c of repeating events)\n    var eventElementsByID = {}; // eventID mapped to array of jQuery elements\n    var eventElementCouples = []; // array of objects, { event, element } // TODO: unify with segment system\n    var options = calendar.options;\n    function opt(name, viewNameOverride) {\n      var v = options[name];\n      if ($.isPlainObject(v)) {\n        return smartProperty(v, viewNameOverride || viewName);\n      }\n      return v;\n    }\n    function trigger(name, thisObj) {\n      return calendar.trigger.apply(calendar, [name, thisObj || t].concat(Array.prototype.slice.call(arguments, 2), [t]));\n    }\n\n    /* Event Editable Boolean Calculations\n    ------------------------------------------------------------------------------*/\n\n    function isEventDraggable(event) {\n      var source = event.source || {};\n      return firstDefined(event.startEditable, source.startEditable, opt('eventStartEditable'), event.editable, source.editable, opt('editable')) && !opt('disableDragging'); // deprecated\n    }\n\n    function isEventResizable(event) {\n      // but also need to make sure the seg.isEnd == true\n      var source = event.source || {};\n      return firstDefined(event.durationEditable, source.durationEditable, opt('eventDurationEditable'), event.editable, source.editable, opt('editable')) && !opt('disableResizing'); // deprecated\n    }\n\n    /* Event Data\n    ------------------------------------------------------------------------------*/\n\n    function setEventData(events) {\n      // events are already normalized at this point\n      eventsByID = {};\n      var i,\n        len = events.length,\n        event;\n      for (i = 0; i < len; i++) {\n        event = events[i];\n        if (eventsByID[event._id]) {\n          eventsByID[event._id].push(event);\n        } else {\n          eventsByID[event._id] = [event];\n        }\n      }\n    }\n    function clearEventData() {\n      eventsByID = {};\n      eventElementsByID = {};\n      eventElementCouples = [];\n    }\n\n    // returns a Date object for an event's end\n    function eventEnd(event) {\n      return event.end ? cloneDate(event.end) : defaultEventEnd(event);\n    }\n\n    /* Event Elements\n    ------------------------------------------------------------------------------*/\n\n    // report when view creates an element for an event\n    function reportEventElement(event, element) {\n      eventElementCouples.push({\n        event: event,\n        element: element\n      });\n      if (eventElementsByID[event._id]) {\n        eventElementsByID[event._id].push(element);\n      } else {\n        eventElementsByID[event._id] = [element];\n      }\n    }\n    function triggerEventDestroy() {\n      $.each(eventElementCouples, function (i, couple) {\n        t.trigger('eventDestroy', couple.event, couple.event, couple.element);\n      });\n    }\n\n    // attaches eventClick, eventMouseover, eventMouseout\n    function eventElementHandlers(event, eventElement) {\n      eventElement.click(function (ev) {\n        if (!eventElement.hasClass('ui-draggable-dragging') && !eventElement.hasClass('ui-resizable-resizing')) {\n          return trigger('eventClick', this, event, ev);\n        }\n      }).hover(function (ev) {\n        trigger('eventMouseover', this, event, ev);\n      }, function (ev) {\n        trigger('eventMouseout', this, event, ev);\n      });\n      // TODO: don't fire eventMouseover/eventMouseout *while* dragging is occuring (on subject element)\n      // TODO: same for resizing\n    }\n\n    function showEvents(event, exceptElement) {\n      eachEventElement(event, exceptElement, 'show');\n    }\n    function hideEvents(event, exceptElement) {\n      eachEventElement(event, exceptElement, 'hide');\n    }\n    function eachEventElement(event, exceptElement, funcName) {\n      // NOTE: there may be multiple events per ID (repeating events)\n      // and multiple segments per event\n      var elements = eventElementsByID[event._id],\n        i,\n        len = elements.length;\n      for (i = 0; i < len; i++) {\n        if (!exceptElement || elements[i][0] != exceptElement[0]) {\n          elements[i][funcName]();\n        }\n      }\n    }\n\n    /* Event Modification Reporting\n    ---------------------------------------------------------------------------------*/\n\n    function eventDrop(e, event, dayDelta, minuteDelta, allDay, ev, ui) {\n      var oldAllDay = event.allDay;\n      var eventId = event._id;\n      moveEvents(eventsByID[eventId], dayDelta, minuteDelta, allDay);\n      trigger('eventDrop', e, event, dayDelta, minuteDelta, allDay, function () {\n        // TODO: investigate cases where this inverse technique might not work\n        moveEvents(eventsByID[eventId], -dayDelta, -minuteDelta, oldAllDay);\n        reportEventChange(eventId);\n      }, ev, ui);\n      reportEventChange(eventId);\n    }\n    function eventResize(e, event, dayDelta, minuteDelta, ev, ui) {\n      var eventId = event._id;\n      elongateEvents(eventsByID[eventId], dayDelta, minuteDelta);\n      trigger('eventResize', e, event, dayDelta, minuteDelta, function () {\n        // TODO: investigate cases where this inverse technique might not work\n        elongateEvents(eventsByID[eventId], -dayDelta, -minuteDelta);\n        reportEventChange(eventId);\n      }, ev, ui);\n      reportEventChange(eventId);\n    }\n\n    /* Event Modification Math\n    ---------------------------------------------------------------------------------*/\n\n    function moveEvents(events, dayDelta, minuteDelta, allDay) {\n      minuteDelta = minuteDelta || 0;\n      for (var e, len = events.length, i = 0; i < len; i++) {\n        e = events[i];\n        if (allDay !== undefined) {\n          e.allDay = allDay;\n        }\n        addMinutes(addDays(e.start, dayDelta, true), minuteDelta);\n        if (e.end) {\n          e.end = addMinutes(addDays(e.end, dayDelta, true), minuteDelta);\n        }\n        normalizeEvent(e, options);\n      }\n    }\n    function elongateEvents(events, dayDelta, minuteDelta) {\n      minuteDelta = minuteDelta || 0;\n      for (var e, len = events.length, i = 0; i < len; i++) {\n        e = events[i];\n        e.end = addMinutes(addDays(eventEnd(e), dayDelta, true), minuteDelta);\n        normalizeEvent(e, options);\n      }\n    }\n\n    // ====================================================================================================\n    // Utilities for day \"cells\"\n    // ====================================================================================================\n    // The \"basic\" views are completely made up of day cells.\n    // The \"agenda\" views have day cells at the top \"all day\" slot.\n    // This was the obvious common place to put these utilities, but they should be abstracted out into\n    // a more meaningful class (like DayEventRenderer).\n    // ====================================================================================================\n\n    // For determining how a given \"cell\" translates into a \"date\":\n    //\n    // 1. Convert the \"cell\" (row and column) into a \"cell offset\" (the # of the cell, cronologically from the first).\n    //    Keep in mind that column indices are inverted with isRTL. This is taken into account.\n    //\n    // 2. Convert the \"cell offset\" to a \"day offset\" (the # of days since the first visible day in the view).\n    //\n    // 3. Convert the \"day offset\" into a \"date\" (a JavaScript Date object).\n    //\n    // The reverse transformation happens when transforming a date into a cell.\n\n    // exports\n    t.isHiddenDay = isHiddenDay;\n    t.skipHiddenDays = skipHiddenDays;\n    t.getCellsPerWeek = getCellsPerWeek;\n    t.dateToCell = dateToCell;\n    t.dateToDayOffset = dateToDayOffset;\n    t.dayOffsetToCellOffset = dayOffsetToCellOffset;\n    t.cellOffsetToCell = cellOffsetToCell;\n    t.cellToDate = cellToDate;\n    t.cellToCellOffset = cellToCellOffset;\n    t.cellOffsetToDayOffset = cellOffsetToDayOffset;\n    t.dayOffsetToDate = dayOffsetToDate;\n    t.rangeToSegments = rangeToSegments;\n\n    // internals\n    var hiddenDays = opt('hiddenDays') || []; // array of day-of-week indices that are hidden\n    var isHiddenDayHash = []; // is the day-of-week hidden? (hash with day-of-week-index -> bool)\n    var cellsPerWeek;\n    var dayToCellMap = []; // hash from dayIndex -> cellIndex, for one week\n    var cellToDayMap = []; // hash from cellIndex -> dayIndex, for one week\n    var isRTL = opt('isRTL');\n\n    // initialize important internal variables\n    (function () {\n      if (opt('weekends') === false) {\n        hiddenDays.push(0, 6); // 0=sunday, 6=saturday\n      }\n\n      // Loop through a hypothetical week and determine which\n      // days-of-week are hidden. Record in both hashes (one is the reverse of the other).\n      for (var dayIndex = 0, cellIndex = 0; dayIndex < 7; dayIndex++) {\n        dayToCellMap[dayIndex] = cellIndex;\n        isHiddenDayHash[dayIndex] = $.inArray(dayIndex, hiddenDays) != -1;\n        if (!isHiddenDayHash[dayIndex]) {\n          cellToDayMap[cellIndex] = dayIndex;\n          cellIndex++;\n        }\n      }\n      cellsPerWeek = cellIndex;\n      if (!cellsPerWeek) {\n        throw 'invalid hiddenDays'; // all days were hidden? bad.\n      }\n    })();\n\n    // Is the current day hidden?\n    // `day` is a day-of-week index (0-6), or a Date object\n    function isHiddenDay(day) {\n      if (typeof day == 'object') {\n        day = day.getDay();\n      }\n      return isHiddenDayHash[day];\n    }\n    function getCellsPerWeek() {\n      return cellsPerWeek;\n    }\n\n    // Keep incrementing the current day until it is no longer a hidden day.\n    // If the initial value of `date` is not a hidden day, don't do anything.\n    // Pass `isExclusive` as `true` if you are dealing with an end date.\n    // `inc` defaults to `1` (increment one day forward each time)\n    function skipHiddenDays(date, inc, isExclusive) {\n      inc = inc || 1;\n      while (isHiddenDayHash[(date.getDay() + (isExclusive ? inc : 0) + 7) % 7]) {\n        addDays(date, inc);\n      }\n    }\n\n    //\n    // TRANSFORMATIONS: cell -> cell offset -> day offset -> date\n    //\n\n    // cell -> date (combines all transformations)\n    // Possible arguments:\n    // - row, col\n    // - { row:#, col: # }\n    function cellToDate() {\n      var cellOffset = cellToCellOffset.apply(null, arguments);\n      var dayOffset = cellOffsetToDayOffset(cellOffset);\n      var date = dayOffsetToDate(dayOffset);\n      return date;\n    }\n\n    // cell -> cell offset\n    // Possible arguments:\n    // - row, col\n    // - { row:#, col:# }\n    function cellToCellOffset(row, col) {\n      var colCnt = t.getColCnt();\n\n      // rtl variables. wish we could pre-populate these. but where?\n      var dis = isRTL ? -1 : 1;\n      var dit = isRTL ? colCnt - 1 : 0;\n      if (typeof row == 'object') {\n        col = row.col;\n        row = row.row;\n      }\n      var cellOffset = row * colCnt + (col * dis + dit); // column, adjusted for RTL (dis & dit)\n\n      return cellOffset;\n    }\n\n    // cell offset -> day offset\n    function cellOffsetToDayOffset(cellOffset) {\n      var day0 = t.visStart.getDay(); // first date's day of week\n      cellOffset += dayToCellMap[day0]; // normlize cellOffset to beginning-of-week\n      return Math.floor(cellOffset / cellsPerWeek) * 7 // # of days from full weeks\n      + cellToDayMap[\n      // # of days from partial last week\n      (cellOffset % cellsPerWeek + cellsPerWeek) % cellsPerWeek // crazy math to handle negative cellOffsets\n      ] - day0; // adjustment for beginning-of-week normalization\n    }\n\n    // day offset -> date (JavaScript Date object)\n    function dayOffsetToDate(dayOffset) {\n      var date = cloneDate(t.visStart);\n      addDays(date, dayOffset);\n      return date;\n    }\n\n    //\n    // TRANSFORMATIONS: date -> day offset -> cell offset -> cell\n    //\n\n    // date -> cell (combines all transformations)\n    function dateToCell(date) {\n      var dayOffset = dateToDayOffset(date);\n      var cellOffset = dayOffsetToCellOffset(dayOffset);\n      var cell = cellOffsetToCell(cellOffset);\n      return cell;\n    }\n\n    // date -> day offset\n    function dateToDayOffset(date) {\n      return dayDiff(date, t.visStart);\n    }\n\n    // day offset -> cell offset\n    function dayOffsetToCellOffset(dayOffset) {\n      var day0 = t.visStart.getDay(); // first date's day of week\n      dayOffset += day0; // normalize dayOffset to beginning-of-week\n      return Math.floor(dayOffset / 7) * cellsPerWeek // # of cells from full weeks\n      + dayToCellMap[\n      // # of cells from partial last week\n      (dayOffset % 7 + 7) % 7 // crazy math to handle negative dayOffsets\n      ] - dayToCellMap[day0]; // adjustment for beginning-of-week normalization\n    }\n\n    // cell offset -> cell (object with row & col keys)\n    function cellOffsetToCell(cellOffset) {\n      var colCnt = t.getColCnt();\n\n      // rtl variables. wish we could pre-populate these. but where?\n      var dis = isRTL ? -1 : 1;\n      var dit = isRTL ? colCnt - 1 : 0;\n      var row = Math.floor(cellOffset / colCnt);\n      var col = (cellOffset % colCnt + colCnt) % colCnt * dis + dit; // column, adjusted for RTL (dis & dit)\n      return {\n        row: row,\n        col: col\n      };\n    }\n\n    //\n    // Converts a date range into an array of segment objects.\n    // \"Segments\" are horizontal stretches of time, sliced up by row.\n    // A segment object has the following properties:\n    // - row\n    // - cols\n    // - isStart\n    // - isEnd\n    //\n    function rangeToSegments(startDate, endDate) {\n      var rowCnt = t.getRowCnt();\n      var colCnt = t.getColCnt();\n      var segments = []; // array of segments to return\n\n      // day offset for given date range\n      var rangeDayOffsetStart = dateToDayOffset(startDate);\n      var rangeDayOffsetEnd = dateToDayOffset(endDate); // exclusive\n\n      // first and last cell offset for the given date range\n      // \"last\" implies inclusivity\n      var rangeCellOffsetFirst = dayOffsetToCellOffset(rangeDayOffsetStart);\n      var rangeCellOffsetLast = dayOffsetToCellOffset(rangeDayOffsetEnd) - 1;\n\n      // loop through all the rows in the view\n      for (var row = 0; row < rowCnt; row++) {\n        // first and last cell offset for the row\n        var rowCellOffsetFirst = row * colCnt;\n        var rowCellOffsetLast = rowCellOffsetFirst + colCnt - 1;\n\n        // get the segment's cell offsets by constraining the range's cell offsets to the bounds of the row\n        var segmentCellOffsetFirst = Math.max(rangeCellOffsetFirst, rowCellOffsetFirst);\n        var segmentCellOffsetLast = Math.min(rangeCellOffsetLast, rowCellOffsetLast);\n\n        // make sure segment's offsets are valid and in view\n        if (segmentCellOffsetFirst <= segmentCellOffsetLast) {\n          // translate to cells\n          var segmentCellFirst = cellOffsetToCell(segmentCellOffsetFirst);\n          var segmentCellLast = cellOffsetToCell(segmentCellOffsetLast);\n\n          // view might be RTL, so order by leftmost column\n          var cols = [segmentCellFirst.col, segmentCellLast.col].sort();\n\n          // Determine if segment's first/last cell is the beginning/end of the date range.\n          // We need to compare \"day offset\" because \"cell offsets\" are often ambiguous and\n          // can translate to multiple days, and an edge case reveals itself when we the\n          // range's first cell is hidden (we don't want isStart to be true).\n          var isStart = cellOffsetToDayOffset(segmentCellOffsetFirst) == rangeDayOffsetStart;\n          var isEnd = cellOffsetToDayOffset(segmentCellOffsetLast) + 1 == rangeDayOffsetEnd; // +1 for comparing exclusively\n\n          segments.push({\n            row: row,\n            leftCol: cols[0],\n            rightCol: cols[1],\n            isStart: isStart,\n            isEnd: isEnd\n          });\n        }\n      }\n      return segments;\n    }\n  }\n  ;\n  ;\n  function DayEventRenderer() {\n    var t = this;\n\n    // exports\n    t.renderDayEvents = renderDayEvents;\n    t.draggableDayEvent = draggableDayEvent; // made public so that subclasses can override\n    t.resizableDayEvent = resizableDayEvent; // \"\n\n    // imports\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var isEventDraggable = t.isEventDraggable;\n    var isEventResizable = t.isEventResizable;\n    var eventEnd = t.eventEnd;\n    var reportEventElement = t.reportEventElement;\n    var eventElementHandlers = t.eventElementHandlers;\n    var showEvents = t.showEvents;\n    var hideEvents = t.hideEvents;\n    var eventDrop = t.eventDrop;\n    var eventResize = t.eventResize;\n    var getRowCnt = t.getRowCnt;\n    var getColCnt = t.getColCnt;\n    var getColWidth = t.getColWidth;\n    var allDayRow = t.allDayRow; // TODO: rename\n    var colLeft = t.colLeft;\n    var colRight = t.colRight;\n    var colContentLeft = t.colContentLeft;\n    var colContentRight = t.colContentRight;\n    var dateToCell = t.dateToCell;\n    var getDaySegmentContainer = t.getDaySegmentContainer;\n    var formatDates = t.calendar.formatDates;\n    var renderDayOverlay = t.renderDayOverlay;\n    var clearOverlays = t.clearOverlays;\n    var clearSelection = t.clearSelection;\n    var getHoverListener = t.getHoverListener;\n    var rangeToSegments = t.rangeToSegments;\n    var cellToDate = t.cellToDate;\n    var cellToCellOffset = t.cellToCellOffset;\n    var cellOffsetToDayOffset = t.cellOffsetToDayOffset;\n    var dateToDayOffset = t.dateToDayOffset;\n    var dayOffsetToCellOffset = t.dayOffsetToCellOffset;\n\n    // Render `events` onto the calendar, attach mouse event handlers, and call the `eventAfterRender` callback for each.\n    // Mouse event will be lazily applied, except if the event has an ID of `modifiedEventId`.\n    // Can only be called when the event container is empty (because it wipes out all innerHTML).\n    function renderDayEvents(events, modifiedEventId) {\n      // do the actual rendering. Receive the intermediate \"segment\" data structures.\n      var segments = _renderDayEvents(events, false,\n      // don't append event elements\n      true // set the heights of the rows\n      );\n\n      // report the elements to the View, for general drag/resize utilities\n      segmentElementEach(segments, function (segment, element) {\n        reportEventElement(segment.event, element);\n      });\n\n      // attach mouse handlers\n      attachHandlers(segments, modifiedEventId);\n\n      // call `eventAfterRender` callback for each event\n      segmentElementEach(segments, function (segment, element) {\n        trigger('eventAfterRender', segment.event, segment.event, element);\n      });\n    }\n\n    // Render an event on the calendar, but don't report them anywhere, and don't attach mouse handlers.\n    // Append this event element to the event container, which might already be populated with events.\n    // If an event's segment will have row equal to `adjustRow`, then explicitly set its top coordinate to `adjustTop`.\n    // This hack is used to maintain continuity when user is manually resizing an event.\n    // Returns an array of DOM elements for the event.\n    function renderTempDayEvent(event, adjustRow, adjustTop) {\n      // actually render the event. `true` for appending element to container.\n      // Recieve the intermediate \"segment\" data structures.\n      var segments = _renderDayEvents([event], true,\n      // append event elements\n      false // don't set the heights of the rows\n      );\n\n      var elements = [];\n\n      // Adjust certain elements' top coordinates\n      segmentElementEach(segments, function (segment, element) {\n        if (segment.row === adjustRow) {\n          element.css('top', adjustTop);\n        }\n        elements.push(element[0]); // accumulate DOM nodes\n      });\n\n      return elements;\n    }\n\n    // Render events onto the calendar. Only responsible for the VISUAL aspect.\n    // Not responsible for attaching handlers or calling callbacks.\n    // Set `doAppend` to `true` for rendering elements without clearing the existing container.\n    // Set `doRowHeights` to allow setting the height of each row, to compensate for vertical event overflow.\n    function _renderDayEvents(events, doAppend, doRowHeights) {\n      // where the DOM nodes will eventually end up\n      var finalContainer = getDaySegmentContainer();\n\n      // the container where the initial HTML will be rendered.\n      // If `doAppend`==true, uses a temporary container.\n      var renderContainer = doAppend ? $(\"<div/>\") : finalContainer;\n      var segments = buildSegments(events);\n      var html;\n      var elements;\n\n      // calculate the desired `left` and `width` properties on each segment object\n      calculateHorizontals(segments);\n\n      // build the HTML string. relies on `left` property\n      html = buildHTML(segments);\n\n      // render the HTML. innerHTML is considerably faster than jQuery's .html()\n      renderContainer[0].innerHTML = html;\n\n      // retrieve the individual elements\n      elements = renderContainer.children();\n\n      // if we were appending, and thus using a temporary container,\n      // re-attach elements to the real container.\n      if (doAppend) {\n        finalContainer.append(elements);\n      }\n\n      // assigns each element to `segment.event`, after filtering them through user callbacks\n      resolveElements(segments, elements);\n\n      // Calculate the left and right padding+margin for each element.\n      // We need this for setting each element's desired outer width, because of the W3C box model.\n      // It's important we do this in a separate pass from acually setting the width on the DOM elements\n      // because alternating reading/writing dimensions causes reflow for every iteration.\n      segmentElementEach(segments, function (segment, element) {\n        segment.hsides = hsides(element, true); // include margins = `true`\n      });\n\n      // Set the width of each element\n      segmentElementEach(segments, function (segment, element) {\n        element.width(Math.max(0, segment.outerWidth - segment.hsides));\n      });\n\n      // Grab each element's outerHeight (setVerticals uses this).\n      // To get an accurate reading, it's important to have each element's width explicitly set already.\n      segmentElementEach(segments, function (segment, element) {\n        segment.outerHeight = element.outerHeight(true); // include margins = `true`\n      });\n\n      // Set the top coordinate on each element (requires segment.outerHeight)\n      setVerticals(segments, doRowHeights);\n      return segments;\n    }\n\n    // Generate an array of \"segments\" for all events.\n    function buildSegments(events) {\n      var segments = [];\n      for (var i = 0; i < events.length; i++) {\n        var eventSegments = buildSegmentsForEvent(events[i]);\n        segments.push.apply(segments, eventSegments); // append an array to an array\n      }\n\n      return segments;\n    }\n\n    // Generate an array of segments for a single event.\n    // A \"segment\" is the same data structure that View.rangeToSegments produces,\n    // with the addition of the `event` property being set to reference the original event.\n    function buildSegmentsForEvent(event) {\n      var startDate = event.start;\n      var endDate = exclEndDay(event);\n      var segments = rangeToSegments(startDate, endDate);\n      for (var i = 0; i < segments.length; i++) {\n        segments[i].event = event;\n      }\n      return segments;\n    }\n\n    // Sets the `left` and `outerWidth` property of each segment.\n    // These values are the desired dimensions for the eventual DOM elements.\n    function calculateHorizontals(segments) {\n      var isRTL = opt('isRTL');\n      for (var i = 0; i < segments.length; i++) {\n        var segment = segments[i];\n\n        // Determine functions used for calulating the elements left/right coordinates,\n        // depending on whether the view is RTL or not.\n        // NOTE:\n        // colLeft/colRight returns the coordinate butting up the edge of the cell.\n        // colContentLeft/colContentRight is indented a little bit from the edge.\n        var leftFunc = (isRTL ? segment.isEnd : segment.isStart) ? colContentLeft : colLeft;\n        var rightFunc = (isRTL ? segment.isStart : segment.isEnd) ? colContentRight : colRight;\n        var left = leftFunc(segment.leftCol);\n        var right = rightFunc(segment.rightCol);\n        segment.left = left;\n        segment.outerWidth = right - left;\n      }\n    }\n\n    // Build a concatenated HTML string for an array of segments\n    function buildHTML(segments) {\n      var html = '';\n      for (var i = 0; i < segments.length; i++) {\n        html += buildHTMLForSegment(segments[i]);\n      }\n      return html;\n    }\n\n    // Build an HTML string for a single segment.\n    // Relies on the following properties:\n    // - `segment.event` (from `buildSegmentsForEvent`)\n    // - `segment.left` (from `calculateHorizontals`)\n    function buildHTMLForSegment(segment) {\n      var html = '';\n      var isRTL = opt('isRTL');\n      var event = segment.event;\n      var url = event.url;\n\n      // generate the list of CSS classNames\n      var classNames = ['fc-event', 'fc-event-hori'];\n      if (isEventDraggable(event)) {\n        classNames.push('fc-event-draggable');\n      }\n      if (segment.isStart) {\n        classNames.push('fc-event-start');\n      }\n      if (segment.isEnd) {\n        classNames.push('fc-event-end');\n      }\n      // use the event's configured classNames\n      // guaranteed to be an array via `normalizeEvent`\n      classNames = classNames.concat(event.className);\n      if (event.source) {\n        // use the event's source's classNames, if specified\n        classNames = classNames.concat(event.source.className || []);\n      }\n\n      // generate a semicolon delimited CSS string for any of the \"skin\" properties\n      // of the event object (`backgroundColor`, `borderColor` and such)\n      var skinCss = getSkinCss(event, opt);\n      if (url) {\n        html += \"<a href='\" + htmlEscape(url) + \"'\";\n      } else {\n        html += \"<div\";\n      }\n      html += \" class='\" + classNames.join(' ') + \"'\" + \" style=\" + \"'\" + \"position:absolute;\" + \"left:\" + segment.left + \"px;\" + skinCss + \"'\" + \">\" + \"<div class='fc-event-inner'>\";\n      if (!event.allDay && segment.isStart) {\n        html += \"<span class='fc-event-time'>\" + htmlEscape(formatDates(event.start, event.end, opt('timeFormat'))) + \"</span>\";\n      }\n      html += \"<span class='fc-event-title'>\" + htmlEscape(event.title || '') + \"</span>\" + \"</div>\";\n      if (segment.isEnd && isEventResizable(event)) {\n        html += \"<div class='ui-resizable-handle ui-resizable-\" + (isRTL ? 'w' : 'e') + \"'>\" + \"   \" +\n        // makes hit area a lot better for IE6/7\n        \"</div>\";\n      }\n      html += \"</\" + (url ? \"a\" : \"div\") + \">\";\n\n      // TODO:\n      // When these elements are initially rendered, they will be briefly visibile on the screen,\n      // even though their widths/heights are not set.\n      // SOLUTION: initially set them as visibility:hidden ?\n\n      return html;\n    }\n\n    // Associate each segment (an object) with an element (a jQuery object),\n    // by setting each `segment.element`.\n    // Run each element through the `eventRender` filter, which allows developers to\n    // modify an existing element, supply a new one, or cancel rendering.\n    function resolveElements(segments, elements) {\n      for (var i = 0; i < segments.length; i++) {\n        var segment = segments[i];\n        var event = segment.event;\n        var element = elements.eq(i);\n\n        // call the trigger with the original element\n        var triggerRes = trigger('eventRender', event, event, element);\n        if (triggerRes === false) {\n          // if `false`, remove the event from the DOM and don't assign it to `segment.event`\n          element.remove();\n        } else {\n          if (triggerRes && triggerRes !== true) {\n            // the trigger returned a new element, but not `true` (which means keep the existing element)\n\n            // re-assign the important CSS dimension properties that were already assigned in `buildHTMLForSegment`\n            triggerRes = $(triggerRes).css({\n              position: 'absolute',\n              left: segment.left\n            });\n            element.replaceWith(triggerRes);\n            element = triggerRes;\n          }\n          segment.element = element;\n        }\n      }\n    }\n\n    /* Top-coordinate Methods\n    -------------------------------------------------------------------------------------------------*/\n\n    // Sets the \"top\" CSS property for each element.\n    // If `doRowHeights` is `true`, also sets each row's first cell to an explicit height,\n    // so that if elements vertically overflow, the cell expands vertically to compensate.\n    function setVerticals(segments, doRowHeights) {\n      var rowContentHeights = calculateVerticals(segments); // also sets segment.top\n      var rowContentElements = getRowContentElements(); // returns 1 inner div per row\n      var rowContentTops = [];\n\n      // Set each row's height by setting height of first inner div\n      if (doRowHeights) {\n        for (var i = 0; i < rowContentElements.length; i++) {\n          rowContentElements[i].height(rowContentHeights[i]);\n        }\n      }\n\n      // Get each row's top, relative to the views's origin.\n      // Important to do this after setting each row's height.\n      for (var i = 0; i < rowContentElements.length; i++) {\n        rowContentTops.push(rowContentElements[i].position().top);\n      }\n\n      // Set each segment element's CSS \"top\" property.\n      // Each segment object has a \"top\" property, which is relative to the row's top, but...\n      segmentElementEach(segments, function (segment, element) {\n        element.css('top', rowContentTops[segment.row] + segment.top // ...now, relative to views's origin\n        );\n      });\n    }\n\n    // Calculate the \"top\" coordinate for each segment, relative to the \"top\" of the row.\n    // Also, return an array that contains the \"content\" height for each row\n    // (the height displaced by the vertically stacked events in the row).\n    // Requires segments to have their `outerHeight` property already set.\n    function calculateVerticals(segments) {\n      var rowCnt = getRowCnt();\n      var colCnt = getColCnt();\n      var rowContentHeights = []; // content height for each row\n      var segmentRows = buildSegmentRows(segments); // an array of segment arrays, one for each row\n\n      for (var rowI = 0; rowI < rowCnt; rowI++) {\n        var segmentRow = segmentRows[rowI];\n\n        // an array of running total heights for each column.\n        // initialize with all zeros.\n        var colHeights = [];\n        for (var colI = 0; colI < colCnt; colI++) {\n          colHeights.push(0);\n        }\n\n        // loop through every segment\n        for (var segmentI = 0; segmentI < segmentRow.length; segmentI++) {\n          var segment = segmentRow[segmentI];\n\n          // find the segment's top coordinate by looking at the max height\n          // of all the columns the segment will be in.\n          segment.top = arrayMax(colHeights.slice(segment.leftCol, segment.rightCol + 1 // make exclusive for slice\n          ));\n\n          // adjust the columns to account for the segment's height\n          for (var colI = segment.leftCol; colI <= segment.rightCol; colI++) {\n            colHeights[colI] = segment.top + segment.outerHeight;\n          }\n        }\n\n        // the tallest column in the row should be the \"content height\"\n        rowContentHeights.push(arrayMax(colHeights));\n      }\n      return rowContentHeights;\n    }\n\n    // Build an array of segment arrays, each representing the segments that will\n    // be in a row of the grid, sorted by which event should be closest to the top.\n    function buildSegmentRows(segments) {\n      var rowCnt = getRowCnt();\n      var segmentRows = [];\n      var segmentI;\n      var segment;\n      var rowI;\n\n      // group segments by row\n      for (segmentI = 0; segmentI < segments.length; segmentI++) {\n        segment = segments[segmentI];\n        rowI = segment.row;\n        if (segment.element) {\n          // was rendered?\n          if (segmentRows[rowI]) {\n            // already other segments. append to array\n            segmentRows[rowI].push(segment);\n          } else {\n            // first segment in row. create new array\n            segmentRows[rowI] = [segment];\n          }\n        }\n      }\n\n      // sort each row\n      for (rowI = 0; rowI < rowCnt; rowI++) {\n        segmentRows[rowI] = sortSegmentRow(segmentRows[rowI] || [] // guarantee an array, even if no segments\n        );\n      }\n\n      return segmentRows;\n    }\n\n    // Sort an array of segments according to which segment should appear closest to the top\n    function sortSegmentRow(segments) {\n      var sortedSegments = [];\n\n      // build the subrow array\n      var subrows = buildSegmentSubrows(segments);\n\n      // flatten it\n      for (var i = 0; i < subrows.length; i++) {\n        sortedSegments.push.apply(sortedSegments, subrows[i]); // append an array to an array\n      }\n\n      return sortedSegments;\n    }\n\n    // Take an array of segments, which are all assumed to be in the same row,\n    // and sort into subrows.\n    function buildSegmentSubrows(segments) {\n      // Give preference to elements with certain criteria, so they have\n      // a chance to be closer to the top.\n      segments.sort(compareDaySegments);\n      var subrows = [];\n      for (var i = 0; i < segments.length; i++) {\n        var segment = segments[i];\n\n        // loop through subrows, starting with the topmost, until the segment\n        // doesn't collide with other segments.\n        for (var j = 0; j < subrows.length; j++) {\n          if (!isDaySegmentCollision(segment, subrows[j])) {\n            break;\n          }\n        }\n        // `j` now holds the desired subrow index\n        if (subrows[j]) {\n          subrows[j].push(segment);\n        } else {\n          subrows[j] = [segment];\n        }\n      }\n      return subrows;\n    }\n\n    // Return an array of jQuery objects for the placeholder content containers of each row.\n    // The content containers don't actually contain anything, but their dimensions should match\n    // the events that are overlaid on top.\n    function getRowContentElements() {\n      var i;\n      var rowCnt = getRowCnt();\n      var rowDivs = [];\n      for (i = 0; i < rowCnt; i++) {\n        rowDivs[i] = allDayRow(i).find('div.fc-day-content > div');\n      }\n      return rowDivs;\n    }\n\n    /* Mouse Handlers\n    ---------------------------------------------------------------------------------------------------*/\n    // TODO: better documentation!\n\n    function attachHandlers(segments, modifiedEventId) {\n      var segmentContainer = getDaySegmentContainer();\n      segmentElementEach(segments, function (segment, element, i) {\n        var event = segment.event;\n        if (event._id === modifiedEventId) {\n          bindDaySeg(event, element, segment);\n        } else {\n          element[0]._fci = i; // for lazySegBind\n        }\n      });\n\n      lazySegBind(segmentContainer, segments, bindDaySeg);\n    }\n    function bindDaySeg(event, eventElement, segment) {\n      if (isEventDraggable(event)) {\n        t.draggableDayEvent(event, eventElement, segment); // use `t` so subclasses can override\n      }\n\n      if (segment.isEnd &&\n      // only allow resizing on the final segment for an event\n      isEventResizable(event)) {\n        t.resizableDayEvent(event, eventElement, segment); // use `t` so subclasses can override\n      }\n\n      // attach all other handlers.\n      // needs to be after, because resizableDayEvent might stopImmediatePropagation on click\n      eventElementHandlers(event, eventElement);\n    }\n    function draggableDayEvent(event, eventElement) {\n      var hoverListener = getHoverListener();\n      var dayDelta;\n      eventElement.draggable({\n        delay: 50,\n        opacity: opt('dragOpacity'),\n        revertDuration: opt('dragRevertDuration'),\n        start: function (ev, ui) {\n          trigger('eventDragStart', eventElement, event, ev, ui);\n          hideEvents(event, eventElement);\n          hoverListener.start(function (cell, origCell, rowDelta, colDelta) {\n            eventElement.draggable('option', 'revert', !cell || !rowDelta && !colDelta);\n            clearOverlays();\n            if (cell) {\n              var origDate = cellToDate(origCell);\n              var date = cellToDate(cell);\n              dayDelta = dayDiff(date, origDate);\n              renderDayOverlay(addDays(cloneDate(event.start), dayDelta), addDays(exclEndDay(event), dayDelta));\n            } else {\n              dayDelta = 0;\n            }\n          }, ev, 'drag');\n        },\n        stop: function (ev, ui) {\n          hoverListener.stop();\n          clearOverlays();\n          trigger('eventDragStop', eventElement, event, ev, ui);\n          if (dayDelta) {\n            eventDrop(this, event, dayDelta, 0, event.allDay, ev, ui);\n          } else {\n            eventElement.css('filter', ''); // clear IE opacity side-effects\n            showEvents(event, eventElement);\n          }\n        }\n      });\n    }\n    function resizableDayEvent(event, element, segment) {\n      var isRTL = opt('isRTL');\n      var direction = isRTL ? 'w' : 'e';\n      var handle = element.find('.ui-resizable-' + direction); // TODO: stop using this class because we aren't using jqui for this\n      var isResizing = false;\n\n      // TODO: look into using jquery-ui mouse widget for this stuff\n      disableTextSelection(element); // prevent native <a> selection for IE\n      element.mousedown(function (ev) {\n        // prevent native <a> selection for others\n        ev.preventDefault();\n      }).click(function (ev) {\n        if (isResizing) {\n          ev.preventDefault(); // prevent link from being visited (only method that worked in IE6)\n          ev.stopImmediatePropagation(); // prevent fullcalendar eventClick handler from being called\n          // (eventElementHandlers needs to be bound after resizableDayEvent)\n        }\n      });\n\n      handle.mousedown(function (ev) {\n        if (ev.which != 1) {\n          return; // needs to be left mouse button\n        }\n\n        isResizing = true;\n        var hoverListener = getHoverListener();\n        var rowCnt = getRowCnt();\n        var colCnt = getColCnt();\n        var elementTop = element.css('top');\n        var dayDelta;\n        var helpers;\n        var eventCopy = $.extend({}, event);\n        var minCellOffset = dayOffsetToCellOffset(dateToDayOffset(event.start));\n        clearSelection();\n        $('body').css('cursor', direction + '-resize').one('mouseup', mouseup);\n        trigger('eventResizeStart', this, event, ev);\n        hoverListener.start(function (cell, origCell) {\n          if (cell) {\n            var origCellOffset = cellToCellOffset(origCell);\n            var cellOffset = cellToCellOffset(cell);\n\n            // don't let resizing move earlier than start date cell\n            cellOffset = Math.max(cellOffset, minCellOffset);\n            dayDelta = cellOffsetToDayOffset(cellOffset) - cellOffsetToDayOffset(origCellOffset);\n            if (dayDelta) {\n              eventCopy.end = addDays(eventEnd(event), dayDelta, true);\n              var oldHelpers = helpers;\n              helpers = renderTempDayEvent(eventCopy, segment.row, elementTop);\n              helpers = $(helpers); // turn array into a jQuery object\n\n              helpers.find('*').css('cursor', direction + '-resize');\n              if (oldHelpers) {\n                oldHelpers.remove();\n              }\n              hideEvents(event);\n            } else {\n              if (helpers) {\n                showEvents(event);\n                helpers.remove();\n                helpers = null;\n              }\n            }\n            clearOverlays();\n            renderDayOverlay(\n            // coordinate grid already rebuilt with hoverListener.start()\n            event.start, addDays(exclEndDay(event), dayDelta)\n            // TODO: instead of calling renderDayOverlay() with dates,\n            // call _renderDayOverlay (or whatever) with cell offsets.\n            );\n          }\n        }, ev);\n        function mouseup(ev) {\n          trigger('eventResizeStop', this, event, ev);\n          $('body').css('cursor', '');\n          hoverListener.stop();\n          clearOverlays();\n          if (dayDelta) {\n            eventResize(this, event, dayDelta, 0, ev);\n            // event redraw will clear helpers\n          }\n          // otherwise, the drag handler already restored the old events\n\n          setTimeout(function () {\n            // make this happen after the element's click event\n            isResizing = false;\n          }, 0);\n        }\n      });\n    }\n  }\n\n  /* Generalized Segment Utilities\n  -------------------------------------------------------------------------------------------------*/\n\n  function isDaySegmentCollision(segment, otherSegments) {\n    for (var i = 0; i < otherSegments.length; i++) {\n      var otherSegment = otherSegments[i];\n      if (otherSegment.leftCol <= segment.rightCol && otherSegment.rightCol >= segment.leftCol) {\n        return true;\n      }\n    }\n    return false;\n  }\n  function segmentElementEach(segments, callback) {\n    // TODO: use in AgendaView?\n    for (var i = 0; i < segments.length; i++) {\n      var segment = segments[i];\n      var element = segment.element;\n      if (element) {\n        callback(segment, element, i);\n      }\n    }\n  }\n\n  // A cmp function for determining which segments should appear higher up\n  function compareDaySegments(a, b) {\n    return b.rightCol - b.leftCol - (a.rightCol - a.leftCol) ||\n    // put wider events first\n    b.event.allDay - a.event.allDay ||\n    // if tie, put all-day events first (booleans cast to 0/1)\n    a.event.start - b.event.start ||\n    // if a tie, sort by event start date\n    (a.event.title || '').localeCompare(b.event.title); // if a tie, sort by event title\n  }\n\n  ;\n  ;\n\n  //BUG: unselect needs to be triggered when events are dragged+dropped\n\n  function SelectionManager() {\n    var t = this;\n\n    // exports\n    t.select = select;\n    t.unselect = unselect;\n    t.reportSelection = reportSelection;\n    t.daySelectionMousedown = daySelectionMousedown;\n\n    // imports\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var defaultSelectionEnd = t.defaultSelectionEnd;\n    var renderSelection = t.renderSelection;\n    var clearSelection = t.clearSelection;\n\n    // locals\n    var selected = false;\n\n    // unselectAuto\n    if (opt('selectable') && opt('unselectAuto')) {\n      $(document).mousedown(function (ev) {\n        var ignore = opt('unselectCancel');\n        if (ignore) {\n          if ($(ev.target).parents(ignore).length) {\n            // could be optimized to stop after first match\n            return;\n          }\n        }\n        unselect(ev);\n      });\n    }\n    function select(startDate, endDate, allDay) {\n      unselect();\n      if (!endDate) {\n        endDate = defaultSelectionEnd(startDate, allDay);\n      }\n      renderSelection(startDate, endDate, allDay);\n      reportSelection(startDate, endDate, allDay);\n    }\n    function unselect(ev) {\n      if (selected) {\n        selected = false;\n        clearSelection();\n        trigger('unselect', null, ev);\n      }\n    }\n    function reportSelection(startDate, endDate, allDay, ev) {\n      selected = true;\n      trigger('select', null, startDate, endDate, allDay, ev);\n    }\n    function daySelectionMousedown(ev) {\n      // not really a generic manager method, oh well\n      var cellToDate = t.cellToDate;\n      var getIsCellAllDay = t.getIsCellAllDay;\n      var hoverListener = t.getHoverListener();\n      var reportDayClick = t.reportDayClick; // this is hacky and sort of weird\n      if (ev.which == 1 && opt('selectable')) {\n        // which==1 means left mouse button\n        unselect(ev);\n        var _mousedownElement = this;\n        var dates;\n        hoverListener.start(function (cell, origCell) {\n          // TODO: maybe put cellToDate/getIsCellAllDay info in cell\n          clearSelection();\n          if (cell && getIsCellAllDay(cell)) {\n            dates = [cellToDate(origCell), cellToDate(cell)].sort(dateCompare);\n            renderSelection(dates[0], dates[1], true);\n          } else {\n            dates = null;\n          }\n        }, ev);\n        $(document).one('mouseup', function (ev) {\n          hoverListener.stop();\n          if (dates) {\n            if (+dates[0] == +dates[1]) {\n              reportDayClick(dates[0], true, ev);\n            }\n            reportSelection(dates[0], dates[1], true, ev);\n          }\n        });\n      }\n    }\n  }\n  ;\n  ;\n  function OverlayManager() {\n    var t = this;\n\n    // exports\n    t.renderOverlay = renderOverlay;\n    t.clearOverlays = clearOverlays;\n\n    // locals\n    var usedOverlays = [];\n    var unusedOverlays = [];\n    function renderOverlay(rect, parent) {\n      var e = unusedOverlays.shift();\n      if (!e) {\n        e = $(\"<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>\");\n      }\n      if (e[0].parentNode != parent[0]) {\n        e.appendTo(parent);\n      }\n      usedOverlays.push(e.css(rect).show());\n      return e;\n    }\n    function clearOverlays() {\n      var e;\n      while (e = usedOverlays.shift()) {\n        unusedOverlays.push(e.hide().unbind());\n      }\n    }\n  }\n  ;\n  ;\n  function CoordinateGrid(buildFunc) {\n    var t = this;\n    var rows;\n    var cols;\n    t.build = function () {\n      rows = [];\n      cols = [];\n      buildFunc(rows, cols);\n    };\n    t.cell = function (x, y) {\n      var rowCnt = rows.length;\n      var colCnt = cols.length;\n      var i,\n        r = -1,\n        c = -1;\n      for (i = 0; i < rowCnt; i++) {\n        if (y >= rows[i][0] && y < rows[i][1]) {\n          r = i;\n          break;\n        }\n      }\n      for (i = 0; i < colCnt; i++) {\n        if (x >= cols[i][0] && x < cols[i][1]) {\n          c = i;\n          break;\n        }\n      }\n      return r >= 0 && c >= 0 ? {\n        row: r,\n        col: c\n      } : null;\n    };\n    t.rect = function (row0, col0, row1, col1, originElement) {\n      // row1,col1 is inclusive\n      var origin = originElement.offset();\n      return {\n        top: rows[row0][0] - origin.top,\n        left: cols[col0][0] - origin.left,\n        width: cols[col1][1] - cols[col0][0],\n        height: rows[row1][1] - rows[row0][0]\n      };\n    };\n  }\n  ;\n  ;\n  function HoverListener(coordinateGrid) {\n    var t = this;\n    var bindType;\n    var change;\n    var firstCell;\n    var cell;\n    t.start = function (_change, ev, _bindType) {\n      change = _change;\n      firstCell = cell = null;\n      coordinateGrid.build();\n      mouse(ev);\n      bindType = _bindType || 'mousemove';\n      $(document).bind(bindType, mouse);\n    };\n    function mouse(ev) {\n      _fixUIEvent(ev); // see below\n      var newCell = coordinateGrid.cell(ev.pageX, ev.pageY);\n      if (!newCell != !cell || newCell && (newCell.row != cell.row || newCell.col != cell.col)) {\n        if (newCell) {\n          if (!firstCell) {\n            firstCell = newCell;\n          }\n          change(newCell, firstCell, newCell.row - firstCell.row, newCell.col - firstCell.col);\n        } else {\n          change(newCell, firstCell);\n        }\n        cell = newCell;\n      }\n    }\n    t.stop = function () {\n      $(document).unbind(bindType, mouse);\n      return cell;\n    };\n  }\n\n  // this fix was only necessary for jQuery UI 1.8.16 (and jQuery 1.7 or 1.7.1)\n  // upgrading to jQuery UI 1.8.17 (and using either jQuery 1.7 or 1.7.1) fixed the problem\n  // but keep this in here for 1.8.16 users\n  // and maybe remove it down the line\n\n  function _fixUIEvent(event) {\n    // for issue 1168\n    if (event.pageX === undefined) {\n      event.pageX = event.originalEvent.pageX;\n      event.pageY = event.originalEvent.pageY;\n    }\n  }\n  ;\n  ;\n  function HorizontalPositionCache(getElement) {\n    var t = this,\n      elements = {},\n      lefts = {},\n      rights = {};\n    function e(i) {\n      return elements[i] = elements[i] || getElement(i);\n    }\n    t.left = function (i) {\n      return lefts[i] = lefts[i] === undefined ? e(i).position().left : lefts[i];\n    };\n    t.right = function (i) {\n      return rights[i] = rights[i] === undefined ? t.left(i) + e(i).width() : rights[i];\n    };\n    t.clear = function () {\n      elements = {};\n      lefts = {};\n      rights = {};\n    };\n  }\n  ;\n  ;\n})(jQuery);\nexport default CadastroHorario;\nvar _c;\n$RefreshReg$(_c, \"CadastroHorario\");","map":{"version":3,"names":["React","useState","useEffect","jsxDEV","_jsxDEV","CadastroHorario","_s","selectedProfessor","setSelectedProfessor","selectedSala","setSelectedSala","selectedNomeDesafio","setSelectedNomeDesafio","setSelectedCurso","professores","setProfessores","salas","setSalas","nomeDesafios","setNomeDesafios","horarios","setHorarios","horaInicial","setHoraInicial","horaFinal","setHoraFinal","storedHorarios","JSON","parse","localStorage","getItem","storedProfessores","storedSalas","storedDesafios","adicionarHorarios","trim","novoHorario","id","Date","getTime","professor","sala","desafio","console","log","prevHorarios","newHorarios","setItem","stringify","excluirHorario","index","splice","children","className","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","e","target","disabled","map","nomeProfessor","numeroSala","nomeDesafio","type","onClick","horario","_c","$","undefined","defaults","defaultView","aspectRatio","header","left","center","right","weekends","weekNumbers","weekNumberCalculation","weekNumberTitle","allDayDefault","ignoreTimezone","lazyFetching","startParam","endParam","titleFormat","month","week","day","columnFormat","timeFormat","isRTL","firstDay","monthNames","monthNamesShort","dayNames","dayNamesShort","buttonText","prev","next","prevYear","nextYear","today","theme","buttonIcons","unselectAuto","dropAccept","handleWindowResize","rtlDefaults","fc","fullCalendar","version","fcViews","views","fn","options","args","Array","prototype","slice","call","arguments","res","each","calendar","data","isFunction","r","apply","removeData","eventSources","events","push","extend","i","_element","element","Calendar","render","setDefaults","d","t","destroy","refetchEvents","reportEvents","reportEventChange","rerenderEvents","changeView","select","unselect","gotoDate","incrementDate","formatDate","format","date","formatDates","date1","date2","getDate","getView","option","trigger","EventManager","isFetchNeeded","fetchEvents","headerElement","content","tm","currentView","elementOuterWidth","suggestedViewHeight","resizeUID","ignoreWindowResize","_dragElement","setYMD","year","inc","initialRender","elementVisible","calcSize","_renderView","addClass","prependTo","Header","prepend","window","resize","windowResize","bodyVisible","lateRender","setTimeout","start","renderView","triggerEventDestroy","unbind","remove","removeClass","is","newViewName","name","_changeView","freezeContentHeight","deactivateButton","activateButton","appendTo","unfreezeContentHeight","end","clearEvents","setSize","afterRender","noop","updateTitle","updateTodayButton","getAndRenderEvents","updateSize","renderEvents","contentHeight","height","vsides","Math","round","width","max","setHeight","setWidth","outerWidth","uid","fetchAndRenderEvents","modifiedEventID","setEventData","clearEventData","visStart","visEnd","_events","eventID","title","disableButton","enableButton","allDay","addYears","dateOfMonth","cloneDate","years","months","days","addMonths","addDays","css","overflow","thisObj","droppable","document","bind","ev","ui","_e","parents","length","accept","dragStart","dragStop","sections","append","renderSection","position","buttonStr","split","prevButton","j","buttonName","buttonClick","button","icon","smartProperty","text","click","hasClass","mousedown","not","mouseup","hover","disableTextSelection","html","find","sourceNormalizers","sourceFetchers","ajaxDefaults","dataType","cache","eventGUID","_sources","addEventSource","removeEventSource","updateEvent","renderEvent","removeEvents","clientEvents","normalizeEvent","stickySource","sources","rangeStart","rangeEnd","currentFetchID","pendingSourceCnt","loadingLevel","_addEventSource","fetchID","len","fetchEventSource","source","_fetchEventSource","eventDataTransform","concat","callback","fetchers","pushLoading","popLoading","isArray","url","success","error","complete","customData","firstDefined","ajax","applyAll","normalizeSource","grep","src","isSourcesEqual","event","defaultEventEnd","startDelta","_start","endDelta","_end","_id","editable","color","backgroundColor","borderColor","textColor","stick","filter","parseDate","normalizers","source1","source2","getSourcePrimitive","parseISO8601","parseTime","dayIDs","DAY_MS","HOUR_MS","MINUTE_MS","n","keepTime","setFullYear","getFullYear","clearTime","m","getMonth","check","setDate","setMonth","dd","setHours","fixDate","setTime","addMinutes","setMinutes","getMinutes","setSeconds","setMilliseconds","dontKeepTime","zeroDate","getHours","dayDiff","d1","d2","y","s","match","parseFloat","Number","setUTCFullYear","setUTCHours","offset","h","parseInt","toLowerCase","charAt","otherDate","c","i2","formatter","substring","subres","replace","subformat","dateFormatters","getSeconds","ss","zeroPad","mm","hh","H","HH","ddd","o","getDay","dddd","M","MM","MMM","MMMM","yy","yyyy","tt","T","TT","u","S","w","W","iso8601Week","time","checkDate","floor","exclEndDay","_exclEndDay","lazySegBind","container","segs","bindHandlers","mouseover","parent","seg","parentNode","_fci","stopPropagation","setOuterWidth","includeMargins","hsides","setOuterHeight","hpadding","hborders","hmargins","vpadding","vborders","vmargins","dateCompare","a","b","arrayMax","obj","parts","htmlEscape","attr","markFirstLast","setDayID","cell","_cell","getSkinCss","opt","eventColor","sourceColor","optionColor","statements","join","functions","ret","MonthView","BasicView","renderBasic","skipHiddenDays","getCellsPerWeek","delta","colCnt","rowCnt","basicWeek","BasicWeekView","basicDay","BasicDayView","weekMode","viewName","renderDayOverlay","defaultSelectionEnd","renderSelection","clearSelection","reportDayClick","getHoverListener","hoverListener","colLeft","colRight","colContentLeft","colContentRight","getIsCellAllDay","allDayRow","getRowCnt","getColCnt","getColWidth","colWidth","getDaySegmentContainer","daySegmentContainer","View","OverlayManager","SelectionManager","BasicEventRenderer","renderOverlay","clearOverlays","daySelectionMousedown","cellToDate","dateToCell","rangeToSegments","table","head","headCells","body","bodyRows","bodyCells","bodyFirstCells","firstRowCellInners","firstRowCellContentInners","viewWidth","viewHeight","weekNumberWidth","showNumbers","coordinateGrid","colPositions","colContentPositions","colFormat","showWeekNumbers","weekNumberFormat","_rowCnt","_colCnt","_showNumbers","updateOptions","buildEventContainer","buildTable","buildTableHTML","eq","add","dayBind","buildHeadHTML","buildBodyHTML","headerClass","col","contentClass","row","buildCellHTML","classNames","bodyHeight","rowHeight","rowHeightLast","clear","dayClick","overlayStart","overlayEnd","refreshCoordinateGrid","build","segments","segment","renderCellOverlay","leftCol","rightCol","row0","col0","row1","col1","rect","startDate","endDate","stop","CoordinateGrid","rows","cols","p","top","outerHeight","HoverListener","HorizontalPositionCache","DayEventRenderer","modifiedEventId","renderDayEvents","empty","agendaWeek","AgendaWeekView","AgendaView","renderAgenda","agendaDay","AgendaDayView","allDaySlot","allDayText","firstHour","slotMinutes","defaultEventMinutes","axisFormat","agenda","dragOpacity","minTime","maxTime","slotEventOverlap","timePosition","getAllDayRow","getCoordinateGrid","getSlotSegmentContainer","slotSegmentContainer","getMinMinute","minMinute","getMaxMinute","maxMinute","getSlotContainer","slotContainer","getSnapHeight","snapHeight","getSnapMinutes","snapMinutes","AgendaEventRenderer","reportSelection","slotSegHtml","dayTable","dayHead","dayHeadCells","dayBody","dayBodyCells","dayBodyCellInners","dayBodyCellContentInners","dayBodyFirstCell","dayBodyFirstCellStretcher","slotLayer","allDayTable","slotScroller","slotTable","selectionHelper","axisWidth","gutterWidth","slotHeight","snapRatio","slotCnt","slotTopCache","rtl","buildSkeleton","buildDayTable","maxd","minutes","slotNormal","slotBind","buildDayTableHTML","buildDayTableHeadHTML","buildDayTableBodyHTML","weekText","cellsHTML","cellHTML","headHeight","allDayHeight","min","axisFirstCells","gutterCells","slotTableWidth","clientWidth","show","hide","resetScroll","d0","scrollDate","scroll","scrollTop","cells","slotClick","slotSelectionMousedown","pageX","rowMatch","mins","hours","renderSlotOverlay","dayStart","dayEnd","stretchStart","stretchEnd","bottom","slotTableTop","slotScrollerTop","slotScrollerBottom","constrain","realCellToDate","slotIndex","slotI","slotTop","offsetTop","renderSlotSelection","helperOption","helperRes","isStart","isEnd","which","dates","origCell","sort","one","isEventDraggable","isEventResizable","eventEnd","eventElementHandlers","reportEventElement","showEvents","hideEvents","eventDrop","eventResize","draggableDayEvent","dayEvents","slotEvents","renderSlotSegs","compileSlotSegs","visEventEnds","slotEventEnd","colSegs","sliceSegs","placeSlotSegs","eventStart","segStart","segEnd","compareSlotSegs","segCnt","columnLeft","columnRight","columnWidth","eventElements","eventElement","triggerRes","titleElement","forwardCoord","backwardCoord","innerHTML","bindSlotSeg","contentTop","style","skinCss","classes","timeElement","draggableSlotEvent","resizableSlotEvent","origWidth","revert","dayDelta","draggable","opacity","revertDuration","origDate","resetElement","minuteDelta","origPosition","isInBounds","prevIsInBounds","isAllDay","prevIsAllDay","colDelta","prevColDelta","prevMinuteDelta","grid","axis","pageY","drag","updateUI","updateTimeText","newStart","newEnd","snapDelta","prevSnapDelta","resizable","handles","originalSize","levels","buildSlotSegLevels","level0","computeForwardSlotSegs","computeSlotSegPressures","computeSlotSegCoords","flattenSlotSegLevels","computeSlotSegCollisions","level","k","forwardSegs","forwardPressure","forwardSeg","seriesBackwardPressure","seriesBackwardCoord","compareForwardSlotSegs","otherSegs","results","isSlotSegCollision","seg1","seg2","localeCompare","eventsByID","eventElementsByID","eventElementCouples","viewNameOverride","v","isPlainObject","startEditable","durationEditable","couple","exceptElement","eachEventElement","funcName","elements","oldAllDay","eventId","moveEvents","elongateEvents","isHiddenDay","dateToDayOffset","dayOffsetToCellOffset","cellOffsetToCell","cellToCellOffset","cellOffsetToDayOffset","dayOffsetToDate","hiddenDays","isHiddenDayHash","cellsPerWeek","dayToCellMap","cellToDayMap","dayIndex","cellIndex","inArray","isExclusive","cellOffset","dayOffset","dis","dit","day0","rangeDayOffsetStart","rangeDayOffsetEnd","rangeCellOffsetFirst","rangeCellOffsetLast","rowCellOffsetFirst","rowCellOffsetLast","segmentCellOffsetFirst","segmentCellOffsetLast","segmentCellFirst","segmentCellLast","resizableDayEvent","_renderDayEvents","segmentElementEach","attachHandlers","renderTempDayEvent","adjustRow","adjustTop","doAppend","doRowHeights","finalContainer","renderContainer","buildSegments","calculateHorizontals","buildHTML","resolveElements","setVerticals","eventSegments","buildSegmentsForEvent","leftFunc","rightFunc","buildHTMLForSegment","replaceWith","rowContentHeights","calculateVerticals","rowContentElements","getRowContentElements","rowContentTops","segmentRows","buildSegmentRows","rowI","segmentRow","colHeights","colI","segmentI","sortSegmentRow","sortedSegments","subrows","buildSegmentSubrows","compareDaySegments","isDaySegmentCollision","rowDivs","segmentContainer","bindDaySeg","delay","rowDelta","direction","handle","isResizing","preventDefault","stopImmediatePropagation","elementTop","helpers","eventCopy","minCellOffset","origCellOffset","oldHelpers","otherSegments","otherSegment","selected","ignore","_mousedownElement","usedOverlays","unusedOverlays","shift","buildFunc","x","originElement","origin","bindType","change","firstCell","_change","_bindType","mouse","_fixUIEvent","newCell","originalEvent","getElement","lefts","rights","jQuery","$RefreshReg$"],"sources":["/home/nomade00/Área de Trabalho/Trabalho James/trabcar/src/pages/CadHorario.js"],"sourcesContent":["\nimport React, { useState, useEffect } from 'react';\n\nfunction CadastroHorario() {\n  const [selectedProfessor, setSelectedProfessor] = useState('');\n  const [selectedSala, setSelectedSala] = useState('');\n  const [selectedNomeDesafio, setSelectedNomeDesafio] = useState('');\n  const [setSelectedCurso] = useState('');\n  const [professores, setProfessores] = useState([]);\n  const [salas, setSalas] = useState([]);\n  const [nomeDesafios, setNomeDesafios] = useState([]);\n  const [horarios, setHorarios] = useState([]);\n  const [horaInicial, setHoraInicial] = useState([]);\n  const [horaFinal, setHoraFinal] = useState([]);\n\n\n  useEffect(() => {\n    const storedHorarios = JSON.parse(localStorage.getItem('Horarios')) || [];\n    setHorarios(storedHorarios);\n  \n    const storedProfessores = JSON.parse(localStorage.getItem('Professores')) || [];\n    setProfessores(storedProfessores);\n  \n    const storedSalas = JSON.parse(localStorage.getItem('Salas')) || [];\n    setSalas(storedSalas);\n  \n    const storedDesafios = JSON.parse(localStorage.getItem('Desafios')) || [];\n    setNomeDesafios(storedDesafios);\n  \n  }, []);\n  \n  const adicionarHorarios = () => {\n   \n    if (\n      selectedProfessor.trim() &&\n      horaFinal.trim() &&\n      horaInicial.trim() &&\n      selectedSala.trim()\n      \n    ) {\n\n      const novoHorario = {\n        id: new Date().getTime(),\n        professor: selectedProfessor,      \n        sala: selectedSala,\n        desafio: selectedNomeDesafio,\n        horaInicial: horaInicial,\n        horaFinal: horaFinal,\n      };\n  console.log(novoHorario)\n      setHorarios((prevHorarios) => {\n        const newHorarios = [...prevHorarios, novoHorario];\n        localStorage.setItem('Horarios', JSON.stringify(newHorarios));\n        return newHorarios;\n      });\n  \n      // Limpa os campos após adicionar\n      setSelectedProfessor('');\n      setSelectedCurso('');\n      setHoraInicial('');\n      setHoraFinal('');\n      setSelectedSala('');\n    }\n  };\n\n  const excluirHorario = (index) => {\n    const novoHorario = [...horarios];\n    novoHorario.splice(index, 1);\n    setHorarios(novoHorario);\n    localStorage.setItem('Horario', JSON.stringify(novoHorario))\n  };\n\n\n  return (\n    <div>\n      <div id='Cad' className=\"form-container\">\n  \n        <h4>Selecione um Professor: </h4>\n        <select\n          id=\"professor\"\n          value={selectedProfessor}\n          onChange={(e) => setSelectedProfessor(e.target.value)}\n        >\n          <option value=\"\" disabled>Selecione um professor</option>\n          {professores.map((professor, index) => (\n            <option key={index} value={professor.nomeProfessor}>{professor.nomeProfessor}</option>\n          ))}\n        </select>\n\n        <h4>Selecione uma Sala: </h4>\n        <select\n          id=\"sala\"\n          value={selectedSala}\n          onChange={(e) => setSelectedSala(e.target.value)}\n        >\n          <option value=\"\" disabled>\n            Selecione uma Sala\n          </option>\n          {salas.map((sala, index) => (\n            <option key={index} value={sala.numeroSala}>\n              {sala.numeroSala}\n            </option>\n          ))}\n        </select>\n\n        <h4>Selecione um Desafio: </h4>\n        <select\n          id=\"desafio\"\n          value={selectedNomeDesafio}\n          onChange={(e) => setSelectedNomeDesafio(e.target.value)}\n        >\n          <option value=\"\" disabled>\n            Selecione um Desafio\n          </option>\n          {nomeDesafios.map((desafio, index) => (\n            <option key={index} value={desafio.nomeDesafio}>\n              {desafio.nomeDesafio}\n            </option>\n          ))}\n        </select>\n            <div>\n        <h4>Horário Inicio: </h4>\n        <input\n          className='home-container'\n          type=\"time\"\n          value={horaInicial}\n          onChange={(e) => setHoraInicial(e.target.value)}\n        />\n\n        <h4>Horário Final: </h4>\n        <input\n          className='home-container'\n          type=\"time\"\n          value={horaFinal}\n          onChange={(e) => setHoraFinal(e.target.value)}\n        />\n        </div>\n\n        <button onClick={adicionarHorarios}>Adicionar</button>\n        \n      </div>\n\n      <div className=\"table-container\">\n        <h2>Horario</h2>\n        <table id=\"tabelaPessoas\">\n          <thead>\n            <tr>\n              <th>ID</th>\n              <th>Professor</th>\n              <th>Sala</th>\n              <th>Curso</th>\n              <th>Horario</th>\n\n            </tr>\n          </thead>\n          <tbody>\n            {horarios.map((horario, index) => (\n              <tr key={horario.id}>\n                <td>{horario.id}</td>\n                <td>{horario.professor}</td>\n                <td>{horario.sala}</td>\n                <td>{horario.desafio}</td>\n                <td>{horario.horaInicial} a{' '}\n                  {horario.horaFinal}\n                </td>\n                <td>\n                  <button className=\"excluir-btn\" onClick={() => excluirHorario(horario.id)}>\n                    Excluir\n                  </button>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}\n\n/*!\n * FullCalendar v1.6.4\n * Docs & License: http://arshaw.com/fullcalendar/\n * (c) 2013 Adam Shaw\n */\n\n/*\n * Use fullcalendar.css for basic styling.\n * For event drag & drop, requires jQuery UI draggable.\n * For event resizing, requires jQuery UI resizable.\n */\n \n(function($, undefined) {\n\n\n;;\n\nvar defaults = {\n\n\t// display\n\tdefaultView: 'month',\n\taspectRatio: 1.35,\n\theader: {\n\t\tleft: 'title',\n\t\tcenter: '',\n\t\tright: 'today prev,next'\n\t},\n\tweekends: true,\n\tweekNumbers: false,\n\tweekNumberCalculation: 'iso',\n\tweekNumberTitle: 'W',\n\t\n\t// editing\n\t//editable: false,\n\t//disableDragging: false,\n\t//disableResizing: false,\n\t\n\tallDayDefault: true,\n\tignoreTimezone: true,\n\t\n\t// event ajax\n\tlazyFetching: true,\n\tstartParam: 'start',\n\tendParam: 'end',\n\t\n\t// time formats\n\ttitleFormat: {\n\t\tmonth: 'MMMM yyyy',\n\t\tweek: \"MMM d[ yyyy]{ '—'[ MMM] d yyyy}\",\n\t\tday: 'dddd, MMM d, yyyy'\n\t},\n\tcolumnFormat: {\n\t\tmonth: 'ddd',\n\t\tweek: 'ddd M/d',\n\t\tday: 'dddd M/d'\n\t},\n\ttimeFormat: { // for event elements\n\t\t'': 'h(:mm)t' // default\n\t},\n\t\n\t// locale\n\tisRTL: false,\n\tfirstDay: 0,\n\tmonthNames: ['January','February','March','April','May','June','July','August','September','October','November','December'],\n\tmonthNamesShort: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],\n\tdayNames: ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],\n\tdayNamesShort: ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],\n\tbuttonText: {\n\t\tprev: \"<span class='fc-text-arrow'>‹</span>\",\n\t\tnext: \"<span class='fc-text-arrow'>›</span>\",\n\t\tprevYear: \"<span class='fc-text-arrow'>«</span>\",\n\t\tnextYear: \"<span class='fc-text-arrow'>»</span>\",\n\t\ttoday: 'today',\n\t\tmonth: 'month',\n\t\tweek: 'week',\n\t\tday: 'day'\n\t},\n\t\n\t// jquery-ui theming\n\ttheme: false,\n\tbuttonIcons: {\n\t\tprev: 'circle-triangle-w',\n\t\tnext: 'circle-triangle-e'\n\t},\n\t\n\t//selectable: false,\n\tunselectAuto: true,\n\t\n\tdropAccept: '*',\n\t\n\thandleWindowResize: true\n\t\n};\n\n// right-to-left defaults\nvar rtlDefaults = {\n\theader: {\n\t\tleft: 'next,prev today',\n\t\tcenter: '',\n\t\tright: 'title'\n\t},\n\tbuttonText: {\n\t\tprev: \"<span class='fc-text-arrow'>›</span>\",\n\t\tnext: \"<span class='fc-text-arrow'>‹</span>\",\n\t\tprevYear: \"<span class='fc-text-arrow'>»</span>\",\n\t\tnextYear: \"<span class='fc-text-arrow'>«</span>\"\n\t},\n\tbuttonIcons: {\n\t\tprev: 'circle-triangle-e',\n\t\tnext: 'circle-triangle-w'\n\t}\n};\n\n\n\n;;\n\nvar fc = $.fullCalendar = { version: \"1.6.4\" };\nvar fcViews = fc.views = {};\n\n\n$.fn.fullCalendar = function(options) {\n\n\n\t// method calling\n\tif (typeof options == 'string') {\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\t\tvar res;\n\t\tthis.each(function() {\n\t\t\tvar calendar = $.data(this, 'fullCalendar');\n\t\t\tif (calendar && $.isFunction(calendar[options])) {\n\t\t\t\tvar r = calendar[options].apply(calendar, args);\n\t\t\t\tif (res === undefined) {\n\t\t\t\t\tres = r;\n\t\t\t\t}\n\t\t\t\tif (options == 'destroy') {\n\t\t\t\t\t$.removeData(this, 'fullCalendar');\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tif (res !== undefined) {\n\t\t\treturn res;\n\t\t}\n\t\treturn this;\n\t}\n\n\toptions = options || {};\n\t\n\t// would like to have this logic in EventManager, but needs to happen before options are recursively extended\n\tvar eventSources = options.eventSources || [];\n\tdelete options.eventSources;\n\tif (options.events) {\n\t\teventSources.push(options.events);\n\t\tdelete options.events;\n\t}\n\t\n\n\toptions = $.extend(true, {},\n\t\tdefaults,\n\t\t(options.isRTL || options.isRTL===undefined && defaults.isRTL) ? rtlDefaults : {},\n\t\toptions\n\t);\n\t\n\t\n\tthis.each(function(i, _element) {\n\t\tvar element = $(_element);\n\t\tvar calendar = new Calendar(element, options, eventSources);\n\t\telement.data('fullCalendar', calendar); // TODO: look into memory leak implications\n\t\tcalendar.render();\n\t});\n\t\n\t\n\treturn this;\n\t\n};\n\n\n// function for adding/overriding defaults\nfunction setDefaults(d) {\n\t$.extend(true, defaults, d);\n}\n\n\n\n;;\n\n \nfunction Calendar(element, options, eventSources) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.options = options;\n\tt.render = render;\n\tt.destroy = destroy;\n\tt.refetchEvents = refetchEvents;\n\tt.reportEvents = reportEvents;\n\tt.reportEventChange = reportEventChange;\n\tt.rerenderEvents = rerenderEvents;\n\tt.changeView = changeView;\n\tt.select = select;\n\tt.unselect = unselect;\n\tt.prev = prev;\n\tt.next = next;\n\tt.prevYear = prevYear;\n\tt.nextYear = nextYear;\n\tt.today = today;\n\tt.gotoDate = gotoDate;\n\tt.incrementDate = incrementDate;\n\tt.formatDate = function(format, date) { return formatDate(format, date, options) };\n\tt.formatDates = function(format, date1, date2) { return formatDates(format, date1, date2, options) };\n\tt.getDate = getDate;\n\tt.getView = getView;\n\tt.option = option;\n\tt.trigger = trigger;\n\t\n\t\n\t// imports\n\tEventManager.call(t, options, eventSources);\n\tvar isFetchNeeded = t.isFetchNeeded;\n\tvar fetchEvents = t.fetchEvents;\n\t\n\t\n\t// locals\n\tvar _element = element[0];\n\tvar header;\n\tvar headerElement;\n\tvar content;\n\tvar tm; // for making theme classes\n\tvar currentView;\n\tvar elementOuterWidth;\n\tvar suggestedViewHeight;\n\tvar resizeUID = 0;\n\tvar ignoreWindowResize = 0;\n\tvar date = new Date();\n\tvar events = [];\n\tvar _dragElement;\n\t\n\t\n\t\n\t/* Main Rendering\n\t-----------------------------------------------------------------------------*/\n\t\n\t\n\tsetYMD(date, options.year, options.month, options.date);\n\t\n\t\n\tfunction render(inc) {\n\t\tif (!content) {\n\t\t\tinitialRender();\n\t\t}\n\t\telse if (elementVisible()) {\n\t\t\t// mainly for the public API\n\t\t\tcalcSize();\n\t\t\t_renderView(inc);\n\t\t}\n\t}\n\t\n\t\n\tfunction initialRender() {\n\t\ttm = options.theme ? 'ui' : 'fc';\n\t\telement.addClass('fc');\n\t\tif (options.isRTL) {\n\t\t\telement.addClass('fc-rtl');\n\t\t}\n\t\telse {\n\t\t\telement.addClass('fc-ltr');\n\t\t}\n\t\tif (options.theme) {\n\t\t\telement.addClass('ui-widget');\n\t\t}\n\n\t\tcontent = $(\"<div class='fc-content' style='position:relative'/>\")\n\t\t\t.prependTo(element);\n\n\t\theader = new Header(t, options);\n\t\theaderElement = header.render();\n\t\tif (headerElement) {\n\t\t\telement.prepend(headerElement);\n\t\t}\n\n\t\tchangeView(options.defaultView);\n\n\t\tif (options.handleWindowResize) {\n\t\t\t$(window).resize(windowResize);\n\t\t}\n\n\t\t// needed for IE in a 0x0 iframe, b/c when it is resized, never triggers a windowResize\n\t\tif (!bodyVisible()) {\n\t\t\tlateRender();\n\t\t}\n\t}\n\t\n\t\n\t// called when we know the calendar couldn't be rendered when it was initialized,\n\t// but we think it's ready now\n\tfunction lateRender() {\n\t\tsetTimeout(function() { // IE7 needs this so dimensions are calculated correctly\n\t\t\tif (!currentView.start && bodyVisible()) { // !currentView.start makes sure this never happens more than once\n\t\t\t\trenderView();\n\t\t\t}\n\t\t},0);\n\t}\n\t\n\t\n\tfunction destroy() {\n\n\t\tif (currentView) {\n\t\t\ttrigger('viewDestroy', currentView, currentView, currentView.element);\n\t\t\tcurrentView.triggerEventDestroy();\n\t\t}\n\n\t\t$(window).unbind('resize', windowResize);\n\n\t\theader.destroy();\n\t\tcontent.remove();\n\t\telement.removeClass('fc fc-rtl ui-widget');\n\t}\n\t\n\t\n\tfunction elementVisible() {\n\t\treturn element.is(':visible');\n\t}\n\t\n\t\n\tfunction bodyVisible() {\n\t\treturn $('body').is(':visible');\n\t}\n\t\n\t\n\t\n\t/* View Rendering\n\t-----------------------------------------------------------------------------*/\n\t\n\n\tfunction changeView(newViewName) {\n\t\tif (!currentView || newViewName != currentView.name) {\n\t\t\t_changeView(newViewName);\n\t\t}\n\t}\n\n\n\tfunction _changeView(newViewName) {\n\t\tignoreWindowResize++;\n\n\t\tif (currentView) {\n\t\t\ttrigger('viewDestroy', currentView, currentView, currentView.element);\n\t\t\tunselect();\n\t\t\tcurrentView.triggerEventDestroy(); // trigger 'eventDestroy' for each event\n\t\t\tfreezeContentHeight();\n\t\t\tcurrentView.element.remove();\n\t\t\theader.deactivateButton(currentView.name);\n\t\t}\n\n\t\theader.activateButton(newViewName);\n\n\t\tcurrentView = new fcViews[newViewName](\n\t\t\t$(\"<div class='fc-view fc-view-\" + newViewName + \"' style='position:relative'/>\")\n\t\t\t\t.appendTo(content),\n\t\t\tt // the calendar object\n\t\t);\n\n\t\trenderView();\n\t\tunfreezeContentHeight();\n\n\t\tignoreWindowResize--;\n\t}\n\n\n\tfunction renderView(inc) {\n\t\tif (\n\t\t\t!currentView.start || // never rendered before\n\t\t\tinc || date < currentView.start || date >= currentView.end // or new date range\n\t\t) {\n\t\t\tif (elementVisible()) {\n\t\t\t\t_renderView(inc);\n\t\t\t}\n\t\t}\n\t}\n\n\n\tfunction _renderView(inc) { // assumes elementVisible\n\t\tignoreWindowResize++;\n\n\t\tif (currentView.start) { // already been rendered?\n\t\t\ttrigger('viewDestroy', currentView, currentView, currentView.element);\n\t\t\tunselect();\n\t\t\tclearEvents();\n\t\t}\n\n\t\tfreezeContentHeight();\n\t\tcurrentView.render(date, inc || 0); // the view's render method ONLY renders the skeleton, nothing else\n\t\tsetSize();\n\t\tunfreezeContentHeight();\n\t\t(currentView.afterRender || noop)();\n\n\t\tupdateTitle();\n\t\tupdateTodayButton();\n\n\t\ttrigger('viewRender', currentView, currentView, currentView.element);\n\t\tcurrentView.trigger('viewDisplay', _element); // deprecated\n\n\t\tignoreWindowResize--;\n\n\t\tgetAndRenderEvents();\n\t}\n\t\n\t\n\n\t/* Resizing\n\t-----------------------------------------------------------------------------*/\n\t\n\t\n\tfunction updateSize() {\n\t\tif (elementVisible()) {\n\t\t\tunselect();\n\t\t\tclearEvents();\n\t\t\tcalcSize();\n\t\t\tsetSize();\n\t\t\trenderEvents();\n\t\t}\n\t}\n\t\n\t\n\tfunction calcSize() { // assumes elementVisible\n\t\tif (options.contentHeight) {\n\t\t\tsuggestedViewHeight = options.contentHeight;\n\t\t}\n\t\telse if (options.height) {\n\t\t\tsuggestedViewHeight = options.height - (headerElement ? headerElement.height() : 0) - vsides(content);\n\t\t}\n\t\telse {\n\t\t\tsuggestedViewHeight = Math.round(content.width() / Math.max(options.aspectRatio, .5));\n\t\t}\n\t}\n\t\n\t\n\tfunction setSize() { // assumes elementVisible\n\n\t\tif (suggestedViewHeight === undefined) {\n\t\t\tcalcSize(); // for first time\n\t\t\t\t// NOTE: we don't want to recalculate on every renderView because\n\t\t\t\t// it could result in oscillating heights due to scrollbars.\n\t\t}\n\n\t\tignoreWindowResize++;\n\t\tcurrentView.setHeight(suggestedViewHeight);\n\t\tcurrentView.setWidth(content.width());\n\t\tignoreWindowResize--;\n\n\t\telementOuterWidth = element.outerWidth();\n\t}\n\t\n\t\n\tfunction windowResize() {\n\t\tif (!ignoreWindowResize) {\n\t\t\tif (currentView.start) { // view has already been rendered\n\t\t\t\tvar uid = ++resizeUID;\n\t\t\t\tsetTimeout(function() { // add a delay\n\t\t\t\t\tif (uid == resizeUID && !ignoreWindowResize && elementVisible()) {\n\t\t\t\t\t\tif (elementOuterWidth != (elementOuterWidth = element.outerWidth())) {\n\t\t\t\t\t\t\tignoreWindowResize++; // in case the windowResize callback changes the height\n\t\t\t\t\t\t\tupdateSize();\n\t\t\t\t\t\t\tcurrentView.trigger('windowResize', _element);\n\t\t\t\t\t\t\tignoreWindowResize--;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}, 200);\n\t\t\t}else{\n\t\t\t\t// calendar must have been initialized in a 0x0 iframe that has just been resized\n\t\t\t\tlateRender();\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t\n\t/* Event Fetching/Rendering\n\t-----------------------------------------------------------------------------*/\n\t// TODO: going forward, most of this stuff should be directly handled by the view\n\n\n\tfunction refetchEvents() { // can be called as an API method\n\t\tclearEvents();\n\t\tfetchAndRenderEvents();\n\t}\n\n\n\tfunction rerenderEvents(modifiedEventID) { // can be called as an API method\n\t\tclearEvents();\n\t\trenderEvents(modifiedEventID);\n\t}\n\n\n\tfunction renderEvents(modifiedEventID) { // TODO: remove modifiedEventID hack\n\t\tif (elementVisible()) {\n\t\t\tcurrentView.setEventData(events); // for View.js, TODO: unify with renderEvents\n\t\t\tcurrentView.renderEvents(events, modifiedEventID); // actually render the DOM elements\n\t\t\tcurrentView.trigger('eventAfterAllRender');\n\t\t}\n\t}\n\n\n\tfunction clearEvents() {\n\t\tcurrentView.triggerEventDestroy(); // trigger 'eventDestroy' for each event\n\t\tcurrentView.clearEvents(); // actually remove the DOM elements\n\t\tcurrentView.clearEventData(); // for View.js, TODO: unify with clearEvents\n\t}\n\t\n\n\tfunction getAndRenderEvents() {\n\t\tif (!options.lazyFetching || isFetchNeeded(currentView.visStart, currentView.visEnd)) {\n\t\t\tfetchAndRenderEvents();\n\t\t}\n\t\telse {\n\t\t\trenderEvents();\n\t\t}\n\t}\n\n\n\tfunction fetchAndRenderEvents() {\n\t\tfetchEvents(currentView.visStart, currentView.visEnd);\n\t\t\t// ... will call reportEvents\n\t\t\t// ... which will call renderEvents\n\t}\n\n\t\n\t// called when event data arrives\n\tfunction reportEvents(_events) {\n\t\tevents = _events;\n\t\trenderEvents();\n\t}\n\n\n\t// called when a single event's data has been changed\n\tfunction reportEventChange(eventID) {\n\t\trerenderEvents(eventID);\n\t}\n\n\n\n\t/* Header Updating\n\t-----------------------------------------------------------------------------*/\n\n\n\tfunction updateTitle() {\n\t\theader.updateTitle(currentView.title);\n\t}\n\n\n\tfunction updateTodayButton() {\n\t\tvar today = new Date();\n\t\tif (today >= currentView.start && today < currentView.end) {\n\t\t\theader.disableButton('today');\n\t\t}\n\t\telse {\n\t\t\theader.enableButton('today');\n\t\t}\n\t}\n\t\n\n\n\t/* Selection\n\t-----------------------------------------------------------------------------*/\n\t\n\n\tfunction select(start, end, allDay) {\n\t\tcurrentView.select(start, end, allDay===undefined ? true : allDay);\n\t}\n\t\n\n\tfunction unselect() { // safe to be called before renderView\n\t\tif (currentView) {\n\t\t\tcurrentView.unselect();\n\t\t}\n\t}\n\t\n\t\n\t\n\t/* Date\n\t-----------------------------------------------------------------------------*/\n\t\n\t\n\tfunction prev() {\n\t\trenderView(-1);\n\t}\n\t\n\t\n\tfunction next() {\n\t\trenderView(1);\n\t}\n\t\n\t\n\tfunction prevYear() {\n\t\taddYears(date, -1);\n\t\trenderView();\n\t}\n\t\n\t\n\tfunction nextYear() {\n\t\taddYears(date, 1);\n\t\trenderView();\n\t}\n\t\n\t\n\tfunction today() {\n\t\tdate = new Date();\n\t\trenderView();\n\t}\n\t\n\t\n\tfunction gotoDate(year, month, dateOfMonth) {\n\t\tif (year instanceof Date) {\n\t\t\tdate = cloneDate(year); // provided 1 argument, a Date\n\t\t}else{\n\t\t\tsetYMD(date, year, month, dateOfMonth);\n\t\t}\n\t\trenderView();\n\t}\n\t\n\t\n\tfunction incrementDate(years, months, days) {\n\t\tif (years !== undefined) {\n\t\t\taddYears(date, years);\n\t\t}\n\t\tif (months !== undefined) {\n\t\t\taddMonths(date, months);\n\t\t}\n\t\tif (days !== undefined) {\n\t\t\taddDays(date, days);\n\t\t}\n\t\trenderView();\n\t}\n\t\n\t\n\tfunction getDate() {\n\t\treturn cloneDate(date);\n\t}\n\n\n\n\t/* Height \"Freezing\"\n\t-----------------------------------------------------------------------------*/\n\n\n\tfunction freezeContentHeight() {\n\t\tcontent.css({\n\t\t\twidth: '100%',\n\t\t\theight: content.height(),\n\t\t\toverflow: 'hidden'\n\t\t});\n\t}\n\n\n\tfunction unfreezeContentHeight() {\n\t\tcontent.css({\n\t\t\twidth: '',\n\t\t\theight: '',\n\t\t\toverflow: ''\n\t\t});\n\t}\n\t\n\t\n\t\n\t/* Misc\n\t-----------------------------------------------------------------------------*/\n\t\n\t\n\tfunction getView() {\n\t\treturn currentView;\n\t}\n\t\n\t\n\tfunction option(name, value) {\n\t\tif (value === undefined) {\n\t\t\treturn options[name];\n\t\t}\n\t\tif (name == 'height' || name == 'contentHeight' || name == 'aspectRatio') {\n\t\t\toptions[name] = value;\n\t\t\tupdateSize();\n\t\t}\n\t}\n\t\n\t\n\tfunction trigger(name, thisObj) {\n\t\tif (options[name]) {\n\t\t\treturn options[name].apply(\n\t\t\t\tthisObj || _element,\n\t\t\t\tArray.prototype.slice.call(arguments, 2)\n\t\t\t);\n\t\t}\n\t}\n\t\n\t\n\t\n\t/* External Dragging\n\t------------------------------------------------------------------------*/\n\t\n\tif (options.droppable) {\n\t\t$(document)\n\t\t\t.bind('dragstart', function(ev, ui) {\n\t\t\t\tvar _e = ev.target;\n\t\t\t\tvar e = $(_e);\n\t\t\t\tif (!e.parents('.fc').length) { // not already inside a calendar\n\t\t\t\t\tvar accept = options.dropAccept;\n\t\t\t\t\tif ($.isFunction(accept) ? accept.call(_e, e) : e.is(accept)) {\n\t\t\t\t\t\t_dragElement = _e;\n\t\t\t\t\t\tcurrentView.dragStart(_dragElement, ev, ui);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})\n\t\t\t.bind('dragstop', function(ev, ui) {\n\t\t\t\tif (_dragElement) {\n\t\t\t\t\tcurrentView.dragStop(_dragElement, ev, ui);\n\t\t\t\t\t_dragElement = null;\n\t\t\t\t}\n\t\t\t});\n\t}\n\t\n\n}\n\n;;\n\nfunction Header(calendar, options) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.render = render;\n\tt.destroy = destroy;\n\tt.updateTitle = updateTitle;\n\tt.activateButton = activateButton;\n\tt.deactivateButton = deactivateButton;\n\tt.disableButton = disableButton;\n\tt.enableButton = enableButton;\n\t\n\t\n\t// locals\n\tvar element = $([]);\n\tvar tm;\n\t\n\n\n\tfunction render() {\n\t\ttm = options.theme ? 'ui' : 'fc';\n\t\tvar sections = options.header;\n\t\tif (sections) {\n\t\t\telement = $(\"<table class='fc-header' style='width:100%'/>\")\n\t\t\t\t.append(\n\t\t\t\t\t$(\"<tr/>\")\n\t\t\t\t\t\t.append(renderSection('left'))\n\t\t\t\t\t\t.append(renderSection('center'))\n\t\t\t\t\t\t.append(renderSection('right'))\n\t\t\t\t);\n\t\t\treturn element;\n\t\t}\n\t}\n\t\n\t\n\tfunction destroy() {\n\t\telement.remove();\n\t}\n\t\n\t\n\tfunction renderSection(position) {\n\t\tvar e = $(\"<td class='fc-header-\" + position + \"'/>\");\n\t\tvar buttonStr = options.header[position];\n\t\tif (buttonStr) {\n\t\t\t$.each(buttonStr.split(' '), function(i) {\n\t\t\t\tif (i > 0) {\n\t\t\t\t\te.append(\"<span class='fc-header-space'/>\");\n\t\t\t\t}\n\t\t\t\tvar prevButton;\n\t\t\t\t$.each(this.split(','), function(j, buttonName) {\n\t\t\t\t\tif (buttonName == 'title') {\n\t\t\t\t\t\te.append(\"<span class='fc-header-title'><h2> </h2></span>\");\n\t\t\t\t\t\tif (prevButton) {\n\t\t\t\t\t\t\tprevButton.addClass(tm + '-corner-right');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tprevButton = null;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tvar buttonClick;\n\t\t\t\t\t\tif (calendar[buttonName]) {\n\t\t\t\t\t\t\tbuttonClick = calendar[buttonName]; // calendar method\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (fcViews[buttonName]) {\n\t\t\t\t\t\t\tbuttonClick = function() {\n\t\t\t\t\t\t\t\tbutton.removeClass(tm + '-state-hover'); // forget why\n\t\t\t\t\t\t\t\tcalendar.changeView(buttonName);\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (buttonClick) {\n\t\t\t\t\t\t\tvar icon = options.theme ? smartProperty(options.buttonIcons, buttonName) : null; // why are we using smartProperty here?\n\t\t\t\t\t\t\tvar text = smartProperty(options.buttonText, buttonName); // why are we using smartProperty here?\n\t\t\t\t\t\t\tvar button = $(\n\t\t\t\t\t\t\t\t\"<span class='fc-button fc-button-\" + buttonName + \" \" + tm + \"-state-default'>\" +\n\t\t\t\t\t\t\t\t\t(icon ?\n\t\t\t\t\t\t\t\t\t\t\"<span class='fc-icon-wrap'>\" +\n\t\t\t\t\t\t\t\t\t\t\t\"<span class='ui-icon ui-icon-\" + icon + \"'/>\" +\n\t\t\t\t\t\t\t\t\t\t\"</span>\" :\n\t\t\t\t\t\t\t\t\t\ttext\n\t\t\t\t\t\t\t\t\t\t) +\n\t\t\t\t\t\t\t\t\"</span>\"\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.click(function() {\n\t\t\t\t\t\t\t\t\tif (!button.hasClass(tm + '-state-disabled')) {\n\t\t\t\t\t\t\t\t\t\tbuttonClick();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.mousedown(function() {\n\t\t\t\t\t\t\t\t\tbutton\n\t\t\t\t\t\t\t\t\t\t.not('.' + tm + '-state-active')\n\t\t\t\t\t\t\t\t\t\t.not('.' + tm + '-state-disabled')\n\t\t\t\t\t\t\t\t\t\t.addClass(tm + '-state-down');\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.mouseup(function() {\n\t\t\t\t\t\t\t\t\tbutton.removeClass(tm + '-state-down');\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t.hover(\n\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\tbutton\n\t\t\t\t\t\t\t\t\t\t\t.not('.' + tm + '-state-active')\n\t\t\t\t\t\t\t\t\t\t\t.not('.' + tm + '-state-disabled')\n\t\t\t\t\t\t\t\t\t\t\t.addClass(tm + '-state-hover');\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tfunction() {\n\t\t\t\t\t\t\t\t\t\tbutton\n\t\t\t\t\t\t\t\t\t\t\t.removeClass(tm + '-state-hover')\n\t\t\t\t\t\t\t\t\t\t\t.removeClass(tm + '-state-down');\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.appendTo(e);\n\t\t\t\t\t\t\tdisableTextSelection(button);\n\t\t\t\t\t\t\tif (!prevButton) {\n\t\t\t\t\t\t\t\tbutton.addClass(tm + '-corner-left');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tprevButton = button;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tif (prevButton) {\n\t\t\t\t\tprevButton.addClass(tm + '-corner-right');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\treturn e;\n\t}\n\t\n\t\n\tfunction updateTitle(html) {\n\t\telement.find('h2')\n\t\t\t.html(html);\n\t}\n\t\n\t\n\tfunction activateButton(buttonName) {\n\t\telement.find('span.fc-button-' + buttonName)\n\t\t\t.addClass(tm + '-state-active');\n\t}\n\t\n\t\n\tfunction deactivateButton(buttonName) {\n\t\telement.find('span.fc-button-' + buttonName)\n\t\t\t.removeClass(tm + '-state-active');\n\t}\n\t\n\t\n\tfunction disableButton(buttonName) {\n\t\telement.find('span.fc-button-' + buttonName)\n\t\t\t.addClass(tm + '-state-disabled');\n\t}\n\t\n\t\n\tfunction enableButton(buttonName) {\n\t\telement.find('span.fc-button-' + buttonName)\n\t\t\t.removeClass(tm + '-state-disabled');\n\t}\n\n\n}\n\n;;\n\nfc.sourceNormalizers = [];\nfc.sourceFetchers = [];\n\nvar ajaxDefaults = {\n\tdataType: 'json',\n\tcache: false\n};\n\nvar eventGUID = 1;\n\n\nfunction EventManager(options, _sources) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.isFetchNeeded = isFetchNeeded;\n\tt.fetchEvents = fetchEvents;\n\tt.addEventSource = addEventSource;\n\tt.removeEventSource = removeEventSource;\n\tt.updateEvent = updateEvent;\n\tt.renderEvent = renderEvent;\n\tt.removeEvents = removeEvents;\n\tt.clientEvents = clientEvents;\n\tt.normalizeEvent = normalizeEvent;\n\t\n\t\n\t// imports\n\tvar trigger = t.trigger;\n\tvar getView = t.getView;\n\tvar reportEvents = t.reportEvents;\n\t\n\t\n\t// locals\n\tvar stickySource = { events: [] };\n\tvar sources = [ stickySource ];\n\tvar rangeStart, rangeEnd;\n\tvar currentFetchID = 0;\n\tvar pendingSourceCnt = 0;\n\tvar loadingLevel = 0;\n\tvar cache = [];\n\t\n\t\n\tfor (var i=0; i<_sources.length; i++) {\n\t\t_addEventSource(_sources[i]);\n\t}\n\t\n\t\n\t\n\t/* Fetching\n\t-----------------------------------------------------------------------------*/\n\t\n\t\n\tfunction isFetchNeeded(start, end) {\n\t\treturn !rangeStart || start < rangeStart || end > rangeEnd;\n\t}\n\t\n\t\n\tfunction fetchEvents(start, end) {\n\t\trangeStart = start;\n\t\trangeEnd = end;\n\t\tcache = [];\n\t\tvar fetchID = ++currentFetchID;\n\t\tvar len = sources.length;\n\t\tpendingSourceCnt = len;\n\t\tfor (var i=0; i<len; i++) {\n\t\t\tfetchEventSource(sources[i], fetchID);\n\t\t}\n\t}\n\t\n\t\n\tfunction fetchEventSource(source, fetchID) {\n\t\t_fetchEventSource(source, function(events) {\n\t\t\tif (fetchID == currentFetchID) {\n\t\t\t\tif (events) {\n\n\t\t\t\t\tif (options.eventDataTransform) {\n\t\t\t\t\t\tevents = $.map(events, options.eventDataTransform);\n\t\t\t\t\t}\n\t\t\t\t\tif (source.eventDataTransform) {\n\t\t\t\t\t\tevents = $.map(events, source.eventDataTransform);\n\t\t\t\t\t}\n\t\t\t\t\t// TODO: this technique is not ideal for static array event sources.\n\t\t\t\t\t//  For arrays, we'll want to process all events right in the beginning, then never again.\n\t\t\t\t\n\t\t\t\t\tfor (var i=0; i<events.length; i++) {\n\t\t\t\t\t\tevents[i].source = source;\n\t\t\t\t\t\tnormalizeEvent(events[i]);\n\t\t\t\t\t}\n\t\t\t\t\tcache = cache.concat(events);\n\t\t\t\t}\n\t\t\t\tpendingSourceCnt--;\n\t\t\t\tif (!pendingSourceCnt) {\n\t\t\t\t\treportEvents(cache);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\t\n\t\n\tfunction _fetchEventSource(source, callback) {\n\t\tvar i;\n\t\tvar fetchers = fc.sourceFetchers;\n\t\tvar res;\n\t\tfor (i=0; i<fetchers.length; i++) {\n\t\t\tres = fetchers[i](source, rangeStart, rangeEnd, callback);\n\t\t\tif (res === true) {\n\t\t\t\t// the fetcher is in charge. made its own async request\n\t\t\t\treturn;\n\t\t\t}\n\t\t\telse if (typeof res == 'object') {\n\t\t\t\t// the fetcher returned a new source. process it\n\t\t\t\t_fetchEventSource(res, callback);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tvar events = source.events;\n\t\tif (events) {\n\t\t\tif ($.isFunction(events)) {\n\t\t\t\tpushLoading();\n\t\t\t\tevents(cloneDate(rangeStart), cloneDate(rangeEnd), function(events) {\n\t\t\t\t\tcallback(events);\n\t\t\t\t\tpopLoading();\n\t\t\t\t});\n\t\t\t}\n\t\t\telse if ($.isArray(events)) {\n\t\t\t\tcallback(events);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}else{\n\t\t\tvar url = source.url;\n\t\t\tif (url) {\n\t\t\t\tvar success = source.success;\n\t\t\t\tvar error = source.error;\n\t\t\t\tvar complete = source.complete;\n\n\t\t\t\t// retrieve any outbound GET/POST $.ajax data from the options\n\t\t\t\tvar customData;\n\t\t\t\tif ($.isFunction(source.data)) {\n\t\t\t\t\t// supplied as a function that returns a key/value object\n\t\t\t\t\tcustomData = source.data();\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// supplied as a straight key/value object\n\t\t\t\t\tcustomData = source.data;\n\t\t\t\t}\n\n\t\t\t\t// use a copy of the custom data so we can modify the parameters\n\t\t\t\t// and not affect the passed-in object.\n\t\t\t\tvar data = $.extend({}, customData || {});\n\n\t\t\t\tvar startParam = firstDefined(source.startParam, options.startParam);\n\t\t\t\tvar endParam = firstDefined(source.endParam, options.endParam);\n\t\t\t\tif (startParam) {\n\t\t\t\t\tdata[startParam] = Math.round(+rangeStart / 1000);\n\t\t\t\t}\n\t\t\t\tif (endParam) {\n\t\t\t\t\tdata[endParam] = Math.round(+rangeEnd / 1000);\n\t\t\t\t}\n\n\t\t\t\tpushLoading();\n\t\t\t\t$.ajax($.extend({}, ajaxDefaults, source, {\n\t\t\t\t\tdata: data,\n\t\t\t\t\tsuccess: function(events) {\n\t\t\t\t\t\tevents = events || [];\n\t\t\t\t\t\tvar res = applyAll(success, this, arguments);\n\t\t\t\t\t\tif ($.isArray(res)) {\n\t\t\t\t\t\t\tevents = res;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcallback(events);\n\t\t\t\t\t},\n\t\t\t\t\terror: function() {\n\t\t\t\t\t\tapplyAll(error, this, arguments);\n\t\t\t\t\t\tcallback();\n\t\t\t\t\t},\n\t\t\t\t\tcomplete: function() {\n\t\t\t\t\t\tapplyAll(complete, this, arguments);\n\t\t\t\t\t\tpopLoading();\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}else{\n\t\t\t\tcallback();\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t\n\t/* Sources\n\t-----------------------------------------------------------------------------*/\n\t\n\n\tfunction addEventSource(source) {\n\t\tsource = _addEventSource(source);\n\t\tif (source) {\n\t\t\tpendingSourceCnt++;\n\t\t\tfetchEventSource(source, currentFetchID); // will eventually call reportEvents\n\t\t}\n\t}\n\t\n\t\n\tfunction _addEventSource(source) {\n\t\tif ($.isFunction(source) || $.isArray(source)) {\n\t\t\tsource = { events: source };\n\t\t}\n\t\telse if (typeof source == 'string') {\n\t\t\tsource = { url: source };\n\t\t}\n\t\tif (typeof source == 'object') {\n\t\t\tnormalizeSource(source);\n\t\t\tsources.push(source);\n\t\t\treturn source;\n\t\t}\n\t}\n\t\n\n\tfunction removeEventSource(source) {\n\t\tsources = $.grep(sources, function(src) {\n\t\t\treturn !isSourcesEqual(src, source);\n\t\t});\n\t\t// remove all client events from that source\n\t\tcache = $.grep(cache, function(e) {\n\t\t\treturn !isSourcesEqual(e.source, source);\n\t\t});\n\t\treportEvents(cache);\n\t}\n\t\n\t\n\t\n\t/* Manipulation\n\t-----------------------------------------------------------------------------*/\n\t\n\t\n\tfunction updateEvent(event) { // update an existing event\n\t\tvar i, len = cache.length, e,\n\t\t\tdefaultEventEnd = getView().defaultEventEnd, // getView???\n\t\t\tstartDelta = event.start - event._start,\n\t\t\tendDelta = event.end ?\n\t\t\t\t(event.end - (event._end || defaultEventEnd(event))) // event._end would be null if event.end\n\t\t\t\t: 0;                                                      // was null and event was just resized\n\t\tfor (i=0; i<len; i++) {\n\t\t\te = cache[i];\n\t\t\tif (e._id == event._id && e != event) {\n\t\t\t\te.start = new Date(+e.start + startDelta);\n\t\t\t\tif (event.end) {\n\t\t\t\t\tif (e.end) {\n\t\t\t\t\t\te.end = new Date(+e.end + endDelta);\n\t\t\t\t\t}else{\n\t\t\t\t\t\te.end = new Date(+defaultEventEnd(e) + endDelta);\n\t\t\t\t\t}\n\t\t\t\t}else{\n\t\t\t\t\te.end = null;\n\t\t\t\t}\n\t\t\t\te.title = event.title;\n\t\t\t\te.url = event.url;\n\t\t\t\te.allDay = event.allDay;\n\t\t\t\te.className = event.className;\n\t\t\t\te.editable = event.editable;\n\t\t\t\te.color = event.color;\n\t\t\t\te.backgroundColor = event.backgroundColor;\n\t\t\t\te.borderColor = event.borderColor;\n\t\t\t\te.textColor = event.textColor;\n\t\t\t\tnormalizeEvent(e);\n\t\t\t}\n\t\t}\n\t\tnormalizeEvent(event);\n\t\treportEvents(cache);\n\t}\n\t\n\t\n\tfunction renderEvent(event, stick) {\n\t\tnormalizeEvent(event);\n\t\tif (!event.source) {\n\t\t\tif (stick) {\n\t\t\t\tstickySource.events.push(event);\n\t\t\t\tevent.source = stickySource;\n\t\t\t}\n\t\t\tcache.push(event);\n\t\t}\n\t\treportEvents(cache);\n\t}\n\t\n\t\n\tfunction removeEvents(filter) {\n\t\tif (!filter) { // remove all\n\t\t\tcache = [];\n\t\t\t// clear all array sources\n\t\t\tfor (var i=0; i<sources.length; i++) {\n\t\t\t\tif ($.isArray(sources[i].events)) {\n\t\t\t\t\tsources[i].events = [];\n\t\t\t\t}\n\t\t\t}\n\t\t}else{\n\t\t\tif (!$.isFunction(filter)) { // an event ID\n\t\t\t\tvar id = filter + '';\n\t\t\t\tfilter = function(e) {\n\t\t\t\t\treturn e._id == id;\n\t\t\t\t};\n\t\t\t}\n\t\t\tcache = $.grep(cache, filter, true);\n\t\t\t// remove events from array sources\n\t\t\tfor (var i=0; i<sources.length; i++) {\n\t\t\t\tif ($.isArray(sources[i].events)) {\n\t\t\t\t\tsources[i].events = $.grep(sources[i].events, filter, true);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treportEvents(cache);\n\t}\n\t\n\t\n\tfunction clientEvents(filter) {\n\t\tif ($.isFunction(filter)) {\n\t\t\treturn $.grep(cache, filter);\n\t\t}\n\t\telse if (filter) { // an event ID\n\t\t\tfilter += '';\n\t\t\treturn $.grep(cache, function(e) {\n\t\t\t\treturn e._id == filter;\n\t\t\t});\n\t\t}\n\t\treturn cache; // else, return all\n\t}\n\t\n\t\n\t\n\t/* Loading State\n\t-----------------------------------------------------------------------------*/\n\t\n\t\n\tfunction pushLoading() {\n\t\tif (!loadingLevel++) {\n\t\t\ttrigger('loading', null, true, getView());\n\t\t}\n\t}\n\t\n\t\n\tfunction popLoading() {\n\t\tif (!--loadingLevel) {\n\t\t\ttrigger('loading', null, false, getView());\n\t\t}\n\t}\n\t\n\t\n\t\n\t/* Event Normalization\n\t-----------------------------------------------------------------------------*/\n\t\n\t\n\tfunction normalizeEvent(event) {\n\t\tvar source = event.source || {};\n\t\tvar ignoreTimezone = firstDefined(source.ignoreTimezone, options.ignoreTimezone);\n\t\tevent._id = event._id || (event.id === undefined ? '_fc' + eventGUID++ : event.id + '');\n\t\tif (event.date) {\n\t\t\tif (!event.start) {\n\t\t\t\tevent.start = event.date;\n\t\t\t}\n\t\t\tdelete event.date;\n\t\t}\n\t\tevent._start = cloneDate(event.start = parseDate(event.start, ignoreTimezone));\n\t\tevent.end = parseDate(event.end, ignoreTimezone);\n\t\tif (event.end && event.end <= event.start) {\n\t\t\tevent.end = null;\n\t\t}\n\t\tevent._end = event.end ? cloneDate(event.end) : null;\n\t\tif (event.allDay === undefined) {\n\t\t\tevent.allDay = firstDefined(source.allDayDefault, options.allDayDefault);\n\t\t}\n\t\tif (event.className) {\n\t\t\tif (typeof event.className == 'string') {\n\t\t\t\tevent.className = event.className.split(/\\s+/);\n\t\t\t}\n\t\t}else{\n\t\t\tevent.className = [];\n\t\t}\n\t\t// TODO: if there is no start date, return false to indicate an invalid event\n\t}\n\t\n\t\n\t\n\t/* Utils\n\t------------------------------------------------------------------------------*/\n\t\n\t\n\tfunction normalizeSource(source) {\n\t\tif (source.className) {\n\t\t\t// TODO: repeat code, same code for event classNames\n\t\t\tif (typeof source.className == 'string') {\n\t\t\t\tsource.className = source.className.split(/\\s+/);\n\t\t\t}\n\t\t}else{\n\t\t\tsource.className = [];\n\t\t}\n\t\tvar normalizers = fc.sourceNormalizers;\n\t\tfor (var i=0; i<normalizers.length; i++) {\n\t\t\tnormalizers[i](source);\n\t\t}\n\t}\n\t\n\t\n\tfunction isSourcesEqual(source1, source2) {\n\t\treturn source1 && source2 && getSourcePrimitive(source1) == getSourcePrimitive(source2);\n\t}\n\t\n\t\n\tfunction getSourcePrimitive(source) {\n\t\treturn ((typeof source == 'object') ? (source.events || source.url) : '') || source;\n\t}\n\n\n}\n\n;;\n\n\nfc.addDays = addDays;\nfc.cloneDate = cloneDate;\nfc.parseDate = parseDate;\nfc.parseISO8601 = parseISO8601;\nfc.parseTime = parseTime;\nfc.formatDate = formatDate;\nfc.formatDates = formatDates;\n\n\n\n/* Date Math\n-----------------------------------------------------------------------------*/\n\nvar dayIDs = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'],\n\tDAY_MS = 86400000,\n\tHOUR_MS = 3600000,\n\tMINUTE_MS = 60000;\n\t\n\nfunction addYears(d, n, keepTime) {\n\td.setFullYear(d.getFullYear() + n);\n\tif (!keepTime) {\n\t\tclearTime(d);\n\t}\n\treturn d;\n}\n\n\nfunction addMonths(d, n, keepTime) { // prevents day overflow/underflow\n\tif (+d) { // prevent infinite looping on invalid dates\n\t\tvar m = d.getMonth() + n,\n\t\t\tcheck = cloneDate(d);\n\t\tcheck.setDate(1);\n\t\tcheck.setMonth(m);\n\t\td.setMonth(m);\n\t\tif (!keepTime) {\n\t\t\tclearTime(d);\n\t\t}\n\t\twhile (d.getMonth() != check.getMonth()) {\n\t\t\td.setDate(d.getDate() + (d < check ? 1 : -1));\n\t\t}\n\t}\n\treturn d;\n}\n\n\nfunction addDays(d, n, keepTime) { // deals with daylight savings\n\tif (+d) {\n\t\tvar dd = d.getDate() + n,\n\t\t\tcheck = cloneDate(d);\n\t\tcheck.setHours(9); // set to middle of day\n\t\tcheck.setDate(dd);\n\t\td.setDate(dd);\n\t\tif (!keepTime) {\n\t\t\tclearTime(d);\n\t\t}\n\t\tfixDate(d, check);\n\t}\n\treturn d;\n}\n\n\nfunction fixDate(d, check) { // force d to be on check's YMD, for daylight savings purposes\n\tif (+d) { // prevent infinite looping on invalid dates\n\t\twhile (d.getDate() != check.getDate()) {\n\t\t\td.setTime(+d + (d < check ? 1 : -1) * HOUR_MS);\n\t\t}\n\t}\n}\n\n\nfunction addMinutes(d, n) {\n\td.setMinutes(d.getMinutes() + n);\n\treturn d;\n}\n\n\nfunction clearTime(d) {\n\td.setHours(0);\n\td.setMinutes(0);\n\td.setSeconds(0); \n\td.setMilliseconds(0);\n\treturn d;\n}\n\n\nfunction cloneDate(d, dontKeepTime) {\n\tif (dontKeepTime) {\n\t\treturn clearTime(new Date(+d));\n\t}\n\treturn new Date(+d);\n}\n\n\nfunction zeroDate() { // returns a Date with time 00:00:00 and dateOfMonth=1\n\tvar i=0, d;\n\tdo {\n\t\td = new Date(1970, i++, 1);\n\t} while (d.getHours()); // != 0\n\treturn d;\n}\n\n\nfunction dayDiff(d1, d2) { // d1 - d2\n\treturn Math.round((cloneDate(d1, true) - cloneDate(d2, true)) / DAY_MS);\n}\n\n\nfunction setYMD(date, y, m, d) {\n\tif (y !== undefined && y != date.getFullYear()) {\n\t\tdate.setDate(1);\n\t\tdate.setMonth(0);\n\t\tdate.setFullYear(y);\n\t}\n\tif (m !== undefined && m != date.getMonth()) {\n\t\tdate.setDate(1);\n\t\tdate.setMonth(m);\n\t}\n\tif (d !== undefined) {\n\t\tdate.setDate(d);\n\t}\n}\n\n\n\n/* Date Parsing\n-----------------------------------------------------------------------------*/\n\n\nfunction parseDate(s, ignoreTimezone) { // ignoreTimezone defaults to true\n\tif (typeof s == 'object') { // already a Date object\n\t\treturn s;\n\t}\n\tif (typeof s == 'number') { // a UNIX timestamp\n\t\treturn new Date(s * 1000);\n\t}\n\tif (typeof s == 'string') {\n\t\tif (s.match(/^\\d+(\\.\\d+)?$/)) { // a UNIX timestamp\n\t\t\treturn new Date(parseFloat(s) * 1000);\n\t\t}\n\t\tif (ignoreTimezone === undefined) {\n\t\t\tignoreTimezone = true;\n\t\t}\n\t\treturn parseISO8601(s, ignoreTimezone) || (s ? new Date(s) : null);\n\t}\n\t// TODO: never return invalid dates (like from new Date(<string>)), return null instead\n\treturn null;\n}\n\n\nfunction parseISO8601(s, ignoreTimezone) { // ignoreTimezone defaults to false\n\t// derived from http://delete.me.uk/2005/03/iso8601.html\n\t// TODO: for a know glitch/feature, read tests/issue_206_parseDate_dst.html\n\tvar m = s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);\n\tif (!m) {\n\t\treturn null;\n\t}\n\tvar date = new Date(m[1], 0, 1);\n\tif (ignoreTimezone || !m[13]) {\n\t\tvar check = new Date(m[1], 0, 1, 9, 0);\n\t\tif (m[3]) {\n\t\t\tdate.setMonth(m[3] - 1);\n\t\t\tcheck.setMonth(m[3] - 1);\n\t\t}\n\t\tif (m[5]) {\n\t\t\tdate.setDate(m[5]);\n\t\t\tcheck.setDate(m[5]);\n\t\t}\n\t\tfixDate(date, check);\n\t\tif (m[7]) {\n\t\t\tdate.setHours(m[7]);\n\t\t}\n\t\tif (m[8]) {\n\t\t\tdate.setMinutes(m[8]);\n\t\t}\n\t\tif (m[10]) {\n\t\t\tdate.setSeconds(m[10]);\n\t\t}\n\t\tif (m[12]) {\n\t\t\tdate.setMilliseconds(Number(\"0.\" + m[12]) * 1000);\n\t\t}\n\t\tfixDate(date, check);\n\t}else{\n\t\tdate.setUTCFullYear(\n\t\t\tm[1],\n\t\t\tm[3] ? m[3] - 1 : 0,\n\t\t\tm[5] || 1\n\t\t);\n\t\tdate.setUTCHours(\n\t\t\tm[7] || 0,\n\t\t\tm[8] || 0,\n\t\t\tm[10] || 0,\n\t\t\tm[12] ? Number(\"0.\" + m[12]) * 1000 : 0\n\t\t);\n\t\tif (m[14]) {\n\t\t\tvar offset = Number(m[16]) * 60 + (m[18] ? Number(m[18]) : 0);\n\t\t\toffset *= m[15] == '-' ? 1 : -1;\n\t\t\tdate = new Date(+date + (offset * 60 * 1000));\n\t\t}\n\t}\n\treturn date;\n}\n\n\nfunction parseTime(s) { // returns minutes since start of day\n\tif (typeof s == 'number') { // an hour\n\t\treturn s * 60;\n\t}\n\tif (typeof s == 'object') { // a Date object\n\t\treturn s.getHours() * 60 + s.getMinutes();\n\t}\n\tvar m = s.match(/(\\d+)(?::(\\d+))?\\s*(\\w+)?/);\n\tif (m) {\n\t\tvar h = parseInt(m[1], 10);\n\t\tif (m[3]) {\n\t\t\th %= 12;\n\t\t\tif (m[3].toLowerCase().charAt(0) == 'p') {\n\t\t\t\th += 12;\n\t\t\t}\n\t\t}\n\t\treturn h * 60 + (m[2] ? parseInt(m[2], 10) : 0);\n\t}\n}\n\n\n\n/* Date Formatting\n-----------------------------------------------------------------------------*/\n// TODO: use same function formatDate(date, [date2], format, [options])\n\n\nfunction formatDate(date, format, options) {\n\treturn formatDates(date, null, format, options);\n}\n\n\nfunction formatDates(date1, date2, format, options) {\n\toptions = options || defaults;\n\tvar date = date1,\n\t\totherDate = date2,\n\t\ti, len = format.length, c,\n\t\ti2, formatter,\n\t\tres = '';\n\tfor (i=0; i<len; i++) {\n\t\tc = format.charAt(i);\n\t\tif (c == \"'\") {\n\t\t\tfor (i2=i+1; i2<len; i2++) {\n\t\t\t\tif (format.charAt(i2) == \"'\") {\n\t\t\t\t\tif (date) {\n\t\t\t\t\t\tif (i2 == i+1) {\n\t\t\t\t\t\t\tres += \"'\";\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\tres += format.substring(i+1, i2);\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti = i2;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (c == '(') {\n\t\t\tfor (i2=i+1; i2<len; i2++) {\n\t\t\t\tif (format.charAt(i2) == ')') {\n\t\t\t\t\tvar subres = formatDate(date, format.substring(i+1, i2), options);\n\t\t\t\t\tif (parseInt(subres.replace(/\\D/, ''), 10)) {\n\t\t\t\t\t\tres += subres;\n\t\t\t\t\t}\n\t\t\t\t\ti = i2;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (c == '[') {\n\t\t\tfor (i2=i+1; i2<len; i2++) {\n\t\t\t\tif (format.charAt(i2) == ']') {\n\t\t\t\t\tvar subformat = format.substring(i+1, i2);\n\t\t\t\t\tvar subres = formatDate(date, subformat, options);\n\t\t\t\t\tif (subres != formatDate(otherDate, subformat, options)) {\n\t\t\t\t\t\tres += subres;\n\t\t\t\t\t}\n\t\t\t\t\ti = i2;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (c == '{') {\n\t\t\tdate = date2;\n\t\t\totherDate = date1;\n\t\t}\n\t\telse if (c == '}') {\n\t\t\tdate = date1;\n\t\t\totherDate = date2;\n\t\t}\n\t\telse {\n\t\t\tfor (i2=len; i2>i; i2--) {\n\t\t\t\tif (formatter = dateFormatters[format.substring(i, i2)]) {\n\t\t\t\t\tif (date) {\n\t\t\t\t\t\tres += formatter(date, options);\n\t\t\t\t\t}\n\t\t\t\t\ti = i2 - 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (i2 == i) {\n\t\t\t\tif (date) {\n\t\t\t\t\tres += c;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn res;\n};\n\n\nvar dateFormatters = {\n\ts\t: function(d)\t{ return d.getSeconds() },\n\tss\t: function(d)\t{ return zeroPad(d.getSeconds()) },\n\tm\t: function(d)\t{ return d.getMinutes() },\n\tmm\t: function(d)\t{ return zeroPad(d.getMinutes()) },\n\th\t: function(d)\t{ return d.getHours() % 12 || 12 },\n\thh\t: function(d)\t{ return zeroPad(d.getHours() % 12 || 12) },\n\tH\t: function(d)\t{ return d.getHours() },\n\tHH\t: function(d)\t{ return zeroPad(d.getHours()) },\n\td\t: function(d)\t{ return d.getDate() },\n\tdd\t: function(d)\t{ return zeroPad(d.getDate()) },\n\tddd\t: function(d,o)\t{ return o.dayNamesShort[d.getDay()] },\n\tdddd: function(d,o)\t{ return o.dayNames[d.getDay()] },\n\tM\t: function(d)\t{ return d.getMonth() + 1 },\n\tMM\t: function(d)\t{ return zeroPad(d.getMonth() + 1) },\n\tMMM\t: function(d,o)\t{ return o.monthNamesShort[d.getMonth()] },\n\tMMMM: function(d,o)\t{ return o.monthNames[d.getMonth()] },\n\tyy\t: function(d)\t{ return (d.getFullYear()+'').substring(2) },\n\tyyyy: function(d)\t{ return d.getFullYear() },\n\tt\t: function(d)\t{ return d.getHours() < 12 ? 'a' : 'p' },\n\ttt\t: function(d)\t{ return d.getHours() < 12 ? 'am' : 'pm' },\n\tT\t: function(d)\t{ return d.getHours() < 12 ? 'A' : 'P' },\n\tTT\t: function(d)\t{ return d.getHours() < 12 ? 'AM' : 'PM' },\n\tu\t: function(d)\t{ return formatDate(d, \"yyyy-MM-dd'T'HH:mm:ss'Z'\") },\n\tS\t: function(d)\t{\n\t\tvar date = d.getDate();\n\t\tif (date > 10 && date < 20) {\n\t\t\treturn 'th';\n\t\t}\n\t\treturn ['st', 'nd', 'rd'][date%10-1] || 'th';\n\t},\n\tw   : function(d, o) { // local\n\t\treturn o.weekNumberCalculation(d);\n\t},\n\tW   : function(d) { // ISO\n\t\treturn iso8601Week(d);\n\t}\n};\nfc.dateFormatters = dateFormatters;\n\n\n/* thanks jQuery UI (https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js)\n * \n * Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.\n * `date` - the date to get the week for\n * `number` - the number of the week within the year that contains this date\n */\nfunction iso8601Week(date) {\n\tvar time;\n\tvar checkDate = new Date(date.getTime());\n\n\t// Find Thursday of this week starting on Monday\n\tcheckDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));\n\n\ttime = checkDate.getTime();\n\tcheckDate.setMonth(0); // Compare with Jan 1\n\tcheckDate.setDate(1);\n\treturn Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;\n}\n\n\n;;\n\nfc.applyAll = applyAll;\n\n\n/* Event Date Math\n-----------------------------------------------------------------------------*/\n\n\nfunction exclEndDay(event) {\n\tif (event.end) {\n\t\treturn _exclEndDay(event.end, event.allDay);\n\t}else{\n\t\treturn addDays(cloneDate(event.start), 1);\n\t}\n}\n\n\nfunction _exclEndDay(end, allDay) {\n\tend = cloneDate(end);\n\treturn allDay || end.getHours() || end.getMinutes() ? addDays(end, 1) : clearTime(end);\n\t// why don't we check for seconds/ms too?\n}\n\n\n\n/* Event Element Binding\n-----------------------------------------------------------------------------*/\n\n\nfunction lazySegBind(container, segs, bindHandlers) {\n\tcontainer.unbind('mouseover').mouseover(function(ev) {\n\t\tvar parent=ev.target, e,\n\t\t\ti, seg;\n\t\twhile (parent != this) {\n\t\t\te = parent;\n\t\t\tparent = parent.parentNode;\n\t\t}\n\t\tif ((i = e._fci) !== undefined) {\n\t\t\te._fci = undefined;\n\t\t\tseg = segs[i];\n\t\t\tbindHandlers(seg.event, seg.element, seg);\n\t\t\t$(ev.target).trigger(ev);\n\t\t}\n\t\tev.stopPropagation();\n\t});\n}\n\n\n\n/* Element Dimensions\n-----------------------------------------------------------------------------*/\n\n\nfunction setOuterWidth(element, width, includeMargins) {\n\tfor (var i=0, e; i<element.length; i++) {\n\t\te = $(element[i]);\n\t\te.width(Math.max(0, width - hsides(e, includeMargins)));\n\t}\n}\n\n\nfunction setOuterHeight(element, height, includeMargins) {\n\tfor (var i=0, e; i<element.length; i++) {\n\t\te = $(element[i]);\n\t\te.height(Math.max(0, height - vsides(e, includeMargins)));\n\t}\n}\n\n\nfunction hsides(element, includeMargins) {\n\treturn hpadding(element) + hborders(element) + (includeMargins ? hmargins(element) : 0);\n}\n\n\nfunction hpadding(element) {\n\treturn (parseFloat($.css(element[0], 'paddingLeft', true)) || 0) +\n\t       (parseFloat($.css(element[0], 'paddingRight', true)) || 0);\n}\n\n\nfunction hmargins(element) {\n\treturn (parseFloat($.css(element[0], 'marginLeft', true)) || 0) +\n\t       (parseFloat($.css(element[0], 'marginRight', true)) || 0);\n}\n\n\nfunction hborders(element) {\n\treturn (parseFloat($.css(element[0], 'borderLeftWidth', true)) || 0) +\n\t       (parseFloat($.css(element[0], 'borderRightWidth', true)) || 0);\n}\n\n\nfunction vsides(element, includeMargins) {\n\treturn vpadding(element) +  vborders(element) + (includeMargins ? vmargins(element) : 0);\n}\n\n\nfunction vpadding(element) {\n\treturn (parseFloat($.css(element[0], 'paddingTop', true)) || 0) +\n\t       (parseFloat($.css(element[0], 'paddingBottom', true)) || 0);\n}\n\n\nfunction vmargins(element) {\n\treturn (parseFloat($.css(element[0], 'marginTop', true)) || 0) +\n\t       (parseFloat($.css(element[0], 'marginBottom', true)) || 0);\n}\n\n\nfunction vborders(element) {\n\treturn (parseFloat($.css(element[0], 'borderTopWidth', true)) || 0) +\n\t       (parseFloat($.css(element[0], 'borderBottomWidth', true)) || 0);\n}\n\n\n\n/* Misc Utils\n-----------------------------------------------------------------------------*/\n\n\n//TODO: arraySlice\n//TODO: isFunction, grep ?\n\n\nfunction noop() { }\n\n\nfunction dateCompare(a, b) {\n\treturn a - b;\n}\n\n\nfunction arrayMax(a) {\n\treturn Math.max.apply(Math, a);\n}\n\n\nfunction zeroPad(n) {\n\treturn (n < 10 ? '0' : '') + n;\n}\n\n\nfunction smartProperty(obj, name) { // get a camel-cased/namespaced property of an object\n\tif (obj[name] !== undefined) {\n\t\treturn obj[name];\n\t}\n\tvar parts = name.split(/(?=[A-Z])/),\n\t\ti=parts.length-1, res;\n\tfor (; i>=0; i--) {\n\t\tres = obj[parts[i].toLowerCase()];\n\t\tif (res !== undefined) {\n\t\t\treturn res;\n\t\t}\n\t}\n\treturn obj[''];\n}\n\n\nfunction htmlEscape(s) {\n\treturn s.replace(/&/g, '&')\n\t\t.replace(/</g, '<')\n\t\t.replace(/>/g, '>')\n\t\t.replace(/'/g, '\\'')\n\t\t.replace(/\"/g, '\"')\n\t\t.replace(/\\n/g, '<br />');\n}\n\n\nfunction disableTextSelection(element) {\n\telement\n\t\t.attr('unselectable', 'on')\n\t\t.css('MozUserSelect', 'none')\n\t\t.bind('selectstart.ui', function() { return false; });\n}\n\n\n/*\nfunction enableTextSelection(element) {\n\telement\n\t\t.attr('unselectable', 'off')\n\t\t.css('MozUserSelect', '')\n\t\t.unbind('selectstart.ui');\n}\n*/\n\n\nfunction markFirstLast(e) {\n\te.children()\n\t\t.removeClass('fc-first fc-last')\n\t\t.filter(':first-child')\n\t\t\t.addClass('fc-first')\n\t\t.end()\n\t\t.filter(':last-child')\n\t\t\t.addClass('fc-last');\n}\n\n\nfunction setDayID(cell, date) {\n\tcell.each(function(i, _cell) {\n\t\t_cell.className = _cell.className.replace(/^fc-\\w*/, 'fc-' + dayIDs[date.getDay()]);\n\t\t// TODO: make a way that doesn't rely on order of classes\n\t});\n}\n\n\nfunction getSkinCss(event, opt) {\n\tvar source = event.source || {};\n\tvar eventColor = event.color;\n\tvar sourceColor = source.color;\n\tvar optionColor = opt('eventColor');\n\tvar backgroundColor =\n\t\tevent.backgroundColor ||\n\t\teventColor ||\n\t\tsource.backgroundColor ||\n\t\tsourceColor ||\n\t\topt('eventBackgroundColor') ||\n\t\toptionColor;\n\tvar borderColor =\n\t\tevent.borderColor ||\n\t\teventColor ||\n\t\tsource.borderColor ||\n\t\tsourceColor ||\n\t\topt('eventBorderColor') ||\n\t\toptionColor;\n\tvar textColor =\n\t\tevent.textColor ||\n\t\tsource.textColor ||\n\t\topt('eventTextColor');\n\tvar statements = [];\n\tif (backgroundColor) {\n\t\tstatements.push('background-color:' + backgroundColor);\n\t}\n\tif (borderColor) {\n\t\tstatements.push('border-color:' + borderColor);\n\t}\n\tif (textColor) {\n\t\tstatements.push('color:' + textColor);\n\t}\n\treturn statements.join(';');\n}\n\n\nfunction applyAll(functions, thisObj, args) {\n\tif ($.isFunction(functions)) {\n\t\tfunctions = [ functions ];\n\t}\n\tif (functions) {\n\t\tvar i;\n\t\tvar ret;\n\t\tfor (i=0; i<functions.length; i++) {\n\t\t\tret = functions[i].apply(thisObj, args) || ret;\n\t\t}\n\t\treturn ret;\n\t}\n}\n\n\nfunction firstDefined() {\n\tfor (var i=0; i<arguments.length; i++) {\n\t\tif (arguments[i] !== undefined) {\n\t\t\treturn arguments[i];\n\t\t}\n\t}\n}\n\n\n;;\n\nfcViews.month = MonthView;\n\nfunction MonthView(element, calendar) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.render = render;\n\t\n\t\n\t// imports\n\tBasicView.call(t, element, calendar, 'month');\n\tvar opt = t.opt;\n\tvar renderBasic = t.renderBasic;\n\tvar skipHiddenDays = t.skipHiddenDays;\n\tvar getCellsPerWeek = t.getCellsPerWeek;\n\tvar formatDate = calendar.formatDate;\n\t\n\t\n\tfunction render(date, delta) {\n\n\t\tif (delta) {\n\t\t\taddMonths(date, delta);\n\t\t\tdate.setDate(1);\n\t\t}\n\n\t\tvar firstDay = opt('firstDay');\n\n\t\tvar start = cloneDate(date, true);\n\t\tstart.setDate(1);\n\n\t\tvar end = addMonths(cloneDate(start), 1);\n\n\t\tvar visStart = cloneDate(start);\n\t\taddDays(visStart, -((visStart.getDay() - firstDay + 7) % 7));\n\t\tskipHiddenDays(visStart);\n\n\t\tvar visEnd = cloneDate(end);\n\t\taddDays(visEnd, (7 - visEnd.getDay() + firstDay) % 7);\n\t\tskipHiddenDays(visEnd, -1, true);\n\n\t\tvar colCnt = getCellsPerWeek();\n\t\tvar rowCnt = Math.round(dayDiff(visEnd, visStart) / 7); // should be no need for Math.round\n\n\t\tif (opt('weekMode') == 'fixed') {\n\t\t\taddDays(visEnd, (6 - rowCnt) * 7); // add weeks to make up for it\n\t\t\trowCnt = 6;\n\t\t}\n\n\t\tt.title = formatDate(start, opt('titleFormat'));\n\n\t\tt.start = start;\n\t\tt.end = end;\n\t\tt.visStart = visStart;\n\t\tt.visEnd = visEnd;\n\n\t\trenderBasic(rowCnt, colCnt, true);\n\t}\n\t\n\t\n}\n\n;;\n\nfcViews.basicWeek = BasicWeekView;\n\nfunction BasicWeekView(element, calendar) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.render = render;\n\t\n\t\n\t// imports\n\tBasicView.call(t, element, calendar, 'basicWeek');\n\tvar opt = t.opt;\n\tvar renderBasic = t.renderBasic;\n\tvar skipHiddenDays = t.skipHiddenDays;\n\tvar getCellsPerWeek = t.getCellsPerWeek;\n\tvar formatDates = calendar.formatDates;\n\t\n\t\n\tfunction render(date, delta) {\n\n\t\tif (delta) {\n\t\t\taddDays(date, delta * 7);\n\t\t}\n\n\t\tvar start = addDays(cloneDate(date), -((date.getDay() - opt('firstDay') + 7) % 7));\n\t\tvar end = addDays(cloneDate(start), 7);\n\n\t\tvar visStart = cloneDate(start);\n\t\tskipHiddenDays(visStart);\n\n\t\tvar visEnd = cloneDate(end);\n\t\tskipHiddenDays(visEnd, -1, true);\n\n\t\tvar colCnt = getCellsPerWeek();\n\n\t\tt.start = start;\n\t\tt.end = end;\n\t\tt.visStart = visStart;\n\t\tt.visEnd = visEnd;\n\n\t\tt.title = formatDates(\n\t\t\tvisStart,\n\t\t\taddDays(cloneDate(visEnd), -1),\n\t\t\topt('titleFormat')\n\t\t);\n\n\t\trenderBasic(1, colCnt, false);\n\t}\n\t\n\t\n}\n\n;;\n\nfcViews.basicDay = BasicDayView;\n\n\nfunction BasicDayView(element, calendar) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.render = render;\n\t\n\t\n\t// imports\n\tBasicView.call(t, element, calendar, 'basicDay');\n\tvar opt = t.opt;\n\tvar renderBasic = t.renderBasic;\n\tvar skipHiddenDays = t.skipHiddenDays;\n\tvar formatDate = calendar.formatDate;\n\t\n\t\n\tfunction render(date, delta) {\n\n\t\tif (delta) {\n\t\t\taddDays(date, delta);\n\t\t}\n\t\tskipHiddenDays(date, delta < 0 ? -1 : 1);\n\n\t\tvar start = cloneDate(date, true);\n\t\tvar end = addDays(cloneDate(start), 1);\n\n\t\tt.title = formatDate(date, opt('titleFormat'));\n\n\t\tt.start = t.visStart = start;\n\t\tt.end = t.visEnd = end;\n\n\t\trenderBasic(1, 1, false);\n\t}\n\t\n\t\n}\n\n;;\n\nsetDefaults({\n\tweekMode: 'fixed'\n});\n\n\nfunction BasicView(element, calendar, viewName) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.renderBasic = renderBasic;\n\tt.setHeight = setHeight;\n\tt.setWidth = setWidth;\n\tt.renderDayOverlay = renderDayOverlay;\n\tt.defaultSelectionEnd = defaultSelectionEnd;\n\tt.renderSelection = renderSelection;\n\tt.clearSelection = clearSelection;\n\tt.reportDayClick = reportDayClick; // for selection (kinda hacky)\n\tt.dragStart = dragStart;\n\tt.dragStop = dragStop;\n\tt.defaultEventEnd = defaultEventEnd;\n\tt.getHoverListener = function() { return hoverListener };\n\tt.colLeft = colLeft;\n\tt.colRight = colRight;\n\tt.colContentLeft = colContentLeft;\n\tt.colContentRight = colContentRight;\n\tt.getIsCellAllDay = function() { return true };\n\tt.allDayRow = allDayRow;\n\tt.getRowCnt = function() { return rowCnt };\n\tt.getColCnt = function() { return colCnt };\n\tt.getColWidth = function() { return colWidth };\n\tt.getDaySegmentContainer = function() { return daySegmentContainer };\n\t\n\t\n\t// imports\n\tView.call(t, element, calendar, viewName);\n\tOverlayManager.call(t);\n\tSelectionManager.call(t);\n\tBasicEventRenderer.call(t);\n\tvar opt = t.opt;\n\tvar trigger = t.trigger;\n\tvar renderOverlay = t.renderOverlay;\n\tvar clearOverlays = t.clearOverlays;\n\tvar daySelectionMousedown = t.daySelectionMousedown;\n\tvar cellToDate = t.cellToDate;\n\tvar dateToCell = t.dateToCell;\n\tvar rangeToSegments = t.rangeToSegments;\n\tvar formatDate = calendar.formatDate;\n\t\n\t\n\t// locals\n\t\n\tvar table;\n\tvar head;\n\tvar headCells;\n\tvar body;\n\tvar bodyRows;\n\tvar bodyCells;\n\tvar bodyFirstCells;\n\tvar firstRowCellInners;\n\tvar firstRowCellContentInners;\n\tvar daySegmentContainer;\n\t\n\tvar viewWidth;\n\tvar viewHeight;\n\tvar colWidth;\n\tvar weekNumberWidth;\n\t\n\tvar rowCnt, colCnt;\n\tvar showNumbers;\n\tvar coordinateGrid;\n\tvar hoverListener;\n\tvar colPositions;\n\tvar colContentPositions;\n\t\n\tvar tm;\n\tvar colFormat;\n\tvar showWeekNumbers;\n\tvar weekNumberTitle;\n\tvar weekNumberFormat;\n\t\n\t\n\t\n\t/* Rendering\n\t------------------------------------------------------------*/\n\t\n\t\n\tdisableTextSelection(element.addClass('fc-grid'));\n\t\n\t\n\tfunction renderBasic(_rowCnt, _colCnt, _showNumbers) {\n\t\trowCnt = _rowCnt;\n\t\tcolCnt = _colCnt;\n\t\tshowNumbers = _showNumbers;\n\t\tupdateOptions();\n\n\t\tif (!body) {\n\t\t\tbuildEventContainer();\n\t\t}\n\n\t\tbuildTable();\n\t}\n\t\n\t\n\tfunction updateOptions() {\n\t\ttm = opt('theme') ? 'ui' : 'fc';\n\t\tcolFormat = opt('columnFormat');\n\n\t\t// week # options. (TODO: bad, logic also in other views)\n\t\tshowWeekNumbers = opt('weekNumbers');\n\t\tweekNumberTitle = opt('weekNumberTitle');\n\t\tif (opt('weekNumberCalculation') != 'iso') {\n\t\t\tweekNumberFormat = \"w\";\n\t\t}\n\t\telse {\n\t\t\tweekNumberFormat = \"W\";\n\t\t}\n\t}\n\t\n\t\n\tfunction buildEventContainer() {\n\t\tdaySegmentContainer =\n\t\t\t$(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\")\n\t\t\t\t.appendTo(element);\n\t}\n\t\n\t\n\tfunction buildTable() {\n\t\tvar html = buildTableHTML();\n\n\t\tif (table) {\n\t\t\ttable.remove();\n\t\t}\n\t\ttable = $(html).appendTo(element);\n\n\t\thead = table.find('thead');\n\t\theadCells = head.find('.fc-day-header');\n\t\tbody = table.find('tbody');\n\t\tbodyRows = body.find('tr');\n\t\tbodyCells = body.find('.fc-day');\n\t\tbodyFirstCells = bodyRows.find('td:first-child');\n\n\t\tfirstRowCellInners = bodyRows.eq(0).find('.fc-day > div');\n\t\tfirstRowCellContentInners = bodyRows.eq(0).find('.fc-day-content > div');\n\t\t\n\t\tmarkFirstLast(head.add(head.find('tr'))); // marks first+last tr/th's\n\t\tmarkFirstLast(bodyRows); // marks first+last td's\n\t\tbodyRows.eq(0).addClass('fc-first');\n\t\tbodyRows.filter(':last').addClass('fc-last');\n\n\t\tbodyCells.each(function(i, _cell) {\n\t\t\tvar date = cellToDate(\n\t\t\t\tMath.floor(i / colCnt),\n\t\t\t\ti % colCnt\n\t\t\t);\n\t\t\ttrigger('dayRender', t, date, $(_cell));\n\t\t});\n\n\t\tdayBind(bodyCells);\n\t}\n\n\n\n\t/* HTML Building\n\t-----------------------------------------------------------*/\n\n\n\tfunction buildTableHTML() {\n\t\tvar html =\n\t\t\t\"<table class='fc-border-separate' style='width:100%' cellspacing='0'>\" +\n\t\t\tbuildHeadHTML() +\n\t\t\tbuildBodyHTML() +\n\t\t\t\"</table>\";\n\n\t\treturn html;\n\t}\n\n\n\tfunction buildHeadHTML() {\n\t\tvar headerClass = tm + \"-widget-header\";\n\t\tvar html = '';\n\t\tvar col;\n\t\tvar date;\n\n\t\thtml += \"<thead><tr>\";\n\n\t\tif (showWeekNumbers) {\n\t\t\thtml +=\n\t\t\t\t\"<th class='fc-week-number \" + headerClass + \"'>\" +\n\t\t\t\thtmlEscape(weekNumberTitle) +\n\t\t\t\t\"</th>\";\n\t\t}\n\n\t\tfor (col=0; col<colCnt; col++) {\n\t\t\tdate = cellToDate(0, col);\n\t\t\thtml +=\n\t\t\t\t\"<th class='fc-day-header fc-\" + dayIDs[date.getDay()] + \" \" + headerClass + \"'>\" +\n\t\t\t\thtmlEscape(formatDate(date, colFormat)) +\n\t\t\t\t\"</th>\";\n\t\t}\n\n\t\thtml += \"</tr></thead>\";\n\n\t\treturn html;\n\t}\n\n\n\tfunction buildBodyHTML() {\n\t\tvar contentClass = tm + \"-widget-content\";\n\t\tvar html = '';\n\t\tvar row;\n\t\tvar col;\n\t\tvar date;\n\n\t\thtml += \"<tbody>\";\n\n\t\tfor (row=0; row<rowCnt; row++) {\n\n\t\t\thtml += \"<tr class='fc-week'>\";\n\n\t\t\tif (showWeekNumbers) {\n\t\t\t\tdate = cellToDate(row, 0);\n\t\t\t\thtml +=\n\t\t\t\t\t\"<td class='fc-week-number \" + contentClass + \"'>\" +\n\t\t\t\t\t\"<div>\" +\n\t\t\t\t\thtmlEscape(formatDate(date, weekNumberFormat)) +\n\t\t\t\t\t\"</div>\" +\n\t\t\t\t\t\"</td>\";\n\t\t\t}\n\n\t\t\tfor (col=0; col<colCnt; col++) {\n\t\t\t\tdate = cellToDate(row, col);\n\t\t\t\thtml += buildCellHTML(date);\n\t\t\t}\n\n\t\t\thtml += \"</tr>\";\n\t\t}\n\n\t\thtml += \"</tbody>\";\n\n\t\treturn html;\n\t}\n\n\n\tfunction buildCellHTML(date) {\n\t\tvar contentClass = tm + \"-widget-content\";\n\t\tvar month = t.start.getMonth();\n\t\tvar today = clearTime(new Date());\n\t\tvar html = '';\n\t\tvar classNames = [\n\t\t\t'fc-day',\n\t\t\t'fc-' + dayIDs[date.getDay()],\n\t\t\tcontentClass\n\t\t];\n\n\t\tif (date.getMonth() != month) {\n\t\t\tclassNames.push('fc-other-month');\n\t\t}\n\t\tif (+date == +today) {\n\t\t\tclassNames.push(\n\t\t\t\t'fc-today',\n\t\t\t\ttm + '-state-highlight'\n\t\t\t);\n\t\t}\n\t\telse if (date < today) {\n\t\t\tclassNames.push('fc-past');\n\t\t}\n\t\telse {\n\t\t\tclassNames.push('fc-future');\n\t\t}\n\n\t\thtml +=\n\t\t\t\"<td\" +\n\t\t\t\" class='\" + classNames.join(' ') + \"'\" +\n\t\t\t\" data-date='\" + formatDate(date, 'yyyy-MM-dd') + \"'\" +\n\t\t\t\">\" +\n\t\t\t\"<div>\";\n\n\t\tif (showNumbers) {\n\t\t\thtml += \"<div class='fc-day-number'>\" + date.getDate() + \"</div>\";\n\t\t}\n\n\t\thtml +=\n\t\t\t\"<div class='fc-day-content'>\" +\n\t\t\t\"<div style='position:relative'> </div>\" +\n\t\t\t\"</div>\" +\n\t\t\t\"</div>\" +\n\t\t\t\"</td>\";\n\n\t\treturn html;\n\t}\n\n\n\n\t/* Dimensions\n\t-----------------------------------------------------------*/\n\t\n\t\n\tfunction setHeight(height) {\n\t\tviewHeight = height;\n\t\t\n\t\tvar bodyHeight = viewHeight - head.height();\n\t\tvar rowHeight;\n\t\tvar rowHeightLast;\n\t\tvar cell;\n\t\t\t\n\t\tif (opt('weekMode') == 'variable') {\n\t\t\trowHeight = rowHeightLast = Math.floor(bodyHeight / (rowCnt==1 ? 2 : 6));\n\t\t}else{\n\t\t\trowHeight = Math.floor(bodyHeight / rowCnt);\n\t\t\trowHeightLast = bodyHeight - rowHeight * (rowCnt-1);\n\t\t}\n\t\t\n\t\tbodyFirstCells.each(function(i, _cell) {\n\t\t\tif (i < rowCnt) {\n\t\t\t\tcell = $(_cell);\n\t\t\t\tcell.find('> div').css(\n\t\t\t\t\t'min-height',\n\t\t\t\t\t(i==rowCnt-1 ? rowHeightLast : rowHeight) - vsides(cell)\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t\t\n\t}\n\t\n\t\n\tfunction setWidth(width) {\n\t\tviewWidth = width;\n\t\tcolPositions.clear();\n\t\tcolContentPositions.clear();\n\n\t\tweekNumberWidth = 0;\n\t\tif (showWeekNumbers) {\n\t\t\tweekNumberWidth = head.find('th.fc-week-number').outerWidth();\n\t\t}\n\n\t\tcolWidth = Math.floor((viewWidth - weekNumberWidth) / colCnt);\n\t\tsetOuterWidth(headCells.slice(0, -1), colWidth);\n\t}\n\t\n\t\n\t\n\t/* Day clicking and binding\n\t-----------------------------------------------------------*/\n\t\n\t\n\tfunction dayBind(days) {\n\t\tdays.click(dayClick)\n\t\t\t.mousedown(daySelectionMousedown);\n\t}\n\t\n\t\n\tfunction dayClick(ev) {\n\t\tif (!opt('selectable')) { // if selectable, SelectionManager will worry about dayClick\n\t\t\tvar date = parseISO8601($(this).data('date'));\n\t\t\ttrigger('dayClick', this, date, true, ev);\n\t\t}\n\t}\n\t\n\t\n\t\n\t/* Semi-transparent Overlay Helpers\n\t------------------------------------------------------*/\n\t// TODO: should be consolidated with AgendaView's methods\n\n\n\tfunction renderDayOverlay(overlayStart, overlayEnd, refreshCoordinateGrid) { // overlayEnd is exclusive\n\n\t\tif (refreshCoordinateGrid) {\n\t\t\tcoordinateGrid.build();\n\t\t}\n\n\t\tvar segments = rangeToSegments(overlayStart, overlayEnd);\n\n\t\tfor (var i=0; i<segments.length; i++) {\n\t\t\tvar segment = segments[i];\n\t\t\tdayBind(\n\t\t\t\trenderCellOverlay(\n\t\t\t\t\tsegment.row,\n\t\t\t\t\tsegment.leftCol,\n\t\t\t\t\tsegment.row,\n\t\t\t\t\tsegment.rightCol\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\n\t\n\tfunction renderCellOverlay(row0, col0, row1, col1) { // row1,col1 is inclusive\n\t\tvar rect = coordinateGrid.rect(row0, col0, row1, col1, element);\n\t\treturn renderOverlay(rect, element);\n\t}\n\t\n\t\n\t\n\t/* Selection\n\t-----------------------------------------------------------------------*/\n\t\n\t\n\tfunction defaultSelectionEnd(startDate, allDay) {\n\t\treturn cloneDate(startDate);\n\t}\n\t\n\t\n\tfunction renderSelection(startDate, endDate, allDay) {\n\t\trenderDayOverlay(startDate, addDays(cloneDate(endDate), 1), true); // rebuild every time???\n\t}\n\t\n\t\n\tfunction clearSelection() {\n\t\tclearOverlays();\n\t}\n\t\n\t\n\tfunction reportDayClick(date, allDay, ev) {\n\t\tvar cell = dateToCell(date);\n\t\tvar _element = bodyCells[cell.row*colCnt + cell.col];\n\t\ttrigger('dayClick', _element, date, allDay, ev);\n\t}\n\t\n\t\n\t\n\t/* External Dragging\n\t-----------------------------------------------------------------------*/\n\t\n\t\n\tfunction dragStart(_dragElement, ev, ui) {\n\t\thoverListener.start(function(cell) {\n\t\t\tclearOverlays();\n\t\t\tif (cell) {\n\t\t\t\trenderCellOverlay(cell.row, cell.col, cell.row, cell.col);\n\t\t\t}\n\t\t}, ev);\n\t}\n\t\n\t\n\tfunction dragStop(_dragElement, ev, ui) {\n\t\tvar cell = hoverListener.stop();\n\t\tclearOverlays();\n\t\tif (cell) {\n\t\t\tvar d = cellToDate(cell);\n\t\t\ttrigger('drop', _dragElement, d, true, ev, ui);\n\t\t}\n\t}\n\t\n\t\n\t\n\t/* Utilities\n\t--------------------------------------------------------*/\n\t\n\t\n\tfunction defaultEventEnd(event) {\n\t\treturn cloneDate(event.start);\n\t}\n\t\n\t\n\tcoordinateGrid = new CoordinateGrid(function(rows, cols) {\n\t\tvar e, n, p;\n\t\theadCells.each(function(i, _e) {\n\t\t\te = $(_e);\n\t\t\tn = e.offset().left;\n\t\t\tif (i) {\n\t\t\t\tp[1] = n;\n\t\t\t}\n\t\t\tp = [n];\n\t\t\tcols[i] = p;\n\t\t});\n\t\tp[1] = n + e.outerWidth();\n\t\tbodyRows.each(function(i, _e) {\n\t\t\tif (i < rowCnt) {\n\t\t\t\te = $(_e);\n\t\t\t\tn = e.offset().top;\n\t\t\t\tif (i) {\n\t\t\t\t\tp[1] = n;\n\t\t\t\t}\n\t\t\t\tp = [n];\n\t\t\t\trows[i] = p;\n\t\t\t}\n\t\t});\n\t\tp[1] = n + e.outerHeight();\n\t});\n\t\n\t\n\thoverListener = new HoverListener(coordinateGrid);\n\t\n\tcolPositions = new HorizontalPositionCache(function(col) {\n\t\treturn firstRowCellInners.eq(col);\n\t});\n\n\tcolContentPositions = new HorizontalPositionCache(function(col) {\n\t\treturn firstRowCellContentInners.eq(col);\n\t});\n\n\n\tfunction colLeft(col) {\n\t\treturn colPositions.left(col);\n\t}\n\n\n\tfunction colRight(col) {\n\t\treturn colPositions.right(col);\n\t}\n\t\n\t\n\tfunction colContentLeft(col) {\n\t\treturn colContentPositions.left(col);\n\t}\n\t\n\t\n\tfunction colContentRight(col) {\n\t\treturn colContentPositions.right(col);\n\t}\n\t\n\t\n\tfunction allDayRow(i) {\n\t\treturn bodyRows.eq(i);\n\t}\n\t\n}\n\n;;\n\nfunction BasicEventRenderer() {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.renderEvents = renderEvents;\n\tt.clearEvents = clearEvents;\n\t\n\n\t// imports\n\tDayEventRenderer.call(t);\n\n\t\n\tfunction renderEvents(events, modifiedEventId) {\n\t\tt.renderDayEvents(events, modifiedEventId);\n\t}\n\t\n\t\n\tfunction clearEvents() {\n\t\tt.getDaySegmentContainer().empty();\n\t}\n\n\n\t// TODO: have this class (and AgendaEventRenderer) be responsible for creating the event container div\n\n}\n\n;;\n\nfcViews.agendaWeek = AgendaWeekView;\n\nfunction AgendaWeekView(element, calendar) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.render = render;\n\t\n\t\n\t// imports\n\tAgendaView.call(t, element, calendar, 'agendaWeek');\n\tvar opt = t.opt;\n\tvar renderAgenda = t.renderAgenda;\n\tvar skipHiddenDays = t.skipHiddenDays;\n\tvar getCellsPerWeek = t.getCellsPerWeek;\n\tvar formatDates = calendar.formatDates;\n\n\t\n\tfunction render(date, delta) {\n\n\t\tif (delta) {\n\t\t\taddDays(date, delta * 7);\n\t\t}\n\n\t\tvar start = addDays(cloneDate(date), -((date.getDay() - opt('firstDay') + 7) % 7));\n\t\tvar end = addDays(cloneDate(start), 7);\n\n\t\tvar visStart = cloneDate(start);\n\t\tskipHiddenDays(visStart);\n\n\t\tvar visEnd = cloneDate(end);\n\t\tskipHiddenDays(visEnd, -1, true);\n\n\t\tvar colCnt = getCellsPerWeek();\n\n\t\tt.title = formatDates(\n\t\t\tvisStart,\n\t\t\taddDays(cloneDate(visEnd), -1),\n\t\t\topt('titleFormat')\n\t\t);\n\n\t\tt.start = start;\n\t\tt.end = end;\n\t\tt.visStart = visStart;\n\t\tt.visEnd = visEnd;\n\n\t\trenderAgenda(colCnt);\n\t}\n\n}\n\n;;\n\nfcViews.agendaDay = AgendaDayView;\n\n\nfunction AgendaDayView(element, calendar) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.render = render;\n\t\n\t\n\t// imports\n\tAgendaView.call(t, element, calendar, 'agendaDay');\n\tvar opt = t.opt;\n\tvar renderAgenda = t.renderAgenda;\n\tvar skipHiddenDays = t.skipHiddenDays;\n\tvar formatDate = calendar.formatDate;\n\t\n\t\n\tfunction render(date, delta) {\n\n\t\tif (delta) {\n\t\t\taddDays(date, delta);\n\t\t}\n\t\tskipHiddenDays(date, delta < 0 ? -1 : 1);\n\n\t\tvar start = cloneDate(date, true);\n\t\tvar end = addDays(cloneDate(start), 1);\n\n\t\tt.title = formatDate(date, opt('titleFormat'));\n\n\t\tt.start = t.visStart = start;\n\t\tt.end = t.visEnd = end;\n\n\t\trenderAgenda(1);\n\t}\n\t\n\n}\n\n;;\n\nsetDefaults({\n\tallDaySlot: true,\n\tallDayText: 'all-day',\n\tfirstHour: 6,\n\tslotMinutes: 30,\n\tdefaultEventMinutes: 120,\n\taxisFormat: 'h(:mm)tt',\n\ttimeFormat: {\n\t\tagenda: 'h:mm{ - h:mm}'\n\t},\n\tdragOpacity: {\n\t\tagenda: .5\n\t},\n\tminTime: 0,\n\tmaxTime: 24,\n\tslotEventOverlap: true\n});\n\n\n// TODO: make it work in quirks mode (event corners, all-day height)\n// TODO: test liquid width, especially in IE6\n\n\nfunction AgendaView(element, calendar, viewName) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.renderAgenda = renderAgenda;\n\tt.setWidth = setWidth;\n\tt.setHeight = setHeight;\n\tt.afterRender = afterRender;\n\tt.defaultEventEnd = defaultEventEnd;\n\tt.timePosition = timePosition;\n\tt.getIsCellAllDay = getIsCellAllDay;\n\tt.allDayRow = getAllDayRow;\n\tt.getCoordinateGrid = function() { return coordinateGrid }; // specifically for AgendaEventRenderer\n\tt.getHoverListener = function() { return hoverListener };\n\tt.colLeft = colLeft;\n\tt.colRight = colRight;\n\tt.colContentLeft = colContentLeft;\n\tt.colContentRight = colContentRight;\n\tt.getDaySegmentContainer = function() { return daySegmentContainer };\n\tt.getSlotSegmentContainer = function() { return slotSegmentContainer };\n\tt.getMinMinute = function() { return minMinute };\n\tt.getMaxMinute = function() { return maxMinute };\n\tt.getSlotContainer = function() { return slotContainer };\n\tt.getRowCnt = function() { return 1 };\n\tt.getColCnt = function() { return colCnt };\n\tt.getColWidth = function() { return colWidth };\n\tt.getSnapHeight = function() { return snapHeight };\n\tt.getSnapMinutes = function() { return snapMinutes };\n\tt.defaultSelectionEnd = defaultSelectionEnd;\n\tt.renderDayOverlay = renderDayOverlay;\n\tt.renderSelection = renderSelection;\n\tt.clearSelection = clearSelection;\n\tt.reportDayClick = reportDayClick; // selection mousedown hack\n\tt.dragStart = dragStart;\n\tt.dragStop = dragStop;\n\t\n\t\n\t// imports\n\tView.call(t, element, calendar, viewName);\n\tOverlayManager.call(t);\n\tSelectionManager.call(t);\n\tAgendaEventRenderer.call(t);\n\tvar opt = t.opt;\n\tvar trigger = t.trigger;\n\tvar renderOverlay = t.renderOverlay;\n\tvar clearOverlays = t.clearOverlays;\n\tvar reportSelection = t.reportSelection;\n\tvar unselect = t.unselect;\n\tvar daySelectionMousedown = t.daySelectionMousedown;\n\tvar slotSegHtml = t.slotSegHtml;\n\tvar cellToDate = t.cellToDate;\n\tvar dateToCell = t.dateToCell;\n\tvar rangeToSegments = t.rangeToSegments;\n\tvar formatDate = calendar.formatDate;\n\t\n\t\n\t// locals\n\t\n\tvar dayTable;\n\tvar dayHead;\n\tvar dayHeadCells;\n\tvar dayBody;\n\tvar dayBodyCells;\n\tvar dayBodyCellInners;\n\tvar dayBodyCellContentInners;\n\tvar dayBodyFirstCell;\n\tvar dayBodyFirstCellStretcher;\n\tvar slotLayer;\n\tvar daySegmentContainer;\n\tvar allDayTable;\n\tvar allDayRow;\n\tvar slotScroller;\n\tvar slotContainer;\n\tvar slotSegmentContainer;\n\tvar slotTable;\n\tvar selectionHelper;\n\t\n\tvar viewWidth;\n\tvar viewHeight;\n\tvar axisWidth;\n\tvar colWidth;\n\tvar gutterWidth;\n\tvar slotHeight; // TODO: what if slotHeight changes? (see issue 650)\n\n\tvar snapMinutes;\n\tvar snapRatio; // ratio of number of \"selection\" slots to normal slots. (ex: 1, 2, 4)\n\tvar snapHeight; // holds the pixel hight of a \"selection\" slot\n\t\n\tvar colCnt;\n\tvar slotCnt;\n\tvar coordinateGrid;\n\tvar hoverListener;\n\tvar colPositions;\n\tvar colContentPositions;\n\tvar slotTopCache = {};\n\t\n\tvar tm;\n\tvar rtl;\n\tvar minMinute, maxMinute;\n\tvar colFormat;\n\tvar showWeekNumbers;\n\tvar weekNumberTitle;\n\tvar weekNumberFormat;\n\t\n\n\t\n\t/* Rendering\n\t-----------------------------------------------------------------------------*/\n\t\n\t\n\tdisableTextSelection(element.addClass('fc-agenda'));\n\t\n\t\n\tfunction renderAgenda(c) {\n\t\tcolCnt = c;\n\t\tupdateOptions();\n\n\t\tif (!dayTable) { // first time rendering?\n\t\t\tbuildSkeleton(); // builds day table, slot area, events containers\n\t\t}\n\t\telse {\n\t\t\tbuildDayTable(); // rebuilds day table\n\t\t}\n\t}\n\t\n\t\n\tfunction updateOptions() {\n\n\t\ttm = opt('theme') ? 'ui' : 'fc';\n\t\trtl = opt('isRTL')\n\t\tminMinute = parseTime(opt('minTime'));\n\t\tmaxMinute = parseTime(opt('maxTime'));\n\t\tcolFormat = opt('columnFormat');\n\n\t\t// week # options. (TODO: bad, logic also in other views)\n\t\tshowWeekNumbers = opt('weekNumbers');\n\t\tweekNumberTitle = opt('weekNumberTitle');\n\t\tif (opt('weekNumberCalculation') != 'iso') {\n\t\t\tweekNumberFormat = \"w\";\n\t\t}\n\t\telse {\n\t\t\tweekNumberFormat = \"W\";\n\t\t}\n\n\t\tsnapMinutes = opt('snapMinutes') || opt('slotMinutes');\n\t}\n\n\n\n\t/* Build DOM\n\t-----------------------------------------------------------------------*/\n\n\n\tfunction buildSkeleton() {\n\t\tvar headerClass = tm + \"-widget-header\";\n\t\tvar contentClass = tm + \"-widget-content\";\n\t\tvar s;\n\t\tvar d;\n\t\tvar i;\n\t\tvar maxd;\n\t\tvar minutes;\n\t\tvar slotNormal = opt('slotMinutes') % 15 == 0;\n\t\t\n\t\tbuildDayTable();\n\t\t\n\t\tslotLayer =\n\t\t\t$(\"<div style='position:absolute;z-index:2;left:0;width:100%'/>\")\n\t\t\t\t.appendTo(element);\n\t\t\t\t\n\t\tif (opt('allDaySlot')) {\n\t\t\n\t\t\tdaySegmentContainer =\n\t\t\t\t$(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\")\n\t\t\t\t\t.appendTo(slotLayer);\n\t\t\n\t\t\ts =\n\t\t\t\t\"<table style='width:100%' class='fc-agenda-allday' cellspacing='0'>\" +\n\t\t\t\t\"<tr>\" +\n\t\t\t\t\"<th class='\" + headerClass + \" fc-agenda-axis'>\" + opt('allDayText') + \"</th>\" +\n\t\t\t\t\"<td>\" +\n\t\t\t\t\"<div class='fc-day-content'><div style='position:relative'/></div>\" +\n\t\t\t\t\"</td>\" +\n\t\t\t\t\"<th class='\" + headerClass + \" fc-agenda-gutter'> </th>\" +\n\t\t\t\t\"</tr>\" +\n\t\t\t\t\"</table>\";\n\t\t\tallDayTable = $(s).appendTo(slotLayer);\n\t\t\tallDayRow = allDayTable.find('tr');\n\t\t\t\n\t\t\tdayBind(allDayRow.find('td'));\n\t\t\t\n\t\t\tslotLayer.append(\n\t\t\t\t\"<div class='fc-agenda-divider \" + headerClass + \"'>\" +\n\t\t\t\t\"<div class='fc-agenda-divider-inner'/>\" +\n\t\t\t\t\"</div>\"\n\t\t\t);\n\t\t\t\n\t\t}else{\n\t\t\n\t\t\tdaySegmentContainer = $([]); // in jQuery 1.4, we can just do $()\n\t\t\n\t\t}\n\t\t\n\t\tslotScroller =\n\t\t\t$(\"<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>\")\n\t\t\t\t.appendTo(slotLayer);\n\t\t\t\t\n\t\tslotContainer =\n\t\t\t$(\"<div style='position:relative;width:100%;overflow:hidden'/>\")\n\t\t\t\t.appendTo(slotScroller);\n\t\t\t\t\n\t\tslotSegmentContainer =\n\t\t\t$(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\")\n\t\t\t\t.appendTo(slotContainer);\n\t\t\n\t\ts =\n\t\t\t\"<table class='fc-agenda-slots' style='width:100%' cellspacing='0'>\" +\n\t\t\t\"<tbody>\";\n\t\td = zeroDate();\n\t\tmaxd = addMinutes(cloneDate(d), maxMinute);\n\t\taddMinutes(d, minMinute);\n\t\tslotCnt = 0;\n\t\tfor (i=0; d < maxd; i++) {\n\t\t\tminutes = d.getMinutes();\n\t\t\ts +=\n\t\t\t\t\"<tr class='fc-slot\" + i + ' ' + (!minutes ? '' : 'fc-minor') + \"'>\" +\n\t\t\t\t\"<th class='fc-agenda-axis \" + headerClass + \"'>\" +\n\t\t\t\t((!slotNormal || !minutes) ? formatDate(d, opt('axisFormat')) : ' ') +\n\t\t\t\t\"</th>\" +\n\t\t\t\t\"<td class='\" + contentClass + \"'>\" +\n\t\t\t\t\"<div style='position:relative'> </div>\" +\n\t\t\t\t\"</td>\" +\n\t\t\t\t\"</tr>\";\n\t\t\taddMinutes(d, opt('slotMinutes'));\n\t\t\tslotCnt++;\n\t\t}\n\t\ts +=\n\t\t\t\"</tbody>\" +\n\t\t\t\"</table>\";\n\t\tslotTable = $(s).appendTo(slotContainer);\n\t\t\n\t\tslotBind(slotTable.find('td'));\n\t}\n\n\n\n\t/* Build Day Table\n\t-----------------------------------------------------------------------*/\n\n\n\tfunction buildDayTable() {\n\t\tvar html = buildDayTableHTML();\n\n\t\tif (dayTable) {\n\t\t\tdayTable.remove();\n\t\t}\n\t\tdayTable = $(html).appendTo(element);\n\n\t\tdayHead = dayTable.find('thead');\n\t\tdayHeadCells = dayHead.find('th').slice(1, -1); // exclude gutter\n\t\tdayBody = dayTable.find('tbody');\n\t\tdayBodyCells = dayBody.find('td').slice(0, -1); // exclude gutter\n\t\tdayBodyCellInners = dayBodyCells.find('> div');\n\t\tdayBodyCellContentInners = dayBodyCells.find('.fc-day-content > div');\n\n\t\tdayBodyFirstCell = dayBodyCells.eq(0);\n\t\tdayBodyFirstCellStretcher = dayBodyCellInners.eq(0);\n\t\t\n\t\tmarkFirstLast(dayHead.add(dayHead.find('tr')));\n\t\tmarkFirstLast(dayBody.add(dayBody.find('tr')));\n\n\t\t// TODO: now that we rebuild the cells every time, we should call dayRender\n\t}\n\n\n\tfunction buildDayTableHTML() {\n\t\tvar html =\n\t\t\t\"<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>\" +\n\t\t\tbuildDayTableHeadHTML() +\n\t\t\tbuildDayTableBodyHTML() +\n\t\t\t\"</table>\";\n\n\t\treturn html;\n\t}\n\n\n\tfunction buildDayTableHeadHTML() {\n\t\tvar headerClass = tm + \"-widget-header\";\n\t\tvar date;\n\t\tvar html = '';\n\t\tvar weekText;\n\t\tvar col;\n\n\t\thtml +=\n\t\t\t\"<thead>\" +\n\t\t\t\"<tr>\";\n\n\t\tif (showWeekNumbers) {\n\t\t\tdate = cellToDate(0, 0);\n\t\t\tweekText = formatDate(date, weekNumberFormat);\n\t\t\tif (rtl) {\n\t\t\t\tweekText += weekNumberTitle;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tweekText = weekNumberTitle + weekText;\n\t\t\t}\n\t\t\thtml +=\n\t\t\t\t\"<th class='fc-agenda-axis fc-week-number \" + headerClass + \"'>\" +\n\t\t\t\thtmlEscape(weekText) +\n\t\t\t\t\"</th>\";\n\t\t}\n\t\telse {\n\t\t\thtml += \"<th class='fc-agenda-axis \" + headerClass + \"'> </th>\";\n\t\t}\n\n\t\tfor (col=0; col<colCnt; col++) {\n\t\t\tdate = cellToDate(0, col);\n\t\t\thtml +=\n\t\t\t\t\"<th class='fc-\" + dayIDs[date.getDay()] + \" fc-col\" + col + ' ' + headerClass + \"'>\" +\n\t\t\t\thtmlEscape(formatDate(date, colFormat)) +\n\t\t\t\t\"</th>\";\n\t\t}\n\n\t\thtml +=\n\t\t\t\"<th class='fc-agenda-gutter \" + headerClass + \"'> </th>\" +\n\t\t\t\"</tr>\" +\n\t\t\t\"</thead>\";\n\n\t\treturn html;\n\t}\n\n\n\tfunction buildDayTableBodyHTML() {\n\t\tvar headerClass = tm + \"-widget-header\"; // TODO: make these when updateOptions() called\n\t\tvar contentClass = tm + \"-widget-content\";\n\t\tvar date;\n\t\tvar today = clearTime(new Date());\n\t\tvar col;\n\t\tvar cellsHTML;\n\t\tvar cellHTML;\n\t\tvar classNames;\n\t\tvar html = '';\n\n\t\thtml +=\n\t\t\t\"<tbody>\" +\n\t\t\t\"<tr>\" +\n\t\t\t\"<th class='fc-agenda-axis \" + headerClass + \"'> </th>\";\n\n\t\tcellsHTML = '';\n\n\t\tfor (col=0; col<colCnt; col++) {\n\n\t\t\tdate = cellToDate(0, col);\n\n\t\t\tclassNames = [\n\t\t\t\t'fc-col' + col,\n\t\t\t\t'fc-' + dayIDs[date.getDay()],\n\t\t\t\tcontentClass\n\t\t\t];\n\t\t\tif (+date == +today) {\n\t\t\t\tclassNames.push(\n\t\t\t\t\ttm + '-state-highlight',\n\t\t\t\t\t'fc-today'\n\t\t\t\t);\n\t\t\t}\n\t\t\telse if (date < today) {\n\t\t\t\tclassNames.push('fc-past');\n\t\t\t}\n\t\t\telse {\n\t\t\t\tclassNames.push('fc-future');\n\t\t\t}\n\n\t\t\tcellHTML =\n\t\t\t\t\"<td class='\" + classNames.join(' ') + \"'>\" +\n\t\t\t\t\"<div>\" +\n\t\t\t\t\"<div class='fc-day-content'>\" +\n\t\t\t\t\"<div style='position:relative'> </div>\" +\n\t\t\t\t\"</div>\" +\n\t\t\t\t\"</div>\" +\n\t\t\t\t\"</td>\";\n\n\t\t\tcellsHTML += cellHTML;\n\t\t}\n\n\t\thtml += cellsHTML;\n\t\thtml +=\n\t\t\t\"<td class='fc-agenda-gutter \" + contentClass + \"'> </td>\" +\n\t\t\t\"</tr>\" +\n\t\t\t\"</tbody>\";\n\n\t\treturn html;\n\t}\n\n\n\t// TODO: data-date on the cells\n\n\t\n\t\n\t/* Dimensions\n\t-----------------------------------------------------------------------*/\n\n\t\n\tfunction setHeight(height) {\n\t\tif (height === undefined) {\n\t\t\theight = viewHeight;\n\t\t}\n\t\tviewHeight = height;\n\t\tslotTopCache = {};\n\t\n\t\tvar headHeight = dayBody.position().top;\n\t\tvar allDayHeight = slotScroller.position().top; // including divider\n\t\tvar bodyHeight = Math.min( // total body height, including borders\n\t\t\theight - headHeight,   // when scrollbars\n\t\t\tslotTable.height() + allDayHeight + 1 // when no scrollbars. +1 for bottom border\n\t\t);\n\n\t\tdayBodyFirstCellStretcher\n\t\t\t.height(bodyHeight - vsides(dayBodyFirstCell));\n\t\t\n\t\tslotLayer.css('top', headHeight);\n\t\t\n\t\tslotScroller.height(bodyHeight - allDayHeight - 1);\n\t\t\n\t\t// the stylesheet guarantees that the first row has no border.\n\t\t// this allows .height() to work well cross-browser.\n\t\tslotHeight = slotTable.find('tr:first').height() + 1; // +1 for bottom border\n\n\t\tsnapRatio = opt('slotMinutes') / snapMinutes;\n\t\tsnapHeight = slotHeight / snapRatio;\n\t}\n\t\n\t\n\tfunction setWidth(width) {\n\t\tviewWidth = width;\n\t\tcolPositions.clear();\n\t\tcolContentPositions.clear();\n\n\t\tvar axisFirstCells = dayHead.find('th:first');\n\t\tif (allDayTable) {\n\t\t\taxisFirstCells = axisFirstCells.add(allDayTable.find('th:first'));\n\t\t}\n\t\taxisFirstCells = axisFirstCells.add(slotTable.find('th:first'));\n\t\t\n\t\taxisWidth = 0;\n\t\tsetOuterWidth(\n\t\t\taxisFirstCells\n\t\t\t\t.width('')\n\t\t\t\t.each(function(i, _cell) {\n\t\t\t\t\taxisWidth = Math.max(axisWidth, $(_cell).outerWidth());\n\t\t\t\t}),\n\t\t\taxisWidth\n\t\t);\n\t\t\n\t\tvar gutterCells = dayTable.find('.fc-agenda-gutter');\n\t\tif (allDayTable) {\n\t\t\tgutterCells = gutterCells.add(allDayTable.find('th.fc-agenda-gutter'));\n\t\t}\n\n\t\tvar slotTableWidth = slotScroller[0].clientWidth; // needs to be done after axisWidth (for IE7)\n\t\t\n\t\tgutterWidth = slotScroller.width() - slotTableWidth;\n\t\tif (gutterWidth) {\n\t\t\tsetOuterWidth(gutterCells, gutterWidth);\n\t\t\tgutterCells\n\t\t\t\t.show()\n\t\t\t\t.prev()\n\t\t\t\t.removeClass('fc-last');\n\t\t}else{\n\t\t\tgutterCells\n\t\t\t\t.hide()\n\t\t\t\t.prev()\n\t\t\t\t.addClass('fc-last');\n\t\t}\n\t\t\n\t\tcolWidth = Math.floor((slotTableWidth - axisWidth) / colCnt);\n\t\tsetOuterWidth(dayHeadCells.slice(0, -1), colWidth);\n\t}\n\t\n\n\n\t/* Scrolling\n\t-----------------------------------------------------------------------*/\n\n\n\tfunction resetScroll() {\n\t\tvar d0 = zeroDate();\n\t\tvar scrollDate = cloneDate(d0);\n\t\tscrollDate.setHours(opt('firstHour'));\n\t\tvar top = timePosition(d0, scrollDate) + 1; // +1 for the border\n\t\tfunction scroll() {\n\t\t\tslotScroller.scrollTop(top);\n\t\t}\n\t\tscroll();\n\t\tsetTimeout(scroll, 0); // overrides any previous scroll state made by the browser\n\t}\n\n\n\tfunction afterRender() { // after the view has been freshly rendered and sized\n\t\tresetScroll();\n\t}\n\t\n\t\n\t\n\t/* Slot/Day clicking and binding\n\t-----------------------------------------------------------------------*/\n\t\n\n\tfunction dayBind(cells) {\n\t\tcells.click(slotClick)\n\t\t\t.mousedown(daySelectionMousedown);\n\t}\n\n\n\tfunction slotBind(cells) {\n\t\tcells.click(slotClick)\n\t\t\t.mousedown(slotSelectionMousedown);\n\t}\n\t\n\t\n\tfunction slotClick(ev) {\n\t\tif (!opt('selectable')) { // if selectable, SelectionManager will worry about dayClick\n\t\t\tvar col = Math.min(colCnt-1, Math.floor((ev.pageX - dayTable.offset().left - axisWidth) / colWidth));\n\t\t\tvar date = cellToDate(0, col);\n\t\t\tvar rowMatch = this.parentNode.className.match(/fc-slot(\\d+)/); // TODO: maybe use data\n\t\t\tif (rowMatch) {\n\t\t\t\tvar mins = parseInt(rowMatch[1]) * opt('slotMinutes');\n\t\t\t\tvar hours = Math.floor(mins/60);\n\t\t\t\tdate.setHours(hours);\n\t\t\t\tdate.setMinutes(mins%60 + minMinute);\n\t\t\t\ttrigger('dayClick', dayBodyCells[col], date, false, ev);\n\t\t\t}else{\n\t\t\t\ttrigger('dayClick', dayBodyCells[col], date, true, ev);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t\n\t/* Semi-transparent Overlay Helpers\n\t-----------------------------------------------------*/\n\t// TODO: should be consolidated with BasicView's methods\n\n\n\tfunction renderDayOverlay(overlayStart, overlayEnd, refreshCoordinateGrid) { // overlayEnd is exclusive\n\n\t\tif (refreshCoordinateGrid) {\n\t\t\tcoordinateGrid.build();\n\t\t}\n\n\t\tvar segments = rangeToSegments(overlayStart, overlayEnd);\n\n\t\tfor (var i=0; i<segments.length; i++) {\n\t\t\tvar segment = segments[i];\n\t\t\tdayBind(\n\t\t\t\trenderCellOverlay(\n\t\t\t\t\tsegment.row,\n\t\t\t\t\tsegment.leftCol,\n\t\t\t\t\tsegment.row,\n\t\t\t\t\tsegment.rightCol\n\t\t\t\t)\n\t\t\t);\n\t\t}\n\t}\n\t\n\t\n\tfunction renderCellOverlay(row0, col0, row1, col1) { // only for all-day?\n\t\tvar rect = coordinateGrid.rect(row0, col0, row1, col1, slotLayer);\n\t\treturn renderOverlay(rect, slotLayer);\n\t}\n\t\n\n\tfunction renderSlotOverlay(overlayStart, overlayEnd) {\n\t\tfor (var i=0; i<colCnt; i++) {\n\t\t\tvar dayStart = cellToDate(0, i);\n\t\t\tvar dayEnd = addDays(cloneDate(dayStart), 1);\n\t\t\tvar stretchStart = new Date(Math.max(dayStart, overlayStart));\n\t\t\tvar stretchEnd = new Date(Math.min(dayEnd, overlayEnd));\n\t\t\tif (stretchStart < stretchEnd) {\n\t\t\t\tvar rect = coordinateGrid.rect(0, i, 0, i, slotContainer); // only use it for horizontal coords\n\t\t\t\tvar top = timePosition(dayStart, stretchStart);\n\t\t\t\tvar bottom = timePosition(dayStart, stretchEnd);\n\t\t\t\trect.top = top;\n\t\t\t\trect.height = bottom - top;\n\t\t\t\tslotBind(\n\t\t\t\t\trenderOverlay(rect, slotContainer)\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t\n\t/* Coordinate Utilities\n\t-----------------------------------------------------------------------------*/\n\t\n\t\n\tcoordinateGrid = new CoordinateGrid(function(rows, cols) {\n\t\tvar e, n, p;\n\t\tdayHeadCells.each(function(i, _e) {\n\t\t\te = $(_e);\n\t\t\tn = e.offset().left;\n\t\t\tif (i) {\n\t\t\t\tp[1] = n;\n\t\t\t}\n\t\t\tp = [n];\n\t\t\tcols[i] = p;\n\t\t});\n\t\tp[1] = n + e.outerWidth();\n\t\tif (opt('allDaySlot')) {\n\t\t\te = allDayRow;\n\t\t\tn = e.offset().top;\n\t\t\trows[0] = [n, n+e.outerHeight()];\n\t\t}\n\t\tvar slotTableTop = slotContainer.offset().top;\n\t\tvar slotScrollerTop = slotScroller.offset().top;\n\t\tvar slotScrollerBottom = slotScrollerTop + slotScroller.outerHeight();\n\t\tfunction constrain(n) {\n\t\t\treturn Math.max(slotScrollerTop, Math.min(slotScrollerBottom, n));\n\t\t}\n\t\tfor (var i=0; i<slotCnt*snapRatio; i++) { // adapt slot count to increased/decreased selection slot count\n\t\t\trows.push([\n\t\t\t\tconstrain(slotTableTop + snapHeight*i),\n\t\t\t\tconstrain(slotTableTop + snapHeight*(i+1))\n\t\t\t]);\n\t\t}\n\t});\n\t\n\t\n\thoverListener = new HoverListener(coordinateGrid);\n\t\n\tcolPositions = new HorizontalPositionCache(function(col) {\n\t\treturn dayBodyCellInners.eq(col);\n\t});\n\t\n\tcolContentPositions = new HorizontalPositionCache(function(col) {\n\t\treturn dayBodyCellContentInners.eq(col);\n\t});\n\t\n\t\n\tfunction colLeft(col) {\n\t\treturn colPositions.left(col);\n\t}\n\n\n\tfunction colContentLeft(col) {\n\t\treturn colContentPositions.left(col);\n\t}\n\n\n\tfunction colRight(col) {\n\t\treturn colPositions.right(col);\n\t}\n\t\n\t\n\tfunction colContentRight(col) {\n\t\treturn colContentPositions.right(col);\n\t}\n\n\n\tfunction getIsCellAllDay(cell) {\n\t\treturn opt('allDaySlot') && !cell.row;\n\t}\n\n\n\tfunction realCellToDate(cell) { // ugh \"real\" ... but blame it on our abuse of the \"cell\" system\n\t\tvar d = cellToDate(0, cell.col);\n\t\tvar slotIndex = cell.row;\n\t\tif (opt('allDaySlot')) {\n\t\t\tslotIndex--;\n\t\t}\n\t\tif (slotIndex >= 0) {\n\t\t\taddMinutes(d, minMinute + slotIndex * snapMinutes);\n\t\t}\n\t\treturn d;\n\t}\n\t\n\t\n\t// get the Y coordinate of the given time on the given day (both Date objects)\n\tfunction timePosition(day, time) { // both date objects. day holds 00:00 of current day\n\t\tday = cloneDate(day, true);\n\t\tif (time < addMinutes(cloneDate(day), minMinute)) {\n\t\t\treturn 0;\n\t\t}\n\t\tif (time >= addMinutes(cloneDate(day), maxMinute)) {\n\t\t\treturn slotTable.height();\n\t\t}\n\t\tvar slotMinutes = opt('slotMinutes'),\n\t\t\tminutes = time.getHours()*60 + time.getMinutes() - minMinute,\n\t\t\tslotI = Math.floor(minutes / slotMinutes),\n\t\t\tslotTop = slotTopCache[slotI];\n\t\tif (slotTop === undefined) {\n\t\t\tslotTop = slotTopCache[slotI] =\n\t\t\t\tslotTable.find('tr').eq(slotI).find('td div')[0].offsetTop;\n\t\t\t\t// .eq() is faster than \":eq()\" selector\n\t\t\t\t// [0].offsetTop is faster than .position().top (do we really need this optimization?)\n\t\t\t\t// a better optimization would be to cache all these divs\n\t\t}\n\t\treturn Math.max(0, Math.round(\n\t\t\tslotTop - 1 + slotHeight * ((minutes % slotMinutes) / slotMinutes)\n\t\t));\n\t}\n\t\n\t\n\tfunction getAllDayRow(index) {\n\t\treturn allDayRow;\n\t}\n\t\n\t\n\tfunction defaultEventEnd(event) {\n\t\tvar start = cloneDate(event.start);\n\t\tif (event.allDay) {\n\t\t\treturn start;\n\t\t}\n\t\treturn addMinutes(start, opt('defaultEventMinutes'));\n\t}\n\t\n\t\n\t\n\t/* Selection\n\t---------------------------------------------------------------------------------*/\n\t\n\t\n\tfunction defaultSelectionEnd(startDate, allDay) {\n\t\tif (allDay) {\n\t\t\treturn cloneDate(startDate);\n\t\t}\n\t\treturn addMinutes(cloneDate(startDate), opt('slotMinutes'));\n\t}\n\t\n\t\n\tfunction renderSelection(startDate, endDate, allDay) { // only for all-day\n\t\tif (allDay) {\n\t\t\tif (opt('allDaySlot')) {\n\t\t\t\trenderDayOverlay(startDate, addDays(cloneDate(endDate), 1), true);\n\t\t\t}\n\t\t}else{\n\t\t\trenderSlotSelection(startDate, endDate);\n\t\t}\n\t}\n\t\n\t\n\tfunction renderSlotSelection(startDate, endDate) {\n\t\tvar helperOption = opt('selectHelper');\n\t\tcoordinateGrid.build();\n\t\tif (helperOption) {\n\t\t\tvar col = dateToCell(startDate).col;\n\t\t\tif (col >= 0 && col < colCnt) { // only works when times are on same day\n\t\t\t\tvar rect = coordinateGrid.rect(0, col, 0, col, slotContainer); // only for horizontal coords\n\t\t\t\tvar top = timePosition(startDate, startDate);\n\t\t\t\tvar bottom = timePosition(startDate, endDate);\n\t\t\t\tif (bottom > top) { // protect against selections that are entirely before or after visible range\n\t\t\t\t\trect.top = top;\n\t\t\t\t\trect.height = bottom - top;\n\t\t\t\t\trect.left += 2;\n\t\t\t\t\trect.width -= 5;\n\t\t\t\t\tif ($.isFunction(helperOption)) {\n\t\t\t\t\t\tvar helperRes = helperOption(startDate, endDate);\n\t\t\t\t\t\tif (helperRes) {\n\t\t\t\t\t\t\trect.position = 'absolute';\n\t\t\t\t\t\t\tselectionHelper = $(helperRes)\n\t\t\t\t\t\t\t\t.css(rect)\n\t\t\t\t\t\t\t\t.appendTo(slotContainer);\n\t\t\t\t\t\t}\n\t\t\t\t\t}else{\n\t\t\t\t\t\trect.isStart = true; // conside rect a \"seg\" now\n\t\t\t\t\t\trect.isEnd = true;   //\n\t\t\t\t\t\tselectionHelper = $(slotSegHtml(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttitle: '',\n\t\t\t\t\t\t\t\tstart: startDate,\n\t\t\t\t\t\t\t\tend: endDate,\n\t\t\t\t\t\t\t\tclassName: ['fc-select-helper'],\n\t\t\t\t\t\t\t\teditable: false\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\trect\n\t\t\t\t\t\t));\n\t\t\t\t\t\tselectionHelper.css('opacity', opt('dragOpacity'));\n\t\t\t\t\t}\n\t\t\t\t\tif (selectionHelper) {\n\t\t\t\t\t\tslotBind(selectionHelper);\n\t\t\t\t\t\tslotContainer.append(selectionHelper);\n\t\t\t\t\t\tsetOuterWidth(selectionHelper, rect.width, true); // needs to be after appended\n\t\t\t\t\t\tsetOuterHeight(selectionHelper, rect.height, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}else{\n\t\t\trenderSlotOverlay(startDate, endDate);\n\t\t}\n\t}\n\t\n\t\n\tfunction clearSelection() {\n\t\tclearOverlays();\n\t\tif (selectionHelper) {\n\t\t\tselectionHelper.remove();\n\t\t\tselectionHelper = null;\n\t\t}\n\t}\n\t\n\t\n\tfunction slotSelectionMousedown(ev) {\n\t\tif (ev.which == 1 && opt('selectable')) { // ev.which==1 means left mouse button\n\t\t\tunselect(ev);\n\t\t\tvar dates;\n\t\t\thoverListener.start(function(cell, origCell) {\n\t\t\t\tclearSelection();\n\t\t\t\tif (cell && cell.col == origCell.col && !getIsCellAllDay(cell)) {\n\t\t\t\t\tvar d1 = realCellToDate(origCell);\n\t\t\t\t\tvar d2 = realCellToDate(cell);\n\t\t\t\t\tdates = [\n\t\t\t\t\t\td1,\n\t\t\t\t\t\taddMinutes(cloneDate(d1), snapMinutes), // calculate minutes depending on selection slot minutes \n\t\t\t\t\t\td2,\n\t\t\t\t\t\taddMinutes(cloneDate(d2), snapMinutes)\n\t\t\t\t\t].sort(dateCompare);\n\t\t\t\t\trenderSlotSelection(dates[0], dates[3]);\n\t\t\t\t}else{\n\t\t\t\t\tdates = null;\n\t\t\t\t}\n\t\t\t}, ev);\n\t\t\t$(document).one('mouseup', function(ev) {\n\t\t\t\thoverListener.stop();\n\t\t\t\tif (dates) {\n\t\t\t\t\tif (+dates[0] == +dates[1]) {\n\t\t\t\t\t\treportDayClick(dates[0], false, ev);\n\t\t\t\t\t}\n\t\t\t\t\treportSelection(dates[0], dates[3], false, ev);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\n\tfunction reportDayClick(date, allDay, ev) {\n\t\ttrigger('dayClick', dayBodyCells[dateToCell(date).col], date, allDay, ev);\n\t}\n\t\n\t\n\t\n\t/* External Dragging\n\t--------------------------------------------------------------------------------*/\n\t\n\t\n\tfunction dragStart(_dragElement, ev, ui) {\n\t\thoverListener.start(function(cell) {\n\t\t\tclearOverlays();\n\t\t\tif (cell) {\n\t\t\t\tif (getIsCellAllDay(cell)) {\n\t\t\t\t\trenderCellOverlay(cell.row, cell.col, cell.row, cell.col);\n\t\t\t\t}else{\n\t\t\t\t\tvar d1 = realCellToDate(cell);\n\t\t\t\t\tvar d2 = addMinutes(cloneDate(d1), opt('defaultEventMinutes'));\n\t\t\t\t\trenderSlotOverlay(d1, d2);\n\t\t\t\t}\n\t\t\t}\n\t\t}, ev);\n\t}\n\t\n\t\n\tfunction dragStop(_dragElement, ev, ui) {\n\t\tvar cell = hoverListener.stop();\n\t\tclearOverlays();\n\t\tif (cell) {\n\t\t\ttrigger('drop', _dragElement, realCellToDate(cell), getIsCellAllDay(cell), ev, ui);\n\t\t}\n\t}\n\t\n\n}\n\n;;\n\nfunction AgendaEventRenderer() {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.renderEvents = renderEvents;\n\tt.clearEvents = clearEvents;\n\tt.slotSegHtml = slotSegHtml;\n\t\n\t\n\t// imports\n\tDayEventRenderer.call(t);\n\tvar opt = t.opt;\n\tvar trigger = t.trigger;\n\tvar isEventDraggable = t.isEventDraggable;\n\tvar isEventResizable = t.isEventResizable;\n\tvar eventEnd = t.eventEnd;\n\tvar eventElementHandlers = t.eventElementHandlers;\n\tvar setHeight = t.setHeight;\n\tvar getDaySegmentContainer = t.getDaySegmentContainer;\n\tvar getSlotSegmentContainer = t.getSlotSegmentContainer;\n\tvar getHoverListener = t.getHoverListener;\n\tvar getMaxMinute = t.getMaxMinute;\n\tvar getMinMinute = t.getMinMinute;\n\tvar timePosition = t.timePosition;\n\tvar getIsCellAllDay = t.getIsCellAllDay;\n\tvar colContentLeft = t.colContentLeft;\n\tvar colContentRight = t.colContentRight;\n\tvar cellToDate = t.cellToDate;\n\tvar getColCnt = t.getColCnt;\n\tvar getColWidth = t.getColWidth;\n\tvar getSnapHeight = t.getSnapHeight;\n\tvar getSnapMinutes = t.getSnapMinutes;\n\tvar getSlotContainer = t.getSlotContainer;\n\tvar reportEventElement = t.reportEventElement;\n\tvar showEvents = t.showEvents;\n\tvar hideEvents = t.hideEvents;\n\tvar eventDrop = t.eventDrop;\n\tvar eventResize = t.eventResize;\n\tvar renderDayOverlay = t.renderDayOverlay;\n\tvar clearOverlays = t.clearOverlays;\n\tvar renderDayEvents = t.renderDayEvents;\n\tvar calendar = t.calendar;\n\tvar formatDate = calendar.formatDate;\n\tvar formatDates = calendar.formatDates;\n\n\n\t// overrides\n\tt.draggableDayEvent = draggableDayEvent;\n\n\t\n\t\n\t/* Rendering\n\t----------------------------------------------------------------------------*/\n\t\n\n\tfunction renderEvents(events, modifiedEventId) {\n\t\tvar i, len=events.length,\n\t\t\tdayEvents=[],\n\t\t\tslotEvents=[];\n\t\tfor (i=0; i<len; i++) {\n\t\t\tif (events[i].allDay) {\n\t\t\t\tdayEvents.push(events[i]);\n\t\t\t}else{\n\t\t\t\tslotEvents.push(events[i]);\n\t\t\t}\n\t\t}\n\n\t\tif (opt('allDaySlot')) {\n\t\t\trenderDayEvents(dayEvents, modifiedEventId);\n\t\t\tsetHeight(); // no params means set to viewHeight\n\t\t}\n\n\t\trenderSlotSegs(compileSlotSegs(slotEvents), modifiedEventId);\n\t}\n\t\n\t\n\tfunction clearEvents() {\n\t\tgetDaySegmentContainer().empty();\n\t\tgetSlotSegmentContainer().empty();\n\t}\n\n\t\n\tfunction compileSlotSegs(events) {\n\t\tvar colCnt = getColCnt(),\n\t\t\tminMinute = getMinMinute(),\n\t\t\tmaxMinute = getMaxMinute(),\n\t\t\td,\n\t\t\tvisEventEnds = $.map(events, slotEventEnd),\n\t\t\ti,\n\t\t\tj, seg,\n\t\t\tcolSegs,\n\t\t\tsegs = [];\n\n\t\tfor (i=0; i<colCnt; i++) {\n\n\t\t\td = cellToDate(0, i);\n\t\t\taddMinutes(d, minMinute);\n\n\t\t\tcolSegs = sliceSegs(\n\t\t\t\tevents,\n\t\t\t\tvisEventEnds,\n\t\t\t\td,\n\t\t\t\taddMinutes(cloneDate(d), maxMinute-minMinute)\n\t\t\t);\n\n\t\t\tcolSegs = placeSlotSegs(colSegs); // returns a new order\n\n\t\t\tfor (j=0; j<colSegs.length; j++) {\n\t\t\t\tseg = colSegs[j];\n\t\t\t\tseg.col = i;\n\t\t\t\tsegs.push(seg);\n\t\t\t}\n\t\t}\n\n\t\treturn segs;\n\t}\n\n\n\tfunction sliceSegs(events, visEventEnds, start, end) {\n\t\tvar segs = [],\n\t\t\ti, len=events.length, event,\n\t\t\teventStart, eventEnd,\n\t\t\tsegStart, segEnd,\n\t\t\tisStart, isEnd;\n\t\tfor (i=0; i<len; i++) {\n\t\t\tevent = events[i];\n\t\t\teventStart = event.start;\n\t\t\teventEnd = visEventEnds[i];\n\t\t\tif (eventEnd > start && eventStart < end) {\n\t\t\t\tif (eventStart < start) {\n\t\t\t\t\tsegStart = cloneDate(start);\n\t\t\t\t\tisStart = false;\n\t\t\t\t}else{\n\t\t\t\t\tsegStart = eventStart;\n\t\t\t\t\tisStart = true;\n\t\t\t\t}\n\t\t\t\tif (eventEnd > end) {\n\t\t\t\t\tsegEnd = cloneDate(end);\n\t\t\t\t\tisEnd = false;\n\t\t\t\t}else{\n\t\t\t\t\tsegEnd = eventEnd;\n\t\t\t\t\tisEnd = true;\n\t\t\t\t}\n\t\t\t\tsegs.push({\n\t\t\t\t\tevent: event,\n\t\t\t\t\tstart: segStart,\n\t\t\t\t\tend: segEnd,\n\t\t\t\t\tisStart: isStart,\n\t\t\t\t\tisEnd: isEnd\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn segs.sort(compareSlotSegs);\n\t}\n\n\n\tfunction slotEventEnd(event) {\n\t\tif (event.end) {\n\t\t\treturn cloneDate(event.end);\n\t\t}else{\n\t\t\treturn addMinutes(cloneDate(event.start), opt('defaultEventMinutes'));\n\t\t}\n\t}\n\t\n\t\n\t// renders events in the 'time slots' at the bottom\n\t// TODO: when we refactor this, when user returns `false` eventRender, don't have empty space\n\t// TODO: refactor will include using pixels to detect collisions instead of dates (handy for seg cmp)\n\t\n\tfunction renderSlotSegs(segs, modifiedEventId) {\n\t\n\t\tvar i, segCnt=segs.length, seg,\n\t\t\tevent,\n\t\t\ttop,\n\t\t\tbottom,\n\t\t\tcolumnLeft,\n\t\t\tcolumnRight,\n\t\t\tcolumnWidth,\n\t\t\twidth,\n\t\t\tleft,\n\t\t\tright,\n\t\t\thtml = '',\n\t\t\teventElements,\n\t\t\teventElement,\n\t\t\ttriggerRes,\n\t\t\ttitleElement,\n\t\t\theight,\n\t\t\tslotSegmentContainer = getSlotSegmentContainer(),\n\t\t\tisRTL = opt('isRTL');\n\t\t\t\n\t\t// calculate position/dimensions, create html\n\t\tfor (i=0; i<segCnt; i++) {\n\t\t\tseg = segs[i];\n\t\t\tevent = seg.event;\n\t\t\ttop = timePosition(seg.start, seg.start);\n\t\t\tbottom = timePosition(seg.start, seg.end);\n\t\t\tcolumnLeft = colContentLeft(seg.col);\n\t\t\tcolumnRight = colContentRight(seg.col);\n\t\t\tcolumnWidth = columnRight - columnLeft;\n\n\t\t\t// shave off space on right near scrollbars (2.5%)\n\t\t\t// TODO: move this to CSS somehow\n\t\t\tcolumnRight -= columnWidth * .025;\n\t\t\tcolumnWidth = columnRight - columnLeft;\n\n\t\t\twidth = columnWidth * (seg.forwardCoord - seg.backwardCoord);\n\n\t\t\tif (opt('slotEventOverlap')) {\n\t\t\t\t// double the width while making sure resize handle is visible\n\t\t\t\t// (assumed to be 20px wide)\n\t\t\t\twidth = Math.max(\n\t\t\t\t\t(width - (20/2)) * 2,\n\t\t\t\t\twidth // narrow columns will want to make the segment smaller than\n\t\t\t\t\t\t// the natural width. don't allow it\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (isRTL) {\n\t\t\t\tright = columnRight - seg.backwardCoord * columnWidth;\n\t\t\t\tleft = right - width;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tleft = columnLeft + seg.backwardCoord * columnWidth;\n\t\t\t\tright = left + width;\n\t\t\t}\n\n\t\t\t// make sure horizontal coordinates are in bounds\n\t\t\tleft = Math.max(left, columnLeft);\n\t\t\tright = Math.min(right, columnRight);\n\t\t\twidth = right - left;\n\n\t\t\tseg.top = top;\n\t\t\tseg.left = left;\n\t\t\tseg.outerWidth = width;\n\t\t\tseg.outerHeight = bottom - top;\n\t\t\thtml += slotSegHtml(event, seg);\n\t\t}\n\n\t\tslotSegmentContainer[0].innerHTML = html; // faster than html()\n\t\teventElements = slotSegmentContainer.children();\n\t\t\n\t\t// retrieve elements, run through eventRender callback, bind event handlers\n\t\tfor (i=0; i<segCnt; i++) {\n\t\t\tseg = segs[i];\n\t\t\tevent = seg.event;\n\t\t\teventElement = $(eventElements[i]); // faster than eq()\n\t\t\ttriggerRes = trigger('eventRender', event, event, eventElement);\n\t\t\tif (triggerRes === false) {\n\t\t\t\teventElement.remove();\n\t\t\t}else{\n\t\t\t\tif (triggerRes && triggerRes !== true) {\n\t\t\t\t\teventElement.remove();\n\t\t\t\t\teventElement = $(triggerRes)\n\t\t\t\t\t\t.css({\n\t\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\t\ttop: seg.top,\n\t\t\t\t\t\t\tleft: seg.left\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.appendTo(slotSegmentContainer);\n\t\t\t\t}\n\t\t\t\tseg.element = eventElement;\n\t\t\t\tif (event._id === modifiedEventId) {\n\t\t\t\t\tbindSlotSeg(event, eventElement, seg);\n\t\t\t\t}else{\n\t\t\t\t\teventElement[0]._fci = i; // for lazySegBind\n\t\t\t\t}\n\t\t\t\treportEventElement(event, eventElement);\n\t\t\t}\n\t\t}\n\t\t\n\t\tlazySegBind(slotSegmentContainer, segs, bindSlotSeg);\n\t\t\n\t\t// record event sides and title positions\n\t\tfor (i=0; i<segCnt; i++) {\n\t\t\tseg = segs[i];\n\t\t\tif (eventElement = seg.element) {\n\t\t\t\tseg.vsides = vsides(eventElement, true);\n\t\t\t\tseg.hsides = hsides(eventElement, true);\n\t\t\t\ttitleElement = eventElement.find('.fc-event-title');\n\t\t\t\tif (titleElement.length) {\n\t\t\t\t\tseg.contentTop = titleElement[0].offsetTop;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t\t// set all positions/dimensions at once\n\t\tfor (i=0; i<segCnt; i++) {\n\t\t\tseg = segs[i];\n\t\t\tif (eventElement = seg.element) {\n\t\t\t\teventElement[0].style.width = Math.max(0, seg.outerWidth - seg.hsides) + 'px';\n\t\t\t\theight = Math.max(0, seg.outerHeight - seg.vsides);\n\t\t\t\teventElement[0].style.height = height + 'px';\n\t\t\t\tevent = seg.event;\n\t\t\t\tif (seg.contentTop !== undefined && height - seg.contentTop < 10) {\n\t\t\t\t\t// not enough room for title, put it in the time (TODO: maybe make both display:inline instead)\n\t\t\t\t\teventElement.find('div.fc-event-time')\n\t\t\t\t\t\t.text(formatDate(event.start, opt('timeFormat')) + ' - ' + event.title);\n\t\t\t\t\teventElement.find('div.fc-event-title')\n\t\t\t\t\t\t.remove();\n\t\t\t\t}\n\t\t\t\ttrigger('eventAfterRender', event, event, eventElement);\n\t\t\t}\n\t\t}\n\t\t\t\t\t\n\t}\n\t\n\t\n\tfunction slotSegHtml(event, seg) {\n\t\tvar html = \"<\";\n\t\tvar url = event.url;\n\t\tvar skinCss = getSkinCss(event, opt);\n\t\tvar classes = ['fc-event', 'fc-event-vert'];\n\t\tif (isEventDraggable(event)) {\n\t\t\tclasses.push('fc-event-draggable');\n\t\t}\n\t\tif (seg.isStart) {\n\t\t\tclasses.push('fc-event-start');\n\t\t}\n\t\tif (seg.isEnd) {\n\t\t\tclasses.push('fc-event-end');\n\t\t}\n\t\tclasses = classes.concat(event.className);\n\t\tif (event.source) {\n\t\t\tclasses = classes.concat(event.source.className || []);\n\t\t}\n\t\tif (url) {\n\t\t\thtml += \"a href='\" + htmlEscape(event.url) + \"'\";\n\t\t}else{\n\t\t\thtml += \"div\";\n\t\t}\n\t\thtml +=\n\t\t\t\" class='\" + classes.join(' ') + \"'\" +\n\t\t\t\" style=\" +\n\t\t\t\t\"'\" +\n\t\t\t\t\"position:absolute;\" +\n\t\t\t\t\"top:\" + seg.top + \"px;\" +\n\t\t\t\t\"left:\" + seg.left + \"px;\" +\n\t\t\t\tskinCss +\n\t\t\t\t\"'\" +\n\t\t\t\">\" +\n\t\t\t\"<div class='fc-event-inner'>\" +\n\t\t\t\"<div class='fc-event-time'>\" +\n\t\t\thtmlEscape(formatDates(event.start, event.end, opt('timeFormat'))) +\n\t\t\t\"</div>\" +\n\t\t\t\"<div class='fc-event-title'>\" +\n\t\t\thtmlEscape(event.title || '') +\n\t\t\t\"</div>\" +\n\t\t\t\"</div>\" +\n\t\t\t\"<div class='fc-event-bg'></div>\";\n\t\tif (seg.isEnd && isEventResizable(event)) {\n\t\t\thtml +=\n\t\t\t\t\"<div class='ui-resizable-handle ui-resizable-s'>=</div>\";\n\t\t}\n\t\thtml +=\n\t\t\t\"</\" + (url ? \"a\" : \"div\") + \">\";\n\t\treturn html;\n\t}\n\t\n\t\n\tfunction bindSlotSeg(event, eventElement, seg) {\n\t\tvar timeElement = eventElement.find('div.fc-event-time');\n\t\tif (isEventDraggable(event)) {\n\t\t\tdraggableSlotEvent(event, eventElement, timeElement);\n\t\t}\n\t\tif (seg.isEnd && isEventResizable(event)) {\n\t\t\tresizableSlotEvent(event, eventElement, timeElement);\n\t\t}\n\t\teventElementHandlers(event, eventElement);\n\t}\n\t\n\t\n\t\n\t/* Dragging\n\t-----------------------------------------------------------------------------------*/\n\t\n\t\n\t// when event starts out FULL-DAY\n\t// overrides DayEventRenderer's version because it needs to account for dragging elements\n\t// to and from the slot area.\n\t\n\tfunction draggableDayEvent(event, eventElement, seg) {\n\t\tvar isStart = seg.isStart;\n\t\tvar origWidth;\n\t\tvar revert;\n\t\tvar allDay = true;\n\t\tvar dayDelta;\n\t\tvar hoverListener = getHoverListener();\n\t\tvar colWidth = getColWidth();\n\t\tvar snapHeight = getSnapHeight();\n\t\tvar snapMinutes = getSnapMinutes();\n\t\tvar minMinute = getMinMinute();\n\t\teventElement.draggable({\n\t\t\topacity: opt('dragOpacity', 'month'), // use whatever the month view was using\n\t\t\trevertDuration: opt('dragRevertDuration'),\n\t\t\tstart: function(ev, ui) {\n\t\t\t\ttrigger('eventDragStart', eventElement, event, ev, ui);\n\t\t\t\thideEvents(event, eventElement);\n\t\t\t\torigWidth = eventElement.width();\n\t\t\t\thoverListener.start(function(cell, origCell) {\n\t\t\t\t\tclearOverlays();\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\trevert = false;\n\t\t\t\t\t\tvar origDate = cellToDate(0, origCell.col);\n\t\t\t\t\t\tvar date = cellToDate(0, cell.col);\n\t\t\t\t\t\tdayDelta = dayDiff(date, origDate);\n\t\t\t\t\t\tif (!cell.row) {\n\t\t\t\t\t\t\t// on full-days\n\t\t\t\t\t\t\trenderDayOverlay(\n\t\t\t\t\t\t\t\taddDays(cloneDate(event.start), dayDelta),\n\t\t\t\t\t\t\t\taddDays(exclEndDay(event), dayDelta)\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tresetElement();\n\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t// mouse is over bottom slots\n\t\t\t\t\t\t\tif (isStart) {\n\t\t\t\t\t\t\t\tif (allDay) {\n\t\t\t\t\t\t\t\t\t// convert event to temporary slot-event\n\t\t\t\t\t\t\t\t\teventElement.width(colWidth - 10); // don't use entire width\n\t\t\t\t\t\t\t\t\tsetOuterHeight(\n\t\t\t\t\t\t\t\t\t\teventElement,\n\t\t\t\t\t\t\t\t\t\tsnapHeight * Math.round(\n\t\t\t\t\t\t\t\t\t\t\t(event.end ? ((event.end - event.start) / MINUTE_MS) : opt('defaultEventMinutes')) /\n\t\t\t\t\t\t\t\t\t\t\t\tsnapMinutes\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\teventElement.draggable('option', 'grid', [colWidth, 1]);\n\t\t\t\t\t\t\t\t\tallDay = false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\trevert = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\trevert = revert || (allDay && !dayDelta);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tresetElement();\n\t\t\t\t\t\trevert = true;\n\t\t\t\t\t}\n\t\t\t\t\teventElement.draggable('option', 'revert', revert);\n\t\t\t\t}, ev, 'drag');\n\t\t\t},\n\t\t\tstop: function(ev, ui) {\n\t\t\t\thoverListener.stop();\n\t\t\t\tclearOverlays();\n\t\t\t\ttrigger('eventDragStop', eventElement, event, ev, ui);\n\t\t\t\tif (revert) {\n\t\t\t\t\t// hasn't moved or is out of bounds (draggable has already reverted)\n\t\t\t\t\tresetElement();\n\t\t\t\t\teventElement.css('filter', ''); // clear IE opacity side-effects\n\t\t\t\t\tshowEvents(event, eventElement);\n\t\t\t\t}else{\n\t\t\t\t\t// changed!\n\t\t\t\t\tvar minuteDelta = 0;\n\t\t\t\t\tif (!allDay) {\n\t\t\t\t\t\tminuteDelta = Math.round((eventElement.offset().top - getSlotContainer().offset().top) / snapHeight)\n\t\t\t\t\t\t\t* snapMinutes\n\t\t\t\t\t\t\t+ minMinute\n\t\t\t\t\t\t\t- (event.start.getHours() * 60 + event.start.getMinutes());\n\t\t\t\t\t}\n\t\t\t\t\teventDrop(this, event, dayDelta, minuteDelta, allDay, ev, ui);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tfunction resetElement() {\n\t\t\tif (!allDay) {\n\t\t\t\teventElement\n\t\t\t\t\t.width(origWidth)\n\t\t\t\t\t.height('')\n\t\t\t\t\t.draggable('option', 'grid', null);\n\t\t\t\tallDay = true;\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t// when event starts out IN TIMESLOTS\n\t\n\tfunction draggableSlotEvent(event, eventElement, timeElement) {\n\t\tvar coordinateGrid = t.getCoordinateGrid();\n\t\tvar colCnt = getColCnt();\n\t\tvar colWidth = getColWidth();\n\t\tvar snapHeight = getSnapHeight();\n\t\tvar snapMinutes = getSnapMinutes();\n\n\t\t// states\n\t\tvar origPosition; // original position of the element, not the mouse\n\t\tvar origCell;\n\t\tvar isInBounds, prevIsInBounds;\n\t\tvar isAllDay, prevIsAllDay;\n\t\tvar colDelta, prevColDelta;\n\t\tvar dayDelta; // derived from colDelta\n\t\tvar minuteDelta, prevMinuteDelta;\n\n\t\teventElement.draggable({\n\t\t\tscroll: false,\n\t\t\tgrid: [ colWidth, snapHeight ],\n\t\t\taxis: colCnt==1 ? 'y' : false,\n\t\t\topacity: opt('dragOpacity'),\n\t\t\trevertDuration: opt('dragRevertDuration'),\n\t\t\tstart: function(ev, ui) {\n\n\t\t\t\ttrigger('eventDragStart', eventElement, event, ev, ui);\n\t\t\t\thideEvents(event, eventElement);\n\n\t\t\t\tcoordinateGrid.build();\n\n\t\t\t\t// initialize states\n\t\t\t\torigPosition = eventElement.position();\n\t\t\t\torigCell = coordinateGrid.cell(ev.pageX, ev.pageY);\n\t\t\t\tisInBounds = prevIsInBounds = true;\n\t\t\t\tisAllDay = prevIsAllDay = getIsCellAllDay(origCell);\n\t\t\t\tcolDelta = prevColDelta = 0;\n\t\t\t\tdayDelta = 0;\n\t\t\t\tminuteDelta = prevMinuteDelta = 0;\n\n\t\t\t},\n\t\t\tdrag: function(ev, ui) {\n\n\t\t\t\t// NOTE: this `cell` value is only useful for determining in-bounds and all-day.\n\t\t\t\t// Bad for anything else due to the discrepancy between the mouse position and the\n\t\t\t\t// element position while snapping. (problem revealed in PR #55)\n\t\t\t\t//\n\t\t\t\t// PS- the problem exists for draggableDayEvent() when dragging an all-day event to a slot event.\n\t\t\t\t// We should overhaul the dragging system and stop relying on jQuery UI.\n\t\t\t\tvar cell = coordinateGrid.cell(ev.pageX, ev.pageY);\n\n\t\t\t\t// update states\n\t\t\t\tisInBounds = !!cell;\n\t\t\t\tif (isInBounds) {\n\t\t\t\t\tisAllDay = getIsCellAllDay(cell);\n\n\t\t\t\t\t// calculate column delta\n\t\t\t\t\tcolDelta = Math.round((ui.position.left - origPosition.left) / colWidth);\n\t\t\t\t\tif (colDelta != prevColDelta) {\n\t\t\t\t\t\t// calculate the day delta based off of the original clicked column and the column delta\n\t\t\t\t\t\tvar origDate = cellToDate(0, origCell.col);\n\t\t\t\t\t\tvar col = origCell.col + colDelta;\n\t\t\t\t\t\tcol = Math.max(0, col);\n\t\t\t\t\t\tcol = Math.min(colCnt-1, col);\n\t\t\t\t\t\tvar date = cellToDate(0, col);\n\t\t\t\t\t\tdayDelta = dayDiff(date, origDate);\n\t\t\t\t\t}\n\n\t\t\t\t\t// calculate minute delta (only if over slots)\n\t\t\t\t\tif (!isAllDay) {\n\t\t\t\t\t\tminuteDelta = Math.round((ui.position.top - origPosition.top) / snapHeight) * snapMinutes;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// any state changes?\n\t\t\t\tif (\n\t\t\t\t\tisInBounds != prevIsInBounds ||\n\t\t\t\t\tisAllDay != prevIsAllDay ||\n\t\t\t\t\tcolDelta != prevColDelta ||\n\t\t\t\t\tminuteDelta != prevMinuteDelta\n\t\t\t\t) {\n\n\t\t\t\t\tupdateUI();\n\n\t\t\t\t\t// update previous states for next time\n\t\t\t\t\tprevIsInBounds = isInBounds;\n\t\t\t\t\tprevIsAllDay = isAllDay;\n\t\t\t\t\tprevColDelta = colDelta;\n\t\t\t\t\tprevMinuteDelta = minuteDelta;\n\t\t\t\t}\n\n\t\t\t\t// if out-of-bounds, revert when done, and vice versa.\n\t\t\t\teventElement.draggable('option', 'revert', !isInBounds);\n\n\t\t\t},\n\t\t\tstop: function(ev, ui) {\n\n\t\t\t\tclearOverlays();\n\t\t\t\ttrigger('eventDragStop', eventElement, event, ev, ui);\n\n\t\t\t\tif (isInBounds && (isAllDay || dayDelta || minuteDelta)) { // changed!\n\t\t\t\t\teventDrop(this, event, dayDelta, isAllDay ? 0 : minuteDelta, isAllDay, ev, ui);\n\t\t\t\t}\n\t\t\t\telse { // either no change or out-of-bounds (draggable has already reverted)\n\n\t\t\t\t\t// reset states for next time, and for updateUI()\n\t\t\t\t\tisInBounds = true;\n\t\t\t\t\tisAllDay = false;\n\t\t\t\t\tcolDelta = 0;\n\t\t\t\t\tdayDelta = 0;\n\t\t\t\t\tminuteDelta = 0;\n\n\t\t\t\t\tupdateUI();\n\t\t\t\t\teventElement.css('filter', ''); // clear IE opacity side-effects\n\n\t\t\t\t\t// sometimes fast drags make event revert to wrong position, so reset.\n\t\t\t\t\t// also, if we dragged the element out of the area because of snapping,\n\t\t\t\t\t// but the *mouse* is still in bounds, we need to reset the position.\n\t\t\t\t\teventElement.css(origPosition);\n\n\t\t\t\t\tshowEvents(event, eventElement);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tfunction updateUI() {\n\t\t\tclearOverlays();\n\t\t\tif (isInBounds) {\n\t\t\t\tif (isAllDay) {\n\t\t\t\t\ttimeElement.hide();\n\t\t\t\t\teventElement.draggable('option', 'grid', null); // disable grid snapping\n\t\t\t\t\trenderDayOverlay(\n\t\t\t\t\t\taddDays(cloneDate(event.start), dayDelta),\n\t\t\t\t\t\taddDays(exclEndDay(event), dayDelta)\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tupdateTimeText(minuteDelta);\n\t\t\t\t\ttimeElement.css('display', ''); // show() was causing display=inline\n\t\t\t\t\teventElement.draggable('option', 'grid', [colWidth, snapHeight]); // re-enable grid snapping\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction updateTimeText(minuteDelta) {\n\t\t\tvar newStart = addMinutes(cloneDate(event.start), minuteDelta);\n\t\t\tvar newEnd;\n\t\t\tif (event.end) {\n\t\t\t\tnewEnd = addMinutes(cloneDate(event.end), minuteDelta);\n\t\t\t}\n\t\t\ttimeElement.text(formatDates(newStart, newEnd, opt('timeFormat')));\n\t\t}\n\n\t}\n\t\n\t\n\t\n\t/* Resizing\n\t--------------------------------------------------------------------------------------*/\n\t\n\t\n\tfunction resizableSlotEvent(event, eventElement, timeElement) {\n\t\tvar snapDelta, prevSnapDelta;\n\t\tvar snapHeight = getSnapHeight();\n\t\tvar snapMinutes = getSnapMinutes();\n\t\teventElement.resizable({\n\t\t\thandles: {\n\t\t\t\ts: '.ui-resizable-handle'\n\t\t\t},\n\t\t\tgrid: snapHeight,\n\t\t\tstart: function(ev, ui) {\n\t\t\t\tsnapDelta = prevSnapDelta = 0;\n\t\t\t\thideEvents(event, eventElement);\n\t\t\t\ttrigger('eventResizeStart', this, event, ev, ui);\n\t\t\t},\n\t\t\tresize: function(ev, ui) {\n\t\t\t\t// don't rely on ui.size.height, doesn't take grid into account\n\t\t\t\tsnapDelta = Math.round((Math.max(snapHeight, eventElement.height()) - ui.originalSize.height) / snapHeight);\n\t\t\t\tif (snapDelta != prevSnapDelta) {\n\t\t\t\t\ttimeElement.text(\n\t\t\t\t\t\tformatDates(\n\t\t\t\t\t\t\tevent.start,\n\t\t\t\t\t\t\t(!snapDelta && !event.end) ? null : // no change, so don't display time range\n\t\t\t\t\t\t\t\taddMinutes(eventEnd(event), snapMinutes*snapDelta),\n\t\t\t\t\t\t\topt('timeFormat')\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t\tprevSnapDelta = snapDelta;\n\t\t\t\t}\n\t\t\t},\n\t\t\tstop: function(ev, ui) {\n\t\t\t\ttrigger('eventResizeStop', this, event, ev, ui);\n\t\t\t\tif (snapDelta) {\n\t\t\t\t\teventResize(this, event, 0, snapMinutes*snapDelta, ev, ui);\n\t\t\t\t}else{\n\t\t\t\t\tshowEvents(event, eventElement);\n\t\t\t\t\t// BUG: if event was really short, need to put title back in span\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\t\n\n}\n\n\n\n/* Agenda Event Segment Utilities\n-----------------------------------------------------------------------------*/\n\n\n// Sets the seg.backwardCoord and seg.forwardCoord on each segment and returns a new\n// list in the order they should be placed into the DOM (an implicit z-index).\nfunction placeSlotSegs(segs) {\n\tvar levels = buildSlotSegLevels(segs);\n\tvar level0 = levels[0];\n\tvar i;\n\n\tcomputeForwardSlotSegs(levels);\n\n\tif (level0) {\n\n\t\tfor (i=0; i<level0.length; i++) {\n\t\t\tcomputeSlotSegPressures(level0[i]);\n\t\t}\n\n\t\tfor (i=0; i<level0.length; i++) {\n\t\t\tcomputeSlotSegCoords(level0[i], 0, 0);\n\t\t}\n\t}\n\n\treturn flattenSlotSegLevels(levels);\n}\n\n\n// Builds an array of segments \"levels\". The first level will be the leftmost tier of segments\n// if the calendar is left-to-right, or the rightmost if the calendar is right-to-left.\nfunction buildSlotSegLevels(segs) {\n\tvar levels = [];\n\tvar i, seg;\n\tvar j;\n\n\tfor (i=0; i<segs.length; i++) {\n\t\tseg = segs[i];\n\n\t\t// go through all the levels and stop on the first level where there are no collisions\n\t\tfor (j=0; j<levels.length; j++) {\n\t\t\tif (!computeSlotSegCollisions(seg, levels[j]).length) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t(levels[j] || (levels[j] = [])).push(seg);\n\t}\n\n\treturn levels;\n}\n\n\n// For every segment, figure out the other segments that are in subsequent\n// levels that also occupy the same vertical space. Accumulate in seg.forwardSegs\nfunction computeForwardSlotSegs(levels) {\n\tvar i, level;\n\tvar j, seg;\n\tvar k;\n\n\tfor (i=0; i<levels.length; i++) {\n\t\tlevel = levels[i];\n\n\t\tfor (j=0; j<level.length; j++) {\n\t\t\tseg = level[j];\n\n\t\t\tseg.forwardSegs = [];\n\t\t\tfor (k=i+1; k<levels.length; k++) {\n\t\t\t\tcomputeSlotSegCollisions(seg, levels[k], seg.forwardSegs);\n\t\t\t}\n\t\t}\n\t}\n}\n\n\n// Figure out which path forward (via seg.forwardSegs) results in the longest path until\n// the furthest edge is reached. The number of segments in this path will be seg.forwardPressure\nfunction computeSlotSegPressures(seg) {\n\tvar forwardSegs = seg.forwardSegs;\n\tvar forwardPressure = 0;\n\tvar i, forwardSeg;\n\n\tif (seg.forwardPressure === undefined) { // not already computed\n\n\t\tfor (i=0; i<forwardSegs.length; i++) {\n\t\t\tforwardSeg = forwardSegs[i];\n\n\t\t\t// figure out the child's maximum forward path\n\t\t\tcomputeSlotSegPressures(forwardSeg);\n\n\t\t\t// either use the existing maximum, or use the child's forward pressure\n\t\t\t// plus one (for the forwardSeg itself)\n\t\t\tforwardPressure = Math.max(\n\t\t\t\tforwardPressure,\n\t\t\t\t1 + forwardSeg.forwardPressure\n\t\t\t);\n\t\t}\n\n\t\tseg.forwardPressure = forwardPressure;\n\t}\n}\n\n\n// Calculate seg.forwardCoord and seg.backwardCoord for the segment, where both values range\n// from 0 to 1. If the calendar is left-to-right, the seg.backwardCoord maps to \"left\" and\n// seg.forwardCoord maps to \"right\" (via percentage). Vice-versa if the calendar is right-to-left.\n//\n// The segment might be part of a \"series\", which means consecutive segments with the same pressure\n// who's width is unknown until an edge has been hit. `seriesBackwardPressure` is the number of\n// segments behind this one in the current series, and `seriesBackwardCoord` is the starting\n// coordinate of the first segment in the series.\nfunction computeSlotSegCoords(seg, seriesBackwardPressure, seriesBackwardCoord) {\n\tvar forwardSegs = seg.forwardSegs;\n\tvar i;\n\n\tif (seg.forwardCoord === undefined) { // not already computed\n\n\t\tif (!forwardSegs.length) {\n\n\t\t\t// if there are no forward segments, this segment should butt up against the edge\n\t\t\tseg.forwardCoord = 1;\n\t\t}\n\t\telse {\n\n\t\t\t// sort highest pressure first\n\t\t\tforwardSegs.sort(compareForwardSlotSegs);\n\n\t\t\t// this segment's forwardCoord will be calculated from the backwardCoord of the\n\t\t\t// highest-pressure forward segment.\n\t\t\tcomputeSlotSegCoords(forwardSegs[0], seriesBackwardPressure + 1, seriesBackwardCoord);\n\t\t\tseg.forwardCoord = forwardSegs[0].backwardCoord;\n\t\t}\n\n\t\t// calculate the backwardCoord from the forwardCoord. consider the series\n\t\tseg.backwardCoord = seg.forwardCoord -\n\t\t\t(seg.forwardCoord - seriesBackwardCoord) / // available width for series\n\t\t\t(seriesBackwardPressure + 1); // # of segments in the series\n\n\t\t// use this segment's coordinates to computed the coordinates of the less-pressurized\n\t\t// forward segments\n\t\tfor (i=0; i<forwardSegs.length; i++) {\n\t\t\tcomputeSlotSegCoords(forwardSegs[i], 0, seg.forwardCoord);\n\t\t}\n\t}\n}\n\n\n// Outputs a flat array of segments, from lowest to highest level\nfunction flattenSlotSegLevels(levels) {\n\tvar segs = [];\n\tvar i, level;\n\tvar j;\n\n\tfor (i=0; i<levels.length; i++) {\n\t\tlevel = levels[i];\n\n\t\tfor (j=0; j<level.length; j++) {\n\t\t\tsegs.push(level[j]);\n\t\t}\n\t}\n\n\treturn segs;\n}\n\n\n// Find all the segments in `otherSegs` that vertically collide with `seg`.\n// Append into an optionally-supplied `results` array and return.\nfunction computeSlotSegCollisions(seg, otherSegs, results) {\n\tresults = results || [];\n\n\tfor (var i=0; i<otherSegs.length; i++) {\n\t\tif (isSlotSegCollision(seg, otherSegs[i])) {\n\t\t\tresults.push(otherSegs[i]);\n\t\t}\n\t}\n\n\treturn results;\n}\n\n\n// Do these segments occupy the same vertical space?\nfunction isSlotSegCollision(seg1, seg2) {\n\treturn seg1.end > seg2.start && seg1.start < seg2.end;\n}\n\n\n// A cmp function for determining which forward segment to rely on more when computing coordinates.\nfunction compareForwardSlotSegs(seg1, seg2) {\n\t// put higher-pressure first\n\treturn seg2.forwardPressure - seg1.forwardPressure ||\n\t\t// put segments that are closer to initial edge first (and favor ones with no coords yet)\n\t\t(seg1.backwardCoord || 0) - (seg2.backwardCoord || 0) ||\n\t\t// do normal sorting...\n\t\tcompareSlotSegs(seg1, seg2);\n}\n\n\n// A cmp function for determining which segment should be closer to the initial edge\n// (the left edge on a left-to-right calendar).\nfunction compareSlotSegs(seg1, seg2) {\n\treturn seg1.start - seg2.start || // earlier start time goes first\n\t\t(seg2.end - seg2.start) - (seg1.end - seg1.start) || // tie? longer-duration goes first\n\t\t(seg1.event.title || '').localeCompare(seg2.event.title); // tie? alphabetically by title\n}\n\n\n;;\n\n\nfunction View(element, calendar, viewName) {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.element = element;\n\tt.calendar = calendar;\n\tt.name = viewName;\n\tt.opt = opt;\n\tt.trigger = trigger;\n\tt.isEventDraggable = isEventDraggable;\n\tt.isEventResizable = isEventResizable;\n\tt.setEventData = setEventData;\n\tt.clearEventData = clearEventData;\n\tt.eventEnd = eventEnd;\n\tt.reportEventElement = reportEventElement;\n\tt.triggerEventDestroy = triggerEventDestroy;\n\tt.eventElementHandlers = eventElementHandlers;\n\tt.showEvents = showEvents;\n\tt.hideEvents = hideEvents;\n\tt.eventDrop = eventDrop;\n\tt.eventResize = eventResize;\n\t// t.title\n\t// t.start, t.end\n\t// t.visStart, t.visEnd\n\t\n\t\n\t// imports\n\tvar defaultEventEnd = t.defaultEventEnd;\n\tvar normalizeEvent = calendar.normalizeEvent; // in EventManager\n\tvar reportEventChange = calendar.reportEventChange;\n\t\n\t\n\t// locals\n\tvar eventsByID = {}; // eventID mapped to array of events (there can be multiple b/c of repeating events)\n\tvar eventElementsByID = {}; // eventID mapped to array of jQuery elements\n\tvar eventElementCouples = []; // array of objects, { event, element } // TODO: unify with segment system\n\tvar options = calendar.options;\n\t\n\t\n\t\n\tfunction opt(name, viewNameOverride) {\n\t\tvar v = options[name];\n\t\tif ($.isPlainObject(v)) {\n\t\t\treturn smartProperty(v, viewNameOverride || viewName);\n\t\t}\n\t\treturn v;\n\t}\n\n\t\n\tfunction trigger(name, thisObj) {\n\t\treturn calendar.trigger.apply(\n\t\t\tcalendar,\n\t\t\t[name, thisObj || t].concat(Array.prototype.slice.call(arguments, 2), [t])\n\t\t);\n\t}\n\t\n\n\n\t/* Event Editable Boolean Calculations\n\t------------------------------------------------------------------------------*/\n\n\t\n\tfunction isEventDraggable(event) {\n\t\tvar source = event.source || {};\n\t\treturn firstDefined(\n\t\t\t\tevent.startEditable,\n\t\t\t\tsource.startEditable,\n\t\t\t\topt('eventStartEditable'),\n\t\t\t\tevent.editable,\n\t\t\t\tsource.editable,\n\t\t\t\topt('editable')\n\t\t\t)\n\t\t\t&& !opt('disableDragging'); // deprecated\n\t}\n\t\n\t\n\tfunction isEventResizable(event) { // but also need to make sure the seg.isEnd == true\n\t\tvar source = event.source || {};\n\t\treturn firstDefined(\n\t\t\t\tevent.durationEditable,\n\t\t\t\tsource.durationEditable,\n\t\t\t\topt('eventDurationEditable'),\n\t\t\t\tevent.editable,\n\t\t\t\tsource.editable,\n\t\t\t\topt('editable')\n\t\t\t)\n\t\t\t&& !opt('disableResizing'); // deprecated\n\t}\n\t\n\t\n\t\n\t/* Event Data\n\t------------------------------------------------------------------------------*/\n\t\n\t\n\tfunction setEventData(events) { // events are already normalized at this point\n\t\teventsByID = {};\n\t\tvar i, len=events.length, event;\n\t\tfor (i=0; i<len; i++) {\n\t\t\tevent = events[i];\n\t\t\tif (eventsByID[event._id]) {\n\t\t\t\teventsByID[event._id].push(event);\n\t\t\t}else{\n\t\t\t\teventsByID[event._id] = [event];\n\t\t\t}\n\t\t}\n\t}\n\n\n\tfunction clearEventData() {\n\t\teventsByID = {};\n\t\teventElementsByID = {};\n\t\teventElementCouples = [];\n\t}\n\t\n\t\n\t// returns a Date object for an event's end\n\tfunction eventEnd(event) {\n\t\treturn event.end ? cloneDate(event.end) : defaultEventEnd(event);\n\t}\n\t\n\t\n\t\n\t/* Event Elements\n\t------------------------------------------------------------------------------*/\n\t\n\t\n\t// report when view creates an element for an event\n\tfunction reportEventElement(event, element) {\n\t\teventElementCouples.push({ event: event, element: element });\n\t\tif (eventElementsByID[event._id]) {\n\t\t\teventElementsByID[event._id].push(element);\n\t\t}else{\n\t\t\teventElementsByID[event._id] = [element];\n\t\t}\n\t}\n\n\n\tfunction triggerEventDestroy() {\n\t\t$.each(eventElementCouples, function(i, couple) {\n\t\t\tt.trigger('eventDestroy', couple.event, couple.event, couple.element);\n\t\t});\n\t}\n\t\n\t\n\t// attaches eventClick, eventMouseover, eventMouseout\n\tfunction eventElementHandlers(event, eventElement) {\n\t\teventElement\n\t\t\t.click(function(ev) {\n\t\t\t\tif (!eventElement.hasClass('ui-draggable-dragging') &&\n\t\t\t\t\t!eventElement.hasClass('ui-resizable-resizing')) {\n\t\t\t\t\t\treturn trigger('eventClick', this, event, ev);\n\t\t\t\t\t}\n\t\t\t})\n\t\t\t.hover(\n\t\t\t\tfunction(ev) {\n\t\t\t\t\ttrigger('eventMouseover', this, event, ev);\n\t\t\t\t},\n\t\t\t\tfunction(ev) {\n\t\t\t\t\ttrigger('eventMouseout', this, event, ev);\n\t\t\t\t}\n\t\t\t);\n\t\t// TODO: don't fire eventMouseover/eventMouseout *while* dragging is occuring (on subject element)\n\t\t// TODO: same for resizing\n\t}\n\t\n\t\n\tfunction showEvents(event, exceptElement) {\n\t\teachEventElement(event, exceptElement, 'show');\n\t}\n\t\n\t\n\tfunction hideEvents(event, exceptElement) {\n\t\teachEventElement(event, exceptElement, 'hide');\n\t}\n\t\n\t\n\tfunction eachEventElement(event, exceptElement, funcName) {\n\t\t// NOTE: there may be multiple events per ID (repeating events)\n\t\t// and multiple segments per event\n\t\tvar elements = eventElementsByID[event._id],\n\t\t\ti, len = elements.length;\n\t\tfor (i=0; i<len; i++) {\n\t\t\tif (!exceptElement || elements[i][0] != exceptElement[0]) {\n\t\t\t\telements[i][funcName]();\n\t\t\t}\n\t\t}\n\t}\n\t\n\t\n\t\n\t/* Event Modification Reporting\n\t---------------------------------------------------------------------------------*/\n\t\n\t\n\tfunction eventDrop(e, event, dayDelta, minuteDelta, allDay, ev, ui) {\n\t\tvar oldAllDay = event.allDay;\n\t\tvar eventId = event._id;\n\t\tmoveEvents(eventsByID[eventId], dayDelta, minuteDelta, allDay);\n\t\ttrigger(\n\t\t\t'eventDrop',\n\t\t\te,\n\t\t\tevent,\n\t\t\tdayDelta,\n\t\t\tminuteDelta,\n\t\t\tallDay,\n\t\t\tfunction() {\n\t\t\t\t// TODO: investigate cases where this inverse technique might not work\n\t\t\t\tmoveEvents(eventsByID[eventId], -dayDelta, -minuteDelta, oldAllDay);\n\t\t\t\treportEventChange(eventId);\n\t\t\t},\n\t\t\tev,\n\t\t\tui\n\t\t);\n\t\treportEventChange(eventId);\n\t}\n\t\n\t\n\tfunction eventResize(e, event, dayDelta, minuteDelta, ev, ui) {\n\t\tvar eventId = event._id;\n\t\telongateEvents(eventsByID[eventId], dayDelta, minuteDelta);\n\t\ttrigger(\n\t\t\t'eventResize',\n\t\t\te,\n\t\t\tevent,\n\t\t\tdayDelta,\n\t\t\tminuteDelta,\n\t\t\tfunction() {\n\t\t\t\t// TODO: investigate cases where this inverse technique might not work\n\t\t\t\telongateEvents(eventsByID[eventId], -dayDelta, -minuteDelta);\n\t\t\t\treportEventChange(eventId);\n\t\t\t},\n\t\t\tev,\n\t\t\tui\n\t\t);\n\t\treportEventChange(eventId);\n\t}\n\t\n\t\n\t\n\t/* Event Modification Math\n\t---------------------------------------------------------------------------------*/\n\t\n\t\n\tfunction moveEvents(events, dayDelta, minuteDelta, allDay) {\n\t\tminuteDelta = minuteDelta || 0;\n\t\tfor (var e, len=events.length, i=0; i<len; i++) {\n\t\t\te = events[i];\n\t\t\tif (allDay !== undefined) {\n\t\t\t\te.allDay = allDay;\n\t\t\t}\n\t\t\taddMinutes(addDays(e.start, dayDelta, true), minuteDelta);\n\t\t\tif (e.end) {\n\t\t\t\te.end = addMinutes(addDays(e.end, dayDelta, true), minuteDelta);\n\t\t\t}\n\t\t\tnormalizeEvent(e, options);\n\t\t}\n\t}\n\t\n\t\n\tfunction elongateEvents(events, dayDelta, minuteDelta) {\n\t\tminuteDelta = minuteDelta || 0;\n\t\tfor (var e, len=events.length, i=0; i<len; i++) {\n\t\t\te = events[i];\n\t\t\te.end = addMinutes(addDays(eventEnd(e), dayDelta, true), minuteDelta);\n\t\t\tnormalizeEvent(e, options);\n\t\t}\n\t}\n\n\n\n\t// ====================================================================================================\n\t// Utilities for day \"cells\"\n\t// ====================================================================================================\n\t// The \"basic\" views are completely made up of day cells.\n\t// The \"agenda\" views have day cells at the top \"all day\" slot.\n\t// This was the obvious common place to put these utilities, but they should be abstracted out into\n\t// a more meaningful class (like DayEventRenderer).\n\t// ====================================================================================================\n\n\n\t// For determining how a given \"cell\" translates into a \"date\":\n\t//\n\t// 1. Convert the \"cell\" (row and column) into a \"cell offset\" (the # of the cell, cronologically from the first).\n\t//    Keep in mind that column indices are inverted with isRTL. This is taken into account.\n\t//\n\t// 2. Convert the \"cell offset\" to a \"day offset\" (the # of days since the first visible day in the view).\n\t//\n\t// 3. Convert the \"day offset\" into a \"date\" (a JavaScript Date object).\n\t//\n\t// The reverse transformation happens when transforming a date into a cell.\n\n\n\t// exports\n\tt.isHiddenDay = isHiddenDay;\n\tt.skipHiddenDays = skipHiddenDays;\n\tt.getCellsPerWeek = getCellsPerWeek;\n\tt.dateToCell = dateToCell;\n\tt.dateToDayOffset = dateToDayOffset;\n\tt.dayOffsetToCellOffset = dayOffsetToCellOffset;\n\tt.cellOffsetToCell = cellOffsetToCell;\n\tt.cellToDate = cellToDate;\n\tt.cellToCellOffset = cellToCellOffset;\n\tt.cellOffsetToDayOffset = cellOffsetToDayOffset;\n\tt.dayOffsetToDate = dayOffsetToDate;\n\tt.rangeToSegments = rangeToSegments;\n\n\n\t// internals\n\tvar hiddenDays = opt('hiddenDays') || []; // array of day-of-week indices that are hidden\n\tvar isHiddenDayHash = []; // is the day-of-week hidden? (hash with day-of-week-index -> bool)\n\tvar cellsPerWeek;\n\tvar dayToCellMap = []; // hash from dayIndex -> cellIndex, for one week\n\tvar cellToDayMap = []; // hash from cellIndex -> dayIndex, for one week\n\tvar isRTL = opt('isRTL');\n\n\n\t// initialize important internal variables\n\t(function() {\n\n\t\tif (opt('weekends') === false) {\n\t\t\thiddenDays.push(0, 6); // 0=sunday, 6=saturday\n\t\t}\n\n\t\t// Loop through a hypothetical week and determine which\n\t\t// days-of-week are hidden. Record in both hashes (one is the reverse of the other).\n\t\tfor (var dayIndex=0, cellIndex=0; dayIndex<7; dayIndex++) {\n\t\t\tdayToCellMap[dayIndex] = cellIndex;\n\t\t\tisHiddenDayHash[dayIndex] = $.inArray(dayIndex, hiddenDays) != -1;\n\t\t\tif (!isHiddenDayHash[dayIndex]) {\n\t\t\t\tcellToDayMap[cellIndex] = dayIndex;\n\t\t\t\tcellIndex++;\n\t\t\t}\n\t\t}\n\n\t\tcellsPerWeek = cellIndex;\n\t\tif (!cellsPerWeek) {\n\t\t\tthrow 'invalid hiddenDays'; // all days were hidden? bad.\n\t\t}\n\n\t})();\n\n\n\t// Is the current day hidden?\n\t// `day` is a day-of-week index (0-6), or a Date object\n\tfunction isHiddenDay(day) {\n\t\tif (typeof day == 'object') {\n\t\t\tday = day.getDay();\n\t\t}\n\t\treturn isHiddenDayHash[day];\n\t}\n\n\n\tfunction getCellsPerWeek() {\n\t\treturn cellsPerWeek;\n\t}\n\n\n\t// Keep incrementing the current day until it is no longer a hidden day.\n\t// If the initial value of `date` is not a hidden day, don't do anything.\n\t// Pass `isExclusive` as `true` if you are dealing with an end date.\n\t// `inc` defaults to `1` (increment one day forward each time)\n\tfunction skipHiddenDays(date, inc, isExclusive) {\n\t\tinc = inc || 1;\n\t\twhile (\n\t\t\tisHiddenDayHash[ ( date.getDay() + (isExclusive ? inc : 0) + 7 ) % 7 ]\n\t\t) {\n\t\t\taddDays(date, inc);\n\t\t}\n\t}\n\n\n\t//\n\t// TRANSFORMATIONS: cell -> cell offset -> day offset -> date\n\t//\n\n\t// cell -> date (combines all transformations)\n\t// Possible arguments:\n\t// - row, col\n\t// - { row:#, col: # }\n\tfunction cellToDate() {\n\t\tvar cellOffset = cellToCellOffset.apply(null, arguments);\n\t\tvar dayOffset = cellOffsetToDayOffset(cellOffset);\n\t\tvar date = dayOffsetToDate(dayOffset);\n\t\treturn date;\n\t}\n\n\t// cell -> cell offset\n\t// Possible arguments:\n\t// - row, col\n\t// - { row:#, col:# }\n\tfunction cellToCellOffset(row, col) {\n\t\tvar colCnt = t.getColCnt();\n\n\t\t// rtl variables. wish we could pre-populate these. but where?\n\t\tvar dis = isRTL ? -1 : 1;\n\t\tvar dit = isRTL ? colCnt - 1 : 0;\n\n\t\tif (typeof row == 'object') {\n\t\t\tcol = row.col;\n\t\t\trow = row.row;\n\t\t}\n\t\tvar cellOffset = row * colCnt + (col * dis + dit); // column, adjusted for RTL (dis & dit)\n\n\t\treturn cellOffset;\n\t}\n\n\t// cell offset -> day offset\n\tfunction cellOffsetToDayOffset(cellOffset) {\n\t\tvar day0 = t.visStart.getDay(); // first date's day of week\n\t\tcellOffset += dayToCellMap[day0]; // normlize cellOffset to beginning-of-week\n\t\treturn Math.floor(cellOffset / cellsPerWeek) * 7 // # of days from full weeks\n\t\t\t+ cellToDayMap[ // # of days from partial last week\n\t\t\t\t(cellOffset % cellsPerWeek + cellsPerWeek) % cellsPerWeek // crazy math to handle negative cellOffsets\n\t\t\t]\n\t\t\t- day0; // adjustment for beginning-of-week normalization\n\t}\n\n\t// day offset -> date (JavaScript Date object)\n\tfunction dayOffsetToDate(dayOffset) {\n\t\tvar date = cloneDate(t.visStart);\n\t\taddDays(date, dayOffset);\n\t\treturn date;\n\t}\n\n\n\t//\n\t// TRANSFORMATIONS: date -> day offset -> cell offset -> cell\n\t//\n\n\t// date -> cell (combines all transformations)\n\tfunction dateToCell(date) {\n\t\tvar dayOffset = dateToDayOffset(date);\n\t\tvar cellOffset = dayOffsetToCellOffset(dayOffset);\n\t\tvar cell = cellOffsetToCell(cellOffset);\n\t\treturn cell;\n\t}\n\n\t// date -> day offset\n\tfunction dateToDayOffset(date) {\n\t\treturn dayDiff(date, t.visStart);\n\t}\n\n\t// day offset -> cell offset\n\tfunction dayOffsetToCellOffset(dayOffset) {\n\t\tvar day0 = t.visStart.getDay(); // first date's day of week\n\t\tdayOffset += day0; // normalize dayOffset to beginning-of-week\n\t\treturn Math.floor(dayOffset / 7) * cellsPerWeek // # of cells from full weeks\n\t\t\t+ dayToCellMap[ // # of cells from partial last week\n\t\t\t\t(dayOffset % 7 + 7) % 7 // crazy math to handle negative dayOffsets\n\t\t\t]\n\t\t\t- dayToCellMap[day0]; // adjustment for beginning-of-week normalization\n\t}\n\n\t// cell offset -> cell (object with row & col keys)\n\tfunction cellOffsetToCell(cellOffset) {\n\t\tvar colCnt = t.getColCnt();\n\n\t\t// rtl variables. wish we could pre-populate these. but where?\n\t\tvar dis = isRTL ? -1 : 1;\n\t\tvar dit = isRTL ? colCnt - 1 : 0;\n\n\t\tvar row = Math.floor(cellOffset / colCnt);\n\t\tvar col = ((cellOffset % colCnt + colCnt) % colCnt) * dis + dit; // column, adjusted for RTL (dis & dit)\n\t\treturn {\n\t\t\trow: row,\n\t\t\tcol: col\n\t\t};\n\t}\n\n\n\t//\n\t// Converts a date range into an array of segment objects.\n\t// \"Segments\" are horizontal stretches of time, sliced up by row.\n\t// A segment object has the following properties:\n\t// - row\n\t// - cols\n\t// - isStart\n\t// - isEnd\n\t//\n\tfunction rangeToSegments(startDate, endDate) {\n\t\tvar rowCnt = t.getRowCnt();\n\t\tvar colCnt = t.getColCnt();\n\t\tvar segments = []; // array of segments to return\n\n\t\t// day offset for given date range\n\t\tvar rangeDayOffsetStart = dateToDayOffset(startDate);\n\t\tvar rangeDayOffsetEnd = dateToDayOffset(endDate); // exclusive\n\n\t\t// first and last cell offset for the given date range\n\t\t// \"last\" implies inclusivity\n\t\tvar rangeCellOffsetFirst = dayOffsetToCellOffset(rangeDayOffsetStart);\n\t\tvar rangeCellOffsetLast = dayOffsetToCellOffset(rangeDayOffsetEnd) - 1;\n\n\t\t// loop through all the rows in the view\n\t\tfor (var row=0; row<rowCnt; row++) {\n\n\t\t\t// first and last cell offset for the row\n\t\t\tvar rowCellOffsetFirst = row * colCnt;\n\t\t\tvar rowCellOffsetLast = rowCellOffsetFirst + colCnt - 1;\n\n\t\t\t// get the segment's cell offsets by constraining the range's cell offsets to the bounds of the row\n\t\t\tvar segmentCellOffsetFirst = Math.max(rangeCellOffsetFirst, rowCellOffsetFirst);\n\t\t\tvar segmentCellOffsetLast = Math.min(rangeCellOffsetLast, rowCellOffsetLast);\n\n\t\t\t// make sure segment's offsets are valid and in view\n\t\t\tif (segmentCellOffsetFirst <= segmentCellOffsetLast) {\n\n\t\t\t\t// translate to cells\n\t\t\t\tvar segmentCellFirst = cellOffsetToCell(segmentCellOffsetFirst);\n\t\t\t\tvar segmentCellLast = cellOffsetToCell(segmentCellOffsetLast);\n\n\t\t\t\t// view might be RTL, so order by leftmost column\n\t\t\t\tvar cols = [ segmentCellFirst.col, segmentCellLast.col ].sort();\n\n\t\t\t\t// Determine if segment's first/last cell is the beginning/end of the date range.\n\t\t\t\t// We need to compare \"day offset\" because \"cell offsets\" are often ambiguous and\n\t\t\t\t// can translate to multiple days, and an edge case reveals itself when we the\n\t\t\t\t// range's first cell is hidden (we don't want isStart to be true).\n\t\t\t\tvar isStart = cellOffsetToDayOffset(segmentCellOffsetFirst) == rangeDayOffsetStart;\n\t\t\t\tvar isEnd = cellOffsetToDayOffset(segmentCellOffsetLast) + 1 == rangeDayOffsetEnd; // +1 for comparing exclusively\n\n\t\t\t\tsegments.push({\n\t\t\t\t\trow: row,\n\t\t\t\t\tleftCol: cols[0],\n\t\t\t\t\trightCol: cols[1],\n\t\t\t\t\tisStart: isStart,\n\t\t\t\t\tisEnd: isEnd\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\treturn segments;\n\t}\n\t\n\n}\n\n;;\n\nfunction DayEventRenderer() {\n\tvar t = this;\n\n\t\n\t// exports\n\tt.renderDayEvents = renderDayEvents;\n\tt.draggableDayEvent = draggableDayEvent; // made public so that subclasses can override\n\tt.resizableDayEvent = resizableDayEvent; // \"\n\t\n\t\n\t// imports\n\tvar opt = t.opt;\n\tvar trigger = t.trigger;\n\tvar isEventDraggable = t.isEventDraggable;\n\tvar isEventResizable = t.isEventResizable;\n\tvar eventEnd = t.eventEnd;\n\tvar reportEventElement = t.reportEventElement;\n\tvar eventElementHandlers = t.eventElementHandlers;\n\tvar showEvents = t.showEvents;\n\tvar hideEvents = t.hideEvents;\n\tvar eventDrop = t.eventDrop;\n\tvar eventResize = t.eventResize;\n\tvar getRowCnt = t.getRowCnt;\n\tvar getColCnt = t.getColCnt;\n\tvar getColWidth = t.getColWidth;\n\tvar allDayRow = t.allDayRow; // TODO: rename\n\tvar colLeft = t.colLeft;\n\tvar colRight = t.colRight;\n\tvar colContentLeft = t.colContentLeft;\n\tvar colContentRight = t.colContentRight;\n\tvar dateToCell = t.dateToCell;\n\tvar getDaySegmentContainer = t.getDaySegmentContainer;\n\tvar formatDates = t.calendar.formatDates;\n\tvar renderDayOverlay = t.renderDayOverlay;\n\tvar clearOverlays = t.clearOverlays;\n\tvar clearSelection = t.clearSelection;\n\tvar getHoverListener = t.getHoverListener;\n\tvar rangeToSegments = t.rangeToSegments;\n\tvar cellToDate = t.cellToDate;\n\tvar cellToCellOffset = t.cellToCellOffset;\n\tvar cellOffsetToDayOffset = t.cellOffsetToDayOffset;\n\tvar dateToDayOffset = t.dateToDayOffset;\n\tvar dayOffsetToCellOffset = t.dayOffsetToCellOffset;\n\n\n\t// Render `events` onto the calendar, attach mouse event handlers, and call the `eventAfterRender` callback for each.\n\t// Mouse event will be lazily applied, except if the event has an ID of `modifiedEventId`.\n\t// Can only be called when the event container is empty (because it wipes out all innerHTML).\n\tfunction renderDayEvents(events, modifiedEventId) {\n\n\t\t// do the actual rendering. Receive the intermediate \"segment\" data structures.\n\t\tvar segments = _renderDayEvents(\n\t\t\tevents,\n\t\t\tfalse, // don't append event elements\n\t\t\ttrue // set the heights of the rows\n\t\t);\n\n\t\t// report the elements to the View, for general drag/resize utilities\n\t\tsegmentElementEach(segments, function(segment, element) {\n\t\t\treportEventElement(segment.event, element);\n\t\t});\n\n\t\t// attach mouse handlers\n\t\tattachHandlers(segments, modifiedEventId);\n\n\t\t// call `eventAfterRender` callback for each event\n\t\tsegmentElementEach(segments, function(segment, element) {\n\t\t\ttrigger('eventAfterRender', segment.event, segment.event, element);\n\t\t});\n\t}\n\n\n\t// Render an event on the calendar, but don't report them anywhere, and don't attach mouse handlers.\n\t// Append this event element to the event container, which might already be populated with events.\n\t// If an event's segment will have row equal to `adjustRow`, then explicitly set its top coordinate to `adjustTop`.\n\t// This hack is used to maintain continuity when user is manually resizing an event.\n\t// Returns an array of DOM elements for the event.\n\tfunction renderTempDayEvent(event, adjustRow, adjustTop) {\n\n\t\t// actually render the event. `true` for appending element to container.\n\t\t// Recieve the intermediate \"segment\" data structures.\n\t\tvar segments = _renderDayEvents(\n\t\t\t[ event ],\n\t\t\ttrue, // append event elements\n\t\t\tfalse // don't set the heights of the rows\n\t\t);\n\n\t\tvar elements = [];\n\n\t\t// Adjust certain elements' top coordinates\n\t\tsegmentElementEach(segments, function(segment, element) {\n\t\t\tif (segment.row === adjustRow) {\n\t\t\t\telement.css('top', adjustTop);\n\t\t\t}\n\t\t\telements.push(element[0]); // accumulate DOM nodes\n\t\t});\n\n\t\treturn elements;\n\t}\n\n\n\t// Render events onto the calendar. Only responsible for the VISUAL aspect.\n\t// Not responsible for attaching handlers or calling callbacks.\n\t// Set `doAppend` to `true` for rendering elements without clearing the existing container.\n\t// Set `doRowHeights` to allow setting the height of each row, to compensate for vertical event overflow.\n\tfunction _renderDayEvents(events, doAppend, doRowHeights) {\n\n\t\t// where the DOM nodes will eventually end up\n\t\tvar finalContainer = getDaySegmentContainer();\n\n\t\t// the container where the initial HTML will be rendered.\n\t\t// If `doAppend`==true, uses a temporary container.\n\t\tvar renderContainer = doAppend ? $(\"<div/>\") : finalContainer;\n\n\t\tvar segments = buildSegments(events);\n\t\tvar html;\n\t\tvar elements;\n\n\t\t// calculate the desired `left` and `width` properties on each segment object\n\t\tcalculateHorizontals(segments);\n\n\t\t// build the HTML string. relies on `left` property\n\t\thtml = buildHTML(segments);\n\n\t\t// render the HTML. innerHTML is considerably faster than jQuery's .html()\n\t\trenderContainer[0].innerHTML = html;\n\n\t\t// retrieve the individual elements\n\t\telements = renderContainer.children();\n\n\t\t// if we were appending, and thus using a temporary container,\n\t\t// re-attach elements to the real container.\n\t\tif (doAppend) {\n\t\t\tfinalContainer.append(elements);\n\t\t}\n\n\t\t// assigns each element to `segment.event`, after filtering them through user callbacks\n\t\tresolveElements(segments, elements);\n\n\t\t// Calculate the left and right padding+margin for each element.\n\t\t// We need this for setting each element's desired outer width, because of the W3C box model.\n\t\t// It's important we do this in a separate pass from acually setting the width on the DOM elements\n\t\t// because alternating reading/writing dimensions causes reflow for every iteration.\n\t\tsegmentElementEach(segments, function(segment, element) {\n\t\t\tsegment.hsides = hsides(element, true); // include margins = `true`\n\t\t});\n\n\t\t// Set the width of each element\n\t\tsegmentElementEach(segments, function(segment, element) {\n\t\t\telement.width(\n\t\t\t\tMath.max(0, segment.outerWidth - segment.hsides)\n\t\t\t);\n\t\t});\n\n\t\t// Grab each element's outerHeight (setVerticals uses this).\n\t\t// To get an accurate reading, it's important to have each element's width explicitly set already.\n\t\tsegmentElementEach(segments, function(segment, element) {\n\t\t\tsegment.outerHeight = element.outerHeight(true); // include margins = `true`\n\t\t});\n\n\t\t// Set the top coordinate on each element (requires segment.outerHeight)\n\t\tsetVerticals(segments, doRowHeights);\n\n\t\treturn segments;\n\t}\n\n\n\t// Generate an array of \"segments\" for all events.\n\tfunction buildSegments(events) {\n\t\tvar segments = [];\n\t\tfor (var i=0; i<events.length; i++) {\n\t\t\tvar eventSegments = buildSegmentsForEvent(events[i]);\n\t\t\tsegments.push.apply(segments, eventSegments); // append an array to an array\n\t\t}\n\t\treturn segments;\n\t}\n\n\n\t// Generate an array of segments for a single event.\n\t// A \"segment\" is the same data structure that View.rangeToSegments produces,\n\t// with the addition of the `event` property being set to reference the original event.\n\tfunction buildSegmentsForEvent(event) {\n\t\tvar startDate = event.start;\n\t\tvar endDate = exclEndDay(event);\n\t\tvar segments = rangeToSegments(startDate, endDate);\n\t\tfor (var i=0; i<segments.length; i++) {\n\t\t\tsegments[i].event = event;\n\t\t}\n\t\treturn segments;\n\t}\n\n\n\t// Sets the `left` and `outerWidth` property of each segment.\n\t// These values are the desired dimensions for the eventual DOM elements.\n\tfunction calculateHorizontals(segments) {\n\t\tvar isRTL = opt('isRTL');\n\t\tfor (var i=0; i<segments.length; i++) {\n\t\t\tvar segment = segments[i];\n\n\t\t\t// Determine functions used for calulating the elements left/right coordinates,\n\t\t\t// depending on whether the view is RTL or not.\n\t\t\t// NOTE:\n\t\t\t// colLeft/colRight returns the coordinate butting up the edge of the cell.\n\t\t\t// colContentLeft/colContentRight is indented a little bit from the edge.\n\t\t\tvar leftFunc = (isRTL ? segment.isEnd : segment.isStart) ? colContentLeft : colLeft;\n\t\t\tvar rightFunc = (isRTL ? segment.isStart : segment.isEnd) ? colContentRight : colRight;\n\n\t\t\tvar left = leftFunc(segment.leftCol);\n\t\t\tvar right = rightFunc(segment.rightCol);\n\t\t\tsegment.left = left;\n\t\t\tsegment.outerWidth = right - left;\n\t\t}\n\t}\n\n\n\t// Build a concatenated HTML string for an array of segments\n\tfunction buildHTML(segments) {\n\t\tvar html = '';\n\t\tfor (var i=0; i<segments.length; i++) {\n\t\t\thtml += buildHTMLForSegment(segments[i]);\n\t\t}\n\t\treturn html;\n\t}\n\n\n\t// Build an HTML string for a single segment.\n\t// Relies on the following properties:\n\t// - `segment.event` (from `buildSegmentsForEvent`)\n\t// - `segment.left` (from `calculateHorizontals`)\n\tfunction buildHTMLForSegment(segment) {\n\t\tvar html = '';\n\t\tvar isRTL = opt('isRTL');\n\t\tvar event = segment.event;\n\t\tvar url = event.url;\n\n\t\t// generate the list of CSS classNames\n\t\tvar classNames = [ 'fc-event', 'fc-event-hori' ];\n\t\tif (isEventDraggable(event)) {\n\t\t\tclassNames.push('fc-event-draggable');\n\t\t}\n\t\tif (segment.isStart) {\n\t\t\tclassNames.push('fc-event-start');\n\t\t}\n\t\tif (segment.isEnd) {\n\t\t\tclassNames.push('fc-event-end');\n\t\t}\n\t\t// use the event's configured classNames\n\t\t// guaranteed to be an array via `normalizeEvent`\n\t\tclassNames = classNames.concat(event.className);\n\t\tif (event.source) {\n\t\t\t// use the event's source's classNames, if specified\n\t\t\tclassNames = classNames.concat(event.source.className || []);\n\t\t}\n\n\t\t// generate a semicolon delimited CSS string for any of the \"skin\" properties\n\t\t// of the event object (`backgroundColor`, `borderColor` and such)\n\t\tvar skinCss = getSkinCss(event, opt);\n\n\t\tif (url) {\n\t\t\thtml += \"<a href='\" + htmlEscape(url) + \"'\";\n\t\t}else{\n\t\t\thtml += \"<div\";\n\t\t}\n\t\thtml +=\n\t\t\t\" class='\" + classNames.join(' ') + \"'\" +\n\t\t\t\" style=\" +\n\t\t\t\t\"'\" +\n\t\t\t\t\"position:absolute;\" +\n\t\t\t\t\"left:\" + segment.left + \"px;\" +\n\t\t\t\tskinCss +\n\t\t\t\t\"'\" +\n\t\t\t\">\" +\n\t\t\t\"<div class='fc-event-inner'>\";\n\t\tif (!event.allDay && segment.isStart) {\n\t\t\thtml +=\n\t\t\t\t\"<span class='fc-event-time'>\" +\n\t\t\t\thtmlEscape(\n\t\t\t\t\tformatDates(event.start, event.end, opt('timeFormat'))\n\t\t\t\t) +\n\t\t\t\t\"</span>\";\n\t\t}\n\t\thtml +=\n\t\t\t\"<span class='fc-event-title'>\" +\n\t\t\thtmlEscape(event.title || '') +\n\t\t\t\"</span>\" +\n\t\t\t\"</div>\";\n\t\tif (segment.isEnd && isEventResizable(event)) {\n\t\t\thtml +=\n\t\t\t\t\"<div class='ui-resizable-handle ui-resizable-\" + (isRTL ? 'w' : 'e') + \"'>\" +\n\t\t\t\t\"   \" + // makes hit area a lot better for IE6/7\n\t\t\t\t\"</div>\";\n\t\t}\n\t\thtml += \"</\" + (url ? \"a\" : \"div\") + \">\";\n\n\t\t// TODO:\n\t\t// When these elements are initially rendered, they will be briefly visibile on the screen,\n\t\t// even though their widths/heights are not set.\n\t\t// SOLUTION: initially set them as visibility:hidden ?\n\n\t\treturn html;\n\t}\n\n\n\t// Associate each segment (an object) with an element (a jQuery object),\n\t// by setting each `segment.element`.\n\t// Run each element through the `eventRender` filter, which allows developers to\n\t// modify an existing element, supply a new one, or cancel rendering.\n\tfunction resolveElements(segments, elements) {\n\t\tfor (var i=0; i<segments.length; i++) {\n\t\t\tvar segment = segments[i];\n\t\t\tvar event = segment.event;\n\t\t\tvar element = elements.eq(i);\n\n\t\t\t// call the trigger with the original element\n\t\t\tvar triggerRes = trigger('eventRender', event, event, element);\n\n\t\t\tif (triggerRes === false) {\n\t\t\t\t// if `false`, remove the event from the DOM and don't assign it to `segment.event`\n\t\t\t\telement.remove();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (triggerRes && triggerRes !== true) {\n\t\t\t\t\t// the trigger returned a new element, but not `true` (which means keep the existing element)\n\n\t\t\t\t\t// re-assign the important CSS dimension properties that were already assigned in `buildHTMLForSegment`\n\t\t\t\t\ttriggerRes = $(triggerRes)\n\t\t\t\t\t\t.css({\n\t\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\t\tleft: segment.left\n\t\t\t\t\t\t});\n\n\t\t\t\t\telement.replaceWith(triggerRes);\n\t\t\t\t\telement = triggerRes;\n\t\t\t\t}\n\n\t\t\t\tsegment.element = element;\n\t\t\t}\n\t\t}\n\t}\n\n\n\n\t/* Top-coordinate Methods\n\t-------------------------------------------------------------------------------------------------*/\n\n\n\t// Sets the \"top\" CSS property for each element.\n\t// If `doRowHeights` is `true`, also sets each row's first cell to an explicit height,\n\t// so that if elements vertically overflow, the cell expands vertically to compensate.\n\tfunction setVerticals(segments, doRowHeights) {\n\t\tvar rowContentHeights = calculateVerticals(segments); // also sets segment.top\n\t\tvar rowContentElements = getRowContentElements(); // returns 1 inner div per row\n\t\tvar rowContentTops = [];\n\n\t\t// Set each row's height by setting height of first inner div\n\t\tif (doRowHeights) {\n\t\t\tfor (var i=0; i<rowContentElements.length; i++) {\n\t\t\t\trowContentElements[i].height(rowContentHeights[i]);\n\t\t\t}\n\t\t}\n\n\t\t// Get each row's top, relative to the views's origin.\n\t\t// Important to do this after setting each row's height.\n\t\tfor (var i=0; i<rowContentElements.length; i++) {\n\t\t\trowContentTops.push(\n\t\t\t\trowContentElements[i].position().top\n\t\t\t);\n\t\t}\n\n\t\t// Set each segment element's CSS \"top\" property.\n\t\t// Each segment object has a \"top\" property, which is relative to the row's top, but...\n\t\tsegmentElementEach(segments, function(segment, element) {\n\t\t\telement.css(\n\t\t\t\t'top',\n\t\t\t\trowContentTops[segment.row] + segment.top // ...now, relative to views's origin\n\t\t\t);\n\t\t});\n\t}\n\n\n\t// Calculate the \"top\" coordinate for each segment, relative to the \"top\" of the row.\n\t// Also, return an array that contains the \"content\" height for each row\n\t// (the height displaced by the vertically stacked events in the row).\n\t// Requires segments to have their `outerHeight` property already set.\n\tfunction calculateVerticals(segments) {\n\t\tvar rowCnt = getRowCnt();\n\t\tvar colCnt = getColCnt();\n\t\tvar rowContentHeights = []; // content height for each row\n\t\tvar segmentRows = buildSegmentRows(segments); // an array of segment arrays, one for each row\n\n\t\tfor (var rowI=0; rowI<rowCnt; rowI++) {\n\t\t\tvar segmentRow = segmentRows[rowI];\n\n\t\t\t// an array of running total heights for each column.\n\t\t\t// initialize with all zeros.\n\t\t\tvar colHeights = [];\n\t\t\tfor (var colI=0; colI<colCnt; colI++) {\n\t\t\t\tcolHeights.push(0);\n\t\t\t}\n\n\t\t\t// loop through every segment\n\t\t\tfor (var segmentI=0; segmentI<segmentRow.length; segmentI++) {\n\t\t\t\tvar segment = segmentRow[segmentI];\n\n\t\t\t\t// find the segment's top coordinate by looking at the max height\n\t\t\t\t// of all the columns the segment will be in.\n\t\t\t\tsegment.top = arrayMax(\n\t\t\t\t\tcolHeights.slice(\n\t\t\t\t\t\tsegment.leftCol,\n\t\t\t\t\t\tsegment.rightCol + 1 // make exclusive for slice\n\t\t\t\t\t)\n\t\t\t\t);\n\n\t\t\t\t// adjust the columns to account for the segment's height\n\t\t\t\tfor (var colI=segment.leftCol; colI<=segment.rightCol; colI++) {\n\t\t\t\t\tcolHeights[colI] = segment.top + segment.outerHeight;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// the tallest column in the row should be the \"content height\"\n\t\t\trowContentHeights.push(arrayMax(colHeights));\n\t\t}\n\n\t\treturn rowContentHeights;\n\t}\n\n\n\t// Build an array of segment arrays, each representing the segments that will\n\t// be in a row of the grid, sorted by which event should be closest to the top.\n\tfunction buildSegmentRows(segments) {\n\t\tvar rowCnt = getRowCnt();\n\t\tvar segmentRows = [];\n\t\tvar segmentI;\n\t\tvar segment;\n\t\tvar rowI;\n\n\t\t// group segments by row\n\t\tfor (segmentI=0; segmentI<segments.length; segmentI++) {\n\t\t\tsegment = segments[segmentI];\n\t\t\trowI = segment.row;\n\t\t\tif (segment.element) { // was rendered?\n\t\t\t\tif (segmentRows[rowI]) {\n\t\t\t\t\t// already other segments. append to array\n\t\t\t\t\tsegmentRows[rowI].push(segment);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// first segment in row. create new array\n\t\t\t\t\tsegmentRows[rowI] = [ segment ];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// sort each row\n\t\tfor (rowI=0; rowI<rowCnt; rowI++) {\n\t\t\tsegmentRows[rowI] = sortSegmentRow(\n\t\t\t\tsegmentRows[rowI] || [] // guarantee an array, even if no segments\n\t\t\t);\n\t\t}\n\n\t\treturn segmentRows;\n\t}\n\n\n\t// Sort an array of segments according to which segment should appear closest to the top\n\tfunction sortSegmentRow(segments) {\n\t\tvar sortedSegments = [];\n\n\t\t// build the subrow array\n\t\tvar subrows = buildSegmentSubrows(segments);\n\n\t\t// flatten it\n\t\tfor (var i=0; i<subrows.length; i++) {\n\t\t\tsortedSegments.push.apply(sortedSegments, subrows[i]); // append an array to an array\n\t\t}\n\n\t\treturn sortedSegments;\n\t}\n\n\n\t// Take an array of segments, which are all assumed to be in the same row,\n\t// and sort into subrows.\n\tfunction buildSegmentSubrows(segments) {\n\n\t\t// Give preference to elements with certain criteria, so they have\n\t\t// a chance to be closer to the top.\n\t\tsegments.sort(compareDaySegments);\n\n\t\tvar subrows = [];\n\t\tfor (var i=0; i<segments.length; i++) {\n\t\t\tvar segment = segments[i];\n\n\t\t\t// loop through subrows, starting with the topmost, until the segment\n\t\t\t// doesn't collide with other segments.\n\t\t\tfor (var j=0; j<subrows.length; j++) {\n\t\t\t\tif (!isDaySegmentCollision(segment, subrows[j])) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// `j` now holds the desired subrow index\n\t\t\tif (subrows[j]) {\n\t\t\t\tsubrows[j].push(segment);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsubrows[j] = [ segment ];\n\t\t\t}\n\t\t}\n\n\t\treturn subrows;\n\t}\n\n\n\t// Return an array of jQuery objects for the placeholder content containers of each row.\n\t// The content containers don't actually contain anything, but their dimensions should match\n\t// the events that are overlaid on top.\n\tfunction getRowContentElements() {\n\t\tvar i;\n\t\tvar rowCnt = getRowCnt();\n\t\tvar rowDivs = [];\n\t\tfor (i=0; i<rowCnt; i++) {\n\t\t\trowDivs[i] = allDayRow(i)\n\t\t\t\t.find('div.fc-day-content > div');\n\t\t}\n\t\treturn rowDivs;\n\t}\n\n\n\n\t/* Mouse Handlers\n\t---------------------------------------------------------------------------------------------------*/\n\t// TODO: better documentation!\n\n\n\tfunction attachHandlers(segments, modifiedEventId) {\n\t\tvar segmentContainer = getDaySegmentContainer();\n\n\t\tsegmentElementEach(segments, function(segment, element, i) {\n\t\t\tvar event = segment.event;\n\t\t\tif (event._id === modifiedEventId) {\n\t\t\t\tbindDaySeg(event, element, segment);\n\t\t\t}else{\n\t\t\t\telement[0]._fci = i; // for lazySegBind\n\t\t\t}\n\t\t});\n\n\t\tlazySegBind(segmentContainer, segments, bindDaySeg);\n\t}\n\n\n\tfunction bindDaySeg(event, eventElement, segment) {\n\n\t\tif (isEventDraggable(event)) {\n\t\t\tt.draggableDayEvent(event, eventElement, segment); // use `t` so subclasses can override\n\t\t}\n\n\t\tif (\n\t\t\tsegment.isEnd && // only allow resizing on the final segment for an event\n\t\t\tisEventResizable(event)\n\t\t) {\n\t\t\tt.resizableDayEvent(event, eventElement, segment); // use `t` so subclasses can override\n\t\t}\n\n\t\t// attach all other handlers.\n\t\t// needs to be after, because resizableDayEvent might stopImmediatePropagation on click\n\t\teventElementHandlers(event, eventElement);\n\t}\n\n\t\n\tfunction draggableDayEvent(event, eventElement) {\n\t\tvar hoverListener = getHoverListener();\n\t\tvar dayDelta;\n\t\teventElement.draggable({\n\t\t\tdelay: 50,\n\t\t\topacity: opt('dragOpacity'),\n\t\t\trevertDuration: opt('dragRevertDuration'),\n\t\t\tstart: function(ev, ui) {\n\t\t\t\ttrigger('eventDragStart', eventElement, event, ev, ui);\n\t\t\t\thideEvents(event, eventElement);\n\t\t\t\thoverListener.start(function(cell, origCell, rowDelta, colDelta) {\n\t\t\t\t\teventElement.draggable('option', 'revert', !cell || !rowDelta && !colDelta);\n\t\t\t\t\tclearOverlays();\n\t\t\t\t\tif (cell) {\n\t\t\t\t\t\tvar origDate = cellToDate(origCell);\n\t\t\t\t\t\tvar date = cellToDate(cell);\n\t\t\t\t\t\tdayDelta = dayDiff(date, origDate);\n\t\t\t\t\t\trenderDayOverlay(\n\t\t\t\t\t\t\taddDays(cloneDate(event.start), dayDelta),\n\t\t\t\t\t\t\taddDays(exclEndDay(event), dayDelta)\n\t\t\t\t\t\t);\n\t\t\t\t\t}else{\n\t\t\t\t\t\tdayDelta = 0;\n\t\t\t\t\t}\n\t\t\t\t}, ev, 'drag');\n\t\t\t},\n\t\t\tstop: function(ev, ui) {\n\t\t\t\thoverListener.stop();\n\t\t\t\tclearOverlays();\n\t\t\t\ttrigger('eventDragStop', eventElement, event, ev, ui);\n\t\t\t\tif (dayDelta) {\n\t\t\t\t\teventDrop(this, event, dayDelta, 0, event.allDay, ev, ui);\n\t\t\t\t}else{\n\t\t\t\t\teventElement.css('filter', ''); // clear IE opacity side-effects\n\t\t\t\t\tshowEvents(event, eventElement);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t\n\tfunction resizableDayEvent(event, element, segment) {\n\t\tvar isRTL = opt('isRTL');\n\t\tvar direction = isRTL ? 'w' : 'e';\n\t\tvar handle = element.find('.ui-resizable-' + direction); // TODO: stop using this class because we aren't using jqui for this\n\t\tvar isResizing = false;\n\t\t\n\t\t// TODO: look into using jquery-ui mouse widget for this stuff\n\t\tdisableTextSelection(element); // prevent native <a> selection for IE\n\t\telement\n\t\t\t.mousedown(function(ev) { // prevent native <a> selection for others\n\t\t\t\tev.preventDefault();\n\t\t\t})\n\t\t\t.click(function(ev) {\n\t\t\t\tif (isResizing) {\n\t\t\t\t\tev.preventDefault(); // prevent link from being visited (only method that worked in IE6)\n\t\t\t\t\tev.stopImmediatePropagation(); // prevent fullcalendar eventClick handler from being called\n\t\t\t\t\t                               // (eventElementHandlers needs to be bound after resizableDayEvent)\n\t\t\t\t}\n\t\t\t});\n\t\t\n\t\thandle.mousedown(function(ev) {\n\t\t\tif (ev.which != 1) {\n\t\t\t\treturn; // needs to be left mouse button\n\t\t\t}\n\t\t\tisResizing = true;\n\t\t\tvar hoverListener = getHoverListener();\n\t\t\tvar rowCnt = getRowCnt();\n\t\t\tvar colCnt = getColCnt();\n\t\t\tvar elementTop = element.css('top');\n\t\t\tvar dayDelta;\n\t\t\tvar helpers;\n\t\t\tvar eventCopy = $.extend({}, event);\n\t\t\tvar minCellOffset = dayOffsetToCellOffset( dateToDayOffset(event.start) );\n\t\t\tclearSelection();\n\t\t\t$('body')\n\t\t\t\t.css('cursor', direction + '-resize')\n\t\t\t\t.one('mouseup', mouseup);\n\t\t\ttrigger('eventResizeStart', this, event, ev);\n\t\t\thoverListener.start(function(cell, origCell) {\n\t\t\t\tif (cell) {\n\n\t\t\t\t\tvar origCellOffset = cellToCellOffset(origCell);\n\t\t\t\t\tvar cellOffset = cellToCellOffset(cell);\n\n\t\t\t\t\t// don't let resizing move earlier than start date cell\n\t\t\t\t\tcellOffset = Math.max(cellOffset, minCellOffset);\n\n\t\t\t\t\tdayDelta =\n\t\t\t\t\t\tcellOffsetToDayOffset(cellOffset) -\n\t\t\t\t\t\tcellOffsetToDayOffset(origCellOffset);\n\n\t\t\t\t\tif (dayDelta) {\n\t\t\t\t\t\teventCopy.end = addDays(eventEnd(event), dayDelta, true);\n\t\t\t\t\t\tvar oldHelpers = helpers;\n\n\t\t\t\t\t\thelpers = renderTempDayEvent(eventCopy, segment.row, elementTop);\n\t\t\t\t\t\thelpers = $(helpers); // turn array into a jQuery object\n\n\t\t\t\t\t\thelpers.find('*').css('cursor', direction + '-resize');\n\t\t\t\t\t\tif (oldHelpers) {\n\t\t\t\t\t\t\toldHelpers.remove();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thideEvents(event);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tif (helpers) {\n\t\t\t\t\t\t\tshowEvents(event);\n\t\t\t\t\t\t\thelpers.remove();\n\t\t\t\t\t\t\thelpers = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tclearOverlays();\n\t\t\t\t\trenderDayOverlay( // coordinate grid already rebuilt with hoverListener.start()\n\t\t\t\t\t\tevent.start,\n\t\t\t\t\t\taddDays( exclEndDay(event), dayDelta )\n\t\t\t\t\t\t// TODO: instead of calling renderDayOverlay() with dates,\n\t\t\t\t\t\t// call _renderDayOverlay (or whatever) with cell offsets.\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}, ev);\n\t\t\t\n\t\t\tfunction mouseup(ev) {\n\t\t\t\ttrigger('eventResizeStop', this, event, ev);\n\t\t\t\t$('body').css('cursor', '');\n\t\t\t\thoverListener.stop();\n\t\t\t\tclearOverlays();\n\t\t\t\tif (dayDelta) {\n\t\t\t\t\teventResize(this, event, dayDelta, 0, ev);\n\t\t\t\t\t// event redraw will clear helpers\n\t\t\t\t}\n\t\t\t\t// otherwise, the drag handler already restored the old events\n\t\t\t\t\n\t\t\t\tsetTimeout(function() { // make this happen after the element's click event\n\t\t\t\t\tisResizing = false;\n\t\t\t\t},0);\n\t\t\t}\n\t\t});\n\t}\n\t\n\n}\n\n\n\n/* Generalized Segment Utilities\n-------------------------------------------------------------------------------------------------*/\n\n\nfunction isDaySegmentCollision(segment, otherSegments) {\n\tfor (var i=0; i<otherSegments.length; i++) {\n\t\tvar otherSegment = otherSegments[i];\n\t\tif (\n\t\t\totherSegment.leftCol <= segment.rightCol &&\n\t\t\totherSegment.rightCol >= segment.leftCol\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\n\nfunction segmentElementEach(segments, callback) { // TODO: use in AgendaView?\n\tfor (var i=0; i<segments.length; i++) {\n\t\tvar segment = segments[i];\n\t\tvar element = segment.element;\n\t\tif (element) {\n\t\t\tcallback(segment, element, i);\n\t\t}\n\t}\n}\n\n\n// A cmp function for determining which segments should appear higher up\nfunction compareDaySegments(a, b) {\n\treturn (b.rightCol - b.leftCol) - (a.rightCol - a.leftCol) || // put wider events first\n\t\tb.event.allDay - a.event.allDay || // if tie, put all-day events first (booleans cast to 0/1)\n\t\ta.event.start - b.event.start || // if a tie, sort by event start date\n\t\t(a.event.title || '').localeCompare(b.event.title) // if a tie, sort by event title\n}\n\n\n;;\n\n//BUG: unselect needs to be triggered when events are dragged+dropped\n\nfunction SelectionManager() {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.select = select;\n\tt.unselect = unselect;\n\tt.reportSelection = reportSelection;\n\tt.daySelectionMousedown = daySelectionMousedown;\n\t\n\t\n\t// imports\n\tvar opt = t.opt;\n\tvar trigger = t.trigger;\n\tvar defaultSelectionEnd = t.defaultSelectionEnd;\n\tvar renderSelection = t.renderSelection;\n\tvar clearSelection = t.clearSelection;\n\t\n\t\n\t// locals\n\tvar selected = false;\n\n\n\n\t// unselectAuto\n\tif (opt('selectable') && opt('unselectAuto')) {\n\t\t$(document).mousedown(function(ev) {\n\t\t\tvar ignore = opt('unselectCancel');\n\t\t\tif (ignore) {\n\t\t\t\tif ($(ev.target).parents(ignore).length) { // could be optimized to stop after first match\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tunselect(ev);\n\t\t});\n\t}\n\t\n\n\tfunction select(startDate, endDate, allDay) {\n\t\tunselect();\n\t\tif (!endDate) {\n\t\t\tendDate = defaultSelectionEnd(startDate, allDay);\n\t\t}\n\t\trenderSelection(startDate, endDate, allDay);\n\t\treportSelection(startDate, endDate, allDay);\n\t}\n\t\n\t\n\tfunction unselect(ev) {\n\t\tif (selected) {\n\t\t\tselected = false;\n\t\t\tclearSelection();\n\t\t\ttrigger('unselect', null, ev);\n\t\t}\n\t}\n\t\n\t\n\tfunction reportSelection(startDate, endDate, allDay, ev) {\n\t\tselected = true;\n\t\ttrigger('select', null, startDate, endDate, allDay, ev);\n\t}\n\t\n\t\n\tfunction daySelectionMousedown(ev) { // not really a generic manager method, oh well\n\t\tvar cellToDate = t.cellToDate;\n\t\tvar getIsCellAllDay = t.getIsCellAllDay;\n\t\tvar hoverListener = t.getHoverListener();\n\t\tvar reportDayClick = t.reportDayClick; // this is hacky and sort of weird\n\t\tif (ev.which == 1 && opt('selectable')) { // which==1 means left mouse button\n\t\t\tunselect(ev);\n\t\t\tvar _mousedownElement = this;\n\t\t\tvar dates;\n\t\t\thoverListener.start(function(cell, origCell) { // TODO: maybe put cellToDate/getIsCellAllDay info in cell\n\t\t\t\tclearSelection();\n\t\t\t\tif (cell && getIsCellAllDay(cell)) {\n\t\t\t\t\tdates = [ cellToDate(origCell), cellToDate(cell) ].sort(dateCompare);\n\t\t\t\t\trenderSelection(dates[0], dates[1], true);\n\t\t\t\t}else{\n\t\t\t\t\tdates = null;\n\t\t\t\t}\n\t\t\t}, ev);\n\t\t\t$(document).one('mouseup', function(ev) {\n\t\t\t\thoverListener.stop();\n\t\t\t\tif (dates) {\n\t\t\t\t\tif (+dates[0] == +dates[1]) {\n\t\t\t\t\t\treportDayClick(dates[0], true, ev);\n\t\t\t\t\t}\n\t\t\t\t\treportSelection(dates[0], dates[1], true, ev);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t}\n\n\n}\n\n;;\n \nfunction OverlayManager() {\n\tvar t = this;\n\t\n\t\n\t// exports\n\tt.renderOverlay = renderOverlay;\n\tt.clearOverlays = clearOverlays;\n\t\n\t\n\t// locals\n\tvar usedOverlays = [];\n\tvar unusedOverlays = [];\n\t\n\t\n\tfunction renderOverlay(rect, parent) {\n\t\tvar e = unusedOverlays.shift();\n\t\tif (!e) {\n\t\t\te = $(\"<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>\");\n\t\t}\n\t\tif (e[0].parentNode != parent[0]) {\n\t\t\te.appendTo(parent);\n\t\t}\n\t\tusedOverlays.push(e.css(rect).show());\n\t\treturn e;\n\t}\n\t\n\n\tfunction clearOverlays() {\n\t\tvar e;\n\t\twhile (e = usedOverlays.shift()) {\n\t\t\tunusedOverlays.push(e.hide().unbind());\n\t\t}\n\t}\n\n\n}\n\n;;\n\nfunction CoordinateGrid(buildFunc) {\n\n\tvar t = this;\n\tvar rows;\n\tvar cols;\n\t\n\t\n\tt.build = function() {\n\t\trows = [];\n\t\tcols = [];\n\t\tbuildFunc(rows, cols);\n\t};\n\t\n\t\n\tt.cell = function(x, y) {\n\t\tvar rowCnt = rows.length;\n\t\tvar colCnt = cols.length;\n\t\tvar i, r=-1, c=-1;\n\t\tfor (i=0; i<rowCnt; i++) {\n\t\t\tif (y >= rows[i][0] && y < rows[i][1]) {\n\t\t\t\tr = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor (i=0; i<colCnt; i++) {\n\t\t\tif (x >= cols[i][0] && x < cols[i][1]) {\n\t\t\t\tc = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn (r>=0 && c>=0) ? { row:r, col:c } : null;\n\t};\n\t\n\t\n\tt.rect = function(row0, col0, row1, col1, originElement) { // row1,col1 is inclusive\n\t\tvar origin = originElement.offset();\n\t\treturn {\n\t\t\ttop: rows[row0][0] - origin.top,\n\t\t\tleft: cols[col0][0] - origin.left,\n\t\t\twidth: cols[col1][1] - cols[col0][0],\n\t\t\theight: rows[row1][1] - rows[row0][0]\n\t\t};\n\t};\n\n}\n\n;;\n\nfunction HoverListener(coordinateGrid) {\n\n\n\tvar t = this;\n\tvar bindType;\n\tvar change;\n\tvar firstCell;\n\tvar cell;\n\t\n\t\n\tt.start = function(_change, ev, _bindType) {\n\t\tchange = _change;\n\t\tfirstCell = cell = null;\n\t\tcoordinateGrid.build();\n\t\tmouse(ev);\n\t\tbindType = _bindType || 'mousemove';\n\t\t$(document).bind(bindType, mouse);\n\t};\n\t\n\t\n\tfunction mouse(ev) {\n\t\t_fixUIEvent(ev); // see below\n\t\tvar newCell = coordinateGrid.cell(ev.pageX, ev.pageY);\n\t\tif (!newCell != !cell || newCell && (newCell.row != cell.row || newCell.col != cell.col)) {\n\t\t\tif (newCell) {\n\t\t\t\tif (!firstCell) {\n\t\t\t\t\tfirstCell = newCell;\n\t\t\t\t}\n\t\t\t\tchange(newCell, firstCell, newCell.row-firstCell.row, newCell.col-firstCell.col);\n\t\t\t}else{\n\t\t\t\tchange(newCell, firstCell);\n\t\t\t}\n\t\t\tcell = newCell;\n\t\t}\n\t}\n\t\n\t\n\tt.stop = function() {\n\t\t$(document).unbind(bindType, mouse);\n\t\treturn cell;\n\t};\n\t\n\t\n}\n\n\n\n// this fix was only necessary for jQuery UI 1.8.16 (and jQuery 1.7 or 1.7.1)\n// upgrading to jQuery UI 1.8.17 (and using either jQuery 1.7 or 1.7.1) fixed the problem\n// but keep this in here for 1.8.16 users\n// and maybe remove it down the line\n\nfunction _fixUIEvent(event) { // for issue 1168\n\tif (event.pageX === undefined) {\n\t\tevent.pageX = event.originalEvent.pageX;\n\t\tevent.pageY = event.originalEvent.pageY;\n\t}\n}\n;;\n\nfunction HorizontalPositionCache(getElement) {\n\n\tvar t = this,\n\t\telements = {},\n\t\tlefts = {},\n\t\trights = {};\n\t\t\n\tfunction e(i) {\n\t\treturn elements[i] = elements[i] || getElement(i);\n\t}\n\t\n\tt.left = function(i) {\n\t\treturn lefts[i] = lefts[i] === undefined ? e(i).position().left : lefts[i];\n\t};\n\t\n\tt.right = function(i) {\n\t\treturn rights[i] = rights[i] === undefined ? t.left(i) + e(i).width() : rights[i];\n\t};\n\t\n\tt.clear = function() {\n\t\telements = {};\n\t\tlefts = {};\n\t\trights = {};\n\t};\n\t\n}\n\n;;\n\n})(jQuery);\n\n\nexport default CadastroHorario;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}