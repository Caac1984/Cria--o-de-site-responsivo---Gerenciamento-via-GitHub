{"ast":null,"code":"var _jsxFileName = \"/home/nomade00/\\xC1rea de Trabalho/Trabalho James/trabcar/src/pages/CadHorario.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction CadastroHorario() {\n  _s();\n  const [selectedProfessor, setSelectedProfessor] = useState('');\n  const [selectedSala, setSelectedSala] = useState('');\n  const [selectedNomeDesafio, setSelectedNomeDesafio] = useState('');\n  const [setSelectedCurso] = useState('');\n  const [professores, setProfessores] = useState([]);\n  const [salas, setSalas] = useState([]);\n  const [nomeDesafios, setNomeDesafios] = useState([]);\n  const [horarios, setHorarios] = useState([]);\n  const [horaInicial, setHoraInicial] = useState([]);\n  const [horaFinal, setHoraFinal] = useState([]);\n  useEffect(() => {\n    const storedHorarios = JSON.parse(localStorage.getItem('Horarios')) || [];\n    setHorarios(storedHorarios);\n    const storedProfessores = JSON.parse(localStorage.getItem('Professores')) || [];\n    setProfessores(storedProfessores);\n    const storedSalas = JSON.parse(localStorage.getItem('Salas')) || [];\n    setSalas(storedSalas);\n    const storedDesafios = JSON.parse(localStorage.getItem('Desafios')) || [];\n    setNomeDesafios(storedDesafios);\n  }, []);\n  const adicionarHorarios = () => {\n    if (selectedProfessor.trim() && horaFinal.trim() && horaInicial.trim() && selectedSala.trim()) {\n      const novoHorario = {\n        id: new Date().getTime(),\n        professor: selectedProfessor,\n        sala: selectedSala,\n        desafio: selectedNomeDesafio,\n        horaInicial: horaInicial,\n        horaFinal: horaFinal\n      };\n      console.log(novoHorario);\n      setHorarios(prevHorarios => {\n        const newHorarios = [...prevHorarios, novoHorario];\n        localStorage.setItem('Horarios', JSON.stringify(newHorarios));\n        return newHorarios;\n      });\n\n      // Limpa os campos apÃ³s adicionar\n      setSelectedProfessor('');\n      setSelectedCurso('');\n      setHoraInicial('');\n      setHoraFinal('');\n      setSelectedSala('');\n    }\n  };\n  const excluirHorario = index => {\n    const novoHorario = [...horarios];\n    novoHorario.splice(index, 1);\n    setHorarios(novoHorario);\n    localStorage.setItem('Horario', JSON.stringify(novoHorario));\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"Cad\",\n      className: \"form-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Selecione um Professor: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        id: \"professor\",\n        value: selectedProfessor,\n        onChange: e => setSelectedProfessor(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          disabled: true,\n          children: \"Selecione um professor\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 11\n        }, this), professores.map((professor, index) => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: professor.nomeProfessor,\n          children: professor.nomeProfessor\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Selecione uma Sala: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        id: \"sala\",\n        value: selectedSala,\n        onChange: e => setSelectedSala(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          disabled: true,\n          children: \"Selecione uma Sala\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 96,\n          columnNumber: 11\n        }, this), salas.map((sala, index) => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: sala.numeroSala,\n          children: sala.numeroSala\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 100,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n        children: \"Selecione um Desafio: \"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"select\", {\n        id: \"desafio\",\n        value: selectedNomeDesafio,\n        onChange: e => setSelectedNomeDesafio(e.target.value),\n        children: [/*#__PURE__*/_jsxDEV(\"option\", {\n          value: \"\",\n          disabled: true,\n          children: \"Selecione um Desafio\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 112,\n          columnNumber: 11\n        }, this), nomeDesafios.map((desafio, index) => /*#__PURE__*/_jsxDEV(\"option\", {\n          value: desafio.nomeDesafio,\n          children: desafio.nomeDesafio\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 13\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"Hor\\xE1rio Inicio: \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 122,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"home-container\",\n          type: \"time\",\n          value: horaInicial,\n          onChange: e => setHoraInicial(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"h4\", {\n          children: \"Hor\\xE1rio Final: \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 9\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          className: \"home-container\",\n          type: \"time\",\n          value: horaFinal,\n          onChange: e => setHoraFinal(e.target.value)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: adicionarHorarios,\n        children: \"Adicionar\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 139,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"table-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n        children: \"Horario\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 144,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"table\", {\n        id: \"tabelaPessoas\",\n        children: [/*#__PURE__*/_jsxDEV(\"thead\", {\n          children: /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"ID\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 148,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Professor\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 149,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Sala\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 150,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Curso\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 151,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"th\", {\n              children: \"Horario\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 152,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 147,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 146,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"tbody\", {\n          children: horarios.map((horario, index) => /*#__PURE__*/_jsxDEV(\"tr\", {\n            children: [/*#__PURE__*/_jsxDEV(\"td\", {\n              children: horario.id\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 159,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: horario.professor\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 160,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: horario.sala\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 161,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: horario.desafio\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 162,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: [horario.horaInicial, \" a\", ' ', horario.horaFinal]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 163,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"td\", {\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"excluir-btn\",\n                onClick: () => excluirHorario(horario.id),\n                children: \"Excluir\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 167,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 166,\n              columnNumber: 17\n            }, this)]\n          }, horario.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 158,\n            columnNumber: 15\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 5\n  }, this);\n}\n\n/*!\n * FullCalendar v1.6.4\n * Docs & License: http://arshaw.com/fullcalendar/\n * (c) 2013 Adam Shaw\n */\n\n/*\n * Use fullcalendar.css for basic styling.\n * For event drag & drop, requires jQuery UI draggable.\n * For event resizing, requires jQuery UI resizable.\n */\n_s(CadastroHorario, \"OM/F5oLZLQYUln0NEAUCCRV6GYY=\");\n_c = CadastroHorario;\n(function ($, undefined) {\n  ;\n  ;\n  var defaults = {\n    // display\n    defaultView: 'month',\n    aspectRatio: 1.35,\n    header: {\n      left: 'title',\n      center: '',\n      right: 'today prev,next'\n    },\n    weekends: true,\n    weekNumbers: false,\n    weekNumberCalculation: 'iso',\n    weekNumberTitle: 'W',\n    // editing\n    //editable: false,\n    //disableDragging: false,\n    //disableResizing: false,\n\n    allDayDefault: true,\n    ignoreTimezone: true,\n    // event ajax\n    lazyFetching: true,\n    startParam: 'start',\n    endParam: 'end',\n    // time formats\n    titleFormat: {\n      month: 'MMMM yyyy',\n      week: \"MMM d[ yyyy]{ 'â'[ MMM] d yyyy}\",\n      day: 'dddd, MMM d, yyyy'\n    },\n    columnFormat: {\n      month: 'ddd',\n      week: 'ddd M/d',\n      day: 'dddd M/d'\n    },\n    timeFormat: {\n      // for event elements\n      '': 'h(:mm)t' // default\n    },\n\n    // locale\n    isRTL: false,\n    firstDay: 0,\n    monthNames: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\n    monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n    dayNames: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\n    dayNamesShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],\n    buttonText: {\n      prev: \"<span class='fc-text-arrow'>â¹</span>\",\n      next: \"<span class='fc-text-arrow'>âº</span>\",\n      prevYear: \"<span class='fc-text-arrow'>Â«</span>\",\n      nextYear: \"<span class='fc-text-arrow'>Â»</span>\",\n      today: 'today',\n      month: 'month',\n      week: 'week',\n      day: 'day'\n    },\n    // jquery-ui theming\n    theme: false,\n    buttonIcons: {\n      prev: 'circle-triangle-w',\n      next: 'circle-triangle-e'\n    },\n    //selectable: false,\n    unselectAuto: true,\n    dropAccept: '*',\n    handleWindowResize: true\n  };\n\n  // right-to-left defaults\n  var rtlDefaults = {\n    header: {\n      left: 'next,prev today',\n      center: '',\n      right: 'title'\n    },\n    buttonText: {\n      prev: \"<span class='fc-text-arrow'>âº</span>\",\n      next: \"<span class='fc-text-arrow'>â¹</span>\",\n      prevYear: \"<span class='fc-text-arrow'>Â»</span>\",\n      nextYear: \"<span class='fc-text-arrow'>Â«</span>\"\n    },\n    buttonIcons: {\n      prev: 'circle-triangle-e',\n      next: 'circle-triangle-w'\n    }\n  };\n  ;\n  ;\n  var fc = $.fullCalendar = {\n    version: \"1.6.4\"\n  };\n  var fcViews = fc.views = {};\n  $.fn.fullCalendar = function (options) {\n    // method calling\n    if (typeof options == 'string') {\n      var args = Array.prototype.slice.call(arguments, 1);\n      var res;\n      this.each(function () {\n        var calendar = $.data(this, 'fullCalendar');\n        if (calendar && $.isFunction(calendar[options])) {\n          var r = calendar[options].apply(calendar, args);\n          if (res === undefined) {\n            res = r;\n          }\n          if (options == 'destroy') {\n            $.removeData(this, 'fullCalendar');\n          }\n        }\n      });\n      if (res !== undefined) {\n        return res;\n      }\n      return this;\n    }\n    options = options || {};\n\n    // would like to have this logic in EventManager, but needs to happen before options are recursively extended\n    var eventSources = options.eventSources || [];\n    delete options.eventSources;\n    if (options.events) {\n      eventSources.push(options.events);\n      delete options.events;\n    }\n    options = $.extend(true, {}, defaults, options.isRTL || options.isRTL === undefined && defaults.isRTL ? rtlDefaults : {}, options);\n    this.each(function (i, _element) {\n      var element = $(_element);\n      var calendar = new Calendar(element, options, eventSources);\n      element.data('fullCalendar', calendar); // TODO: look into memory leak implications\n      calendar.render();\n    });\n    return this;\n  };\n\n  // function for adding/overriding defaults\n  function setDefaults(d) {\n    $.extend(true, defaults, d);\n  }\n  ;\n  ;\n  function Calendar(element, options, eventSources) {\n    var t = this;\n\n    // exports\n    t.options = options;\n    t.render = render;\n    t.destroy = destroy;\n    t.refetchEvents = refetchEvents;\n    t.reportEvents = reportEvents;\n    t.reportEventChange = reportEventChange;\n    t.rerenderEvents = rerenderEvents;\n    t.changeView = changeView;\n    t.select = select;\n    t.unselect = unselect;\n    t.prev = prev;\n    t.next = next;\n    t.prevYear = prevYear;\n    t.nextYear = nextYear;\n    t.today = today;\n    t.gotoDate = gotoDate;\n    t.incrementDate = incrementDate;\n    t.formatDate = function (format, date) {\n      return formatDate(format, date, options);\n    };\n    t.formatDates = function (format, date1, date2) {\n      return formatDates(format, date1, date2, options);\n    };\n    t.getDate = getDate;\n    t.getView = getView;\n    t.option = option;\n    t.trigger = trigger;\n\n    // imports\n    EventManager.call(t, options, eventSources);\n    var isFetchNeeded = t.isFetchNeeded;\n    var fetchEvents = t.fetchEvents;\n\n    // locals\n    var _element = element[0];\n    var header;\n    var headerElement;\n    var content;\n    var tm; // for making theme classes\n    var currentView;\n    var elementOuterWidth;\n    var suggestedViewHeight;\n    var resizeUID = 0;\n    var ignoreWindowResize = 0;\n    var date = new Date();\n    var events = [];\n    var _dragElement;\n\n    /* Main Rendering\n    -----------------------------------------------------------------------------*/\n\n    setYMD(date, options.year, options.month, options.date);\n    function render(inc) {\n      if (!content) {\n        initialRender();\n      } else if (elementVisible()) {\n        // mainly for the public API\n        calcSize();\n        _renderView(inc);\n      }\n    }\n    function initialRender() {\n      tm = options.theme ? 'ui' : 'fc';\n      element.addClass('fc');\n      if (options.isRTL) {\n        element.addClass('fc-rtl');\n      } else {\n        element.addClass('fc-ltr');\n      }\n      if (options.theme) {\n        element.addClass('ui-widget');\n      }\n      content = $(\"<div class='fc-content' style='position:relative'/>\").prependTo(element);\n      header = new Header(t, options);\n      headerElement = header.render();\n      if (headerElement) {\n        element.prepend(headerElement);\n      }\n      changeView(options.defaultView);\n      if (options.handleWindowResize) {\n        $(window).resize(windowResize);\n      }\n\n      // needed for IE in a 0x0 iframe, b/c when it is resized, never triggers a windowResize\n      if (!bodyVisible()) {\n        lateRender();\n      }\n    }\n\n    // called when we know the calendar couldn't be rendered when it was initialized,\n    // but we think it's ready now\n    function lateRender() {\n      setTimeout(function () {\n        // IE7 needs this so dimensions are calculated correctly\n        if (!currentView.start && bodyVisible()) {\n          // !currentView.start makes sure this never happens more than once\n          renderView();\n        }\n      }, 0);\n    }\n    function destroy() {\n      if (currentView) {\n        trigger('viewDestroy', currentView, currentView, currentView.element);\n        currentView.triggerEventDestroy();\n      }\n      $(window).unbind('resize', windowResize);\n      header.destroy();\n      content.remove();\n      element.removeClass('fc fc-rtl ui-widget');\n    }\n    function elementVisible() {\n      return element.is(':visible');\n    }\n    function bodyVisible() {\n      return $('body').is(':visible');\n    }\n\n    /* View Rendering\n    -----------------------------------------------------------------------------*/\n\n    function changeView(newViewName) {\n      if (!currentView || newViewName != currentView.name) {\n        _changeView(newViewName);\n      }\n    }\n    function _changeView(newViewName) {\n      ignoreWindowResize++;\n      if (currentView) {\n        trigger('viewDestroy', currentView, currentView, currentView.element);\n        unselect();\n        currentView.triggerEventDestroy(); // trigger 'eventDestroy' for each event\n        freezeContentHeight();\n        currentView.element.remove();\n        header.deactivateButton(currentView.name);\n      }\n      header.activateButton(newViewName);\n      currentView = new fcViews[newViewName]($(\"<div class='fc-view fc-view-\" + newViewName + \"' style='position:relative'/>\").appendTo(content), t // the calendar object\n      );\n\n      renderView();\n      unfreezeContentHeight();\n      ignoreWindowResize--;\n    }\n    function renderView(inc) {\n      if (!currentView.start ||\n      // never rendered before\n      inc || date < currentView.start || date >= currentView.end // or new date range\n      ) {\n        if (elementVisible()) {\n          _renderView(inc);\n        }\n      }\n    }\n    function _renderView(inc) {\n      // assumes elementVisible\n      ignoreWindowResize++;\n      if (currentView.start) {\n        // already been rendered?\n        trigger('viewDestroy', currentView, currentView, currentView.element);\n        unselect();\n        clearEvents();\n      }\n      freezeContentHeight();\n      currentView.render(date, inc || 0); // the view's render method ONLY renders the skeleton, nothing else\n      setSize();\n      unfreezeContentHeight();\n      (currentView.afterRender || noop)();\n      updateTitle();\n      updateTodayButton();\n      trigger('viewRender', currentView, currentView, currentView.element);\n      currentView.trigger('viewDisplay', _element); // deprecated\n\n      ignoreWindowResize--;\n      getAndRenderEvents();\n    }\n\n    /* Resizing\n    -----------------------------------------------------------------------------*/\n\n    function updateSize() {\n      if (elementVisible()) {\n        unselect();\n        clearEvents();\n        calcSize();\n        setSize();\n        renderEvents();\n      }\n    }\n    function calcSize() {\n      // assumes elementVisible\n      if (options.contentHeight) {\n        suggestedViewHeight = options.contentHeight;\n      } else if (options.height) {\n        suggestedViewHeight = options.height - (headerElement ? headerElement.height() : 0) - vsides(content);\n      } else {\n        suggestedViewHeight = Math.round(content.width() / Math.max(options.aspectRatio, .5));\n      }\n    }\n    function setSize() {\n      // assumes elementVisible\n\n      if (suggestedViewHeight === undefined) {\n        calcSize(); // for first time\n        // NOTE: we don't want to recalculate on every renderView because\n        // it could result in oscillating heights due to scrollbars.\n      }\n\n      ignoreWindowResize++;\n      currentView.setHeight(suggestedViewHeight);\n      currentView.setWidth(content.width());\n      ignoreWindowResize--;\n      elementOuterWidth = element.outerWidth();\n    }\n    function windowResize() {\n      if (!ignoreWindowResize) {\n        if (currentView.start) {\n          // view has already been rendered\n          var uid = ++resizeUID;\n          setTimeout(function () {\n            // add a delay\n            if (uid == resizeUID && !ignoreWindowResize && elementVisible()) {\n              if (elementOuterWidth != (elementOuterWidth = element.outerWidth())) {\n                ignoreWindowResize++; // in case the windowResize callback changes the height\n                updateSize();\n                currentView.trigger('windowResize', _element);\n                ignoreWindowResize--;\n              }\n            }\n          }, 200);\n        } else {\n          // calendar must have been initialized in a 0x0 iframe that has just been resized\n          lateRender();\n        }\n      }\n    }\n\n    /* Event Fetching/Rendering\n    -----------------------------------------------------------------------------*/\n    // TODO: going forward, most of this stuff should be directly handled by the view\n\n    function refetchEvents() {\n      // can be called as an API method\n      clearEvents();\n      fetchAndRenderEvents();\n    }\n    function rerenderEvents(modifiedEventID) {\n      // can be called as an API method\n      clearEvents();\n      renderEvents(modifiedEventID);\n    }\n    function renderEvents(modifiedEventID) {\n      // TODO: remove modifiedEventID hack\n      if (elementVisible()) {\n        currentView.setEventData(events); // for View.js, TODO: unify with renderEvents\n        currentView.renderEvents(events, modifiedEventID); // actually render the DOM elements\n        currentView.trigger('eventAfterAllRender');\n      }\n    }\n    function clearEvents() {\n      currentView.triggerEventDestroy(); // trigger 'eventDestroy' for each event\n      currentView.clearEvents(); // actually remove the DOM elements\n      currentView.clearEventData(); // for View.js, TODO: unify with clearEvents\n    }\n\n    function getAndRenderEvents() {\n      if (!options.lazyFetching || isFetchNeeded(currentView.visStart, currentView.visEnd)) {\n        fetchAndRenderEvents();\n      } else {\n        renderEvents();\n      }\n    }\n    function fetchAndRenderEvents() {\n      fetchEvents(currentView.visStart, currentView.visEnd);\n      // ... will call reportEvents\n      // ... which will call renderEvents\n    }\n\n    // called when event data arrives\n    function reportEvents(_events) {\n      events = _events;\n      renderEvents();\n    }\n\n    // called when a single event's data has been changed\n    function reportEventChange(eventID) {\n      rerenderEvents(eventID);\n    }\n\n    /* Header Updating\n    -----------------------------------------------------------------------------*/\n\n    function updateTitle() {\n      header.updateTitle(currentView.title);\n    }\n    function updateTodayButton() {\n      var today = new Date();\n      if (today >= currentView.start && today < currentView.end) {\n        header.disableButton('today');\n      } else {\n        header.enableButton('today');\n      }\n    }\n\n    /* Selection\n    -----------------------------------------------------------------------------*/\n\n    function select(start, end, allDay) {\n      currentView.select(start, end, allDay === undefined ? true : allDay);\n    }\n    function unselect() {\n      // safe to be called before renderView\n      if (currentView) {\n        currentView.unselect();\n      }\n    }\n\n    /* Date\n    -----------------------------------------------------------------------------*/\n\n    function prev() {\n      renderView(-1);\n    }\n    function next() {\n      renderView(1);\n    }\n    function prevYear() {\n      addYears(date, -1);\n      renderView();\n    }\n    function nextYear() {\n      addYears(date, 1);\n      renderView();\n    }\n    function today() {\n      date = new Date();\n      renderView();\n    }\n    function gotoDate(year, month, dateOfMonth) {\n      if (year instanceof Date) {\n        date = cloneDate(year); // provided 1 argument, a Date\n      } else {\n        setYMD(date, year, month, dateOfMonth);\n      }\n      renderView();\n    }\n    function incrementDate(years, months, days) {\n      if (years !== undefined) {\n        addYears(date, years);\n      }\n      if (months !== undefined) {\n        addMonths(date, months);\n      }\n      if (days !== undefined) {\n        addDays(date, days);\n      }\n      renderView();\n    }\n    function getDate() {\n      return cloneDate(date);\n    }\n\n    /* Height \"Freezing\"\n    -----------------------------------------------------------------------------*/\n\n    function freezeContentHeight() {\n      content.css({\n        width: '100%',\n        height: content.height(),\n        overflow: 'hidden'\n      });\n    }\n    function unfreezeContentHeight() {\n      content.css({\n        width: '',\n        height: '',\n        overflow: ''\n      });\n    }\n\n    /* Misc\n    -----------------------------------------------------------------------------*/\n\n    function getView() {\n      return currentView;\n    }\n    function option(name, value) {\n      if (value === undefined) {\n        return options[name];\n      }\n      if (name == 'height' || name == 'contentHeight' || name == 'aspectRatio') {\n        options[name] = value;\n        updateSize();\n      }\n    }\n    function trigger(name, thisObj) {\n      if (options[name]) {\n        return options[name].apply(thisObj || _element, Array.prototype.slice.call(arguments, 2));\n      }\n    }\n\n    /* External Dragging\n    ------------------------------------------------------------------------*/\n\n    if (options.droppable) {\n      $(document).bind('dragstart', function (ev, ui) {\n        var _e = ev.target;\n        var e = $(_e);\n        if (!e.parents('.fc').length) {\n          // not already inside a calendar\n          var accept = options.dropAccept;\n          if ($.isFunction(accept) ? accept.call(_e, e) : e.is(accept)) {\n            _dragElement = _e;\n            currentView.dragStart(_dragElement, ev, ui);\n          }\n        }\n      }).bind('dragstop', function (ev, ui) {\n        if (_dragElement) {\n          currentView.dragStop(_dragElement, ev, ui);\n          _dragElement = null;\n        }\n      });\n    }\n  }\n  ;\n  ;\n  function Header(calendar, options) {\n    var t = this;\n\n    // exports\n    t.render = render;\n    t.destroy = destroy;\n    t.updateTitle = updateTitle;\n    t.activateButton = activateButton;\n    t.deactivateButton = deactivateButton;\n    t.disableButton = disableButton;\n    t.enableButton = enableButton;\n\n    // locals\n    var element = $([]);\n    var tm;\n    function render() {\n      tm = options.theme ? 'ui' : 'fc';\n      var sections = options.header;\n      if (sections) {\n        element = $(\"<table class='fc-header' style='width:100%'/>\").append($(\"<tr/>\").append(renderSection('left')).append(renderSection('center')).append(renderSection('right')));\n        return element;\n      }\n    }\n    function destroy() {\n      element.remove();\n    }\n    function renderSection(position) {\n      var e = $(\"<td class='fc-header-\" + position + \"'/>\");\n      var buttonStr = options.header[position];\n      if (buttonStr) {\n        $.each(buttonStr.split(' '), function (i) {\n          if (i > 0) {\n            e.append(\"<span class='fc-header-space'/>\");\n          }\n          var prevButton;\n          $.each(this.split(','), function (j, buttonName) {\n            if (buttonName == 'title') {\n              e.append(\"<span class='fc-header-title'><h2>Â </h2></span>\");\n              if (prevButton) {\n                prevButton.addClass(tm + '-corner-right');\n              }\n              prevButton = null;\n            } else {\n              var buttonClick;\n              if (calendar[buttonName]) {\n                buttonClick = calendar[buttonName]; // calendar method\n              } else if (fcViews[buttonName]) {\n                buttonClick = function () {\n                  button.removeClass(tm + '-state-hover'); // forget why\n                  calendar.changeView(buttonName);\n                };\n              }\n              if (buttonClick) {\n                var icon = options.theme ? smartProperty(options.buttonIcons, buttonName) : null; // why are we using smartProperty here?\n                var text = smartProperty(options.buttonText, buttonName); // why are we using smartProperty here?\n                var button = $(\"<span class='fc-button fc-button-\" + buttonName + \" \" + tm + \"-state-default'>\" + (icon ? \"<span class='fc-icon-wrap'>\" + \"<span class='ui-icon ui-icon-\" + icon + \"'/>\" + \"</span>\" : text) + \"</span>\").click(function () {\n                  if (!button.hasClass(tm + '-state-disabled')) {\n                    buttonClick();\n                  }\n                }).mousedown(function () {\n                  button.not('.' + tm + '-state-active').not('.' + tm + '-state-disabled').addClass(tm + '-state-down');\n                }).mouseup(function () {\n                  button.removeClass(tm + '-state-down');\n                }).hover(function () {\n                  button.not('.' + tm + '-state-active').not('.' + tm + '-state-disabled').addClass(tm + '-state-hover');\n                }, function () {\n                  button.removeClass(tm + '-state-hover').removeClass(tm + '-state-down');\n                }).appendTo(e);\n                disableTextSelection(button);\n                if (!prevButton) {\n                  button.addClass(tm + '-corner-left');\n                }\n                prevButton = button;\n              }\n            }\n          });\n          if (prevButton) {\n            prevButton.addClass(tm + '-corner-right');\n          }\n        });\n      }\n      return e;\n    }\n    function updateTitle(html) {\n      element.find('h2').html(html);\n    }\n    function activateButton(buttonName) {\n      element.find('span.fc-button-' + buttonName).addClass(tm + '-state-active');\n    }\n    function deactivateButton(buttonName) {\n      element.find('span.fc-button-' + buttonName).removeClass(tm + '-state-active');\n    }\n    function disableButton(buttonName) {\n      element.find('span.fc-button-' + buttonName).addClass(tm + '-state-disabled');\n    }\n    function enableButton(buttonName) {\n      element.find('span.fc-button-' + buttonName).removeClass(tm + '-state-disabled');\n    }\n  }\n  ;\n  ;\n  fc.sourceNormalizers = [];\n  fc.sourceFetchers = [];\n  var ajaxDefaults = {\n    dataType: 'json',\n    cache: false\n  };\n  var eventGUID = 1;\n  function EventManager(options, _sources) {\n    var t = this;\n\n    // exports\n    t.isFetchNeeded = isFetchNeeded;\n    t.fetchEvents = fetchEvents;\n    t.addEventSource = addEventSource;\n    t.removeEventSource = removeEventSource;\n    t.updateEvent = updateEvent;\n    t.renderEvent = renderEvent;\n    t.removeEvents = removeEvents;\n    t.clientEvents = clientEvents;\n    t.normalizeEvent = normalizeEvent;\n\n    // imports\n    var trigger = t.trigger;\n    var getView = t.getView;\n    var reportEvents = t.reportEvents;\n\n    // locals\n    var stickySource = {\n      events: []\n    };\n    var sources = [stickySource];\n    var rangeStart, rangeEnd;\n    var currentFetchID = 0;\n    var pendingSourceCnt = 0;\n    var loadingLevel = 0;\n    var cache = [];\n    for (var i = 0; i < _sources.length; i++) {\n      _addEventSource(_sources[i]);\n    }\n\n    /* Fetching\n    -----------------------------------------------------------------------------*/\n\n    function isFetchNeeded(start, end) {\n      return !rangeStart || start < rangeStart || end > rangeEnd;\n    }\n    function fetchEvents(start, end) {\n      rangeStart = start;\n      rangeEnd = end;\n      cache = [];\n      var fetchID = ++currentFetchID;\n      var len = sources.length;\n      pendingSourceCnt = len;\n      for (var i = 0; i < len; i++) {\n        fetchEventSource(sources[i], fetchID);\n      }\n    }\n    function fetchEventSource(source, fetchID) {\n      _fetchEventSource(source, function (events) {\n        if (fetchID == currentFetchID) {\n          if (events) {\n            if (options.eventDataTransform) {\n              events = $.map(events, options.eventDataTransform);\n            }\n            if (source.eventDataTransform) {\n              events = $.map(events, source.eventDataTransform);\n            }\n            // TODO: this technique is not ideal for static array event sources.\n            //  For arrays, we'll want to process all events right in the beginning, then never again.\n\n            for (var i = 0; i < events.length; i++) {\n              events[i].source = source;\n              normalizeEvent(events[i]);\n            }\n            cache = cache.concat(events);\n          }\n          pendingSourceCnt--;\n          if (!pendingSourceCnt) {\n            reportEvents(cache);\n          }\n        }\n      });\n    }\n    function _fetchEventSource(source, callback) {\n      var i;\n      var fetchers = fc.sourceFetchers;\n      var res;\n      for (i = 0; i < fetchers.length; i++) {\n        res = fetchers[i](source, rangeStart, rangeEnd, callback);\n        if (res === true) {\n          // the fetcher is in charge. made its own async request\n          return;\n        } else if (typeof res == 'object') {\n          // the fetcher returned a new source. process it\n          _fetchEventSource(res, callback);\n          return;\n        }\n      }\n      var events = source.events;\n      if (events) {\n        if ($.isFunction(events)) {\n          pushLoading();\n          events(cloneDate(rangeStart), cloneDate(rangeEnd), function (events) {\n            callback(events);\n            popLoading();\n          });\n        } else if ($.isArray(events)) {\n          callback(events);\n        } else {\n          callback();\n        }\n      } else {\n        var url = source.url;\n        if (url) {\n          var success = source.success;\n          var error = source.error;\n          var complete = source.complete;\n\n          // retrieve any outbound GET/POST $.ajax data from the options\n          var customData;\n          if ($.isFunction(source.data)) {\n            // supplied as a function that returns a key/value object\n            customData = source.data();\n          } else {\n            // supplied as a straight key/value object\n            customData = source.data;\n          }\n\n          // use a copy of the custom data so we can modify the parameters\n          // and not affect the passed-in object.\n          var data = $.extend({}, customData || {});\n          var startParam = firstDefined(source.startParam, options.startParam);\n          var endParam = firstDefined(source.endParam, options.endParam);\n          if (startParam) {\n            data[startParam] = Math.round(+rangeStart / 1000);\n          }\n          if (endParam) {\n            data[endParam] = Math.round(+rangeEnd / 1000);\n          }\n          pushLoading();\n          $.ajax($.extend({}, ajaxDefaults, source, {\n            data: data,\n            success: function (events) {\n              events = events || [];\n              var res = applyAll(success, this, arguments);\n              if ($.isArray(res)) {\n                events = res;\n              }\n              callback(events);\n            },\n            error: function () {\n              applyAll(error, this, arguments);\n              callback();\n            },\n            complete: function () {\n              applyAll(complete, this, arguments);\n              popLoading();\n            }\n          }));\n        } else {\n          callback();\n        }\n      }\n    }\n\n    /* Sources\n    -----------------------------------------------------------------------------*/\n\n    function addEventSource(source) {\n      source = _addEventSource(source);\n      if (source) {\n        pendingSourceCnt++;\n        fetchEventSource(source, currentFetchID); // will eventually call reportEvents\n      }\n    }\n\n    function _addEventSource(source) {\n      if ($.isFunction(source) || $.isArray(source)) {\n        source = {\n          events: source\n        };\n      } else if (typeof source == 'string') {\n        source = {\n          url: source\n        };\n      }\n      if (typeof source == 'object') {\n        normalizeSource(source);\n        sources.push(source);\n        return source;\n      }\n    }\n    function removeEventSource(source) {\n      sources = $.grep(sources, function (src) {\n        return !isSourcesEqual(src, source);\n      });\n      // remove all client events from that source\n      cache = $.grep(cache, function (e) {\n        return !isSourcesEqual(e.source, source);\n      });\n      reportEvents(cache);\n    }\n\n    /* Manipulation\n    -----------------------------------------------------------------------------*/\n\n    function updateEvent(event) {\n      // update an existing event\n      var i,\n        len = cache.length,\n        e,\n        defaultEventEnd = getView().defaultEventEnd,\n        // getView???\n        startDelta = event.start - event._start,\n        endDelta = event.end ? event.end - (event._end || defaultEventEnd(event)) // event._end would be null if event.end\n        : 0; // was null and event was just resized\n      for (i = 0; i < len; i++) {\n        e = cache[i];\n        if (e._id == event._id && e != event) {\n          e.start = new Date(+e.start + startDelta);\n          if (event.end) {\n            if (e.end) {\n              e.end = new Date(+e.end + endDelta);\n            } else {\n              e.end = new Date(+defaultEventEnd(e) + endDelta);\n            }\n          } else {\n            e.end = null;\n          }\n          e.title = event.title;\n          e.url = event.url;\n          e.allDay = event.allDay;\n          e.className = event.className;\n          e.editable = event.editable;\n          e.color = event.color;\n          e.backgroundColor = event.backgroundColor;\n          e.borderColor = event.borderColor;\n          e.textColor = event.textColor;\n          normalizeEvent(e);\n        }\n      }\n      normalizeEvent(event);\n      reportEvents(cache);\n    }\n    function renderEvent(event, stick) {\n      normalizeEvent(event);\n      if (!event.source) {\n        if (stick) {\n          stickySource.events.push(event);\n          event.source = stickySource;\n        }\n        cache.push(event);\n      }\n      reportEvents(cache);\n    }\n    function removeEvents(filter) {\n      if (!filter) {\n        // remove all\n        cache = [];\n        // clear all array sources\n        for (var i = 0; i < sources.length; i++) {\n          if ($.isArray(sources[i].events)) {\n            sources[i].events = [];\n          }\n        }\n      } else {\n        if (!$.isFunction(filter)) {\n          // an event ID\n          var id = filter + '';\n          filter = function (e) {\n            return e._id == id;\n          };\n        }\n        cache = $.grep(cache, filter, true);\n        // remove events from array sources\n        for (var i = 0; i < sources.length; i++) {\n          if ($.isArray(sources[i].events)) {\n            sources[i].events = $.grep(sources[i].events, filter, true);\n          }\n        }\n      }\n      reportEvents(cache);\n    }\n    function clientEvents(filter) {\n      if ($.isFunction(filter)) {\n        return $.grep(cache, filter);\n      } else if (filter) {\n        // an event ID\n        filter += '';\n        return $.grep(cache, function (e) {\n          return e._id == filter;\n        });\n      }\n      return cache; // else, return all\n    }\n\n    /* Loading State\n    -----------------------------------------------------------------------------*/\n\n    function pushLoading() {\n      if (!loadingLevel++) {\n        trigger('loading', null, true, getView());\n      }\n    }\n    function popLoading() {\n      if (! --loadingLevel) {\n        trigger('loading', null, false, getView());\n      }\n    }\n\n    /* Event Normalization\n    -----------------------------------------------------------------------------*/\n\n    function normalizeEvent(event) {\n      var source = event.source || {};\n      var ignoreTimezone = firstDefined(source.ignoreTimezone, options.ignoreTimezone);\n      event._id = event._id || (event.id === undefined ? '_fc' + eventGUID++ : event.id + '');\n      if (event.date) {\n        if (!event.start) {\n          event.start = event.date;\n        }\n        delete event.date;\n      }\n      event._start = cloneDate(event.start = parseDate(event.start, ignoreTimezone));\n      event.end = parseDate(event.end, ignoreTimezone);\n      if (event.end && event.end <= event.start) {\n        event.end = null;\n      }\n      event._end = event.end ? cloneDate(event.end) : null;\n      if (event.allDay === undefined) {\n        event.allDay = firstDefined(source.allDayDefault, options.allDayDefault);\n      }\n      if (event.className) {\n        if (typeof event.className == 'string') {\n          event.className = event.className.split(/\\s+/);\n        }\n      } else {\n        event.className = [];\n      }\n      // TODO: if there is no start date, return false to indicate an invalid event\n    }\n\n    /* Utils\n    ------------------------------------------------------------------------------*/\n\n    function normalizeSource(source) {\n      if (source.className) {\n        // TODO: repeat code, same code for event classNames\n        if (typeof source.className == 'string') {\n          source.className = source.className.split(/\\s+/);\n        }\n      } else {\n        source.className = [];\n      }\n      var normalizers = fc.sourceNormalizers;\n      for (var i = 0; i < normalizers.length; i++) {\n        normalizers[i](source);\n      }\n    }\n    function isSourcesEqual(source1, source2) {\n      return source1 && source2 && getSourcePrimitive(source1) == getSourcePrimitive(source2);\n    }\n    function getSourcePrimitive(source) {\n      return (typeof source == 'object' ? source.events || source.url : '') || source;\n    }\n  }\n  ;\n  ;\n  fc.addDays = addDays;\n  fc.cloneDate = cloneDate;\n  fc.parseDate = parseDate;\n  fc.parseISO8601 = parseISO8601;\n  fc.parseTime = parseTime;\n  fc.formatDate = formatDate;\n  fc.formatDates = formatDates;\n\n  /* Date Math\n  -----------------------------------------------------------------------------*/\n\n  var dayIDs = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'],\n    DAY_MS = 86400000,\n    HOUR_MS = 3600000,\n    MINUTE_MS = 60000;\n  function addYears(d, n, keepTime) {\n    d.setFullYear(d.getFullYear() + n);\n    if (!keepTime) {\n      clearTime(d);\n    }\n    return d;\n  }\n  function addMonths(d, n, keepTime) {\n    // prevents day overflow/underflow\n    if (+d) {\n      // prevent infinite looping on invalid dates\n      var m = d.getMonth() + n,\n        check = cloneDate(d);\n      check.setDate(1);\n      check.setMonth(m);\n      d.setMonth(m);\n      if (!keepTime) {\n        clearTime(d);\n      }\n      while (d.getMonth() != check.getMonth()) {\n        d.setDate(d.getDate() + (d < check ? 1 : -1));\n      }\n    }\n    return d;\n  }\n  function addDays(d, n, keepTime) {\n    // deals with daylight savings\n    if (+d) {\n      var dd = d.getDate() + n,\n        check = cloneDate(d);\n      check.setHours(9); // set to middle of day\n      check.setDate(dd);\n      d.setDate(dd);\n      if (!keepTime) {\n        clearTime(d);\n      }\n      fixDate(d, check);\n    }\n    return d;\n  }\n  function fixDate(d, check) {\n    // force d to be on check's YMD, for daylight savings purposes\n    if (+d) {\n      // prevent infinite looping on invalid dates\n      while (d.getDate() != check.getDate()) {\n        d.setTime(+d + (d < check ? 1 : -1) * HOUR_MS);\n      }\n    }\n  }\n  function addMinutes(d, n) {\n    d.setMinutes(d.getMinutes() + n);\n    return d;\n  }\n  function clearTime(d) {\n    d.setHours(0);\n    d.setMinutes(0);\n    d.setSeconds(0);\n    d.setMilliseconds(0);\n    return d;\n  }\n  function cloneDate(d, dontKeepTime) {\n    if (dontKeepTime) {\n      return clearTime(new Date(+d));\n    }\n    return new Date(+d);\n  }\n  function zeroDate() {\n    // returns a Date with time 00:00:00 and dateOfMonth=1\n    var i = 0,\n      d;\n    do {\n      d = new Date(1970, i++, 1);\n    } while (d.getHours()); // != 0\n    return d;\n  }\n  function dayDiff(d1, d2) {\n    // d1 - d2\n    return Math.round((cloneDate(d1, true) - cloneDate(d2, true)) / DAY_MS);\n  }\n  function setYMD(date, y, m, d) {\n    if (y !== undefined && y != date.getFullYear()) {\n      date.setDate(1);\n      date.setMonth(0);\n      date.setFullYear(y);\n    }\n    if (m !== undefined && m != date.getMonth()) {\n      date.setDate(1);\n      date.setMonth(m);\n    }\n    if (d !== undefined) {\n      date.setDate(d);\n    }\n  }\n\n  /* Date Parsing\n  -----------------------------------------------------------------------------*/\n\n  function parseDate(s, ignoreTimezone) {\n    // ignoreTimezone defaults to true\n    if (typeof s == 'object') {\n      // already a Date object\n      return s;\n    }\n    if (typeof s == 'number') {\n      // a UNIX timestamp\n      return new Date(s * 1000);\n    }\n    if (typeof s == 'string') {\n      if (s.match(/^\\d+(\\.\\d+)?$/)) {\n        // a UNIX timestamp\n        return new Date(parseFloat(s) * 1000);\n      }\n      if (ignoreTimezone === undefined) {\n        ignoreTimezone = true;\n      }\n      return parseISO8601(s, ignoreTimezone) || (s ? new Date(s) : null);\n    }\n    // TODO: never return invalid dates (like from new Date(<string>)), return null instead\n    return null;\n  }\n  function parseISO8601(s, ignoreTimezone) {\n    // ignoreTimezone defaults to false\n    // derived from http://delete.me.uk/2005/03/iso8601.html\n    // TODO: for a know glitch/feature, read tests/issue_206_parseDate_dst.html\n    var m = s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);\n    if (!m) {\n      return null;\n    }\n    var date = new Date(m[1], 0, 1);\n    if (ignoreTimezone || !m[13]) {\n      var check = new Date(m[1], 0, 1, 9, 0);\n      if (m[3]) {\n        date.setMonth(m[3] - 1);\n        check.setMonth(m[3] - 1);\n      }\n      if (m[5]) {\n        date.setDate(m[5]);\n        check.setDate(m[5]);\n      }\n      fixDate(date, check);\n      if (m[7]) {\n        date.setHours(m[7]);\n      }\n      if (m[8]) {\n        date.setMinutes(m[8]);\n      }\n      if (m[10]) {\n        date.setSeconds(m[10]);\n      }\n      if (m[12]) {\n        date.setMilliseconds(Number(\"0.\" + m[12]) * 1000);\n      }\n      fixDate(date, check);\n    } else {\n      date.setUTCFullYear(m[1], m[3] ? m[3] - 1 : 0, m[5] || 1);\n      date.setUTCHours(m[7] || 0, m[8] || 0, m[10] || 0, m[12] ? Number(\"0.\" + m[12]) * 1000 : 0);\n      if (m[14]) {\n        var offset = Number(m[16]) * 60 + (m[18] ? Number(m[18]) : 0);\n        offset *= m[15] == '-' ? 1 : -1;\n        date = new Date(+date + offset * 60 * 1000);\n      }\n    }\n    return date;\n  }\n  function parseTime(s) {\n    // returns minutes since start of day\n    if (typeof s == 'number') {\n      // an hour\n      return s * 60;\n    }\n    if (typeof s == 'object') {\n      // a Date object\n      return s.getHours() * 60 + s.getMinutes();\n    }\n    var m = s.match(/(\\d+)(?::(\\d+))?\\s*(\\w+)?/);\n    if (m) {\n      var h = parseInt(m[1], 10);\n      if (m[3]) {\n        h %= 12;\n        if (m[3].toLowerCase().charAt(0) == 'p') {\n          h += 12;\n        }\n      }\n      return h * 60 + (m[2] ? parseInt(m[2], 10) : 0);\n    }\n  }\n\n  /* Date Formatting\n  -----------------------------------------------------------------------------*/\n  // TODO: use same function formatDate(date, [date2], format, [options])\n\n  function formatDate(date, format, options) {\n    return formatDates(date, null, format, options);\n  }\n  function formatDates(date1, date2, format, options) {\n    options = options || defaults;\n    var date = date1,\n      otherDate = date2,\n      i,\n      len = format.length,\n      c,\n      i2,\n      formatter,\n      res = '';\n    for (i = 0; i < len; i++) {\n      c = format.charAt(i);\n      if (c == \"'\") {\n        for (i2 = i + 1; i2 < len; i2++) {\n          if (format.charAt(i2) == \"'\") {\n            if (date) {\n              if (i2 == i + 1) {\n                res += \"'\";\n              } else {\n                res += format.substring(i + 1, i2);\n              }\n              i = i2;\n            }\n            break;\n          }\n        }\n      } else if (c == '(') {\n        for (i2 = i + 1; i2 < len; i2++) {\n          if (format.charAt(i2) == ')') {\n            var subres = formatDate(date, format.substring(i + 1, i2), options);\n            if (parseInt(subres.replace(/\\D/, ''), 10)) {\n              res += subres;\n            }\n            i = i2;\n            break;\n          }\n        }\n      } else if (c == '[') {\n        for (i2 = i + 1; i2 < len; i2++) {\n          if (format.charAt(i2) == ']') {\n            var subformat = format.substring(i + 1, i2);\n            var subres = formatDate(date, subformat, options);\n            if (subres != formatDate(otherDate, subformat, options)) {\n              res += subres;\n            }\n            i = i2;\n            break;\n          }\n        }\n      } else if (c == '{') {\n        date = date2;\n        otherDate = date1;\n      } else if (c == '}') {\n        date = date1;\n        otherDate = date2;\n      } else {\n        for (i2 = len; i2 > i; i2--) {\n          if (formatter = dateFormatters[format.substring(i, i2)]) {\n            if (date) {\n              res += formatter(date, options);\n            }\n            i = i2 - 1;\n            break;\n          }\n        }\n        if (i2 == i) {\n          if (date) {\n            res += c;\n          }\n        }\n      }\n    }\n    return res;\n  }\n  ;\n  var dateFormatters = {\n    s: function (d) {\n      return d.getSeconds();\n    },\n    ss: function (d) {\n      return zeroPad(d.getSeconds());\n    },\n    m: function (d) {\n      return d.getMinutes();\n    },\n    mm: function (d) {\n      return zeroPad(d.getMinutes());\n    },\n    h: function (d) {\n      return d.getHours() % 12 || 12;\n    },\n    hh: function (d) {\n      return zeroPad(d.getHours() % 12 || 12);\n    },\n    H: function (d) {\n      return d.getHours();\n    },\n    HH: function (d) {\n      return zeroPad(d.getHours());\n    },\n    d: function (d) {\n      return d.getDate();\n    },\n    dd: function (d) {\n      return zeroPad(d.getDate());\n    },\n    ddd: function (d, o) {\n      return o.dayNamesShort[d.getDay()];\n    },\n    dddd: function (d, o) {\n      return o.dayNames[d.getDay()];\n    },\n    M: function (d) {\n      return d.getMonth() + 1;\n    },\n    MM: function (d) {\n      return zeroPad(d.getMonth() + 1);\n    },\n    MMM: function (d, o) {\n      return o.monthNamesShort[d.getMonth()];\n    },\n    MMMM: function (d, o) {\n      return o.monthNames[d.getMonth()];\n    },\n    yy: function (d) {\n      return (d.getFullYear() + '').substring(2);\n    },\n    yyyy: function (d) {\n      return d.getFullYear();\n    },\n    t: function (d) {\n      return d.getHours() < 12 ? 'a' : 'p';\n    },\n    tt: function (d) {\n      return d.getHours() < 12 ? 'am' : 'pm';\n    },\n    T: function (d) {\n      return d.getHours() < 12 ? 'A' : 'P';\n    },\n    TT: function (d) {\n      return d.getHours() < 12 ? 'AM' : 'PM';\n    },\n    u: function (d) {\n      return formatDate(d, \"yyyy-MM-dd'T'HH:mm:ss'Z'\");\n    },\n    S: function (d) {\n      var date = d.getDate();\n      if (date > 10 && date < 20) {\n        return 'th';\n      }\n      return ['st', 'nd', 'rd'][date % 10 - 1] || 'th';\n    },\n    w: function (d, o) {\n      // local\n      return o.weekNumberCalculation(d);\n    },\n    W: function (d) {\n      // ISO\n      return iso8601Week(d);\n    }\n  };\n  fc.dateFormatters = dateFormatters;\n\n  /* thanks jQuery UI (https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js)\n   * \n   * Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.\n   * `date` - the date to get the week for\n   * `number` - the number of the week within the year that contains this date\n   */\n  function iso8601Week(date) {\n    var time;\n    var checkDate = new Date(date.getTime());\n\n    // Find Thursday of this week starting on Monday\n    checkDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));\n    time = checkDate.getTime();\n    checkDate.setMonth(0); // Compare with Jan 1\n    checkDate.setDate(1);\n    return Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;\n  }\n  ;\n  ;\n  fc.applyAll = applyAll;\n\n  /* Event Date Math\n  -----------------------------------------------------------------------------*/\n\n  function exclEndDay(event) {\n    if (event.end) {\n      return _exclEndDay(event.end, event.allDay);\n    } else {\n      return addDays(cloneDate(event.start), 1);\n    }\n  }\n  function _exclEndDay(end, allDay) {\n    end = cloneDate(end);\n    return allDay || end.getHours() || end.getMinutes() ? addDays(end, 1) : clearTime(end);\n    // why don't we check for seconds/ms too?\n  }\n\n  /* Event Element Binding\n  -----------------------------------------------------------------------------*/\n\n  function lazySegBind(container, segs, bindHandlers) {\n    container.unbind('mouseover').mouseover(function (ev) {\n      var parent = ev.target,\n        e,\n        i,\n        seg;\n      while (parent != this) {\n        e = parent;\n        parent = parent.parentNode;\n      }\n      if ((i = e._fci) !== undefined) {\n        e._fci = undefined;\n        seg = segs[i];\n        bindHandlers(seg.event, seg.element, seg);\n        $(ev.target).trigger(ev);\n      }\n      ev.stopPropagation();\n    });\n  }\n\n  /* Element Dimensions\n  -----------------------------------------------------------------------------*/\n\n  function setOuterWidth(element, width, includeMargins) {\n    for (var i = 0, e; i < element.length; i++) {\n      e = $(element[i]);\n      e.width(Math.max(0, width - hsides(e, includeMargins)));\n    }\n  }\n  function setOuterHeight(element, height, includeMargins) {\n    for (var i = 0, e; i < element.length; i++) {\n      e = $(element[i]);\n      e.height(Math.max(0, height - vsides(e, includeMargins)));\n    }\n  }\n  function hsides(element, includeMargins) {\n    return hpadding(element) + hborders(element) + (includeMargins ? hmargins(element) : 0);\n  }\n  function hpadding(element) {\n    return (parseFloat($.css(element[0], 'paddingLeft', true)) || 0) + (parseFloat($.css(element[0], 'paddingRight', true)) || 0);\n  }\n  function hmargins(element) {\n    return (parseFloat($.css(element[0], 'marginLeft', true)) || 0) + (parseFloat($.css(element[0], 'marginRight', true)) || 0);\n  }\n  function hborders(element) {\n    return (parseFloat($.css(element[0], 'borderLeftWidth', true)) || 0) + (parseFloat($.css(element[0], 'borderRightWidth', true)) || 0);\n  }\n  function vsides(element, includeMargins) {\n    return vpadding(element) + vborders(element) + (includeMargins ? vmargins(element) : 0);\n  }\n  function vpadding(element) {\n    return (parseFloat($.css(element[0], 'paddingTop', true)) || 0) + (parseFloat($.css(element[0], 'paddingBottom', true)) || 0);\n  }\n  function vmargins(element) {\n    return (parseFloat($.css(element[0], 'marginTop', true)) || 0) + (parseFloat($.css(element[0], 'marginBottom', true)) || 0);\n  }\n  function vborders(element) {\n    return (parseFloat($.css(element[0], 'borderTopWidth', true)) || 0) + (parseFloat($.css(element[0], 'borderBottomWidth', true)) || 0);\n  }\n\n  /* Misc Utils\n  -----------------------------------------------------------------------------*/\n\n  //TODO: arraySlice\n  //TODO: isFunction, grep ?\n\n  function noop() {}\n  function dateCompare(a, b) {\n    return a - b;\n  }\n  function arrayMax(a) {\n    return Math.max.apply(Math, a);\n  }\n  function zeroPad(n) {\n    return (n < 10 ? '0' : '') + n;\n  }\n  function smartProperty(obj, name) {\n    // get a camel-cased/namespaced property of an object\n    if (obj[name] !== undefined) {\n      return obj[name];\n    }\n    var parts = name.split(/(?=[A-Z])/),\n      i = parts.length - 1,\n      res;\n    for (; i >= 0; i--) {\n      res = obj[parts[i].toLowerCase()];\n      if (res !== undefined) {\n        return res;\n      }\n    }\n    return obj[''];\n  }\n  function htmlEscape(s) {\n    return s.replace(/&/g, '&').replace(/</g, '<').replace(/>/g, '>').replace(/'/g, '\\'').replace(/\"/g, '\"').replace(/\\n/g, '<br />');\n  }\n  function disableTextSelection(element) {\n    element.attr('unselectable', 'on').css('MozUserSelect', 'none').bind('selectstart.ui', function () {\n      return false;\n    });\n  }\n\n  /*\n  function enableTextSelection(element) {\n    element\n      .attr('unselectable', 'off')\n      .css('MozUserSelect', '')\n      .unbind('selectstart.ui');\n  }\n  */\n\n  function markFirstLast(e) {\n    e.children().removeClass('fc-first fc-last').filter(':first-child').addClass('fc-first').end().filter(':last-child').addClass('fc-last');\n  }\n  function setDayID(cell, date) {\n    cell.each(function (i, _cell) {\n      _cell.className = _cell.className.replace(/^fc-\\w*/, 'fc-' + dayIDs[date.getDay()]);\n      // TODO: make a way that doesn't rely on order of classes\n    });\n  }\n\n  function getSkinCss(event, opt) {\n    var source = event.source || {};\n    var eventColor = event.color;\n    var sourceColor = source.color;\n    var optionColor = opt('eventColor');\n    var backgroundColor = event.backgroundColor || eventColor || source.backgroundColor || sourceColor || opt('eventBackgroundColor') || optionColor;\n    var borderColor = event.borderColor || eventColor || source.borderColor || sourceColor || opt('eventBorderColor') || optionColor;\n    var textColor = event.textColor || source.textColor || opt('eventTextColor');\n    var statements = [];\n    if (backgroundColor) {\n      statements.push('background-color:' + backgroundColor);\n    }\n    if (borderColor) {\n      statements.push('border-color:' + borderColor);\n    }\n    if (textColor) {\n      statements.push('color:' + textColor);\n    }\n    return statements.join(';');\n  }\n  function applyAll(functions, thisObj, args) {\n    if ($.isFunction(functions)) {\n      functions = [functions];\n    }\n    if (functions) {\n      var i;\n      var ret;\n      for (i = 0; i < functions.length; i++) {\n        ret = functions[i].apply(thisObj, args) || ret;\n      }\n      return ret;\n    }\n  }\n  function firstDefined() {\n    for (var i = 0; i < arguments.length; i++) {\n      if (arguments[i] !== undefined) {\n        return arguments[i];\n      }\n    }\n  }\n  ;\n  ;\n  fcViews.month = MonthView;\n  function MonthView(element, calendar) {\n    var t = this;\n\n    // exports\n    t.render = render;\n\n    // imports\n    BasicView.call(t, element, calendar, 'month');\n    var opt = t.opt;\n    var renderBasic = t.renderBasic;\n    var skipHiddenDays = t.skipHiddenDays;\n    var getCellsPerWeek = t.getCellsPerWeek;\n    var formatDate = calendar.formatDate;\n    function render(date, delta) {\n      if (delta) {\n        addMonths(date, delta);\n        date.setDate(1);\n      }\n      var firstDay = opt('firstDay');\n      var start = cloneDate(date, true);\n      start.setDate(1);\n      var end = addMonths(cloneDate(start), 1);\n      var visStart = cloneDate(start);\n      addDays(visStart, -((visStart.getDay() - firstDay + 7) % 7));\n      skipHiddenDays(visStart);\n      var visEnd = cloneDate(end);\n      addDays(visEnd, (7 - visEnd.getDay() + firstDay) % 7);\n      skipHiddenDays(visEnd, -1, true);\n      var colCnt = getCellsPerWeek();\n      var rowCnt = Math.round(dayDiff(visEnd, visStart) / 7); // should be no need for Math.round\n\n      if (opt('weekMode') == 'fixed') {\n        addDays(visEnd, (6 - rowCnt) * 7); // add weeks to make up for it\n        rowCnt = 6;\n      }\n      t.title = formatDate(start, opt('titleFormat'));\n      t.start = start;\n      t.end = end;\n      t.visStart = visStart;\n      t.visEnd = visEnd;\n      renderBasic(rowCnt, colCnt, true);\n    }\n  }\n  ;\n  ;\n  fcViews.basicWeek = BasicWeekView;\n  function BasicWeekView(element, calendar) {\n    var t = this;\n\n    // exports\n    t.render = render;\n\n    // imports\n    BasicView.call(t, element, calendar, 'basicWeek');\n    var opt = t.opt;\n    var renderBasic = t.renderBasic;\n    var skipHiddenDays = t.skipHiddenDays;\n    var getCellsPerWeek = t.getCellsPerWeek;\n    var formatDates = calendar.formatDates;\n    function render(date, delta) {\n      if (delta) {\n        addDays(date, delta * 7);\n      }\n      var start = addDays(cloneDate(date), -((date.getDay() - opt('firstDay') + 7) % 7));\n      var end = addDays(cloneDate(start), 7);\n      var visStart = cloneDate(start);\n      skipHiddenDays(visStart);\n      var visEnd = cloneDate(end);\n      skipHiddenDays(visEnd, -1, true);\n      var colCnt = getCellsPerWeek();\n      t.start = start;\n      t.end = end;\n      t.visStart = visStart;\n      t.visEnd = visEnd;\n      t.title = formatDates(visStart, addDays(cloneDate(visEnd), -1), opt('titleFormat'));\n      renderBasic(1, colCnt, false);\n    }\n  }\n  ;\n  ;\n  fcViews.basicDay = BasicDayView;\n  function BasicDayView(element, calendar) {\n    var t = this;\n\n    // exports\n    t.render = render;\n\n    // imports\n    BasicView.call(t, element, calendar, 'basicDay');\n    var opt = t.opt;\n    var renderBasic = t.renderBasic;\n    var skipHiddenDays = t.skipHiddenDays;\n    var formatDate = calendar.formatDate;\n    function render(date, delta) {\n      if (delta) {\n        addDays(date, delta);\n      }\n      skipHiddenDays(date, delta < 0 ? -1 : 1);\n      var start = cloneDate(date, true);\n      var end = addDays(cloneDate(start), 1);\n      t.title = formatDate(date, opt('titleFormat'));\n      t.start = t.visStart = start;\n      t.end = t.visEnd = end;\n      renderBasic(1, 1, false);\n    }\n  }\n  ;\n  ;\n  setDefaults({\n    weekMode: 'fixed'\n  });\n  function BasicView(element, calendar, viewName) {\n    var t = this;\n\n    // exports\n    t.renderBasic = renderBasic;\n    t.setHeight = setHeight;\n    t.setWidth = setWidth;\n    t.renderDayOverlay = renderDayOverlay;\n    t.defaultSelectionEnd = defaultSelectionEnd;\n    t.renderSelection = renderSelection;\n    t.clearSelection = clearSelection;\n    t.reportDayClick = reportDayClick; // for selection (kinda hacky)\n    t.dragStart = dragStart;\n    t.dragStop = dragStop;\n    t.defaultEventEnd = defaultEventEnd;\n    t.getHoverListener = function () {\n      return hoverListener;\n    };\n    t.colLeft = colLeft;\n    t.colRight = colRight;\n    t.colContentLeft = colContentLeft;\n    t.colContentRight = colContentRight;\n    t.getIsCellAllDay = function () {\n      return true;\n    };\n    t.allDayRow = allDayRow;\n    t.getRowCnt = function () {\n      return rowCnt;\n    };\n    t.getColCnt = function () {\n      return colCnt;\n    };\n    t.getColWidth = function () {\n      return colWidth;\n    };\n    t.getDaySegmentContainer = function () {\n      return daySegmentContainer;\n    };\n\n    // imports\n    View.call(t, element, calendar, viewName);\n    OverlayManager.call(t);\n    SelectionManager.call(t);\n    BasicEventRenderer.call(t);\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var renderOverlay = t.renderOverlay;\n    var clearOverlays = t.clearOverlays;\n    var daySelectionMousedown = t.daySelectionMousedown;\n    var cellToDate = t.cellToDate;\n    var dateToCell = t.dateToCell;\n    var rangeToSegments = t.rangeToSegments;\n    var formatDate = calendar.formatDate;\n\n    // locals\n\n    var table;\n    var head;\n    var headCells;\n    var body;\n    var bodyRows;\n    var bodyCells;\n    var bodyFirstCells;\n    var firstRowCellInners;\n    var firstRowCellContentInners;\n    var daySegmentContainer;\n    var viewWidth;\n    var viewHeight;\n    var colWidth;\n    var weekNumberWidth;\n    var rowCnt, colCnt;\n    var showNumbers;\n    var coordinateGrid;\n    var hoverListener;\n    var colPositions;\n    var colContentPositions;\n    var tm;\n    var colFormat;\n    var showWeekNumbers;\n    var weekNumberTitle;\n    var weekNumberFormat;\n\n    /* Rendering\n    ------------------------------------------------------------*/\n\n    disableTextSelection(element.addClass('fc-grid'));\n    function renderBasic(_rowCnt, _colCnt, _showNumbers) {\n      rowCnt = _rowCnt;\n      colCnt = _colCnt;\n      showNumbers = _showNumbers;\n      updateOptions();\n      if (!body) {\n        buildEventContainer();\n      }\n      buildTable();\n    }\n    function updateOptions() {\n      tm = opt('theme') ? 'ui' : 'fc';\n      colFormat = opt('columnFormat');\n\n      // week # options. (TODO: bad, logic also in other views)\n      showWeekNumbers = opt('weekNumbers');\n      weekNumberTitle = opt('weekNumberTitle');\n      if (opt('weekNumberCalculation') != 'iso') {\n        weekNumberFormat = \"w\";\n      } else {\n        weekNumberFormat = \"W\";\n      }\n    }\n    function buildEventContainer() {\n      daySegmentContainer = $(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\").appendTo(element);\n    }\n    function buildTable() {\n      var html = buildTableHTML();\n      if (table) {\n        table.remove();\n      }\n      table = $(html).appendTo(element);\n      head = table.find('thead');\n      headCells = head.find('.fc-day-header');\n      body = table.find('tbody');\n      bodyRows = body.find('tr');\n      bodyCells = body.find('.fc-day');\n      bodyFirstCells = bodyRows.find('td:first-child');\n      firstRowCellInners = bodyRows.eq(0).find('.fc-day > div');\n      firstRowCellContentInners = bodyRows.eq(0).find('.fc-day-content > div');\n      markFirstLast(head.add(head.find('tr'))); // marks first+last tr/th's\n      markFirstLast(bodyRows); // marks first+last td's\n      bodyRows.eq(0).addClass('fc-first');\n      bodyRows.filter(':last').addClass('fc-last');\n      bodyCells.each(function (i, _cell) {\n        var date = cellToDate(Math.floor(i / colCnt), i % colCnt);\n        trigger('dayRender', t, date, $(_cell));\n      });\n      dayBind(bodyCells);\n    }\n\n    /* HTML Building\n    -----------------------------------------------------------*/\n\n    function buildTableHTML() {\n      var html = \"<table class='fc-border-separate' style='width:100%' cellspacing='0'>\" + buildHeadHTML() + buildBodyHTML() + \"</table>\";\n      return html;\n    }\n    function buildHeadHTML() {\n      var headerClass = tm + \"-widget-header\";\n      var html = '';\n      var col;\n      var date;\n      html += \"<thead><tr>\";\n      if (showWeekNumbers) {\n        html += \"<th class='fc-week-number \" + headerClass + \"'>\" + htmlEscape(weekNumberTitle) + \"</th>\";\n      }\n      for (col = 0; col < colCnt; col++) {\n        date = cellToDate(0, col);\n        html += \"<th class='fc-day-header fc-\" + dayIDs[date.getDay()] + \" \" + headerClass + \"'>\" + htmlEscape(formatDate(date, colFormat)) + \"</th>\";\n      }\n      html += \"</tr></thead>\";\n      return html;\n    }\n    function buildBodyHTML() {\n      var contentClass = tm + \"-widget-content\";\n      var html = '';\n      var row;\n      var col;\n      var date;\n      html += \"<tbody>\";\n      for (row = 0; row < rowCnt; row++) {\n        html += \"<tr class='fc-week'>\";\n        if (showWeekNumbers) {\n          date = cellToDate(row, 0);\n          html += \"<td class='fc-week-number \" + contentClass + \"'>\" + \"<div>\" + htmlEscape(formatDate(date, weekNumberFormat)) + \"</div>\" + \"</td>\";\n        }\n        for (col = 0; col < colCnt; col++) {\n          date = cellToDate(row, col);\n          html += buildCellHTML(date);\n        }\n        html += \"</tr>\";\n      }\n      html += \"</tbody>\";\n      return html;\n    }\n    function buildCellHTML(date) {\n      var contentClass = tm + \"-widget-content\";\n      var month = t.start.getMonth();\n      var today = clearTime(new Date());\n      var html = '';\n      var classNames = ['fc-day', 'fc-' + dayIDs[date.getDay()], contentClass];\n      if (date.getMonth() != month) {\n        classNames.push('fc-other-month');\n      }\n      if (+date == +today) {\n        classNames.push('fc-today', tm + '-state-highlight');\n      } else if (date < today) {\n        classNames.push('fc-past');\n      } else {\n        classNames.push('fc-future');\n      }\n      html += \"<td\" + \" class='\" + classNames.join(' ') + \"'\" + \" data-date='\" + formatDate(date, 'yyyy-MM-dd') + \"'\" + \">\" + \"<div>\";\n      if (showNumbers) {\n        html += \"<div class='fc-day-number'>\" + date.getDate() + \"</div>\";\n      }\n      html += \"<div class='fc-day-content'>\" + \"<div style='position:relative'>Â </div>\" + \"</div>\" + \"</div>\" + \"</td>\";\n      return html;\n    }\n\n    /* Dimensions\n    -----------------------------------------------------------*/\n\n    function setHeight(height) {\n      viewHeight = height;\n      var bodyHeight = viewHeight - head.height();\n      var rowHeight;\n      var rowHeightLast;\n      var cell;\n      if (opt('weekMode') == 'variable') {\n        rowHeight = rowHeightLast = Math.floor(bodyHeight / (rowCnt == 1 ? 2 : 6));\n      } else {\n        rowHeight = Math.floor(bodyHeight / rowCnt);\n        rowHeightLast = bodyHeight - rowHeight * (rowCnt - 1);\n      }\n      bodyFirstCells.each(function (i, _cell) {\n        if (i < rowCnt) {\n          cell = $(_cell);\n          cell.find('> div').css('min-height', (i == rowCnt - 1 ? rowHeightLast : rowHeight) - vsides(cell));\n        }\n      });\n    }\n    function setWidth(width) {\n      viewWidth = width;\n      colPositions.clear();\n      colContentPositions.clear();\n      weekNumberWidth = 0;\n      if (showWeekNumbers) {\n        weekNumberWidth = head.find('th.fc-week-number').outerWidth();\n      }\n      colWidth = Math.floor((viewWidth - weekNumberWidth) / colCnt);\n      setOuterWidth(headCells.slice(0, -1), colWidth);\n    }\n\n    /* Day clicking and binding\n    -----------------------------------------------------------*/\n\n    function dayBind(days) {\n      days.click(dayClick).mousedown(daySelectionMousedown);\n    }\n    function dayClick(ev) {\n      if (!opt('selectable')) {\n        // if selectable, SelectionManager will worry about dayClick\n        var date = parseISO8601($(this).data('date'));\n        trigger('dayClick', this, date, true, ev);\n      }\n    }\n\n    /* Semi-transparent Overlay Helpers\n    ------------------------------------------------------*/\n    // TODO: should be consolidated with AgendaView's methods\n\n    function renderDayOverlay(overlayStart, overlayEnd, refreshCoordinateGrid) {\n      // overlayEnd is exclusive\n\n      if (refreshCoordinateGrid) {\n        coordinateGrid.build();\n      }\n      var segments = rangeToSegments(overlayStart, overlayEnd);\n      for (var i = 0; i < segments.length; i++) {\n        var segment = segments[i];\n        dayBind(renderCellOverlay(segment.row, segment.leftCol, segment.row, segment.rightCol));\n      }\n    }\n    function renderCellOverlay(row0, col0, row1, col1) {\n      // row1,col1 is inclusive\n      var rect = coordinateGrid.rect(row0, col0, row1, col1, element);\n      return renderOverlay(rect, element);\n    }\n\n    /* Selection\n    -----------------------------------------------------------------------*/\n\n    function defaultSelectionEnd(startDate, allDay) {\n      return cloneDate(startDate);\n    }\n    function renderSelection(startDate, endDate, allDay) {\n      renderDayOverlay(startDate, addDays(cloneDate(endDate), 1), true); // rebuild every time???\n    }\n\n    function clearSelection() {\n      clearOverlays();\n    }\n    function reportDayClick(date, allDay, ev) {\n      var cell = dateToCell(date);\n      var _element = bodyCells[cell.row * colCnt + cell.col];\n      trigger('dayClick', _element, date, allDay, ev);\n    }\n\n    /* External Dragging\n    -----------------------------------------------------------------------*/\n\n    function dragStart(_dragElement, ev, ui) {\n      hoverListener.start(function (cell) {\n        clearOverlays();\n        if (cell) {\n          renderCellOverlay(cell.row, cell.col, cell.row, cell.col);\n        }\n      }, ev);\n    }\n    function dragStop(_dragElement, ev, ui) {\n      var cell = hoverListener.stop();\n      clearOverlays();\n      if (cell) {\n        var d = cellToDate(cell);\n        trigger('drop', _dragElement, d, true, ev, ui);\n      }\n    }\n\n    /* Utilities\n    --------------------------------------------------------*/\n\n    function defaultEventEnd(event) {\n      return cloneDate(event.start);\n    }\n    coordinateGrid = new CoordinateGrid(function (rows, cols) {\n      var e, n, p;\n      headCells.each(function (i, _e) {\n        e = $(_e);\n        n = e.offset().left;\n        if (i) {\n          p[1] = n;\n        }\n        p = [n];\n        cols[i] = p;\n      });\n      p[1] = n + e.outerWidth();\n      bodyRows.each(function (i, _e) {\n        if (i < rowCnt) {\n          e = $(_e);\n          n = e.offset().top;\n          if (i) {\n            p[1] = n;\n          }\n          p = [n];\n          rows[i] = p;\n        }\n      });\n      p[1] = n + e.outerHeight();\n    });\n    hoverListener = new HoverListener(coordinateGrid);\n    colPositions = new HorizontalPositionCache(function (col) {\n      return firstRowCellInners.eq(col);\n    });\n    colContentPositions = new HorizontalPositionCache(function (col) {\n      return firstRowCellContentInners.eq(col);\n    });\n    function colLeft(col) {\n      return colPositions.left(col);\n    }\n    function colRight(col) {\n      return colPositions.right(col);\n    }\n    function colContentLeft(col) {\n      return colContentPositions.left(col);\n    }\n    function colContentRight(col) {\n      return colContentPositions.right(col);\n    }\n    function allDayRow(i) {\n      return bodyRows.eq(i);\n    }\n  }\n  ;\n  ;\n  function BasicEventRenderer() {\n    var t = this;\n\n    // exports\n    t.renderEvents = renderEvents;\n    t.clearEvents = clearEvents;\n\n    // imports\n    DayEventRenderer.call(t);\n    function renderEvents(events, modifiedEventId) {\n      t.renderDayEvents(events, modifiedEventId);\n    }\n    function clearEvents() {\n      t.getDaySegmentContainer().empty();\n    }\n\n    // TODO: have this class (and AgendaEventRenderer) be responsible for creating the event container div\n  }\n\n  ;\n  ;\n  fcViews.agendaWeek = AgendaWeekView;\n  function AgendaWeekView(element, calendar) {\n    var t = this;\n\n    // exports\n    t.render = render;\n\n    // imports\n    AgendaView.call(t, element, calendar, 'agendaWeek');\n    var opt = t.opt;\n    var renderAgenda = t.renderAgenda;\n    var skipHiddenDays = t.skipHiddenDays;\n    var getCellsPerWeek = t.getCellsPerWeek;\n    var formatDates = calendar.formatDates;\n    function render(date, delta) {\n      if (delta) {\n        addDays(date, delta * 7);\n      }\n      var start = addDays(cloneDate(date), -((date.getDay() - opt('firstDay') + 7) % 7));\n      var end = addDays(cloneDate(start), 7);\n      var visStart = cloneDate(start);\n      skipHiddenDays(visStart);\n      var visEnd = cloneDate(end);\n      skipHiddenDays(visEnd, -1, true);\n      var colCnt = getCellsPerWeek();\n      t.title = formatDates(visStart, addDays(cloneDate(visEnd), -1), opt('titleFormat'));\n      t.start = start;\n      t.end = end;\n      t.visStart = visStart;\n      t.visEnd = visEnd;\n      renderAgenda(colCnt);\n    }\n  }\n  ;\n  ;\n  fcViews.agendaDay = AgendaDayView;\n  function AgendaDayView(element, calendar) {\n    var t = this;\n\n    // exports\n    t.render = render;\n\n    // imports\n    AgendaView.call(t, element, calendar, 'agendaDay');\n    var opt = t.opt;\n    var renderAgenda = t.renderAgenda;\n    var skipHiddenDays = t.skipHiddenDays;\n    var formatDate = calendar.formatDate;\n    function render(date, delta) {\n      if (delta) {\n        addDays(date, delta);\n      }\n      skipHiddenDays(date, delta < 0 ? -1 : 1);\n      var start = cloneDate(date, true);\n      var end = addDays(cloneDate(start), 1);\n      t.title = formatDate(date, opt('titleFormat'));\n      t.start = t.visStart = start;\n      t.end = t.visEnd = end;\n      renderAgenda(1);\n    }\n  }\n  ;\n  ;\n  setDefaults({\n    allDaySlot: true,\n    allDayText: 'all-day',\n    firstHour: 6,\n    slotMinutes: 30,\n    defaultEventMinutes: 120,\n    axisFormat: 'h(:mm)tt',\n    timeFormat: {\n      agenda: 'h:mm{ - h:mm}'\n    },\n    dragOpacity: {\n      agenda: .5\n    },\n    minTime: 0,\n    maxTime: 24,\n    slotEventOverlap: true\n  });\n\n  // TODO: make it work in quirks mode (event corners, all-day height)\n  // TODO: test liquid width, especially in IE6\n\n  function AgendaView(element, calendar, viewName) {\n    var t = this;\n\n    // exports\n    t.renderAgenda = renderAgenda;\n    t.setWidth = setWidth;\n    t.setHeight = setHeight;\n    t.afterRender = afterRender;\n    t.defaultEventEnd = defaultEventEnd;\n    t.timePosition = timePosition;\n    t.getIsCellAllDay = getIsCellAllDay;\n    t.allDayRow = getAllDayRow;\n    t.getCoordinateGrid = function () {\n      return coordinateGrid;\n    }; // specifically for AgendaEventRenderer\n    t.getHoverListener = function () {\n      return hoverListener;\n    };\n    t.colLeft = colLeft;\n    t.colRight = colRight;\n    t.colContentLeft = colContentLeft;\n    t.colContentRight = colContentRight;\n    t.getDaySegmentContainer = function () {\n      return daySegmentContainer;\n    };\n    t.getSlotSegmentContainer = function () {\n      return slotSegmentContainer;\n    };\n    t.getMinMinute = function () {\n      return minMinute;\n    };\n    t.getMaxMinute = function () {\n      return maxMinute;\n    };\n    t.getSlotContainer = function () {\n      return slotContainer;\n    };\n    t.getRowCnt = function () {\n      return 1;\n    };\n    t.getColCnt = function () {\n      return colCnt;\n    };\n    t.getColWidth = function () {\n      return colWidth;\n    };\n    t.getSnapHeight = function () {\n      return snapHeight;\n    };\n    t.getSnapMinutes = function () {\n      return snapMinutes;\n    };\n    t.defaultSelectionEnd = defaultSelectionEnd;\n    t.renderDayOverlay = renderDayOverlay;\n    t.renderSelection = renderSelection;\n    t.clearSelection = clearSelection;\n    t.reportDayClick = reportDayClick; // selection mousedown hack\n    t.dragStart = dragStart;\n    t.dragStop = dragStop;\n\n    // imports\n    View.call(t, element, calendar, viewName);\n    OverlayManager.call(t);\n    SelectionManager.call(t);\n    AgendaEventRenderer.call(t);\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var renderOverlay = t.renderOverlay;\n    var clearOverlays = t.clearOverlays;\n    var reportSelection = t.reportSelection;\n    var unselect = t.unselect;\n    var daySelectionMousedown = t.daySelectionMousedown;\n    var slotSegHtml = t.slotSegHtml;\n    var cellToDate = t.cellToDate;\n    var dateToCell = t.dateToCell;\n    var rangeToSegments = t.rangeToSegments;\n    var formatDate = calendar.formatDate;\n\n    // locals\n\n    var dayTable;\n    var dayHead;\n    var dayHeadCells;\n    var dayBody;\n    var dayBodyCells;\n    var dayBodyCellInners;\n    var dayBodyCellContentInners;\n    var dayBodyFirstCell;\n    var dayBodyFirstCellStretcher;\n    var slotLayer;\n    var daySegmentContainer;\n    var allDayTable;\n    var allDayRow;\n    var slotScroller;\n    var slotContainer;\n    var slotSegmentContainer;\n    var slotTable;\n    var selectionHelper;\n    var viewWidth;\n    var viewHeight;\n    var axisWidth;\n    var colWidth;\n    var gutterWidth;\n    var slotHeight; // TODO: what if slotHeight changes? (see issue 650)\n\n    var snapMinutes;\n    var snapRatio; // ratio of number of \"selection\" slots to normal slots. (ex: 1, 2, 4)\n    var snapHeight; // holds the pixel hight of a \"selection\" slot\n\n    var colCnt;\n    var slotCnt;\n    var coordinateGrid;\n    var hoverListener;\n    var colPositions;\n    var colContentPositions;\n    var slotTopCache = {};\n    var tm;\n    var rtl;\n    var minMinute, maxMinute;\n    var colFormat;\n    var showWeekNumbers;\n    var weekNumberTitle;\n    var weekNumberFormat;\n\n    /* Rendering\n    -----------------------------------------------------------------------------*/\n\n    disableTextSelection(element.addClass('fc-agenda'));\n    function renderAgenda(c) {\n      colCnt = c;\n      updateOptions();\n      if (!dayTable) {\n        // first time rendering?\n        buildSkeleton(); // builds day table, slot area, events containers\n      } else {\n        buildDayTable(); // rebuilds day table\n      }\n    }\n\n    function updateOptions() {\n      tm = opt('theme') ? 'ui' : 'fc';\n      rtl = opt('isRTL');\n      minMinute = parseTime(opt('minTime'));\n      maxMinute = parseTime(opt('maxTime'));\n      colFormat = opt('columnFormat');\n\n      // week # options. (TODO: bad, logic also in other views)\n      showWeekNumbers = opt('weekNumbers');\n      weekNumberTitle = opt('weekNumberTitle');\n      if (opt('weekNumberCalculation') != 'iso') {\n        weekNumberFormat = \"w\";\n      } else {\n        weekNumberFormat = \"W\";\n      }\n      snapMinutes = opt('snapMinutes') || opt('slotMinutes');\n    }\n\n    /* Build DOM\n    -----------------------------------------------------------------------*/\n\n    function buildSkeleton() {\n      var headerClass = tm + \"-widget-header\";\n      var contentClass = tm + \"-widget-content\";\n      var s;\n      var d;\n      var i;\n      var maxd;\n      var minutes;\n      var slotNormal = opt('slotMinutes') % 15 == 0;\n      buildDayTable();\n      slotLayer = $(\"<div style='position:absolute;z-index:2;left:0;width:100%'/>\").appendTo(element);\n      if (opt('allDaySlot')) {\n        daySegmentContainer = $(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\").appendTo(slotLayer);\n        s = \"<table style='width:100%' class='fc-agenda-allday' cellspacing='0'>\" + \"<tr>\" + \"<th class='\" + headerClass + \" fc-agenda-axis'>\" + opt('allDayText') + \"</th>\" + \"<td>\" + \"<div class='fc-day-content'><div style='position:relative'/></div>\" + \"</td>\" + \"<th class='\" + headerClass + \" fc-agenda-gutter'>Â </th>\" + \"</tr>\" + \"</table>\";\n        allDayTable = $(s).appendTo(slotLayer);\n        allDayRow = allDayTable.find('tr');\n        dayBind(allDayRow.find('td'));\n        slotLayer.append(\"<div class='fc-agenda-divider \" + headerClass + \"'>\" + \"<div class='fc-agenda-divider-inner'/>\" + \"</div>\");\n      } else {\n        daySegmentContainer = $([]); // in jQuery 1.4, we can just do $()\n      }\n\n      slotScroller = $(\"<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>\").appendTo(slotLayer);\n      slotContainer = $(\"<div style='position:relative;width:100%;overflow:hidden'/>\").appendTo(slotScroller);\n      slotSegmentContainer = $(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\").appendTo(slotContainer);\n      s = \"<table class='fc-agenda-slots' style='width:100%' cellspacing='0'>\" + \"<tbody>\";\n      d = zeroDate();\n      maxd = addMinutes(cloneDate(d), maxMinute);\n      addMinutes(d, minMinute);\n      slotCnt = 0;\n      for (i = 0; d < maxd; i++) {\n        minutes = d.getMinutes();\n        s += \"<tr class='fc-slot\" + i + ' ' + (!minutes ? '' : 'fc-minor') + \"'>\" + \"<th class='fc-agenda-axis \" + headerClass + \"'>\" + (!slotNormal || !minutes ? formatDate(d, opt('axisFormat')) : 'Â ') + \"</th>\" + \"<td class='\" + contentClass + \"'>\" + \"<div style='position:relative'>Â </div>\" + \"</td>\" + \"</tr>\";\n        addMinutes(d, opt('slotMinutes'));\n        slotCnt++;\n      }\n      s += \"</tbody>\" + \"</table>\";\n      slotTable = $(s).appendTo(slotContainer);\n      slotBind(slotTable.find('td'));\n    }\n\n    /* Build Day Table\n    -----------------------------------------------------------------------*/\n\n    function buildDayTable() {\n      var html = buildDayTableHTML();\n      if (dayTable) {\n        dayTable.remove();\n      }\n      dayTable = $(html).appendTo(element);\n      dayHead = dayTable.find('thead');\n      dayHeadCells = dayHead.find('th').slice(1, -1); // exclude gutter\n      dayBody = dayTable.find('tbody');\n      dayBodyCells = dayBody.find('td').slice(0, -1); // exclude gutter\n      dayBodyCellInners = dayBodyCells.find('> div');\n      dayBodyCellContentInners = dayBodyCells.find('.fc-day-content > div');\n      dayBodyFirstCell = dayBodyCells.eq(0);\n      dayBodyFirstCellStretcher = dayBodyCellInners.eq(0);\n      markFirstLast(dayHead.add(dayHead.find('tr')));\n      markFirstLast(dayBody.add(dayBody.find('tr')));\n\n      // TODO: now that we rebuild the cells every time, we should call dayRender\n    }\n\n    function buildDayTableHTML() {\n      var html = \"<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>\" + buildDayTableHeadHTML() + buildDayTableBodyHTML() + \"</table>\";\n      return html;\n    }\n    function buildDayTableHeadHTML() {\n      var headerClass = tm + \"-widget-header\";\n      var date;\n      var html = '';\n      var weekText;\n      var col;\n      html += \"<thead>\" + \"<tr>\";\n      if (showWeekNumbers) {\n        date = cellToDate(0, 0);\n        weekText = formatDate(date, weekNumberFormat);\n        if (rtl) {\n          weekText += weekNumberTitle;\n        } else {\n          weekText = weekNumberTitle + weekText;\n        }\n        html += \"<th class='fc-agenda-axis fc-week-number \" + headerClass + \"'>\" + htmlEscape(weekText) + \"</th>\";\n      } else {\n        html += \"<th class='fc-agenda-axis \" + headerClass + \"'>Â </th>\";\n      }\n      for (col = 0; col < colCnt; col++) {\n        date = cellToDate(0, col);\n        html += \"<th class='fc-\" + dayIDs[date.getDay()] + \" fc-col\" + col + ' ' + headerClass + \"'>\" + htmlEscape(formatDate(date, colFormat)) + \"</th>\";\n      }\n      html += \"<th class='fc-agenda-gutter \" + headerClass + \"'>Â </th>\" + \"</tr>\" + \"</thead>\";\n      return html;\n    }\n    function buildDayTableBodyHTML() {\n      var headerClass = tm + \"-widget-header\"; // TODO: make these when updateOptions() called\n      var contentClass = tm + \"-widget-content\";\n      var date;\n      var today = clearTime(new Date());\n      var col;\n      var cellsHTML;\n      var cellHTML;\n      var classNames;\n      var html = '';\n      html += \"<tbody>\" + \"<tr>\" + \"<th class='fc-agenda-axis \" + headerClass + \"'>Â </th>\";\n      cellsHTML = '';\n      for (col = 0; col < colCnt; col++) {\n        date = cellToDate(0, col);\n        classNames = ['fc-col' + col, 'fc-' + dayIDs[date.getDay()], contentClass];\n        if (+date == +today) {\n          classNames.push(tm + '-state-highlight', 'fc-today');\n        } else if (date < today) {\n          classNames.push('fc-past');\n        } else {\n          classNames.push('fc-future');\n        }\n        cellHTML = \"<td class='\" + classNames.join(' ') + \"'>\" + \"<div>\" + \"<div class='fc-day-content'>\" + \"<div style='position:relative'>Â </div>\" + \"</div>\" + \"</div>\" + \"</td>\";\n        cellsHTML += cellHTML;\n      }\n      html += cellsHTML;\n      html += \"<td class='fc-agenda-gutter \" + contentClass + \"'>Â </td>\" + \"</tr>\" + \"</tbody>\";\n      return html;\n    }\n\n    // TODO: data-date on the cells\n\n    /* Dimensions\n    -----------------------------------------------------------------------*/\n\n    function setHeight(height) {\n      if (height === undefined) {\n        height = viewHeight;\n      }\n      viewHeight = height;\n      slotTopCache = {};\n      var headHeight = dayBody.position().top;\n      var allDayHeight = slotScroller.position().top; // including divider\n      var bodyHeight = Math.min(\n      // total body height, including borders\n      height - headHeight,\n      // when scrollbars\n      slotTable.height() + allDayHeight + 1 // when no scrollbars. +1 for bottom border\n      );\n\n      dayBodyFirstCellStretcher.height(bodyHeight - vsides(dayBodyFirstCell));\n      slotLayer.css('top', headHeight);\n      slotScroller.height(bodyHeight - allDayHeight - 1);\n\n      // the stylesheet guarantees that the first row has no border.\n      // this allows .height() to work well cross-browser.\n      slotHeight = slotTable.find('tr:first').height() + 1; // +1 for bottom border\n\n      snapRatio = opt('slotMinutes') / snapMinutes;\n      snapHeight = slotHeight / snapRatio;\n    }\n    function setWidth(width) {\n      viewWidth = width;\n      colPositions.clear();\n      colContentPositions.clear();\n      var axisFirstCells = dayHead.find('th:first');\n      if (allDayTable) {\n        axisFirstCells = axisFirstCells.add(allDayTable.find('th:first'));\n      }\n      axisFirstCells = axisFirstCells.add(slotTable.find('th:first'));\n      axisWidth = 0;\n      setOuterWidth(axisFirstCells.width('').each(function (i, _cell) {\n        axisWidth = Math.max(axisWidth, $(_cell).outerWidth());\n      }), axisWidth);\n      var gutterCells = dayTable.find('.fc-agenda-gutter');\n      if (allDayTable) {\n        gutterCells = gutterCells.add(allDayTable.find('th.fc-agenda-gutter'));\n      }\n      var slotTableWidth = slotScroller[0].clientWidth; // needs to be done after axisWidth (for IE7)\n\n      gutterWidth = slotScroller.width() - slotTableWidth;\n      if (gutterWidth) {\n        setOuterWidth(gutterCells, gutterWidth);\n        gutterCells.show().prev().removeClass('fc-last');\n      } else {\n        gutterCells.hide().prev().addClass('fc-last');\n      }\n      colWidth = Math.floor((slotTableWidth - axisWidth) / colCnt);\n      setOuterWidth(dayHeadCells.slice(0, -1), colWidth);\n    }\n\n    /* Scrolling\n    -----------------------------------------------------------------------*/\n\n    function resetScroll() {\n      var d0 = zeroDate();\n      var scrollDate = cloneDate(d0);\n      scrollDate.setHours(opt('firstHour'));\n      var top = timePosition(d0, scrollDate) + 1; // +1 for the border\n      function scroll() {\n        slotScroller.scrollTop(top);\n      }\n      scroll();\n      setTimeout(scroll, 0); // overrides any previous scroll state made by the browser\n    }\n\n    function afterRender() {\n      // after the view has been freshly rendered and sized\n      resetScroll();\n    }\n\n    /* Slot/Day clicking and binding\n    -----------------------------------------------------------------------*/\n\n    function dayBind(cells) {\n      cells.click(slotClick).mousedown(daySelectionMousedown);\n    }\n    function slotBind(cells) {\n      cells.click(slotClick).mousedown(slotSelectionMousedown);\n    }\n    function slotClick(ev) {\n      if (!opt('selectable')) {\n        // if selectable, SelectionManager will worry about dayClick\n        var col = Math.min(colCnt - 1, Math.floor((ev.pageX - dayTable.offset().left - axisWidth) / colWidth));\n        var date = cellToDate(0, col);\n        var rowMatch = this.parentNode.className.match(/fc-slot(\\d+)/); // TODO: maybe use data\n        if (rowMatch) {\n          var mins = parseInt(rowMatch[1]) * opt('slotMinutes');\n          var hours = Math.floor(mins / 60);\n          date.setHours(hours);\n          date.setMinutes(mins % 60 + minMinute);\n          trigger('dayClick', dayBodyCells[col], date, false, ev);\n        } else {\n          trigger('dayClick', dayBodyCells[col], date, true, ev);\n        }\n      }\n    }\n\n    /* Semi-transparent Overlay Helpers\n    -----------------------------------------------------*/\n    // TODO: should be consolidated with BasicView's methods\n\n    function renderDayOverlay(overlayStart, overlayEnd, refreshCoordinateGrid) {\n      // overlayEnd is exclusive\n\n      if (refreshCoordinateGrid) {\n        coordinateGrid.build();\n      }\n      var segments = rangeToSegments(overlayStart, overlayEnd);\n      for (var i = 0; i < segments.length; i++) {\n        var segment = segments[i];\n        dayBind(renderCellOverlay(segment.row, segment.leftCol, segment.row, segment.rightCol));\n      }\n    }\n    function renderCellOverlay(row0, col0, row1, col1) {\n      // only for all-day?\n      var rect = coordinateGrid.rect(row0, col0, row1, col1, slotLayer);\n      return renderOverlay(rect, slotLayer);\n    }\n    function renderSlotOverlay(overlayStart, overlayEnd) {\n      for (var i = 0; i < colCnt; i++) {\n        var dayStart = cellToDate(0, i);\n        var dayEnd = addDays(cloneDate(dayStart), 1);\n        var stretchStart = new Date(Math.max(dayStart, overlayStart));\n        var stretchEnd = new Date(Math.min(dayEnd, overlayEnd));\n        if (stretchStart < stretchEnd) {\n          var rect = coordinateGrid.rect(0, i, 0, i, slotContainer); // only use it for horizontal coords\n          var top = timePosition(dayStart, stretchStart);\n          var bottom = timePosition(dayStart, stretchEnd);\n          rect.top = top;\n          rect.height = bottom - top;\n          slotBind(renderOverlay(rect, slotContainer));\n        }\n      }\n    }\n\n    /* Coordinate Utilities\n    -----------------------------------------------------------------------------*/\n\n    coordinateGrid = new CoordinateGrid(function (rows, cols) {\n      var e, n, p;\n      dayHeadCells.each(function (i, _e) {\n        e = $(_e);\n        n = e.offset().left;\n        if (i) {\n          p[1] = n;\n        }\n        p = [n];\n        cols[i] = p;\n      });\n      p[1] = n + e.outerWidth();\n      if (opt('allDaySlot')) {\n        e = allDayRow;\n        n = e.offset().top;\n        rows[0] = [n, n + e.outerHeight()];\n      }\n      var slotTableTop = slotContainer.offset().top;\n      var slotScrollerTop = slotScroller.offset().top;\n      var slotScrollerBottom = slotScrollerTop + slotScroller.outerHeight();\n      function constrain(n) {\n        return Math.max(slotScrollerTop, Math.min(slotScrollerBottom, n));\n      }\n      for (var i = 0; i < slotCnt * snapRatio; i++) {\n        // adapt slot count to increased/decreased selection slot count\n        rows.push([constrain(slotTableTop + snapHeight * i), constrain(slotTableTop + snapHeight * (i + 1))]);\n      }\n    });\n    hoverListener = new HoverListener(coordinateGrid);\n    colPositions = new HorizontalPositionCache(function (col) {\n      return dayBodyCellInners.eq(col);\n    });\n    colContentPositions = new HorizontalPositionCache(function (col) {\n      return dayBodyCellContentInners.eq(col);\n    });\n    function colLeft(col) {\n      return colPositions.left(col);\n    }\n    function colContentLeft(col) {\n      return colContentPositions.left(col);\n    }\n    function colRight(col) {\n      return colPositions.right(col);\n    }\n    function colContentRight(col) {\n      return colContentPositions.right(col);\n    }\n    function getIsCellAllDay(cell) {\n      return opt('allDaySlot') && !cell.row;\n    }\n    function realCellToDate(cell) {\n      // ugh \"real\" ... but blame it on our abuse of the \"cell\" system\n      var d = cellToDate(0, cell.col);\n      var slotIndex = cell.row;\n      if (opt('allDaySlot')) {\n        slotIndex--;\n      }\n      if (slotIndex >= 0) {\n        addMinutes(d, minMinute + slotIndex * snapMinutes);\n      }\n      return d;\n    }\n\n    // get the Y coordinate of the given time on the given day (both Date objects)\n    function timePosition(day, time) {\n      // both date objects. day holds 00:00 of current day\n      day = cloneDate(day, true);\n      if (time < addMinutes(cloneDate(day), minMinute)) {\n        return 0;\n      }\n      if (time >= addMinutes(cloneDate(day), maxMinute)) {\n        return slotTable.height();\n      }\n      var slotMinutes = opt('slotMinutes'),\n        minutes = time.getHours() * 60 + time.getMinutes() - minMinute,\n        slotI = Math.floor(minutes / slotMinutes),\n        slotTop = slotTopCache[slotI];\n      if (slotTop === undefined) {\n        slotTop = slotTopCache[slotI] = slotTable.find('tr').eq(slotI).find('td div')[0].offsetTop;\n        // .eq() is faster than \":eq()\" selector\n        // [0].offsetTop is faster than .position().top (do we really need this optimization?)\n        // a better optimization would be to cache all these divs\n      }\n\n      return Math.max(0, Math.round(slotTop - 1 + slotHeight * (minutes % slotMinutes / slotMinutes)));\n    }\n    function getAllDayRow(index) {\n      return allDayRow;\n    }\n    function defaultEventEnd(event) {\n      var start = cloneDate(event.start);\n      if (event.allDay) {\n        return start;\n      }\n      return addMinutes(start, opt('defaultEventMinutes'));\n    }\n\n    /* Selection\n    ---------------------------------------------------------------------------------*/\n\n    function defaultSelectionEnd(startDate, allDay) {\n      if (allDay) {\n        return cloneDate(startDate);\n      }\n      return addMinutes(cloneDate(startDate), opt('slotMinutes'));\n    }\n    function renderSelection(startDate, endDate, allDay) {\n      // only for all-day\n      if (allDay) {\n        if (opt('allDaySlot')) {\n          renderDayOverlay(startDate, addDays(cloneDate(endDate), 1), true);\n        }\n      } else {\n        renderSlotSelection(startDate, endDate);\n      }\n    }\n    function renderSlotSelection(startDate, endDate) {\n      var helperOption = opt('selectHelper');\n      coordinateGrid.build();\n      if (helperOption) {\n        var col = dateToCell(startDate).col;\n        if (col >= 0 && col < colCnt) {\n          // only works when times are on same day\n          var rect = coordinateGrid.rect(0, col, 0, col, slotContainer); // only for horizontal coords\n          var top = timePosition(startDate, startDate);\n          var bottom = timePosition(startDate, endDate);\n          if (bottom > top) {\n            // protect against selections that are entirely before or after visible range\n            rect.top = top;\n            rect.height = bottom - top;\n            rect.left += 2;\n            rect.width -= 5;\n            if ($.isFunction(helperOption)) {\n              var helperRes = helperOption(startDate, endDate);\n              if (helperRes) {\n                rect.position = 'absolute';\n                selectionHelper = $(helperRes).css(rect).appendTo(slotContainer);\n              }\n            } else {\n              rect.isStart = true; // conside rect a \"seg\" now\n              rect.isEnd = true; //\n              selectionHelper = $(slotSegHtml({\n                title: '',\n                start: startDate,\n                end: endDate,\n                className: ['fc-select-helper'],\n                editable: false\n              }, rect));\n              selectionHelper.css('opacity', opt('dragOpacity'));\n            }\n            if (selectionHelper) {\n              slotBind(selectionHelper);\n              slotContainer.append(selectionHelper);\n              setOuterWidth(selectionHelper, rect.width, true); // needs to be after appended\n              setOuterHeight(selectionHelper, rect.height, true);\n            }\n          }\n        }\n      } else {\n        renderSlotOverlay(startDate, endDate);\n      }\n    }\n    function clearSelection() {\n      clearOverlays();\n      if (selectionHelper) {\n        selectionHelper.remove();\n        selectionHelper = null;\n      }\n    }\n    function slotSelectionMousedown(ev) {\n      if (ev.which == 1 && opt('selectable')) {\n        // ev.which==1 means left mouse button\n        unselect(ev);\n        var dates;\n        hoverListener.start(function (cell, origCell) {\n          clearSelection();\n          if (cell && cell.col == origCell.col && !getIsCellAllDay(cell)) {\n            var d1 = realCellToDate(origCell);\n            var d2 = realCellToDate(cell);\n            dates = [d1, addMinutes(cloneDate(d1), snapMinutes),\n            // calculate minutes depending on selection slot minutes \n            d2, addMinutes(cloneDate(d2), snapMinutes)].sort(dateCompare);\n            renderSlotSelection(dates[0], dates[3]);\n          } else {\n            dates = null;\n          }\n        }, ev);\n        $(document).one('mouseup', function (ev) {\n          hoverListener.stop();\n          if (dates) {\n            if (+dates[0] == +dates[1]) {\n              reportDayClick(dates[0], false, ev);\n            }\n            reportSelection(dates[0], dates[3], false, ev);\n          }\n        });\n      }\n    }\n    function reportDayClick(date, allDay, ev) {\n      trigger('dayClick', dayBodyCells[dateToCell(date).col], date, allDay, ev);\n    }\n\n    /* External Dragging\n    --------------------------------------------------------------------------------*/\n\n    function dragStart(_dragElement, ev, ui) {\n      hoverListener.start(function (cell) {\n        clearOverlays();\n        if (cell) {\n          if (getIsCellAllDay(cell)) {\n            renderCellOverlay(cell.row, cell.col, cell.row, cell.col);\n          } else {\n            var d1 = realCellToDate(cell);\n            var d2 = addMinutes(cloneDate(d1), opt('defaultEventMinutes'));\n            renderSlotOverlay(d1, d2);\n          }\n        }\n      }, ev);\n    }\n    function dragStop(_dragElement, ev, ui) {\n      var cell = hoverListener.stop();\n      clearOverlays();\n      if (cell) {\n        trigger('drop', _dragElement, realCellToDate(cell), getIsCellAllDay(cell), ev, ui);\n      }\n    }\n  }\n  ;\n  ;\n  function AgendaEventRenderer() {\n    var t = this;\n\n    // exports\n    t.renderEvents = renderEvents;\n    t.clearEvents = clearEvents;\n    t.slotSegHtml = slotSegHtml;\n\n    // imports\n    DayEventRenderer.call(t);\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var isEventDraggable = t.isEventDraggable;\n    var isEventResizable = t.isEventResizable;\n    var eventEnd = t.eventEnd;\n    var eventElementHandlers = t.eventElementHandlers;\n    var setHeight = t.setHeight;\n    var getDaySegmentContainer = t.getDaySegmentContainer;\n    var getSlotSegmentContainer = t.getSlotSegmentContainer;\n    var getHoverListener = t.getHoverListener;\n    var getMaxMinute = t.getMaxMinute;\n    var getMinMinute = t.getMinMinute;\n    var timePosition = t.timePosition;\n    var getIsCellAllDay = t.getIsCellAllDay;\n    var colContentLeft = t.colContentLeft;\n    var colContentRight = t.colContentRight;\n    var cellToDate = t.cellToDate;\n    var getColCnt = t.getColCnt;\n    var getColWidth = t.getColWidth;\n    var getSnapHeight = t.getSnapHeight;\n    var getSnapMinutes = t.getSnapMinutes;\n    var getSlotContainer = t.getSlotContainer;\n    var reportEventElement = t.reportEventElement;\n    var showEvents = t.showEvents;\n    var hideEvents = t.hideEvents;\n    var eventDrop = t.eventDrop;\n    var eventResize = t.eventResize;\n    var renderDayOverlay = t.renderDayOverlay;\n    var clearOverlays = t.clearOverlays;\n    var renderDayEvents = t.renderDayEvents;\n    var calendar = t.calendar;\n    var formatDate = calendar.formatDate;\n    var formatDates = calendar.formatDates;\n\n    // overrides\n    t.draggableDayEvent = draggableDayEvent;\n\n    /* Rendering\n    ----------------------------------------------------------------------------*/\n\n    function renderEvents(events, modifiedEventId) {\n      var i,\n        len = events.length,\n        dayEvents = [],\n        slotEvents = [];\n      for (i = 0; i < len; i++) {\n        if (events[i].allDay) {\n          dayEvents.push(events[i]);\n        } else {\n          slotEvents.push(events[i]);\n        }\n      }\n      if (opt('allDaySlot')) {\n        renderDayEvents(dayEvents, modifiedEventId);\n        setHeight(); // no params means set to viewHeight\n      }\n\n      renderSlotSegs(compileSlotSegs(slotEvents), modifiedEventId);\n    }\n    function clearEvents() {\n      getDaySegmentContainer().empty();\n      getSlotSegmentContainer().empty();\n    }\n    function compileSlotSegs(events) {\n      var colCnt = getColCnt(),\n        minMinute = getMinMinute(),\n        maxMinute = getMaxMinute(),\n        d,\n        visEventEnds = $.map(events, slotEventEnd),\n        i,\n        j,\n        seg,\n        colSegs,\n        segs = [];\n      for (i = 0; i < colCnt; i++) {\n        d = cellToDate(0, i);\n        addMinutes(d, minMinute);\n        colSegs = sliceSegs(events, visEventEnds, d, addMinutes(cloneDate(d), maxMinute - minMinute));\n        colSegs = placeSlotSegs(colSegs); // returns a new order\n\n        for (j = 0; j < colSegs.length; j++) {\n          seg = colSegs[j];\n          seg.col = i;\n          segs.push(seg);\n        }\n      }\n      return segs;\n    }\n    function sliceSegs(events, visEventEnds, start, end) {\n      var segs = [],\n        i,\n        len = events.length,\n        event,\n        eventStart,\n        eventEnd,\n        segStart,\n        segEnd,\n        isStart,\n        isEnd;\n      for (i = 0; i < len; i++) {\n        event = events[i];\n        eventStart = event.start;\n        eventEnd = visEventEnds[i];\n        if (eventEnd > start && eventStart < end) {\n          if (eventStart < start) {\n            segStart = cloneDate(start);\n            isStart = false;\n          } else {\n            segStart = eventStart;\n            isStart = true;\n          }\n          if (eventEnd > end) {\n            segEnd = cloneDate(end);\n            isEnd = false;\n          } else {\n            segEnd = eventEnd;\n            isEnd = true;\n          }\n          segs.push({\n            event: event,\n            start: segStart,\n            end: segEnd,\n            isStart: isStart,\n            isEnd: isEnd\n          });\n        }\n      }\n      return segs.sort(compareSlotSegs);\n    }\n    function slotEventEnd(event) {\n      if (event.end) {\n        return cloneDate(event.end);\n      } else {\n        return addMinutes(cloneDate(event.start), opt('defaultEventMinutes'));\n      }\n    }\n\n    // renders events in the 'time slots' at the bottom\n    // TODO: when we refactor this, when user returns `false` eventRender, don't have empty space\n    // TODO: refactor will include using pixels to detect collisions instead of dates (handy for seg cmp)\n\n    function renderSlotSegs(segs, modifiedEventId) {\n      var i,\n        segCnt = segs.length,\n        seg,\n        event,\n        top,\n        bottom,\n        columnLeft,\n        columnRight,\n        columnWidth,\n        width,\n        left,\n        right,\n        html = '',\n        eventElements,\n        eventElement,\n        triggerRes,\n        titleElement,\n        height,\n        slotSegmentContainer = getSlotSegmentContainer(),\n        isRTL = opt('isRTL');\n\n      // calculate position/dimensions, create html\n      for (i = 0; i < segCnt; i++) {\n        seg = segs[i];\n        event = seg.event;\n        top = timePosition(seg.start, seg.start);\n        bottom = timePosition(seg.start, seg.end);\n        columnLeft = colContentLeft(seg.col);\n        columnRight = colContentRight(seg.col);\n        columnWidth = columnRight - columnLeft;\n\n        // shave off space on right near scrollbars (2.5%)\n        // TODO: move this to CSS somehow\n        columnRight -= columnWidth * .025;\n        columnWidth = columnRight - columnLeft;\n        width = columnWidth * (seg.forwardCoord - seg.backwardCoord);\n        if (opt('slotEventOverlap')) {\n          // double the width while making sure resize handle is visible\n          // (assumed to be 20px wide)\n          width = Math.max((width - 20 / 2) * 2, width // narrow columns will want to make the segment smaller than\n          // the natural width. don't allow it\n          );\n        }\n\n        if (isRTL) {\n          right = columnRight - seg.backwardCoord * columnWidth;\n          left = right - width;\n        } else {\n          left = columnLeft + seg.backwardCoord * columnWidth;\n          right = left + width;\n        }\n\n        // make sure horizontal coordinates are in bounds\n        left = Math.max(left, columnLeft);\n        right = Math.min(right, columnRight);\n        width = right - left;\n        seg.top = top;\n        seg.left = left;\n        seg.outerWidth = width;\n        seg.outerHeight = bottom - top;\n        html += slotSegHtml(event, seg);\n      }\n      slotSegmentContainer[0].innerHTML = html; // faster than html()\n      eventElements = slotSegmentContainer.children();\n\n      // retrieve elements, run through eventRender callback, bind event handlers\n      for (i = 0; i < segCnt; i++) {\n        seg = segs[i];\n        event = seg.event;\n        eventElement = $(eventElements[i]); // faster than eq()\n        triggerRes = trigger('eventRender', event, event, eventElement);\n        if (triggerRes === false) {\n          eventElement.remove();\n        } else {\n          if (triggerRes && triggerRes !== true) {\n            eventElement.remove();\n            eventElement = $(triggerRes).css({\n              position: 'absolute',\n              top: seg.top,\n              left: seg.left\n            }).appendTo(slotSegmentContainer);\n          }\n          seg.element = eventElement;\n          if (event._id === modifiedEventId) {\n            bindSlotSeg(event, eventElement, seg);\n          } else {\n            eventElement[0]._fci = i; // for lazySegBind\n          }\n\n          reportEventElement(event, eventElement);\n        }\n      }\n      lazySegBind(slotSegmentContainer, segs, bindSlotSeg);\n\n      // record event sides and title positions\n      for (i = 0; i < segCnt; i++) {\n        seg = segs[i];\n        if (eventElement = seg.element) {\n          seg.vsides = vsides(eventElement, true);\n          seg.hsides = hsides(eventElement, true);\n          titleElement = eventElement.find('.fc-event-title');\n          if (titleElement.length) {\n            seg.contentTop = titleElement[0].offsetTop;\n          }\n        }\n      }\n\n      // set all positions/dimensions at once\n      for (i = 0; i < segCnt; i++) {\n        seg = segs[i];\n        if (eventElement = seg.element) {\n          eventElement[0].style.width = Math.max(0, seg.outerWidth - seg.hsides) + 'px';\n          height = Math.max(0, seg.outerHeight - seg.vsides);\n          eventElement[0].style.height = height + 'px';\n          event = seg.event;\n          if (seg.contentTop !== undefined && height - seg.contentTop < 10) {\n            // not enough room for title, put it in the time (TODO: maybe make both display:inline instead)\n            eventElement.find('div.fc-event-time').text(formatDate(event.start, opt('timeFormat')) + ' - ' + event.title);\n            eventElement.find('div.fc-event-title').remove();\n          }\n          trigger('eventAfterRender', event, event, eventElement);\n        }\n      }\n    }\n    function slotSegHtml(event, seg) {\n      var html = \"<\";\n      var url = event.url;\n      var skinCss = getSkinCss(event, opt);\n      var classes = ['fc-event', 'fc-event-vert'];\n      if (isEventDraggable(event)) {\n        classes.push('fc-event-draggable');\n      }\n      if (seg.isStart) {\n        classes.push('fc-event-start');\n      }\n      if (seg.isEnd) {\n        classes.push('fc-event-end');\n      }\n      classes = classes.concat(event.className);\n      if (event.source) {\n        classes = classes.concat(event.source.className || []);\n      }\n      if (url) {\n        html += \"a href='\" + htmlEscape(event.url) + \"'\";\n      } else {\n        html += \"div\";\n      }\n      html += \" class='\" + classes.join(' ') + \"'\" + \" style=\" + \"'\" + \"position:absolute;\" + \"top:\" + seg.top + \"px;\" + \"left:\" + seg.left + \"px;\" + skinCss + \"'\" + \">\" + \"<div class='fc-event-inner'>\" + \"<div class='fc-event-time'>\" + htmlEscape(formatDates(event.start, event.end, opt('timeFormat'))) + \"</div>\" + \"<div class='fc-event-title'>\" + htmlEscape(event.title || '') + \"</div>\" + \"</div>\" + \"<div class='fc-event-bg'></div>\";\n      if (seg.isEnd && isEventResizable(event)) {\n        html += \"<div class='ui-resizable-handle ui-resizable-s'>=</div>\";\n      }\n      html += \"</\" + (url ? \"a\" : \"div\") + \">\";\n      return html;\n    }\n    function bindSlotSeg(event, eventElement, seg) {\n      var timeElement = eventElement.find('div.fc-event-time');\n      if (isEventDraggable(event)) {\n        draggableSlotEvent(event, eventElement, timeElement);\n      }\n      if (seg.isEnd && isEventResizable(event)) {\n        resizableSlotEvent(event, eventElement, timeElement);\n      }\n      eventElementHandlers(event, eventElement);\n    }\n\n    /* Dragging\n    -----------------------------------------------------------------------------------*/\n\n    // when event starts out FULL-DAY\n    // overrides DayEventRenderer's version because it needs to account for dragging elements\n    // to and from the slot area.\n\n    function draggableDayEvent(event, eventElement, seg) {\n      var isStart = seg.isStart;\n      var origWidth;\n      var revert;\n      var allDay = true;\n      var dayDelta;\n      var hoverListener = getHoverListener();\n      var colWidth = getColWidth();\n      var snapHeight = getSnapHeight();\n      var snapMinutes = getSnapMinutes();\n      var minMinute = getMinMinute();\n      eventElement.draggable({\n        opacity: opt('dragOpacity', 'month'),\n        // use whatever the month view was using\n        revertDuration: opt('dragRevertDuration'),\n        start: function (ev, ui) {\n          trigger('eventDragStart', eventElement, event, ev, ui);\n          hideEvents(event, eventElement);\n          origWidth = eventElement.width();\n          hoverListener.start(function (cell, origCell) {\n            clearOverlays();\n            if (cell) {\n              revert = false;\n              var origDate = cellToDate(0, origCell.col);\n              var date = cellToDate(0, cell.col);\n              dayDelta = dayDiff(date, origDate);\n              if (!cell.row) {\n                // on full-days\n                renderDayOverlay(addDays(cloneDate(event.start), dayDelta), addDays(exclEndDay(event), dayDelta));\n                resetElement();\n              } else {\n                // mouse is over bottom slots\n                if (isStart) {\n                  if (allDay) {\n                    // convert event to temporary slot-event\n                    eventElement.width(colWidth - 10); // don't use entire width\n                    setOuterHeight(eventElement, snapHeight * Math.round((event.end ? (event.end - event.start) / MINUTE_MS : opt('defaultEventMinutes')) / snapMinutes));\n                    eventElement.draggable('option', 'grid', [colWidth, 1]);\n                    allDay = false;\n                  }\n                } else {\n                  revert = true;\n                }\n              }\n              revert = revert || allDay && !dayDelta;\n            } else {\n              resetElement();\n              revert = true;\n            }\n            eventElement.draggable('option', 'revert', revert);\n          }, ev, 'drag');\n        },\n        stop: function (ev, ui) {\n          hoverListener.stop();\n          clearOverlays();\n          trigger('eventDragStop', eventElement, event, ev, ui);\n          if (revert) {\n            // hasn't moved or is out of bounds (draggable has already reverted)\n            resetElement();\n            eventElement.css('filter', ''); // clear IE opacity side-effects\n            showEvents(event, eventElement);\n          } else {\n            // changed!\n            var minuteDelta = 0;\n            if (!allDay) {\n              minuteDelta = Math.round((eventElement.offset().top - getSlotContainer().offset().top) / snapHeight) * snapMinutes + minMinute - (event.start.getHours() * 60 + event.start.getMinutes());\n            }\n            eventDrop(this, event, dayDelta, minuteDelta, allDay, ev, ui);\n          }\n        }\n      });\n      function resetElement() {\n        if (!allDay) {\n          eventElement.width(origWidth).height('').draggable('option', 'grid', null);\n          allDay = true;\n        }\n      }\n    }\n\n    // when event starts out IN TIMESLOTS\n\n    function draggableSlotEvent(event, eventElement, timeElement) {\n      var coordinateGrid = t.getCoordinateGrid();\n      var colCnt = getColCnt();\n      var colWidth = getColWidth();\n      var snapHeight = getSnapHeight();\n      var snapMinutes = getSnapMinutes();\n\n      // states\n      var origPosition; // original position of the element, not the mouse\n      var origCell;\n      var isInBounds, prevIsInBounds;\n      var isAllDay, prevIsAllDay;\n      var colDelta, prevColDelta;\n      var dayDelta; // derived from colDelta\n      var minuteDelta, prevMinuteDelta;\n      eventElement.draggable({\n        scroll: false,\n        grid: [colWidth, snapHeight],\n        axis: colCnt == 1 ? 'y' : false,\n        opacity: opt('dragOpacity'),\n        revertDuration: opt('dragRevertDuration'),\n        start: function (ev, ui) {\n          trigger('eventDragStart', eventElement, event, ev, ui);\n          hideEvents(event, eventElement);\n          coordinateGrid.build();\n\n          // initialize states\n          origPosition = eventElement.position();\n          origCell = coordinateGrid.cell(ev.pageX, ev.pageY);\n          isInBounds = prevIsInBounds = true;\n          isAllDay = prevIsAllDay = getIsCellAllDay(origCell);\n          colDelta = prevColDelta = 0;\n          dayDelta = 0;\n          minuteDelta = prevMinuteDelta = 0;\n        },\n        drag: function (ev, ui) {\n          // NOTE: this `cell` value is only useful for determining in-bounds and all-day.\n          // Bad for anything else due to the discrepancy between the mouse position and the\n          // element position while snapping. (problem revealed in PR #55)\n          //\n          // PS- the problem exists for draggableDayEvent() when dragging an all-day event to a slot event.\n          // We should overhaul the dragging system and stop relying on jQuery UI.\n          var cell = coordinateGrid.cell(ev.pageX, ev.pageY);\n\n          // update states\n          isInBounds = !!cell;\n          if (isInBounds) {\n            isAllDay = getIsCellAllDay(cell);\n\n            // calculate column delta\n            colDelta = Math.round((ui.position.left - origPosition.left) / colWidth);\n            if (colDelta != prevColDelta) {\n              // calculate the day delta based off of the original clicked column and the column delta\n              var origDate = cellToDate(0, origCell.col);\n              var col = origCell.col + colDelta;\n              col = Math.max(0, col);\n              col = Math.min(colCnt - 1, col);\n              var date = cellToDate(0, col);\n              dayDelta = dayDiff(date, origDate);\n            }\n\n            // calculate minute delta (only if over slots)\n            if (!isAllDay) {\n              minuteDelta = Math.round((ui.position.top - origPosition.top) / snapHeight) * snapMinutes;\n            }\n          }\n\n          // any state changes?\n          if (isInBounds != prevIsInBounds || isAllDay != prevIsAllDay || colDelta != prevColDelta || minuteDelta != prevMinuteDelta) {\n            updateUI();\n\n            // update previous states for next time\n            prevIsInBounds = isInBounds;\n            prevIsAllDay = isAllDay;\n            prevColDelta = colDelta;\n            prevMinuteDelta = minuteDelta;\n          }\n\n          // if out-of-bounds, revert when done, and vice versa.\n          eventElement.draggable('option', 'revert', !isInBounds);\n        },\n        stop: function (ev, ui) {\n          clearOverlays();\n          trigger('eventDragStop', eventElement, event, ev, ui);\n          if (isInBounds && (isAllDay || dayDelta || minuteDelta)) {\n            // changed!\n            eventDrop(this, event, dayDelta, isAllDay ? 0 : minuteDelta, isAllDay, ev, ui);\n          } else {\n            // either no change or out-of-bounds (draggable has already reverted)\n\n            // reset states for next time, and for updateUI()\n            isInBounds = true;\n            isAllDay = false;\n            colDelta = 0;\n            dayDelta = 0;\n            minuteDelta = 0;\n            updateUI();\n            eventElement.css('filter', ''); // clear IE opacity side-effects\n\n            // sometimes fast drags make event revert to wrong position, so reset.\n            // also, if we dragged the element out of the area because of snapping,\n            // but the *mouse* is still in bounds, we need to reset the position.\n            eventElement.css(origPosition);\n            showEvents(event, eventElement);\n          }\n        }\n      });\n      function updateUI() {\n        clearOverlays();\n        if (isInBounds) {\n          if (isAllDay) {\n            timeElement.hide();\n            eventElement.draggable('option', 'grid', null); // disable grid snapping\n            renderDayOverlay(addDays(cloneDate(event.start), dayDelta), addDays(exclEndDay(event), dayDelta));\n          } else {\n            updateTimeText(minuteDelta);\n            timeElement.css('display', ''); // show() was causing display=inline\n            eventElement.draggable('option', 'grid', [colWidth, snapHeight]); // re-enable grid snapping\n          }\n        }\n      }\n\n      function updateTimeText(minuteDelta) {\n        var newStart = addMinutes(cloneDate(event.start), minuteDelta);\n        var newEnd;\n        if (event.end) {\n          newEnd = addMinutes(cloneDate(event.end), minuteDelta);\n        }\n        timeElement.text(formatDates(newStart, newEnd, opt('timeFormat')));\n      }\n    }\n\n    /* Resizing\n    --------------------------------------------------------------------------------------*/\n\n    function resizableSlotEvent(event, eventElement, timeElement) {\n      var snapDelta, prevSnapDelta;\n      var snapHeight = getSnapHeight();\n      var snapMinutes = getSnapMinutes();\n      eventElement.resizable({\n        handles: {\n          s: '.ui-resizable-handle'\n        },\n        grid: snapHeight,\n        start: function (ev, ui) {\n          snapDelta = prevSnapDelta = 0;\n          hideEvents(event, eventElement);\n          trigger('eventResizeStart', this, event, ev, ui);\n        },\n        resize: function (ev, ui) {\n          // don't rely on ui.size.height, doesn't take grid into account\n          snapDelta = Math.round((Math.max(snapHeight, eventElement.height()) - ui.originalSize.height) / snapHeight);\n          if (snapDelta != prevSnapDelta) {\n            timeElement.text(formatDates(event.start, !snapDelta && !event.end ? null :\n            // no change, so don't display time range\n            addMinutes(eventEnd(event), snapMinutes * snapDelta), opt('timeFormat')));\n            prevSnapDelta = snapDelta;\n          }\n        },\n        stop: function (ev, ui) {\n          trigger('eventResizeStop', this, event, ev, ui);\n          if (snapDelta) {\n            eventResize(this, event, 0, snapMinutes * snapDelta, ev, ui);\n          } else {\n            showEvents(event, eventElement);\n            // BUG: if event was really short, need to put title back in span\n          }\n        }\n      });\n    }\n  }\n\n  /* Agenda Event Segment Utilities\n  -----------------------------------------------------------------------------*/\n\n  // Sets the seg.backwardCoord and seg.forwardCoord on each segment and returns a new\n  // list in the order they should be placed into the DOM (an implicit z-index).\n  function placeSlotSegs(segs) {\n    var levels = buildSlotSegLevels(segs);\n    var level0 = levels[0];\n    var i;\n    computeForwardSlotSegs(levels);\n    if (level0) {\n      for (i = 0; i < level0.length; i++) {\n        computeSlotSegPressures(level0[i]);\n      }\n      for (i = 0; i < level0.length; i++) {\n        computeSlotSegCoords(level0[i], 0, 0);\n      }\n    }\n    return flattenSlotSegLevels(levels);\n  }\n\n  // Builds an array of segments \"levels\". The first level will be the leftmost tier of segments\n  // if the calendar is left-to-right, or the rightmost if the calendar is right-to-left.\n  function buildSlotSegLevels(segs) {\n    var levels = [];\n    var i, seg;\n    var j;\n    for (i = 0; i < segs.length; i++) {\n      seg = segs[i];\n\n      // go through all the levels and stop on the first level where there are no collisions\n      for (j = 0; j < levels.length; j++) {\n        if (!computeSlotSegCollisions(seg, levels[j]).length) {\n          break;\n        }\n      }\n      (levels[j] || (levels[j] = [])).push(seg);\n    }\n    return levels;\n  }\n\n  // For every segment, figure out the other segments that are in subsequent\n  // levels that also occupy the same vertical space. Accumulate in seg.forwardSegs\n  function computeForwardSlotSegs(levels) {\n    var i, level;\n    var j, seg;\n    var k;\n    for (i = 0; i < levels.length; i++) {\n      level = levels[i];\n      for (j = 0; j < level.length; j++) {\n        seg = level[j];\n        seg.forwardSegs = [];\n        for (k = i + 1; k < levels.length; k++) {\n          computeSlotSegCollisions(seg, levels[k], seg.forwardSegs);\n        }\n      }\n    }\n  }\n\n  // Figure out which path forward (via seg.forwardSegs) results in the longest path until\n  // the furthest edge is reached. The number of segments in this path will be seg.forwardPressure\n  function computeSlotSegPressures(seg) {\n    var forwardSegs = seg.forwardSegs;\n    var forwardPressure = 0;\n    var i, forwardSeg;\n    if (seg.forwardPressure === undefined) {\n      // not already computed\n\n      for (i = 0; i < forwardSegs.length; i++) {\n        forwardSeg = forwardSegs[i];\n\n        // figure out the child's maximum forward path\n        computeSlotSegPressures(forwardSeg);\n\n        // either use the existing maximum, or use the child's forward pressure\n        // plus one (for the forwardSeg itself)\n        forwardPressure = Math.max(forwardPressure, 1 + forwardSeg.forwardPressure);\n      }\n      seg.forwardPressure = forwardPressure;\n    }\n  }\n\n  // Calculate seg.forwardCoord and seg.backwardCoord for the segment, where both values range\n  // from 0 to 1. If the calendar is left-to-right, the seg.backwardCoord maps to \"left\" and\n  // seg.forwardCoord maps to \"right\" (via percentage). Vice-versa if the calendar is right-to-left.\n  //\n  // The segment might be part of a \"series\", which means consecutive segments with the same pressure\n  // who's width is unknown until an edge has been hit. `seriesBackwardPressure` is the number of\n  // segments behind this one in the current series, and `seriesBackwardCoord` is the starting\n  // coordinate of the first segment in the series.\n  function computeSlotSegCoords(seg, seriesBackwardPressure, seriesBackwardCoord) {\n    var forwardSegs = seg.forwardSegs;\n    var i;\n    if (seg.forwardCoord === undefined) {\n      // not already computed\n\n      if (!forwardSegs.length) {\n        // if there are no forward segments, this segment should butt up against the edge\n        seg.forwardCoord = 1;\n      } else {\n        // sort highest pressure first\n        forwardSegs.sort(compareForwardSlotSegs);\n\n        // this segment's forwardCoord will be calculated from the backwardCoord of the\n        // highest-pressure forward segment.\n        computeSlotSegCoords(forwardSegs[0], seriesBackwardPressure + 1, seriesBackwardCoord);\n        seg.forwardCoord = forwardSegs[0].backwardCoord;\n      }\n\n      // calculate the backwardCoord from the forwardCoord. consider the series\n      seg.backwardCoord = seg.forwardCoord - (seg.forwardCoord - seriesBackwardCoord) / (\n      // available width for series\n      seriesBackwardPressure + 1); // # of segments in the series\n\n      // use this segment's coordinates to computed the coordinates of the less-pressurized\n      // forward segments\n      for (i = 0; i < forwardSegs.length; i++) {\n        computeSlotSegCoords(forwardSegs[i], 0, seg.forwardCoord);\n      }\n    }\n  }\n\n  // Outputs a flat array of segments, from lowest to highest level\n  function flattenSlotSegLevels(levels) {\n    var segs = [];\n    var i, level;\n    var j;\n    for (i = 0; i < levels.length; i++) {\n      level = levels[i];\n      for (j = 0; j < level.length; j++) {\n        segs.push(level[j]);\n      }\n    }\n    return segs;\n  }\n\n  // Find all the segments in `otherSegs` that vertically collide with `seg`.\n  // Append into an optionally-supplied `results` array and return.\n  function computeSlotSegCollisions(seg, otherSegs, results) {\n    results = results || [];\n    for (var i = 0; i < otherSegs.length; i++) {\n      if (isSlotSegCollision(seg, otherSegs[i])) {\n        results.push(otherSegs[i]);\n      }\n    }\n    return results;\n  }\n\n  // Do these segments occupy the same vertical space?\n  function isSlotSegCollision(seg1, seg2) {\n    return seg1.end > seg2.start && seg1.start < seg2.end;\n  }\n\n  // A cmp function for determining which forward segment to rely on more when computing coordinates.\n  function compareForwardSlotSegs(seg1, seg2) {\n    // put higher-pressure first\n    return seg2.forwardPressure - seg1.forwardPressure ||\n    // put segments that are closer to initial edge first (and favor ones with no coords yet)\n    (seg1.backwardCoord || 0) - (seg2.backwardCoord || 0) ||\n    // do normal sorting...\n    compareSlotSegs(seg1, seg2);\n  }\n\n  // A cmp function for determining which segment should be closer to the initial edge\n  // (the left edge on a left-to-right calendar).\n  function compareSlotSegs(seg1, seg2) {\n    return seg1.start - seg2.start ||\n    // earlier start time goes first\n    seg2.end - seg2.start - (seg1.end - seg1.start) ||\n    // tie? longer-duration goes first\n    (seg1.event.title || '').localeCompare(seg2.event.title); // tie? alphabetically by title\n  }\n\n  ;\n  ;\n  function View(element, calendar, viewName) {\n    var t = this;\n\n    // exports\n    t.element = element;\n    t.calendar = calendar;\n    t.name = viewName;\n    t.opt = opt;\n    t.trigger = trigger;\n    t.isEventDraggable = isEventDraggable;\n    t.isEventResizable = isEventResizable;\n    t.setEventData = setEventData;\n    t.clearEventData = clearEventData;\n    t.eventEnd = eventEnd;\n    t.reportEventElement = reportEventElement;\n    t.triggerEventDestroy = triggerEventDestroy;\n    t.eventElementHandlers = eventElementHandlers;\n    t.showEvents = showEvents;\n    t.hideEvents = hideEvents;\n    t.eventDrop = eventDrop;\n    t.eventResize = eventResize;\n    // t.title\n    // t.start, t.end\n    // t.visStart, t.visEnd\n\n    // imports\n    var defaultEventEnd = t.defaultEventEnd;\n    var normalizeEvent = calendar.normalizeEvent; // in EventManager\n    var reportEventChange = calendar.reportEventChange;\n\n    // locals\n    var eventsByID = {}; // eventID mapped to array of events (there can be multiple b/c of repeating events)\n    var eventElementsByID = {}; // eventID mapped to array of jQuery elements\n    var eventElementCouples = []; // array of objects, { event, element } // TODO: unify with segment system\n    var options = calendar.options;\n    function opt(name, viewNameOverride) {\n      var v = options[name];\n      if ($.isPlainObject(v)) {\n        return smartProperty(v, viewNameOverride || viewName);\n      }\n      return v;\n    }\n    function trigger(name, thisObj) {\n      return calendar.trigger.apply(calendar, [name, thisObj || t].concat(Array.prototype.slice.call(arguments, 2), [t]));\n    }\n\n    /* Event Editable Boolean Calculations\n    ------------------------------------------------------------------------------*/\n\n    function isEventDraggable(event) {\n      var source = event.source || {};\n      return firstDefined(event.startEditable, source.startEditable, opt('eventStartEditable'), event.editable, source.editable, opt('editable')) && !opt('disableDragging'); // deprecated\n    }\n\n    function isEventResizable(event) {\n      // but also need to make sure the seg.isEnd == true\n      var source = event.source || {};\n      return firstDefined(event.durationEditable, source.durationEditable, opt('eventDurationEditable'), event.editable, source.editable, opt('editable')) && !opt('disableResizing'); // deprecated\n    }\n\n    /* Event Data\n    ------------------------------------------------------------------------------*/\n\n    function setEventData(events) {\n      // events are already normalized at this point\n      eventsByID = {};\n      var i,\n        len = events.length,\n        event;\n      for (i = 0; i < len; i++) {\n        event = events[i];\n        if (eventsByID[event._id]) {\n          eventsByID[event._id].push(event);\n        } else {\n          eventsByID[event._id] = [event];\n        }\n      }\n    }\n    function clearEventData() {\n      eventsByID = {};\n      eventElementsByID = {};\n      eventElementCouples = [];\n    }\n\n    // returns a Date object for an event's end\n    function eventEnd(event) {\n      return event.end ? cloneDate(event.end) : defaultEventEnd(event);\n    }\n\n    /* Event Elements\n    ------------------------------------------------------------------------------*/\n\n    // report when view creates an element for an event\n    function reportEventElement(event, element) {\n      eventElementCouples.push({\n        event: event,\n        element: element\n      });\n      if (eventElementsByID[event._id]) {\n        eventElementsByID[event._id].push(element);\n      } else {\n        eventElementsByID[event._id] = [element];\n      }\n    }\n    function triggerEventDestroy() {\n      $.each(eventElementCouples, function (i, couple) {\n        t.trigger('eventDestroy', couple.event, couple.event, couple.element);\n      });\n    }\n\n    // attaches eventClick, eventMouseover, eventMouseout\n    function eventElementHandlers(event, eventElement) {\n      eventElement.click(function (ev) {\n        if (!eventElement.hasClass('ui-draggable-dragging') && !eventElement.hasClass('ui-resizable-resizing')) {\n          return trigger('eventClick', this, event, ev);\n        }\n      }).hover(function (ev) {\n        trigger('eventMouseover', this, event, ev);\n      }, function (ev) {\n        trigger('eventMouseout', this, event, ev);\n      });\n      // TODO: don't fire eventMouseover/eventMouseout *while* dragging is occuring (on subject element)\n      // TODO: same for resizing\n    }\n\n    function showEvents(event, exceptElement) {\n      eachEventElement(event, exceptElement, 'show');\n    }\n    function hideEvents(event, exceptElement) {\n      eachEventElement(event, exceptElement, 'hide');\n    }\n    function eachEventElement(event, exceptElement, funcName) {\n      // NOTE: there may be multiple events per ID (repeating events)\n      // and multiple segments per event\n      var elements = eventElementsByID[event._id],\n        i,\n        len = elements.length;\n      for (i = 0; i < len; i++) {\n        if (!exceptElement || elements[i][0] != exceptElement[0]) {\n          elements[i][funcName]();\n        }\n      }\n    }\n\n    /* Event Modification Reporting\n    ---------------------------------------------------------------------------------*/\n\n    function eventDrop(e, event, dayDelta, minuteDelta, allDay, ev, ui) {\n      var oldAllDay = event.allDay;\n      var eventId = event._id;\n      moveEvents(eventsByID[eventId], dayDelta, minuteDelta, allDay);\n      trigger('eventDrop', e, event, dayDelta, minuteDelta, allDay, function () {\n        // TODO: investigate cases where this inverse technique might not work\n        moveEvents(eventsByID[eventId], -dayDelta, -minuteDelta, oldAllDay);\n        reportEventChange(eventId);\n      }, ev, ui);\n      reportEventChange(eventId);\n    }\n    function eventResize(e, event, dayDelta, minuteDelta, ev, ui) {\n      var eventId = event._id;\n      elongateEvents(eventsByID[eventId], dayDelta, minuteDelta);\n      trigger('eventResize', e, event, dayDelta, minuteDelta, function () {\n        // TODO: investigate cases where this inverse technique might not work\n        elongateEvents(eventsByID[eventId], -dayDelta, -minuteDelta);\n        reportEventChange(eventId);\n      }, ev, ui);\n      reportEventChange(eventId);\n    }\n\n    /* Event Modification Math\n    ---------------------------------------------------------------------------------*/\n\n    function moveEvents(events, dayDelta, minuteDelta, allDay) {\n      minuteDelta = minuteDelta || 0;\n      for (var e, len = events.length, i = 0; i < len; i++) {\n        e = events[i];\n        if (allDay !== undefined) {\n          e.allDay = allDay;\n        }\n        addMinutes(addDays(e.start, dayDelta, true), minuteDelta);\n        if (e.end) {\n          e.end = addMinutes(addDays(e.end, dayDelta, true), minuteDelta);\n        }\n        normalizeEvent(e, options);\n      }\n    }\n    function elongateEvents(events, dayDelta, minuteDelta) {\n      minuteDelta = minuteDelta || 0;\n      for (var e, len = events.length, i = 0; i < len; i++) {\n        e = events[i];\n        e.end = addMinutes(addDays(eventEnd(e), dayDelta, true), minuteDelta);\n        normalizeEvent(e, options);\n      }\n    }\n\n    // ====================================================================================================\n    // Utilities for day \"cells\"\n    // ====================================================================================================\n    // The \"basic\" views are completely made up of day cells.\n    // The \"agenda\" views have day cells at the top \"all day\" slot.\n    // This was the obvious common place to put these utilities, but they should be abstracted out into\n    // a more meaningful class (like DayEventRenderer).\n    // ====================================================================================================\n\n    // For determining how a given \"cell\" translates into a \"date\":\n    //\n    // 1. Convert the \"cell\" (row and column) into a \"cell offset\" (the # of the cell, cronologically from the first).\n    //    Keep in mind that column indices are inverted with isRTL. This is taken into account.\n    //\n    // 2. Convert the \"cell offset\" to a \"day offset\" (the # of days since the first visible day in the view).\n    //\n    // 3. Convert the \"day offset\" into a \"date\" (a JavaScript Date object).\n    //\n    // The reverse transformation happens when transforming a date into a cell.\n\n    // exports\n    t.isHiddenDay = isHiddenDay;\n    t.skipHiddenDays = skipHiddenDays;\n    t.getCellsPerWeek = getCellsPerWeek;\n    t.dateToCell = dateToCell;\n    t.dateToDayOffset = dateToDayOffset;\n    t.dayOffsetToCellOffset = dayOffsetToCellOffset;\n    t.cellOffsetToCell = cellOffsetToCell;\n    t.cellToDate = cellToDate;\n    t.cellToCellOffset = cellToCellOffset;\n    t.cellOffsetToDayOffset = cellOffsetToDayOffset;\n    t.dayOffsetToDate = dayOffsetToDate;\n    t.rangeToSegments = rangeToSegments;\n\n    // internals\n    var hiddenDays = opt('hiddenDays') || []; // array of day-of-week indices that are hidden\n    var isHiddenDayHash = []; // is the day-of-week hidden? (hash with day-of-week-index -> bool)\n    var cellsPerWeek;\n    var dayToCellMap = []; // hash from dayIndex -> cellIndex, for one week\n    var cellToDayMap = []; // hash from cellIndex -> dayIndex, for one week\n    var isRTL = opt('isRTL');\n\n    // initialize important internal variables\n    (function () {\n      if (opt('weekends') === false) {\n        hiddenDays.push(0, 6); // 0=sunday, 6=saturday\n      }\n\n      // Loop through a hypothetical week and determine which\n      // days-of-week are hidden. Record in both hashes (one is the reverse of the other).\n      for (var dayIndex = 0, cellIndex = 0; dayIndex < 7; dayIndex++) {\n        dayToCellMap[dayIndex] = cellIndex;\n        isHiddenDayHash[dayIndex] = $.inArray(dayIndex, hiddenDays) != -1;\n        if (!isHiddenDayHash[dayIndex]) {\n          cellToDayMap[cellIndex] = dayIndex;\n          cellIndex++;\n        }\n      }\n      cellsPerWeek = cellIndex;\n      if (!cellsPerWeek) {\n        throw 'invalid hiddenDays'; // all days were hidden? bad.\n      }\n    })();\n\n    // Is the current day hidden?\n    // `day` is a day-of-week index (0-6), or a Date object\n    function isHiddenDay(day) {\n      if (typeof day == 'object') {\n        day = day.getDay();\n      }\n      return isHiddenDayHash[day];\n    }\n    function getCellsPerWeek() {\n      return cellsPerWeek;\n    }\n\n    // Keep incrementing the current day until it is no longer a hidden day.\n    // If the initial value of `date` is not a hidden day, don't do anything.\n    // Pass `isExclusive` as `true` if you are dealing with an end date.\n    // `inc` defaults to `1` (increment one day forward each time)\n    function skipHiddenDays(date, inc, isExclusive) {\n      inc = inc || 1;\n      while (isHiddenDayHash[(date.getDay() + (isExclusive ? inc : 0) + 7) % 7]) {\n        addDays(date, inc);\n      }\n    }\n\n    //\n    // TRANSFORMATIONS: cell -> cell offset -> day offset -> date\n    //\n\n    // cell -> date (combines all transformations)\n    // Possible arguments:\n    // - row, col\n    // - { row:#, col: # }\n    function cellToDate() {\n      var cellOffset = cellToCellOffset.apply(null, arguments);\n      var dayOffset = cellOffsetToDayOffset(cellOffset);\n      var date = dayOffsetToDate(dayOffset);\n      return date;\n    }\n\n    // cell -> cell offset\n    // Possible arguments:\n    // - row, col\n    // - { row:#, col:# }\n    function cellToCellOffset(row, col) {\n      var colCnt = t.getColCnt();\n\n      // rtl variables. wish we could pre-populate these. but where?\n      var dis = isRTL ? -1 : 1;\n      var dit = isRTL ? colCnt - 1 : 0;\n      if (typeof row == 'object') {\n        col = row.col;\n        row = row.row;\n      }\n      var cellOffset = row * colCnt + (col * dis + dit); // column, adjusted for RTL (dis & dit)\n\n      return cellOffset;\n    }\n\n    // cell offset -> day offset\n    function cellOffsetToDayOffset(cellOffset) {\n      var day0 = t.visStart.getDay(); // first date's day of week\n      cellOffset += dayToCellMap[day0]; // normlize cellOffset to beginning-of-week\n      return Math.floor(cellOffset / cellsPerWeek) * 7 // # of days from full weeks\n      + cellToDayMap[\n      // # of days from partial last week\n      (cellOffset % cellsPerWeek + cellsPerWeek) % cellsPerWeek // crazy math to handle negative cellOffsets\n      ] - day0; // adjustment for beginning-of-week normalization\n    }\n\n    // day offset -> date (JavaScript Date object)\n    function dayOffsetToDate(dayOffset) {\n      var date = cloneDate(t.visStart);\n      addDays(date, dayOffset);\n      return date;\n    }\n\n    //\n    // TRANSFORMATIONS: date -> day offset -> cell offset -> cell\n    //\n\n    // date -> cell (combines all transformations)\n    function dateToCell(date) {\n      var dayOffset = dateToDayOffset(date);\n      var cellOffset = dayOffsetToCellOffset(dayOffset);\n      var cell = cellOffsetToCell(cellOffset);\n      return cell;\n    }\n\n    // date -> day offset\n    function dateToDayOffset(date) {\n      return dayDiff(date, t.visStart);\n    }\n\n    // day offset -> cell offset\n    function dayOffsetToCellOffset(dayOffset) {\n      var day0 = t.visStart.getDay(); // first date's day of week\n      dayOffset += day0; // normalize dayOffset to beginning-of-week\n      return Math.floor(dayOffset / 7) * cellsPerWeek // # of cells from full weeks\n      + dayToCellMap[\n      // # of cells from partial last week\n      (dayOffset % 7 + 7) % 7 // crazy math to handle negative dayOffsets\n      ] - dayToCellMap[day0]; // adjustment for beginning-of-week normalization\n    }\n\n    // cell offset -> cell (object with row & col keys)\n    function cellOffsetToCell(cellOffset) {\n      var colCnt = t.getColCnt();\n\n      // rtl variables. wish we could pre-populate these. but where?\n      var dis = isRTL ? -1 : 1;\n      var dit = isRTL ? colCnt - 1 : 0;\n      var row = Math.floor(cellOffset / colCnt);\n      var col = (cellOffset % colCnt + colCnt) % colCnt * dis + dit; // column, adjusted for RTL (dis & dit)\n      return {\n        row: row,\n        col: col\n      };\n    }\n\n    //\n    // Converts a date range into an array of segment objects.\n    // \"Segments\" are horizontal stretches of time, sliced up by row.\n    // A segment object has the following properties:\n    // - row\n    // - cols\n    // - isStart\n    // - isEnd\n    //\n    function rangeToSegments(startDate, endDate) {\n      var rowCnt = t.getRowCnt();\n      var colCnt = t.getColCnt();\n      var segments = []; // array of segments to return\n\n      // day offset for given date range\n      var rangeDayOffsetStart = dateToDayOffset(startDate);\n      var rangeDayOffsetEnd = dateToDayOffset(endDate); // exclusive\n\n      // first and last cell offset for the given date range\n      // \"last\" implies inclusivity\n      var rangeCellOffsetFirst = dayOffsetToCellOffset(rangeDayOffsetStart);\n      var rangeCellOffsetLast = dayOffsetToCellOffset(rangeDayOffsetEnd) - 1;\n\n      // loop through all the rows in the view\n      for (var row = 0; row < rowCnt; row++) {\n        // first and last cell offset for the row\n        var rowCellOffsetFirst = row * colCnt;\n        var rowCellOffsetLast = rowCellOffsetFirst + colCnt - 1;\n\n        // get the segment's cell offsets by constraining the range's cell offsets to the bounds of the row\n        var segmentCellOffsetFirst = Math.max(rangeCellOffsetFirst, rowCellOffsetFirst);\n        var segmentCellOffsetLast = Math.min(rangeCellOffsetLast, rowCellOffsetLast);\n\n        // make sure segment's offsets are valid and in view\n        if (segmentCellOffsetFirst <= segmentCellOffsetLast) {\n          // translate to cells\n          var segmentCellFirst = cellOffsetToCell(segmentCellOffsetFirst);\n          var segmentCellLast = cellOffsetToCell(segmentCellOffsetLast);\n\n          // view might be RTL, so order by leftmost column\n          var cols = [segmentCellFirst.col, segmentCellLast.col].sort();\n\n          // Determine if segment's first/last cell is the beginning/end of the date range.\n          // We need to compare \"day offset\" because \"cell offsets\" are often ambiguous and\n          // can translate to multiple days, and an edge case reveals itself when we the\n          // range's first cell is hidden (we don't want isStart to be true).\n          var isStart = cellOffsetToDayOffset(segmentCellOffsetFirst) == rangeDayOffsetStart;\n          var isEnd = cellOffsetToDayOffset(segmentCellOffsetLast) + 1 == rangeDayOffsetEnd; // +1 for comparing exclusively\n\n          segments.push({\n            row: row,\n            leftCol: cols[0],\n            rightCol: cols[1],\n            isStart: isStart,\n            isEnd: isEnd\n          });\n        }\n      }\n      return segments;\n    }\n  }\n  ;\n  ;\n  function DayEventRenderer() {\n    var t = this;\n\n    // exports\n    t.renderDayEvents = renderDayEvents;\n    t.draggableDayEvent = draggableDayEvent; // made public so that subclasses can override\n    t.resizableDayEvent = resizableDayEvent; // \"\n\n    // imports\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var isEventDraggable = t.isEventDraggable;\n    var isEventResizable = t.isEventResizable;\n    var eventEnd = t.eventEnd;\n    var reportEventElement = t.reportEventElement;\n    var eventElementHandlers = t.eventElementHandlers;\n    var showEvents = t.showEvents;\n    var hideEvents = t.hideEvents;\n    var eventDrop = t.eventDrop;\n    var eventResize = t.eventResize;\n    var getRowCnt = t.getRowCnt;\n    var getColCnt = t.getColCnt;\n    var getColWidth = t.getColWidth;\n    var allDayRow = t.allDayRow; // TODO: rename\n    var colLeft = t.colLeft;\n    var colRight = t.colRight;\n    var colContentLeft = t.colContentLeft;\n    var colContentRight = t.colContentRight;\n    var dateToCell = t.dateToCell;\n    var getDaySegmentContainer = t.getDaySegmentContainer;\n    var formatDates = t.calendar.formatDates;\n    var renderDayOverlay = t.renderDayOverlay;\n    var clearOverlays = t.clearOverlays;\n    var clearSelection = t.clearSelection;\n    var getHoverListener = t.getHoverListener;\n    var rangeToSegments = t.rangeToSegments;\n    var cellToDate = t.cellToDate;\n    var cellToCellOffset = t.cellToCellOffset;\n    var cellOffsetToDayOffset = t.cellOffsetToDayOffset;\n    var dateToDayOffset = t.dateToDayOffset;\n    var dayOffsetToCellOffset = t.dayOffsetToCellOffset;\n\n    // Render `events` onto the calendar, attach mouse event handlers, and call the `eventAfterRender` callback for each.\n    // Mouse event will be lazily applied, except if the event has an ID of `modifiedEventId`.\n    // Can only be called when the event container is empty (because it wipes out all innerHTML).\n    function renderDayEvents(events, modifiedEventId) {\n      // do the actual rendering. Receive the intermediate \"segment\" data structures.\n      var segments = _renderDayEvents(events, false,\n      // don't append event elements\n      true // set the heights of the rows\n      );\n\n      // report the elements to the View, for general drag/resize utilities\n      segmentElementEach(segments, function (segment, element) {\n        reportEventElement(segment.event, element);\n      });\n\n      // attach mouse handlers\n      attachHandlers(segments, modifiedEventId);\n\n      // call `eventAfterRender` callback for each event\n      segmentElementEach(segments, function (segment, element) {\n        trigger('eventAfterRender', segment.event, segment.event, element);\n      });\n    }\n\n    // Render an event on the calendar, but don't report them anywhere, and don't attach mouse handlers.\n    // Append this event element to the event container, which might already be populated with events.\n    // If an event's segment will have row equal to `adjustRow`, then explicitly set its top coordinate to `adjustTop`.\n    // This hack is used to maintain continuity when user is manually resizing an event.\n    // Returns an array of DOM elements for the event.\n    function renderTempDayEvent(event, adjustRow, adjustTop) {\n      // actually render the event. `true` for appending element to container.\n      // Recieve the intermediate \"segment\" data structures.\n      var segments = _renderDayEvents([event], true,\n      // append event elements\n      false // don't set the heights of the rows\n      );\n\n      var elements = [];\n\n      // Adjust certain elements' top coordinates\n      segmentElementEach(segments, function (segment, element) {\n        if (segment.row === adjustRow) {\n          element.css('top', adjustTop);\n        }\n        elements.push(element[0]); // accumulate DOM nodes\n      });\n\n      return elements;\n    }\n\n    // Render events onto the calendar. Only responsible for the VISUAL aspect.\n    // Not responsible for attaching handlers or calling callbacks.\n    // Set `doAppend` to `true` for rendering elements without clearing the existing container.\n    // Set `doRowHeights` to allow setting the height of each row, to compensate for vertical event overflow.\n    function _renderDayEvents(events, doAppend, doRowHeights) {\n      // where the DOM nodes will eventually end up\n      var finalContainer = getDaySegmentContainer();\n\n      // the container where the initial HTML will be rendered.\n      // If `doAppend`==true, uses a temporary container.\n      var renderContainer = doAppend ? $(\"<div/>\") : finalContainer;\n      var segments = buildSegments(events);\n      var html;\n      var elements;\n\n      // calculate the desired `left` and `width` properties on each segment object\n      calculateHorizontals(segments);\n\n      // build the HTML string. relies on `left` property\n      html = buildHTML(segments);\n\n      // render the HTML. innerHTML is considerably faster than jQuery's .html()\n      renderContainer[0].innerHTML = html;\n\n      // retrieve the individual elements\n      elements = renderContainer.children();\n\n      // if we were appending, and thus using a temporary container,\n      // re-attach elements to the real container.\n      if (doAppend) {\n        finalContainer.append(elements);\n      }\n\n      // assigns each element to `segment.event`, after filtering them through user callbacks\n      resolveElements(segments, elements);\n\n      // Calculate the left and right padding+margin for each element.\n      // We need this for setting each element's desired outer width, because of the W3C box model.\n      // It's important we do this in a separate pass from acually setting the width on the DOM elements\n      // because alternating reading/writing dimensions causes reflow for every iteration.\n      segmentElementEach(segments, function (segment, element) {\n        segment.hsides = hsides(element, true); // include margins = `true`\n      });\n\n      // Set the width of each element\n      segmentElementEach(segments, function (segment, element) {\n        element.width(Math.max(0, segment.outerWidth - segment.hsides));\n      });\n\n      // Grab each element's outerHeight (setVerticals uses this).\n      // To get an accurate reading, it's important to have each element's width explicitly set already.\n      segmentElementEach(segments, function (segment, element) {\n        segment.outerHeight = element.outerHeight(true); // include margins = `true`\n      });\n\n      // Set the top coordinate on each element (requires segment.outerHeight)\n      setVerticals(segments, doRowHeights);\n      return segments;\n    }\n\n    // Generate an array of \"segments\" for all events.\n    function buildSegments(events) {\n      var segments = [];\n      for (var i = 0; i < events.length; i++) {\n        var eventSegments = buildSegmentsForEvent(events[i]);\n        segments.push.apply(segments, eventSegments); // append an array to an array\n      }\n\n      return segments;\n    }\n\n    // Generate an array of segments for a single event.\n    // A \"segment\" is the same data structure that View.rangeToSegments produces,\n    // with the addition of the `event` property being set to reference the original event.\n    function buildSegmentsForEvent(event) {\n      var startDate = event.start;\n      var endDate = exclEndDay(event);\n      var segments = rangeToSegments(startDate, endDate);\n      for (var i = 0; i < segments.length; i++) {\n        segments[i].event = event;\n      }\n      return segments;\n    }\n\n    // Sets the `left` and `outerWidth` property of each segment.\n    // These values are the desired dimensions for the eventual DOM elements.\n    function calculateHorizontals(segments) {\n      var isRTL = opt('isRTL');\n      for (var i = 0; i < segments.length; i++) {\n        var segment = segments[i];\n\n        // Determine functions used for calulating the elements left/right coordinates,\n        // depending on whether the view is RTL or not.\n        // NOTE:\n        // colLeft/colRight returns the coordinate butting up the edge of the cell.\n        // colContentLeft/colContentRight is indented a little bit from the edge.\n        var leftFunc = (isRTL ? segment.isEnd : segment.isStart) ? colContentLeft : colLeft;\n        var rightFunc = (isRTL ? segment.isStart : segment.isEnd) ? colContentRight : colRight;\n        var left = leftFunc(segment.leftCol);\n        var right = rightFunc(segment.rightCol);\n        segment.left = left;\n        segment.outerWidth = right - left;\n      }\n    }\n\n    // Build a concatenated HTML string for an array of segments\n    function buildHTML(segments) {\n      var html = '';\n      for (var i = 0; i < segments.length; i++) {\n        html += buildHTMLForSegment(segments[i]);\n      }\n      return html;\n    }\n\n    // Build an HTML string for a single segment.\n    // Relies on the following properties:\n    // - `segment.event` (from `buildSegmentsForEvent`)\n    // - `segment.left` (from `calculateHorizontals`)\n    function buildHTMLForSegment(segment) {\n      var html = '';\n      var isRTL = opt('isRTL');\n      var event = segment.event;\n      var url = event.url;\n\n      // generate the list of CSS classNames\n      var classNames = ['fc-event', 'fc-event-hori'];\n      if (isEventDraggable(event)) {\n        classNames.push('fc-event-draggable');\n      }\n      if (segment.isStart) {\n        classNames.push('fc-event-start');\n      }\n      if (segment.isEnd) {\n        classNames.push('fc-event-end');\n      }\n      // use the event's configured classNames\n      // guaranteed to be an array via `normalizeEvent`\n      classNames = classNames.concat(event.className);\n      if (event.source) {\n        // use the event's source's classNames, if specified\n        classNames = classNames.concat(event.source.className || []);\n      }\n\n      // generate a semicolon delimited CSS string for any of the \"skin\" properties\n      // of the event object (`backgroundColor`, `borderColor` and such)\n      var skinCss = getSkinCss(event, opt);\n      if (url) {\n        html += \"<a href='\" + htmlEscape(url) + \"'\";\n      } else {\n        html += \"<div\";\n      }\n      html += \" class='\" + classNames.join(' ') + \"'\" + \" style=\" + \"'\" + \"position:absolute;\" + \"left:\" + segment.left + \"px;\" + skinCss + \"'\" + \">\" + \"<div class='fc-event-inner'>\";\n      if (!event.allDay && segment.isStart) {\n        html += \"<span class='fc-event-time'>\" + htmlEscape(formatDates(event.start, event.end, opt('timeFormat'))) + \"</span>\";\n      }\n      html += \"<span class='fc-event-title'>\" + htmlEscape(event.title || '') + \"</span>\" + \"</div>\";\n      if (segment.isEnd && isEventResizable(event)) {\n        html += \"<div class='ui-resizable-handle ui-resizable-\" + (isRTL ? 'w' : 'e') + \"'>\" + \"Â Â Â \" +\n        // makes hit area a lot better for IE6/7\n        \"</div>\";\n      }\n      html += \"</\" + (url ? \"a\" : \"div\") + \">\";\n\n      // TODO:\n      // When these elements are initially rendered, they will be briefly visibile on the screen,\n      // even though their widths/heights are not set.\n      // SOLUTION: initially set them as visibility:hidden ?\n\n      return html;\n    }\n\n    // Associate each segment (an object) with an element (a jQuery object),\n    // by setting each `segment.element`.\n    // Run each element through the `eventRender` filter, which allows developers to\n    // modify an existing element, supply a new one, or cancel rendering.\n    function resolveElements(segments, elements) {\n      for (var i = 0; i < segments.length; i++) {\n        var segment = segments[i];\n        var event = segment.event;\n        var element = elements.eq(i);\n\n        // call the trigger with the original element\n        var triggerRes = trigger('eventRender', event, event, element);\n        if (triggerRes === false) {\n          // if `false`, remove the event from the DOM and don't assign it to `segment.event`\n          element.remove();\n        } else {\n          if (triggerRes && triggerRes !== true) {\n            // the trigger returned a new element, but not `true` (which means keep the existing element)\n\n            // re-assign the important CSS dimension properties that were already assigned in `buildHTMLForSegment`\n            triggerRes = $(triggerRes).css({\n              position: 'absolute',\n              left: segment.left\n            });\n            element.replaceWith(triggerRes);\n            element = triggerRes;\n          }\n          segment.element = element;\n        }\n      }\n    }\n\n    /* Top-coordinate Methods\n    -------------------------------------------------------------------------------------------------*/\n\n    // Sets the \"top\" CSS property for each element.\n    // If `doRowHeights` is `true`, also sets each row's first cell to an explicit height,\n    // so that if elements vertically overflow, the cell expands vertically to compensate.\n    function setVerticals(segments, doRowHeights) {\n      var rowContentHeights = calculateVerticals(segments); // also sets segment.top\n      var rowContentElements = getRowContentElements(); // returns 1 inner div per row\n      var rowContentTops = [];\n\n      // Set each row's height by setting height of first inner div\n      if (doRowHeights) {\n        for (var i = 0; i < rowContentElements.length; i++) {\n          rowContentElements[i].height(rowContentHeights[i]);\n        }\n      }\n\n      // Get each row's top, relative to the views's origin.\n      // Important to do this after setting each row's height.\n      for (var i = 0; i < rowContentElements.length; i++) {\n        rowContentTops.push(rowContentElements[i].position().top);\n      }\n\n      // Set each segment element's CSS \"top\" property.\n      // Each segment object has a \"top\" property, which is relative to the row's top, but...\n      segmentElementEach(segments, function (segment, element) {\n        element.css('top', rowContentTops[segment.row] + segment.top // ...now, relative to views's origin\n        );\n      });\n    }\n\n    // Calculate the \"top\" coordinate for each segment, relative to the \"top\" of the row.\n    // Also, return an array that contains the \"content\" height for each row\n    // (the height displaced by the vertically stacked events in the row).\n    // Requires segments to have their `outerHeight` property already set.\n    function calculateVerticals(segments) {\n      var rowCnt = getRowCnt();\n      var colCnt = getColCnt();\n      var rowContentHeights = []; // content height for each row\n      var segmentRows = buildSegmentRows(segments); // an array of segment arrays, one for each row\n\n      for (var rowI = 0; rowI < rowCnt; rowI++) {\n        var segmentRow = segmentRows[rowI];\n\n        // an array of running total heights for each column.\n        // initialize with all zeros.\n        var colHeights = [];\n        for (var colI = 0; colI < colCnt; colI++) {\n          colHeights.push(0);\n        }\n\n        // loop through every segment\n        for (var segmentI = 0; segmentI < segmentRow.length; segmentI++) {\n          var segment = segmentRow[segmentI];\n\n          // find the segment's top coordinate by looking at the max height\n          // of all the columns the segment will be in.\n          segment.top = arrayMax(colHeights.slice(segment.leftCol, segment.rightCol + 1 // make exclusive for slice\n          ));\n\n          // adjust the columns to account for the segment's height\n          for (var colI = segment.leftCol; colI <= segment.rightCol; colI++) {\n            colHeights[colI] = segment.top + segment.outerHeight;\n          }\n        }\n\n        // the tallest column in the row should be the \"content height\"\n        rowContentHeights.push(arrayMax(colHeights));\n      }\n      return rowContentHeights;\n    }\n\n    // Build an array of segment arrays, each representing the segments that will\n    // be in a row of the grid, sorted by which event should be closest to the top.\n    function buildSegmentRows(segments) {\n      var rowCnt = getRowCnt();\n      var segmentRows = [];\n      var segmentI;\n      var segment;\n      var rowI;\n\n      // group segments by row\n      for (segmentI = 0; segmentI < segments.length; segmentI++) {\n        segment = segments[segmentI];\n        rowI = segment.row;\n        if (segment.element) {\n          // was rendered?\n          if (segmentRows[rowI]) {\n            // already other segments. append to array\n            segmentRows[rowI].push(segment);\n          } else {\n            // first segment in row. create new array\n            segmentRows[rowI] = [segment];\n          }\n        }\n      }\n\n      // sort each row\n      for (rowI = 0; rowI < rowCnt; rowI++) {\n        segmentRows[rowI] = sortSegmentRow(segmentRows[rowI] || [] // guarantee an array, even if no segments\n        );\n      }\n\n      return segmentRows;\n    }\n\n    // Sort an array of segments according to which segment should appear closest to the top\n    function sortSegmentRow(segments) {\n      var sortedSegments = [];\n\n      // build the subrow array\n      var subrows = buildSegmentSubrows(segments);\n\n      // flatten it\n      for (var i = 0; i < subrows.length; i++) {\n        sortedSegments.push.apply(sortedSegments, subrows[i]); // append an array to an array\n      }\n\n      return sortedSegments;\n    }\n\n    // Take an array of segments, which are all assumed to be in the same row,\n    // and sort into subrows.\n    function buildSegmentSubrows(segments) {\n      // Give preference to elements with certain criteria, so they have\n      // a chance to be closer to the top.\n      segments.sort(compareDaySegments);\n      var subrows = [];\n      for (var i = 0; i < segments.length; i++) {\n        var segment = segments[i];\n\n        // loop through subrows, starting with the topmost, until the segment\n        // doesn't collide with other segments.\n        for (var j = 0; j < subrows.length; j++) {\n          if (!isDaySegmentCollision(segment, subrows[j])) {\n            break;\n          }\n        }\n        // `j` now holds the desired subrow index\n        if (subrows[j]) {\n          subrows[j].push(segment);\n        } else {\n          subrows[j] = [segment];\n        }\n      }\n      return subrows;\n    }\n\n    // Return an array of jQuery objects for the placeholder content containers of each row.\n    // The content containers don't actually contain anything, but their dimensions should match\n    // the events that are overlaid on top.\n    function getRowContentElements() {\n      var i;\n      var rowCnt = getRowCnt();\n      var rowDivs = [];\n      for (i = 0; i < rowCnt; i++) {\n        rowDivs[i] = allDayRow(i).find('div.fc-day-content > div');\n      }\n      return rowDivs;\n    }\n\n    /* Mouse Handlers\n    ---------------------------------------------------------------------------------------------------*/\n    // TODO: better documentation!\n\n    function attachHandlers(segments, modifiedEventId) {\n      var segmentContainer = getDaySegmentContainer();\n      segmentElementEach(segments, function (segment, element, i) {\n        var event = segment.event;\n        if (event._id === modifiedEventId) {\n          bindDaySeg(event, element, segment);\n        } else {\n          element[0]._fci = i; // for lazySegBind\n        }\n      });\n\n      lazySegBind(segmentContainer, segments, bindDaySeg);\n    }\n    function bindDaySeg(event, eventElement, segment) {\n      if (isEventDraggable(event)) {\n        t.draggableDayEvent(event, eventElement, segment); // use `t` so subclasses can override\n      }\n\n      if (segment.isEnd &&\n      // only allow resizing on the final segment for an event\n      isEventResizable(event)) {\n        t.resizableDayEvent(event, eventElement, segment); // use `t` so subclasses can override\n      }\n\n      // attach all other handlers.\n      // needs to be after, because resizableDayEvent might stopImmediatePropagation on click\n      eventElementHandlers(event, eventElement);\n    }\n    function draggableDayEvent(event, eventElement) {\n      var hoverListener = getHoverListener();\n      var dayDelta;\n      eventElement.draggable({\n        delay: 50,\n        opacity: opt('dragOpacity'),\n        revertDuration: opt('dragRevertDuration'),\n        start: function (ev, ui) {\n          trigger('eventDragStart', eventElement, event, ev, ui);\n          hideEvents(event, eventElement);\n          hoverListener.start(function (cell, origCell, rowDelta, colDelta) {\n            eventElement.draggable('option', 'revert', !cell || !rowDelta && !colDelta);\n            clearOverlays();\n            if (cell) {\n              var origDate = cellToDate(origCell);\n              var date = cellToDate(cell);\n              dayDelta = dayDiff(date, origDate);\n              renderDayOverlay(addDays(cloneDate(event.start), dayDelta), addDays(exclEndDay(event), dayDelta));\n            } else {\n              dayDelta = 0;\n            }\n          }, ev, 'drag');\n        },\n        stop: function (ev, ui) {\n          hoverListener.stop();\n          clearOverlays();\n          trigger('eventDragStop', eventElement, event, ev, ui);\n          if (dayDelta) {\n            eventDrop(this, event, dayDelta, 0, event.allDay, ev, ui);\n          } else {\n            eventElement.css('filter', ''); // clear IE opacity side-effects\n            showEvents(event, eventElement);\n          }\n        }\n      });\n    }\n    function resizableDayEvent(event, element, segment) {\n      var isRTL = opt('isRTL');\n      var direction = isRTL ? 'w' : 'e';\n      var handle = element.find('.ui-resizable-' + direction); // TODO: stop using this class because we aren't using jqui for this\n      var isResizing = false;\n\n      // TODO: look into using jquery-ui mouse widget for this stuff\n      disableTextSelection(element); // prevent native <a> selection for IE\n      element.mousedown(function (ev) {\n        // prevent native <a> selection for others\n        ev.preventDefault();\n      }).click(function (ev) {\n        if (isResizing) {\n          ev.preventDefault(); // prevent link from being visited (only method that worked in IE6)\n          ev.stopImmediatePropagation(); // prevent fullcalendar eventClick handler from being called\n          // (eventElementHandlers needs to be bound after resizableDayEvent)\n        }\n      });\n\n      handle.mousedown(function (ev) {\n        if (ev.which != 1) {\n          return; // needs to be left mouse button\n        }\n\n        isResizing = true;\n        var hoverListener = getHoverListener();\n        var rowCnt = getRowCnt();\n        var colCnt = getColCnt();\n        var elementTop = element.css('top');\n        var dayDelta;\n        var helpers;\n        var eventCopy = $.extend({}, event);\n        var minCellOffset = dayOffsetToCellOffset(dateToDayOffset(event.start));\n        clearSelection();\n        $('body').css('cursor', direction + '-resize').one('mouseup', mouseup);\n        trigger('eventResizeStart', this, event, ev);\n        hoverListener.start(function (cell, origCell) {\n          if (cell) {\n            var origCellOffset = cellToCellOffset(origCell);\n            var cellOffset = cellToCellOffset(cell);\n\n            // don't let resizing move earlier than start date cell\n            cellOffset = Math.max(cellOffset, minCellOffset);\n            dayDelta = cellOffsetToDayOffset(cellOffset) - cellOffsetToDayOffset(origCellOffset);\n            if (dayDelta) {\n              eventCopy.end = addDays(eventEnd(event), dayDelta, true);\n              var oldHelpers = helpers;\n              helpers = renderTempDayEvent(eventCopy, segment.row, elementTop);\n              helpers = $(helpers); // turn array into a jQuery object\n\n              helpers.find('*').css('cursor', direction + '-resize');\n              if (oldHelpers) {\n                oldHelpers.remove();\n              }\n              hideEvents(event);\n            } else {\n              if (helpers) {\n                showEvents(event);\n                helpers.remove();\n                helpers = null;\n              }\n            }\n            clearOverlays();\n            renderDayOverlay(\n            // coordinate grid already rebuilt with hoverListener.start()\n            event.start, addDays(exclEndDay(event), dayDelta)\n            // TODO: instead of calling renderDayOverlay() with dates,\n            // call _renderDayOverlay (or whatever) with cell offsets.\n            );\n          }\n        }, ev);\n        function mouseup(ev) {\n          trigger('eventResizeStop', this, event, ev);\n          $('body').css('cursor', '');\n          hoverListener.stop();\n          clearOverlays();\n          if (dayDelta) {\n            eventResize(this, event, dayDelta, 0, ev);\n            // event redraw will clear helpers\n          }\n          // otherwise, the drag handler already restored the old events\n\n          setTimeout(function () {\n            // make this happen after the element's click event\n            isResizing = false;\n          }, 0);\n        }\n      });\n    }\n  }\n\n  /* Generalized Segment Utilities\n  -------------------------------------------------------------------------------------------------*/\n\n  function isDaySegmentCollision(segment, otherSegments) {\n    for (var i = 0; i < otherSegments.length; i++) {\n      var otherSegment = otherSegments[i];\n      if (otherSegment.leftCol <= segment.rightCol && otherSegment.rightCol >= segment.leftCol) {\n        return true;\n      }\n    }\n    return false;\n  }\n  function segmentElementEach(segments, callback) {\n    // TODO: use in AgendaView?\n    for (var i = 0; i < segments.length; i++) {\n      var segment = segments[i];\n      var element = segment.element;\n      if (element) {\n        callback(segment, element, i);\n      }\n    }\n  }\n\n  // A cmp function for determining which segments should appear higher up\n  function compareDaySegments(a, b) {\n    return b.rightCol - b.leftCol - (a.rightCol - a.leftCol) ||\n    // put wider events first\n    b.event.allDay - a.event.allDay ||\n    // if tie, put all-day events first (booleans cast to 0/1)\n    a.event.start - b.event.start ||\n    // if a tie, sort by event start date\n    (a.event.title || '').localeCompare(b.event.title); // if a tie, sort by event title\n  }\n\n  ;\n  ;\n\n  //BUG: unselect needs to be triggered when events are dragged+dropped\n\n  function SelectionManager() {\n    var t = this;\n\n    // exports\n    t.select = select;\n    t.unselect = unselect;\n    t.reportSelection = reportSelection;\n    t.daySelectionMousedown = daySelectionMousedown;\n\n    // imports\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var defaultSelectionEnd = t.defaultSelectionEnd;\n    var renderSelection = t.renderSelection;\n    var clearSelection = t.clearSelection;\n\n    // locals\n    var selected = false;\n\n    // unselectAuto\n    if (opt('selectable') && opt('unselectAuto')) {\n      $(document).mousedown(function (ev) {\n        var ignore = opt('unselectCancel');\n        if (ignore) {\n          if ($(ev.target).parents(ignore).length) {\n            // could be optimized to stop after first match\n            return;\n          }\n        }\n        unselect(ev);\n      });\n    }\n    function select(startDate, endDate, allDay) {\n      unselect();\n      if (!endDate) {\n        endDate = defaultSelectionEnd(startDate, allDay);\n      }\n      renderSelection(startDate, endDate, allDay);\n      reportSelection(startDate, endDate, allDay);\n    }\n    function unselect(ev) {\n      if (selected) {\n        selected = false;\n        clearSelection();\n        trigger('unselect', null, ev);\n      }\n    }\n    function reportSelection(startDate, endDate, allDay, ev) {\n      selected = true;\n      trigger('select', null, startDate, endDate, allDay, ev);\n    }\n    function daySelectionMousedown(ev) {\n      // not really a generic manager method, oh well\n      var cellToDate = t.cellToDate;\n      var getIsCellAllDay = t.getIsCellAllDay;\n      var hoverListener = t.getHoverListener();\n      var reportDayClick = t.reportDayClick; // this is hacky and sort of weird\n      if (ev.which == 1 && opt('selectable')) {\n        // which==1 means left mouse button\n        unselect(ev);\n        var _mousedownElement = this;\n        var dates;\n        hoverListener.start(function (cell, origCell) {\n          // TODO: maybe put cellToDate/getIsCellAllDay info in cell\n          clearSelection();\n          if (cell && getIsCellAllDay(cell)) {\n            dates = [cellToDate(origCell), cellToDate(cell)].sort(dateCompare);\n            renderSelection(dates[0], dates[1], true);\n          } else {\n            dates = null;\n          }\n        }, ev);\n        $(document).one('mouseup', function (ev) {\n          hoverListener.stop();\n          if (dates) {\n            if (+dates[0] == +dates[1]) {\n              reportDayClick(dates[0], true, ev);\n            }\n            reportSelection(dates[0], dates[1], true, ev);\n          }\n        });\n      }\n    }\n  }\n  ;\n  ;\n  function OverlayManager() {\n    var t = this;\n\n    // exports\n    t.renderOverlay = renderOverlay;\n    t.clearOverlays = clearOverlays;\n\n    // locals\n    var usedOverlays = [];\n    var unusedOverlays = [];\n    function renderOverlay(rect, parent) {\n      var e = unusedOverlays.shift();\n      if (!e) {\n        e = $(\"<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>\");\n      }\n      if (e[0].parentNode != parent[0]) {\n        e.appendTo(parent);\n      }\n      usedOverlays.push(e.css(rect).show());\n      return e;\n    }\n    function clearOverlays() {\n      var e;\n      while (e = usedOverlays.shift()) {\n        unusedOverlays.push(e.hide().unbind());\n      }\n    }\n  }\n  ;\n  ;\n  function CoordinateGrid(buildFunc) {\n    var t = this;\n    var rows;\n    var cols;\n    t.build = function () {\n      rows = [];\n      cols = [];\n      buildFunc(rows, cols);\n    };\n    t.cell = function (x, y) {\n      var rowCnt = rows.length;\n      var colCnt = cols.length;\n      var i,\n        r = -1,\n        c = -1;\n      for (i = 0; i < rowCnt; i++) {\n        if (y >= rows[i][0] && y < rows[i][1]) {\n          r = i;\n          break;\n        }\n      }\n      for (i = 0; i < colCnt; i++) {\n        if (x >= cols[i][0] && x < cols[i][1]) {\n          c = i;\n          break;\n        }\n      }\n      return r >= 0 && c >= 0 ? {\n        row: r,\n        col: c\n      } : null;\n    };\n    t.rect = function (row0, col0, row1, col1, originElement) {\n      // row1,col1 is inclusive\n      var origin = originElement.offset();\n      return {\n        top: rows[row0][0] - origin.top,\n        left: cols[col0][0] - origin.left,\n        width: cols[col1][1] - cols[col0][0],\n        height: rows[row1][1] - rows[row0][0]\n      };\n    };\n  }\n  ;\n  ;\n  function HoverListener(coordinateGrid) {\n    var t = this;\n    var bindType;\n    var change;\n    var firstCell;\n    var cell;\n    t.start = function (_change, ev, _bindType) {\n      change = _change;\n      firstCell = cell = null;\n      coordinateGrid.build();\n      mouse(ev);\n      bindType = _bindType || 'mousemove';\n      $(document).bind(bindType, mouse);\n    };\n    function mouse(ev) {\n      _fixUIEvent(ev); // see below\n      var newCell = coordinateGrid.cell(ev.pageX, ev.pageY);\n      if (!newCell != !cell || newCell && (newCell.row != cell.row || newCell.col != cell.col)) {\n        if (newCell) {\n          if (!firstCell) {\n            firstCell = newCell;\n          }\n          change(newCell, firstCell, newCell.row - firstCell.row, newCell.col - firstCell.col);\n        } else {\n          change(newCell, firstCell);\n        }\n        cell = newCell;\n      }\n    }\n    t.stop = function () {\n      $(document).unbind(bindType, mouse);\n      return cell;\n    };\n  }\n\n  // this fix was only necessary for jQuery UI 1.8.16 (and jQuery 1.7 or 1.7.1)\n  // upgrading to jQuery UI 1.8.17 (and using either jQuery 1.7 or 1.7.1) fixed the problem\n  // but keep this in here for 1.8.16 users\n  // and maybe remove it down the line\n\n  function _fixUIEvent(event) {\n    // for issue 1168\n    if (event.pageX === undefined) {\n      event.pageX = event.originalEvent.pageX;\n      event.pageY = event.originalEvent.pageY;\n    }\n  }\n  ;\n  ;\n  function HorizontalPositionCache(getElement) {\n    var t = this,\n      elements = {},\n      lefts = {},\n      rights = {};\n    function e(i) {\n      return elements[i] = elements[i] || getElement(i);\n    }\n    t.left = function (i) {\n      return lefts[i] = lefts[i] === undefined ? e(i).position().left : lefts[i];\n    };\n    t.right = function (i) {\n      return rights[i] = rights[i] === undefined ? t.left(i) + e(i).width() : rights[i];\n    };\n    t.clear = function () {\n      elements = {};\n      lefts = {};\n      rights = {};\n    };\n  }\n  ;\n  ;\n})();\nexport default CadastroHorario;\nvar _c;\n$RefreshReg$(_c, \"CadastroHorario\");","map":{"version":3,"names":["React","useState","useEffect","jsxDEV","_jsxDEV","CadastroHorario","_s","selectedProfessor","setSelectedProfessor","selectedSala","setSelectedSala","selectedNomeDesafio","setSelectedNomeDesafio","setSelectedCurso","professores","setProfessores","salas","setSalas","nomeDesafios","setNomeDesafios","horarios","setHorarios","horaInicial","setHoraInicial","horaFinal","setHoraFinal","storedHorarios","JSON","parse","localStorage","getItem","storedProfessores","storedSalas","storedDesafios","adicionarHorarios","trim","novoHorario","id","Date","getTime","professor","sala","desafio","console","log","prevHorarios","newHorarios","setItem","stringify","excluirHorario","index","splice","children","className","fileName","_jsxFileName","lineNumber","columnNumber","value","onChange","e","target","disabled","map","nomeProfessor","numeroSala","nomeDesafio","type","onClick","horario","_c","$","undefined","defaults","defaultView","aspectRatio","header","left","center","right","weekends","weekNumbers","weekNumberCalculation","weekNumberTitle","allDayDefault","ignoreTimezone","lazyFetching","startParam","endParam","titleFormat","month","week","day","columnFormat","timeFormat","isRTL","firstDay","monthNames","monthNamesShort","dayNames","dayNamesShort","buttonText","prev","next","prevYear","nextYear","today","theme","buttonIcons","unselectAuto","dropAccept","handleWindowResize","rtlDefaults","fc","fullCalendar","version","fcViews","views","fn","options","args","Array","prototype","slice","call","arguments","res","each","calendar","data","isFunction","r","apply","removeData","eventSources","events","push","extend","i","_element","element","Calendar","render","setDefaults","d","t","destroy","refetchEvents","reportEvents","reportEventChange","rerenderEvents","changeView","select","unselect","gotoDate","incrementDate","formatDate","format","date","formatDates","date1","date2","getDate","getView","option","trigger","EventManager","isFetchNeeded","fetchEvents","headerElement","content","tm","currentView","elementOuterWidth","suggestedViewHeight","resizeUID","ignoreWindowResize","_dragElement","setYMD","year","inc","initialRender","elementVisible","calcSize","_renderView","addClass","prependTo","Header","prepend","window","resize","windowResize","bodyVisible","lateRender","setTimeout","start","renderView","triggerEventDestroy","unbind","remove","removeClass","is","newViewName","name","_changeView","freezeContentHeight","deactivateButton","activateButton","appendTo","unfreezeContentHeight","end","clearEvents","setSize","afterRender","noop","updateTitle","updateTodayButton","getAndRenderEvents","updateSize","renderEvents","contentHeight","height","vsides","Math","round","width","max","setHeight","setWidth","outerWidth","uid","fetchAndRenderEvents","modifiedEventID","setEventData","clearEventData","visStart","visEnd","_events","eventID","title","disableButton","enableButton","allDay","addYears","dateOfMonth","cloneDate","years","months","days","addMonths","addDays","css","overflow","thisObj","droppable","document","bind","ev","ui","_e","parents","length","accept","dragStart","dragStop","sections","append","renderSection","position","buttonStr","split","prevButton","j","buttonName","buttonClick","button","icon","smartProperty","text","click","hasClass","mousedown","not","mouseup","hover","disableTextSelection","html","find","sourceNormalizers","sourceFetchers","ajaxDefaults","dataType","cache","eventGUID","_sources","addEventSource","removeEventSource","updateEvent","renderEvent","removeEvents","clientEvents","normalizeEvent","stickySource","sources","rangeStart","rangeEnd","currentFetchID","pendingSourceCnt","loadingLevel","_addEventSource","fetchID","len","fetchEventSource","source","_fetchEventSource","eventDataTransform","concat","callback","fetchers","pushLoading","popLoading","isArray","url","success","error","complete","customData","firstDefined","ajax","applyAll","normalizeSource","grep","src","isSourcesEqual","event","defaultEventEnd","startDelta","_start","endDelta","_end","_id","editable","color","backgroundColor","borderColor","textColor","stick","filter","parseDate","normalizers","source1","source2","getSourcePrimitive","parseISO8601","parseTime","dayIDs","DAY_MS","HOUR_MS","MINUTE_MS","n","keepTime","setFullYear","getFullYear","clearTime","m","getMonth","check","setDate","setMonth","dd","setHours","fixDate","setTime","addMinutes","setMinutes","getMinutes","setSeconds","setMilliseconds","dontKeepTime","zeroDate","getHours","dayDiff","d1","d2","y","s","match","parseFloat","Number","setUTCFullYear","setUTCHours","offset","h","parseInt","toLowerCase","charAt","otherDate","c","i2","formatter","substring","subres","replace","subformat","dateFormatters","getSeconds","ss","zeroPad","mm","hh","H","HH","ddd","o","getDay","dddd","M","MM","MMM","MMMM","yy","yyyy","tt","T","TT","u","S","w","W","iso8601Week","time","checkDate","floor","exclEndDay","_exclEndDay","lazySegBind","container","segs","bindHandlers","mouseover","parent","seg","parentNode","_fci","stopPropagation","setOuterWidth","includeMargins","hsides","setOuterHeight","hpadding","hborders","hmargins","vpadding","vborders","vmargins","dateCompare","a","b","arrayMax","obj","parts","htmlEscape","attr","markFirstLast","setDayID","cell","_cell","getSkinCss","opt","eventColor","sourceColor","optionColor","statements","join","functions","ret","MonthView","BasicView","renderBasic","skipHiddenDays","getCellsPerWeek","delta","colCnt","rowCnt","basicWeek","BasicWeekView","basicDay","BasicDayView","weekMode","viewName","renderDayOverlay","defaultSelectionEnd","renderSelection","clearSelection","reportDayClick","getHoverListener","hoverListener","colLeft","colRight","colContentLeft","colContentRight","getIsCellAllDay","allDayRow","getRowCnt","getColCnt","getColWidth","colWidth","getDaySegmentContainer","daySegmentContainer","View","OverlayManager","SelectionManager","BasicEventRenderer","renderOverlay","clearOverlays","daySelectionMousedown","cellToDate","dateToCell","rangeToSegments","table","head","headCells","body","bodyRows","bodyCells","bodyFirstCells","firstRowCellInners","firstRowCellContentInners","viewWidth","viewHeight","weekNumberWidth","showNumbers","coordinateGrid","colPositions","colContentPositions","colFormat","showWeekNumbers","weekNumberFormat","_rowCnt","_colCnt","_showNumbers","updateOptions","buildEventContainer","buildTable","buildTableHTML","eq","add","dayBind","buildHeadHTML","buildBodyHTML","headerClass","col","contentClass","row","buildCellHTML","classNames","bodyHeight","rowHeight","rowHeightLast","clear","dayClick","overlayStart","overlayEnd","refreshCoordinateGrid","build","segments","segment","renderCellOverlay","leftCol","rightCol","row0","col0","row1","col1","rect","startDate","endDate","stop","CoordinateGrid","rows","cols","p","top","outerHeight","HoverListener","HorizontalPositionCache","DayEventRenderer","modifiedEventId","renderDayEvents","empty","agendaWeek","AgendaWeekView","AgendaView","renderAgenda","agendaDay","AgendaDayView","allDaySlot","allDayText","firstHour","slotMinutes","defaultEventMinutes","axisFormat","agenda","dragOpacity","minTime","maxTime","slotEventOverlap","timePosition","getAllDayRow","getCoordinateGrid","getSlotSegmentContainer","slotSegmentContainer","getMinMinute","minMinute","getMaxMinute","maxMinute","getSlotContainer","slotContainer","getSnapHeight","snapHeight","getSnapMinutes","snapMinutes","AgendaEventRenderer","reportSelection","slotSegHtml","dayTable","dayHead","dayHeadCells","dayBody","dayBodyCells","dayBodyCellInners","dayBodyCellContentInners","dayBodyFirstCell","dayBodyFirstCellStretcher","slotLayer","allDayTable","slotScroller","slotTable","selectionHelper","axisWidth","gutterWidth","slotHeight","snapRatio","slotCnt","slotTopCache","rtl","buildSkeleton","buildDayTable","maxd","minutes","slotNormal","slotBind","buildDayTableHTML","buildDayTableHeadHTML","buildDayTableBodyHTML","weekText","cellsHTML","cellHTML","headHeight","allDayHeight","min","axisFirstCells","gutterCells","slotTableWidth","clientWidth","show","hide","resetScroll","d0","scrollDate","scroll","scrollTop","cells","slotClick","slotSelectionMousedown","pageX","rowMatch","mins","hours","renderSlotOverlay","dayStart","dayEnd","stretchStart","stretchEnd","bottom","slotTableTop","slotScrollerTop","slotScrollerBottom","constrain","realCellToDate","slotIndex","slotI","slotTop","offsetTop","renderSlotSelection","helperOption","helperRes","isStart","isEnd","which","dates","origCell","sort","one","isEventDraggable","isEventResizable","eventEnd","eventElementHandlers","reportEventElement","showEvents","hideEvents","eventDrop","eventResize","draggableDayEvent","dayEvents","slotEvents","renderSlotSegs","compileSlotSegs","visEventEnds","slotEventEnd","colSegs","sliceSegs","placeSlotSegs","eventStart","segStart","segEnd","compareSlotSegs","segCnt","columnLeft","columnRight","columnWidth","eventElements","eventElement","triggerRes","titleElement","forwardCoord","backwardCoord","innerHTML","bindSlotSeg","contentTop","style","skinCss","classes","timeElement","draggableSlotEvent","resizableSlotEvent","origWidth","revert","dayDelta","draggable","opacity","revertDuration","origDate","resetElement","minuteDelta","origPosition","isInBounds","prevIsInBounds","isAllDay","prevIsAllDay","colDelta","prevColDelta","prevMinuteDelta","grid","axis","pageY","drag","updateUI","updateTimeText","newStart","newEnd","snapDelta","prevSnapDelta","resizable","handles","originalSize","levels","buildSlotSegLevels","level0","computeForwardSlotSegs","computeSlotSegPressures","computeSlotSegCoords","flattenSlotSegLevels","computeSlotSegCollisions","level","k","forwardSegs","forwardPressure","forwardSeg","seriesBackwardPressure","seriesBackwardCoord","compareForwardSlotSegs","otherSegs","results","isSlotSegCollision","seg1","seg2","localeCompare","eventsByID","eventElementsByID","eventElementCouples","viewNameOverride","v","isPlainObject","startEditable","durationEditable","couple","exceptElement","eachEventElement","funcName","elements","oldAllDay","eventId","moveEvents","elongateEvents","isHiddenDay","dateToDayOffset","dayOffsetToCellOffset","cellOffsetToCell","cellToCellOffset","cellOffsetToDayOffset","dayOffsetToDate","hiddenDays","isHiddenDayHash","cellsPerWeek","dayToCellMap","cellToDayMap","dayIndex","cellIndex","inArray","isExclusive","cellOffset","dayOffset","dis","dit","day0","rangeDayOffsetStart","rangeDayOffsetEnd","rangeCellOffsetFirst","rangeCellOffsetLast","rowCellOffsetFirst","rowCellOffsetLast","segmentCellOffsetFirst","segmentCellOffsetLast","segmentCellFirst","segmentCellLast","resizableDayEvent","_renderDayEvents","segmentElementEach","attachHandlers","renderTempDayEvent","adjustRow","adjustTop","doAppend","doRowHeights","finalContainer","renderContainer","buildSegments","calculateHorizontals","buildHTML","resolveElements","setVerticals","eventSegments","buildSegmentsForEvent","leftFunc","rightFunc","buildHTMLForSegment","replaceWith","rowContentHeights","calculateVerticals","rowContentElements","getRowContentElements","rowContentTops","segmentRows","buildSegmentRows","rowI","segmentRow","colHeights","colI","segmentI","sortSegmentRow","sortedSegments","subrows","buildSegmentSubrows","compareDaySegments","isDaySegmentCollision","rowDivs","segmentContainer","bindDaySeg","delay","rowDelta","direction","handle","isResizing","preventDefault","stopImmediatePropagation","elementTop","helpers","eventCopy","minCellOffset","origCellOffset","oldHelpers","otherSegments","otherSegment","selected","ignore","_mousedownElement","usedOverlays","unusedOverlays","shift","buildFunc","x","originElement","origin","bindType","change","firstCell","_change","_bindType","mouse","_fixUIEvent","newCell","originalEvent","getElement","lefts","rights","$RefreshReg$"],"sources":["/home/nomade00/Ãrea de Trabalho/Trabalho James/trabcar/src/pages/CadHorario.js"],"sourcesContent":["\nimport React, { useState, useEffect } from 'react';\n\nfunction CadastroHorario() {\n  const [selectedProfessor, setSelectedProfessor] = useState('');\n  const [selectedSala, setSelectedSala] = useState('');\n  const [selectedNomeDesafio, setSelectedNomeDesafio] = useState('');\n  const [setSelectedCurso] = useState('');\n  const [professores, setProfessores] = useState([]);\n  const [salas, setSalas] = useState([]);\n  const [nomeDesafios, setNomeDesafios] = useState([]);\n  const [horarios, setHorarios] = useState([]);\n  const [horaInicial, setHoraInicial] = useState([]);\n  const [horaFinal, setHoraFinal] = useState([]);\n\n\n  useEffect(() => {\n    const storedHorarios = JSON.parse(localStorage.getItem('Horarios')) || [];\n    setHorarios(storedHorarios);\n  \n    const storedProfessores = JSON.parse(localStorage.getItem('Professores')) || [];\n    setProfessores(storedProfessores);\n  \n    const storedSalas = JSON.parse(localStorage.getItem('Salas')) || [];\n    setSalas(storedSalas);\n  \n    const storedDesafios = JSON.parse(localStorage.getItem('Desafios')) || [];\n    setNomeDesafios(storedDesafios);\n  \n  }, []);\n  \n  const adicionarHorarios = () => {\n   \n    if (\n      selectedProfessor.trim() &&\n      horaFinal.trim() &&\n      horaInicial.trim() &&\n      selectedSala.trim()\n      \n    ) {\n\n      const novoHorario = {\n        id: new Date().getTime(),\n        professor: selectedProfessor,      \n        sala: selectedSala,\n        desafio: selectedNomeDesafio,\n        horaInicial: horaInicial,\n        horaFinal: horaFinal,\n      };\n  console.log(novoHorario)\n      setHorarios((prevHorarios) => {\n        const newHorarios = [...prevHorarios, novoHorario];\n        localStorage.setItem('Horarios', JSON.stringify(newHorarios));\n        return newHorarios;\n      });\n  \n      // Limpa os campos apÃ³s adicionar\n      setSelectedProfessor('');\n      setSelectedCurso('');\n      setHoraInicial('');\n      setHoraFinal('');\n      setSelectedSala('');\n    }\n  };\n\n  const excluirHorario = (index) => {\n    const novoHorario = [...horarios];\n    novoHorario.splice(index, 1);\n    setHorarios(novoHorario);\n    localStorage.setItem('Horario', JSON.stringify(novoHorario))\n  };\n\n\n  return (\n    <div>\n      <div id='Cad' className=\"form-container\">\n  \n        <h4>Selecione um Professor: </h4>\n        <select\n          id=\"professor\"\n          value={selectedProfessor}\n          onChange={(e) => setSelectedProfessor(e.target.value)}\n        >\n          <option value=\"\" disabled>Selecione um professor</option>\n          {professores.map((professor, index) => (\n            <option key={index} value={professor.nomeProfessor}>{professor.nomeProfessor}</option>\n          ))}\n        </select>\n\n        <h4>Selecione uma Sala: </h4>\n        <select\n          id=\"sala\"\n          value={selectedSala}\n          onChange={(e) => setSelectedSala(e.target.value)}\n        >\n          <option value=\"\" disabled>\n            Selecione uma Sala\n          </option>\n          {salas.map((sala, index) => (\n            <option key={index} value={sala.numeroSala}>\n              {sala.numeroSala}\n            </option>\n          ))}\n        </select>\n\n        <h4>Selecione um Desafio: </h4>\n        <select\n          id=\"desafio\"\n          value={selectedNomeDesafio}\n          onChange={(e) => setSelectedNomeDesafio(e.target.value)}\n        >\n          <option value=\"\" disabled>\n            Selecione um Desafio\n          </option>\n          {nomeDesafios.map((desafio, index) => (\n            <option key={index} value={desafio.nomeDesafio}>\n              {desafio.nomeDesafio}\n            </option>\n          ))}\n        </select>\n            <div>\n        <h4>HorÃ¡rio Inicio: </h4>\n        <input\n          className='home-container'\n          type=\"time\"\n          value={horaInicial}\n          onChange={(e) => setHoraInicial(e.target.value)}\n        />\n\n        <h4>HorÃ¡rio Final: </h4>\n        <input\n          className='home-container'\n          type=\"time\"\n          value={horaFinal}\n          onChange={(e) => setHoraFinal(e.target.value)}\n        />\n        </div>\n\n        <button onClick={adicionarHorarios}>Adicionar</button>\n        \n      </div>\n\n      <div className=\"table-container\">\n        <h2>Horario</h2>\n        <table id=\"tabelaPessoas\">\n          <thead>\n            <tr>\n              <th>ID</th>\n              <th>Professor</th>\n              <th>Sala</th>\n              <th>Curso</th>\n              <th>Horario</th>\n\n            </tr>\n          </thead>\n          <tbody>\n            {horarios.map((horario, index) => (\n              <tr key={horario.id}>\n                <td>{horario.id}</td>\n                <td>{horario.professor}</td>\n                <td>{horario.sala}</td>\n                <td>{horario.desafio}</td>\n                <td>{horario.horaInicial} a{' '}\n                  {horario.horaFinal}\n                </td>\n                <td>\n                  <button className=\"excluir-btn\" onClick={() => excluirHorario(horario.id)}>\n                    Excluir\n                  </button>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}\n\n/*!\n * FullCalendar v1.6.4\n * Docs & License: http://arshaw.com/fullcalendar/\n * (c) 2013 Adam Shaw\n */\n\n/*\n * Use fullcalendar.css for basic styling.\n * For event drag & drop, requires jQuery UI draggable.\n * For event resizing, requires jQuery UI resizable.\n */\n \n(function($, undefined) {\n\n\n  ;;\n  \n  var defaults = {\n  \n    // display\n    defaultView: 'month',\n    aspectRatio: 1.35,\n    header: {\n      left: 'title',\n      center: '',\n      right: 'today prev,next'\n    },\n    weekends: true,\n    weekNumbers: false,\n    weekNumberCalculation: 'iso',\n    weekNumberTitle: 'W',\n    \n    // editing\n    //editable: false,\n    //disableDragging: false,\n    //disableResizing: false,\n    \n    allDayDefault: true,\n    ignoreTimezone: true,\n    \n    // event ajax\n    lazyFetching: true,\n    startParam: 'start',\n    endParam: 'end',\n    \n    // time formats\n    titleFormat: {\n      month: 'MMMM yyyy',\n      week: \"MMM d[ yyyy]{ 'â'[ MMM] d yyyy}\",\n      day: 'dddd, MMM d, yyyy'\n    },\n    columnFormat: {\n      month: 'ddd',\n      week: 'ddd M/d',\n      day: 'dddd M/d'\n    },\n    timeFormat: { // for event elements\n      '': 'h(:mm)t' // default\n    },\n    \n    // locale\n    isRTL: false,\n    firstDay: 0,\n    monthNames: ['January','February','March','April','May','June','July','August','September','October','November','December'],\n    monthNamesShort: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],\n    dayNames: ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],\n    dayNamesShort: ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],\n    buttonText: {\n      prev: \"<span class='fc-text-arrow'>â¹</span>\",\n      next: \"<span class='fc-text-arrow'>âº</span>\",\n      prevYear: \"<span class='fc-text-arrow'>Â«</span>\",\n      nextYear: \"<span class='fc-text-arrow'>Â»</span>\",\n      today: 'today',\n      month: 'month',\n      week: 'week',\n      day: 'day'\n    },\n    \n    // jquery-ui theming\n    theme: false,\n    buttonIcons: {\n      prev: 'circle-triangle-w',\n      next: 'circle-triangle-e'\n    },\n    \n    //selectable: false,\n    unselectAuto: true,\n    \n    dropAccept: '*',\n    \n    handleWindowResize: true\n    \n  };\n  \n  // right-to-left defaults\n  var rtlDefaults = {\n    header: {\n      left: 'next,prev today',\n      center: '',\n      right: 'title'\n    },\n    buttonText: {\n      prev: \"<span class='fc-text-arrow'>âº</span>\",\n      next: \"<span class='fc-text-arrow'>â¹</span>\",\n      prevYear: \"<span class='fc-text-arrow'>Â»</span>\",\n      nextYear: \"<span class='fc-text-arrow'>Â«</span>\"\n    },\n    buttonIcons: {\n      prev: 'circle-triangle-e',\n      next: 'circle-triangle-w'\n    }\n  };\n  \n  \n  \n  ;;\n  \n  var fc = $.fullCalendar = { version: \"1.6.4\" };\n  var fcViews = fc.views = {};\n  \n  \n  $.fn.fullCalendar = function(options) {\n  \n  \n    // method calling\n    if (typeof options == 'string') {\n      var args = Array.prototype.slice.call(arguments, 1);\n      var res;\n      this.each(function() {\n        var calendar = $.data(this, 'fullCalendar');\n        if (calendar && $.isFunction(calendar[options])) {\n          var r = calendar[options].apply(calendar, args);\n          if (res === undefined) {\n            res = r;\n          }\n          if (options == 'destroy') {\n            $.removeData(this, 'fullCalendar');\n          }\n        }\n      });\n      if (res !== undefined) {\n        return res;\n      }\n      return this;\n    }\n  \n    options = options || {};\n    \n    // would like to have this logic in EventManager, but needs to happen before options are recursively extended\n    var eventSources = options.eventSources || [];\n    delete options.eventSources;\n    if (options.events) {\n      eventSources.push(options.events);\n      delete options.events;\n    }\n    \n  \n    options = $.extend(true, {},\n      defaults,\n      (options.isRTL || options.isRTL===undefined && defaults.isRTL) ? rtlDefaults : {},\n      options\n    );\n    \n    \n    this.each(function(i, _element) {\n      var element = $(_element);\n      var calendar = new Calendar(element, options, eventSources);\n      element.data('fullCalendar', calendar); // TODO: look into memory leak implications\n      calendar.render();\n    });\n    \n    \n    return this;\n    \n  };\n  \n  \n  // function for adding/overriding defaults\n  function setDefaults(d) {\n    $.extend(true, defaults, d);\n  }\n  \n  \n  \n  ;;\n  \n   \n  function Calendar(element, options, eventSources) {\n    var t = this;\n    \n    \n    // exports\n    t.options = options;\n    t.render = render;\n    t.destroy = destroy;\n    t.refetchEvents = refetchEvents;\n    t.reportEvents = reportEvents;\n    t.reportEventChange = reportEventChange;\n    t.rerenderEvents = rerenderEvents;\n    t.changeView = changeView;\n    t.select = select;\n    t.unselect = unselect;\n    t.prev = prev;\n    t.next = next;\n    t.prevYear = prevYear;\n    t.nextYear = nextYear;\n    t.today = today;\n    t.gotoDate = gotoDate;\n    t.incrementDate = incrementDate;\n    t.formatDate = function(format, date) { return formatDate(format, date, options) };\n    t.formatDates = function(format, date1, date2) { return formatDates(format, date1, date2, options) };\n    t.getDate = getDate;\n    t.getView = getView;\n    t.option = option;\n    t.trigger = trigger;\n    \n    \n    // imports\n    EventManager.call(t, options, eventSources);\n    var isFetchNeeded = t.isFetchNeeded;\n    var fetchEvents = t.fetchEvents;\n    \n    \n    // locals\n    var _element = element[0];\n    var header;\n    var headerElement;\n    var content;\n    var tm; // for making theme classes\n    var currentView;\n    var elementOuterWidth;\n    var suggestedViewHeight;\n    var resizeUID = 0;\n    var ignoreWindowResize = 0;\n    var date = new Date();\n    var events = [];\n    var _dragElement;\n    \n    \n    \n    /* Main Rendering\n    -----------------------------------------------------------------------------*/\n    \n    \n    setYMD(date, options.year, options.month, options.date);\n    \n    \n    function render(inc) {\n      if (!content) {\n        initialRender();\n      }\n      else if (elementVisible()) {\n        // mainly for the public API\n        calcSize();\n        _renderView(inc);\n      }\n    }\n    \n    \n    function initialRender() {\n      tm = options.theme ? 'ui' : 'fc';\n      element.addClass('fc');\n      if (options.isRTL) {\n        element.addClass('fc-rtl');\n      }\n      else {\n        element.addClass('fc-ltr');\n      }\n      if (options.theme) {\n        element.addClass('ui-widget');\n      }\n  \n      content = $(\"<div class='fc-content' style='position:relative'/>\")\n        .prependTo(element);\n  \n      header = new Header(t, options);\n      headerElement = header.render();\n      if (headerElement) {\n        element.prepend(headerElement);\n      }\n  \n      changeView(options.defaultView);\n  \n      if (options.handleWindowResize) {\n        $(window).resize(windowResize);\n      }\n  \n      // needed for IE in a 0x0 iframe, b/c when it is resized, never triggers a windowResize\n      if (!bodyVisible()) {\n        lateRender();\n      }\n    }\n    \n    \n    // called when we know the calendar couldn't be rendered when it was initialized,\n    // but we think it's ready now\n    function lateRender() {\n      setTimeout(function() { // IE7 needs this so dimensions are calculated correctly\n        if (!currentView.start && bodyVisible()) { // !currentView.start makes sure this never happens more than once\n          renderView();\n        }\n      },0);\n    }\n    \n    \n    function destroy() {\n  \n      if (currentView) {\n        trigger('viewDestroy', currentView, currentView, currentView.element);\n        currentView.triggerEventDestroy();\n      }\n  \n      $(window).unbind('resize', windowResize);\n  \n      header.destroy();\n      content.remove();\n      element.removeClass('fc fc-rtl ui-widget');\n    }\n    \n    \n    function elementVisible() {\n      return element.is(':visible');\n    }\n    \n    \n    function bodyVisible() {\n      return $('body').is(':visible');\n    }\n    \n    \n    \n    /* View Rendering\n    -----------------------------------------------------------------------------*/\n    \n  \n    function changeView(newViewName) {\n      if (!currentView || newViewName != currentView.name) {\n        _changeView(newViewName);\n      }\n    }\n  \n  \n    function _changeView(newViewName) {\n      ignoreWindowResize++;\n  \n      if (currentView) {\n        trigger('viewDestroy', currentView, currentView, currentView.element);\n        unselect();\n        currentView.triggerEventDestroy(); // trigger 'eventDestroy' for each event\n        freezeContentHeight();\n        currentView.element.remove();\n        header.deactivateButton(currentView.name);\n      }\n  \n      header.activateButton(newViewName);\n  \n      currentView = new fcViews[newViewName](\n        $(\"<div class='fc-view fc-view-\" + newViewName + \"' style='position:relative'/>\")\n          .appendTo(content),\n        t // the calendar object\n      );\n  \n      renderView();\n      unfreezeContentHeight();\n  \n      ignoreWindowResize--;\n    }\n  \n  \n    function renderView(inc) {\n      if (\n        !currentView.start || // never rendered before\n        inc || date < currentView.start || date >= currentView.end // or new date range\n      ) {\n        if (elementVisible()) {\n          _renderView(inc);\n        }\n      }\n    }\n  \n  \n    function _renderView(inc) { // assumes elementVisible\n      ignoreWindowResize++;\n  \n      if (currentView.start) { // already been rendered?\n        trigger('viewDestroy', currentView, currentView, currentView.element);\n        unselect();\n        clearEvents();\n      }\n  \n      freezeContentHeight();\n      currentView.render(date, inc || 0); // the view's render method ONLY renders the skeleton, nothing else\n      setSize();\n      unfreezeContentHeight();\n      (currentView.afterRender || noop)();\n  \n      updateTitle();\n      updateTodayButton();\n  \n      trigger('viewRender', currentView, currentView, currentView.element);\n      currentView.trigger('viewDisplay', _element); // deprecated\n  \n      ignoreWindowResize--;\n  \n      getAndRenderEvents();\n    }\n    \n    \n  \n    /* Resizing\n    -----------------------------------------------------------------------------*/\n    \n    \n    function updateSize() {\n      if (elementVisible()) {\n        unselect();\n        clearEvents();\n        calcSize();\n        setSize();\n        renderEvents();\n      }\n    }\n    \n    \n    function calcSize() { // assumes elementVisible\n      if (options.contentHeight) {\n        suggestedViewHeight = options.contentHeight;\n      }\n      else if (options.height) {\n        suggestedViewHeight = options.height - (headerElement ? headerElement.height() : 0) - vsides(content);\n      }\n      else {\n        suggestedViewHeight = Math.round(content.width() / Math.max(options.aspectRatio, .5));\n      }\n    }\n    \n    \n    function setSize() { // assumes elementVisible\n  \n      if (suggestedViewHeight === undefined) {\n        calcSize(); // for first time\n          // NOTE: we don't want to recalculate on every renderView because\n          // it could result in oscillating heights due to scrollbars.\n      }\n  \n      ignoreWindowResize++;\n      currentView.setHeight(suggestedViewHeight);\n      currentView.setWidth(content.width());\n      ignoreWindowResize--;\n  \n      elementOuterWidth = element.outerWidth();\n    }\n    \n    \n    function windowResize() {\n      if (!ignoreWindowResize) {\n        if (currentView.start) { // view has already been rendered\n          var uid = ++resizeUID;\n          setTimeout(function() { // add a delay\n            if (uid == resizeUID && !ignoreWindowResize && elementVisible()) {\n              if (elementOuterWidth != (elementOuterWidth = element.outerWidth())) {\n                ignoreWindowResize++; // in case the windowResize callback changes the height\n                updateSize();\n                currentView.trigger('windowResize', _element);\n                ignoreWindowResize--;\n              }\n            }\n          }, 200);\n        }else{\n          // calendar must have been initialized in a 0x0 iframe that has just been resized\n          lateRender();\n        }\n      }\n    }\n    \n    \n    \n    /* Event Fetching/Rendering\n    -----------------------------------------------------------------------------*/\n    // TODO: going forward, most of this stuff should be directly handled by the view\n  \n  \n    function refetchEvents() { // can be called as an API method\n      clearEvents();\n      fetchAndRenderEvents();\n    }\n  \n  \n    function rerenderEvents(modifiedEventID) { // can be called as an API method\n      clearEvents();\n      renderEvents(modifiedEventID);\n    }\n  \n  \n    function renderEvents(modifiedEventID) { // TODO: remove modifiedEventID hack\n      if (elementVisible()) {\n        currentView.setEventData(events); // for View.js, TODO: unify with renderEvents\n        currentView.renderEvents(events, modifiedEventID); // actually render the DOM elements\n        currentView.trigger('eventAfterAllRender');\n      }\n    }\n  \n  \n    function clearEvents() {\n      currentView.triggerEventDestroy(); // trigger 'eventDestroy' for each event\n      currentView.clearEvents(); // actually remove the DOM elements\n      currentView.clearEventData(); // for View.js, TODO: unify with clearEvents\n    }\n    \n  \n    function getAndRenderEvents() {\n      if (!options.lazyFetching || isFetchNeeded(currentView.visStart, currentView.visEnd)) {\n        fetchAndRenderEvents();\n      }\n      else {\n        renderEvents();\n      }\n    }\n  \n  \n    function fetchAndRenderEvents() {\n      fetchEvents(currentView.visStart, currentView.visEnd);\n        // ... will call reportEvents\n        // ... which will call renderEvents\n    }\n  \n    \n    // called when event data arrives\n    function reportEvents(_events) {\n      events = _events;\n      renderEvents();\n    }\n  \n  \n    // called when a single event's data has been changed\n    function reportEventChange(eventID) {\n      rerenderEvents(eventID);\n    }\n  \n  \n  \n    /* Header Updating\n    -----------------------------------------------------------------------------*/\n  \n  \n    function updateTitle() {\n      header.updateTitle(currentView.title);\n    }\n  \n  \n    function updateTodayButton() {\n      var today = new Date();\n      if (today >= currentView.start && today < currentView.end) {\n        header.disableButton('today');\n      }\n      else {\n        header.enableButton('today');\n      }\n    }\n    \n  \n  \n    /* Selection\n    -----------------------------------------------------------------------------*/\n    \n  \n    function select(start, end, allDay) {\n      currentView.select(start, end, allDay===undefined ? true : allDay);\n    }\n    \n  \n    function unselect() { // safe to be called before renderView\n      if (currentView) {\n        currentView.unselect();\n      }\n    }\n    \n    \n    \n    /* Date\n    -----------------------------------------------------------------------------*/\n    \n    \n    function prev() {\n      renderView(-1);\n    }\n    \n    \n    function next() {\n      renderView(1);\n    }\n    \n    \n    function prevYear() {\n      addYears(date, -1);\n      renderView();\n    }\n    \n    \n    function nextYear() {\n      addYears(date, 1);\n      renderView();\n    }\n    \n    \n    function today() {\n      date = new Date();\n      renderView();\n    }\n    \n    \n    function gotoDate(year, month, dateOfMonth) {\n      if (year instanceof Date) {\n        date = cloneDate(year); // provided 1 argument, a Date\n      }else{\n        setYMD(date, year, month, dateOfMonth);\n      }\n      renderView();\n    }\n    \n    \n    function incrementDate(years, months, days) {\n      if (years !== undefined) {\n        addYears(date, years);\n      }\n      if (months !== undefined) {\n        addMonths(date, months);\n      }\n      if (days !== undefined) {\n        addDays(date, days);\n      }\n      renderView();\n    }\n    \n    \n    function getDate() {\n      return cloneDate(date);\n    }\n  \n  \n  \n    /* Height \"Freezing\"\n    -----------------------------------------------------------------------------*/\n  \n  \n    function freezeContentHeight() {\n      content.css({\n        width: '100%',\n        height: content.height(),\n        overflow: 'hidden'\n      });\n    }\n  \n  \n    function unfreezeContentHeight() {\n      content.css({\n        width: '',\n        height: '',\n        overflow: ''\n      });\n    }\n    \n    \n    \n    /* Misc\n    -----------------------------------------------------------------------------*/\n    \n    \n    function getView() {\n      return currentView;\n    }\n    \n    \n    function option(name, value) {\n      if (value === undefined) {\n        return options[name];\n      }\n      if (name == 'height' || name == 'contentHeight' || name == 'aspectRatio') {\n        options[name] = value;\n        updateSize();\n      }\n    }\n    \n    \n    function trigger(name, thisObj) {\n      if (options[name]) {\n        return options[name].apply(\n          thisObj || _element,\n          Array.prototype.slice.call(arguments, 2)\n        );\n      }\n    }\n    \n    \n    \n    /* External Dragging\n    ------------------------------------------------------------------------*/\n    \n    if (options.droppable) {\n      $(document)\n        .bind('dragstart', function(ev, ui) {\n          var _e = ev.target;\n          var e = $(_e);\n          if (!e.parents('.fc').length) { // not already inside a calendar\n            var accept = options.dropAccept;\n            if ($.isFunction(accept) ? accept.call(_e, e) : e.is(accept)) {\n              _dragElement = _e;\n              currentView.dragStart(_dragElement, ev, ui);\n            }\n          }\n        })\n        .bind('dragstop', function(ev, ui) {\n          if (_dragElement) {\n            currentView.dragStop(_dragElement, ev, ui);\n            _dragElement = null;\n          }\n        });\n    }\n    \n  \n  }\n  \n  ;;\n  \n  function Header(calendar, options) {\n    var t = this;\n    \n    \n    // exports\n    t.render = render;\n    t.destroy = destroy;\n    t.updateTitle = updateTitle;\n    t.activateButton = activateButton;\n    t.deactivateButton = deactivateButton;\n    t.disableButton = disableButton;\n    t.enableButton = enableButton;\n    \n    \n    // locals\n    var element = $([]);\n    var tm;\n    \n  \n  \n    function render() {\n      tm = options.theme ? 'ui' : 'fc';\n      var sections = options.header;\n      if (sections) {\n        element = $(\"<table class='fc-header' style='width:100%'/>\")\n          .append(\n            $(\"<tr/>\")\n              .append(renderSection('left'))\n              .append(renderSection('center'))\n              .append(renderSection('right'))\n          );\n        return element;\n      }\n    }\n    \n    \n    function destroy() {\n      element.remove();\n    }\n    \n    \n    function renderSection(position) {\n      var e = $(\"<td class='fc-header-\" + position + \"'/>\");\n      var buttonStr = options.header[position];\n      if (buttonStr) {\n        $.each(buttonStr.split(' '), function(i) {\n          if (i > 0) {\n            e.append(\"<span class='fc-header-space'/>\");\n          }\n          var prevButton;\n          $.each(this.split(','), function(j, buttonName) {\n            if (buttonName == 'title') {\n              e.append(\"<span class='fc-header-title'><h2>Â </h2></span>\");\n              if (prevButton) {\n                prevButton.addClass(tm + '-corner-right');\n              }\n              prevButton = null;\n            }else{\n              var buttonClick;\n              if (calendar[buttonName]) {\n                buttonClick = calendar[buttonName]; // calendar method\n              }\n              else if (fcViews[buttonName]) {\n                buttonClick = function() {\n                  button.removeClass(tm + '-state-hover'); // forget why\n                  calendar.changeView(buttonName);\n                };\n              }\n              if (buttonClick) {\n                var icon = options.theme ? smartProperty(options.buttonIcons, buttonName) : null; // why are we using smartProperty here?\n                var text = smartProperty(options.buttonText, buttonName); // why are we using smartProperty here?\n                var button = $(\n                  \"<span class='fc-button fc-button-\" + buttonName + \" \" + tm + \"-state-default'>\" +\n                    (icon ?\n                      \"<span class='fc-icon-wrap'>\" +\n                        \"<span class='ui-icon ui-icon-\" + icon + \"'/>\" +\n                      \"</span>\" :\n                      text\n                      ) +\n                  \"</span>\"\n                  )\n                  .click(function() {\n                    if (!button.hasClass(tm + '-state-disabled')) {\n                      buttonClick();\n                    }\n                  })\n                  .mousedown(function() {\n                    button\n                      .not('.' + tm + '-state-active')\n                      .not('.' + tm + '-state-disabled')\n                      .addClass(tm + '-state-down');\n                  })\n                  .mouseup(function() {\n                    button.removeClass(tm + '-state-down');\n                  })\n                  .hover(\n                    function() {\n                      button\n                        .not('.' + tm + '-state-active')\n                        .not('.' + tm + '-state-disabled')\n                        .addClass(tm + '-state-hover');\n                    },\n                    function() {\n                      button\n                        .removeClass(tm + '-state-hover')\n                        .removeClass(tm + '-state-down');\n                    }\n                  )\n                  .appendTo(e);\n                disableTextSelection(button);\n                if (!prevButton) {\n                  button.addClass(tm + '-corner-left');\n                }\n                prevButton = button;\n              }\n            }\n          });\n          if (prevButton) {\n            prevButton.addClass(tm + '-corner-right');\n          }\n        });\n      }\n      return e;\n    }\n    \n    \n    function updateTitle(html) {\n      element.find('h2')\n        .html(html);\n    }\n    \n    \n    function activateButton(buttonName) {\n      element.find('span.fc-button-' + buttonName)\n        .addClass(tm + '-state-active');\n    }\n    \n    \n    function deactivateButton(buttonName) {\n      element.find('span.fc-button-' + buttonName)\n        .removeClass(tm + '-state-active');\n    }\n    \n    \n    function disableButton(buttonName) {\n      element.find('span.fc-button-' + buttonName)\n        .addClass(tm + '-state-disabled');\n    }\n    \n    \n    function enableButton(buttonName) {\n      element.find('span.fc-button-' + buttonName)\n        .removeClass(tm + '-state-disabled');\n    }\n  \n  \n  }\n  \n  ;;\n  \n  fc.sourceNormalizers = [];\n  fc.sourceFetchers = [];\n  \n  var ajaxDefaults = {\n    dataType: 'json',\n    cache: false\n  };\n  \n  var eventGUID = 1;\n  \n  \n  function EventManager(options, _sources) {\n    var t = this;\n    \n    \n    // exports\n    t.isFetchNeeded = isFetchNeeded;\n    t.fetchEvents = fetchEvents;\n    t.addEventSource = addEventSource;\n    t.removeEventSource = removeEventSource;\n    t.updateEvent = updateEvent;\n    t.renderEvent = renderEvent;\n    t.removeEvents = removeEvents;\n    t.clientEvents = clientEvents;\n    t.normalizeEvent = normalizeEvent;\n    \n    \n    // imports\n    var trigger = t.trigger;\n    var getView = t.getView;\n    var reportEvents = t.reportEvents;\n    \n    \n    // locals\n    var stickySource = { events: [] };\n    var sources = [ stickySource ];\n    var rangeStart, rangeEnd;\n    var currentFetchID = 0;\n    var pendingSourceCnt = 0;\n    var loadingLevel = 0;\n    var cache = [];\n    \n    \n    for (var i=0; i<_sources.length; i++) {\n      _addEventSource(_sources[i]);\n    }\n    \n    \n    \n    /* Fetching\n    -----------------------------------------------------------------------------*/\n    \n    \n    function isFetchNeeded(start, end) {\n      return !rangeStart || start < rangeStart || end > rangeEnd;\n    }\n    \n    \n    function fetchEvents(start, end) {\n      rangeStart = start;\n      rangeEnd = end;\n      cache = [];\n      var fetchID = ++currentFetchID;\n      var len = sources.length;\n      pendingSourceCnt = len;\n      for (var i=0; i<len; i++) {\n        fetchEventSource(sources[i], fetchID);\n      }\n    }\n    \n    \n    function fetchEventSource(source, fetchID) {\n      _fetchEventSource(source, function(events) {\n        if (fetchID == currentFetchID) {\n          if (events) {\n  \n            if (options.eventDataTransform) {\n              events = $.map(events, options.eventDataTransform);\n            }\n            if (source.eventDataTransform) {\n              events = $.map(events, source.eventDataTransform);\n            }\n            // TODO: this technique is not ideal for static array event sources.\n            //  For arrays, we'll want to process all events right in the beginning, then never again.\n          \n            for (var i=0; i<events.length; i++) {\n              events[i].source = source;\n              normalizeEvent(events[i]);\n            }\n            cache = cache.concat(events);\n          }\n          pendingSourceCnt--;\n          if (!pendingSourceCnt) {\n            reportEvents(cache);\n          }\n        }\n      });\n    }\n    \n    \n    function _fetchEventSource(source, callback) {\n      var i;\n      var fetchers = fc.sourceFetchers;\n      var res;\n      for (i=0; i<fetchers.length; i++) {\n        res = fetchers[i](source, rangeStart, rangeEnd, callback);\n        if (res === true) {\n          // the fetcher is in charge. made its own async request\n          return;\n        }\n        else if (typeof res == 'object') {\n          // the fetcher returned a new source. process it\n          _fetchEventSource(res, callback);\n          return;\n        }\n      }\n      var events = source.events;\n      if (events) {\n        if ($.isFunction(events)) {\n          pushLoading();\n          events(cloneDate(rangeStart), cloneDate(rangeEnd), function(events) {\n            callback(events);\n            popLoading();\n          });\n        }\n        else if ($.isArray(events)) {\n          callback(events);\n        }\n        else {\n          callback();\n        }\n      }else{\n        var url = source.url;\n        if (url) {\n          var success = source.success;\n          var error = source.error;\n          var complete = source.complete;\n  \n          // retrieve any outbound GET/POST $.ajax data from the options\n          var customData;\n          if ($.isFunction(source.data)) {\n            // supplied as a function that returns a key/value object\n            customData = source.data();\n          }\n          else {\n            // supplied as a straight key/value object\n            customData = source.data;\n          }\n  \n          // use a copy of the custom data so we can modify the parameters\n          // and not affect the passed-in object.\n          var data = $.extend({}, customData || {});\n  \n          var startParam = firstDefined(source.startParam, options.startParam);\n          var endParam = firstDefined(source.endParam, options.endParam);\n          if (startParam) {\n            data[startParam] = Math.round(+rangeStart / 1000);\n          }\n          if (endParam) {\n            data[endParam] = Math.round(+rangeEnd / 1000);\n          }\n  \n          pushLoading();\n          $.ajax($.extend({}, ajaxDefaults, source, {\n            data: data,\n            success: function(events) {\n              events = events || [];\n              var res = applyAll(success, this, arguments);\n              if ($.isArray(res)) {\n                events = res;\n              }\n              callback(events);\n            },\n            error: function() {\n              applyAll(error, this, arguments);\n              callback();\n            },\n            complete: function() {\n              applyAll(complete, this, arguments);\n              popLoading();\n            }\n          }));\n        }else{\n          callback();\n        }\n      }\n    }\n    \n    \n    \n    /* Sources\n    -----------------------------------------------------------------------------*/\n    \n  \n    function addEventSource(source) {\n      source = _addEventSource(source);\n      if (source) {\n        pendingSourceCnt++;\n        fetchEventSource(source, currentFetchID); // will eventually call reportEvents\n      }\n    }\n    \n    \n    function _addEventSource(source) {\n      if ($.isFunction(source) || $.isArray(source)) {\n        source = { events: source };\n      }\n      else if (typeof source == 'string') {\n        source = { url: source };\n      }\n      if (typeof source == 'object') {\n        normalizeSource(source);\n        sources.push(source);\n        return source;\n      }\n    }\n    \n  \n    function removeEventSource(source) {\n      sources = $.grep(sources, function(src) {\n        return !isSourcesEqual(src, source);\n      });\n      // remove all client events from that source\n      cache = $.grep(cache, function(e) {\n        return !isSourcesEqual(e.source, source);\n      });\n      reportEvents(cache);\n    }\n    \n    \n    \n    /* Manipulation\n    -----------------------------------------------------------------------------*/\n    \n    \n    function updateEvent(event) { // update an existing event\n      var i, len = cache.length, e,\n        defaultEventEnd = getView().defaultEventEnd, // getView???\n        startDelta = event.start - event._start,\n        endDelta = event.end ?\n          (event.end - (event._end || defaultEventEnd(event))) // event._end would be null if event.end\n          : 0;                                                      // was null and event was just resized\n      for (i=0; i<len; i++) {\n        e = cache[i];\n        if (e._id == event._id && e != event) {\n          e.start = new Date(+e.start + startDelta);\n          if (event.end) {\n            if (e.end) {\n              e.end = new Date(+e.end + endDelta);\n            }else{\n              e.end = new Date(+defaultEventEnd(e) + endDelta);\n            }\n          }else{\n            e.end = null;\n          }\n          e.title = event.title;\n          e.url = event.url;\n          e.allDay = event.allDay;\n          e.className = event.className;\n          e.editable = event.editable;\n          e.color = event.color;\n          e.backgroundColor = event.backgroundColor;\n          e.borderColor = event.borderColor;\n          e.textColor = event.textColor;\n          normalizeEvent(e);\n        }\n      }\n      normalizeEvent(event);\n      reportEvents(cache);\n    }\n    \n    \n    function renderEvent(event, stick) {\n      normalizeEvent(event);\n      if (!event.source) {\n        if (stick) {\n          stickySource.events.push(event);\n          event.source = stickySource;\n        }\n        cache.push(event);\n      }\n      reportEvents(cache);\n    }\n    \n    \n    function removeEvents(filter) {\n      if (!filter) { // remove all\n        cache = [];\n        // clear all array sources\n        for (var i=0; i<sources.length; i++) {\n          if ($.isArray(sources[i].events)) {\n            sources[i].events = [];\n          }\n        }\n      }else{\n        if (!$.isFunction(filter)) { // an event ID\n          var id = filter + '';\n          filter = function(e) {\n            return e._id == id;\n          };\n        }\n        cache = $.grep(cache, filter, true);\n        // remove events from array sources\n        for (var i=0; i<sources.length; i++) {\n          if ($.isArray(sources[i].events)) {\n            sources[i].events = $.grep(sources[i].events, filter, true);\n          }\n        }\n      }\n      reportEvents(cache);\n    }\n    \n    \n    function clientEvents(filter) {\n      if ($.isFunction(filter)) {\n        return $.grep(cache, filter);\n      }\n      else if (filter) { // an event ID\n        filter += '';\n        return $.grep(cache, function(e) {\n          return e._id == filter;\n        });\n      }\n      return cache; // else, return all\n    }\n    \n    \n    \n    /* Loading State\n    -----------------------------------------------------------------------------*/\n    \n    \n    function pushLoading() {\n      if (!loadingLevel++) {\n        trigger('loading', null, true, getView());\n      }\n    }\n    \n    \n    function popLoading() {\n      if (!--loadingLevel) {\n        trigger('loading', null, false, getView());\n      }\n    }\n    \n    \n    \n    /* Event Normalization\n    -----------------------------------------------------------------------------*/\n    \n    \n    function normalizeEvent(event) {\n      var source = event.source || {};\n      var ignoreTimezone = firstDefined(source.ignoreTimezone, options.ignoreTimezone);\n      event._id = event._id || (event.id === undefined ? '_fc' + eventGUID++ : event.id + '');\n      if (event.date) {\n        if (!event.start) {\n          event.start = event.date;\n        }\n        delete event.date;\n      }\n      event._start = cloneDate(event.start = parseDate(event.start, ignoreTimezone));\n      event.end = parseDate(event.end, ignoreTimezone);\n      if (event.end && event.end <= event.start) {\n        event.end = null;\n      }\n      event._end = event.end ? cloneDate(event.end) : null;\n      if (event.allDay === undefined) {\n        event.allDay = firstDefined(source.allDayDefault, options.allDayDefault);\n      }\n      if (event.className) {\n        if (typeof event.className == 'string') {\n          event.className = event.className.split(/\\s+/);\n        }\n      }else{\n        event.className = [];\n      }\n      // TODO: if there is no start date, return false to indicate an invalid event\n    }\n    \n    \n    \n    /* Utils\n    ------------------------------------------------------------------------------*/\n    \n    \n    function normalizeSource(source) {\n      if (source.className) {\n        // TODO: repeat code, same code for event classNames\n        if (typeof source.className == 'string') {\n          source.className = source.className.split(/\\s+/);\n        }\n      }else{\n        source.className = [];\n      }\n      var normalizers = fc.sourceNormalizers;\n      for (var i=0; i<normalizers.length; i++) {\n        normalizers[i](source);\n      }\n    }\n    \n    \n    function isSourcesEqual(source1, source2) {\n      return source1 && source2 && getSourcePrimitive(source1) == getSourcePrimitive(source2);\n    }\n    \n    \n    function getSourcePrimitive(source) {\n      return ((typeof source == 'object') ? (source.events || source.url) : '') || source;\n    }\n  \n  \n  }\n  \n  ;;\n  \n  \n  fc.addDays = addDays;\n  fc.cloneDate = cloneDate;\n  fc.parseDate = parseDate;\n  fc.parseISO8601 = parseISO8601;\n  fc.parseTime = parseTime;\n  fc.formatDate = formatDate;\n  fc.formatDates = formatDates;\n  \n  \n  \n  /* Date Math\n  -----------------------------------------------------------------------------*/\n  \n  var dayIDs = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'],\n    DAY_MS = 86400000,\n    HOUR_MS = 3600000,\n    MINUTE_MS = 60000;\n    \n  \n  function addYears(d, n, keepTime) {\n    d.setFullYear(d.getFullYear() + n);\n    if (!keepTime) {\n      clearTime(d);\n    }\n    return d;\n  }\n  \n  \n  function addMonths(d, n, keepTime) { // prevents day overflow/underflow\n    if (+d) { // prevent infinite looping on invalid dates\n      var m = d.getMonth() + n,\n        check = cloneDate(d);\n      check.setDate(1);\n      check.setMonth(m);\n      d.setMonth(m);\n      if (!keepTime) {\n        clearTime(d);\n      }\n      while (d.getMonth() != check.getMonth()) {\n        d.setDate(d.getDate() + (d < check ? 1 : -1));\n      }\n    }\n    return d;\n  }\n  \n  \n  function addDays(d, n, keepTime) { // deals with daylight savings\n    if (+d) {\n      var dd = d.getDate() + n,\n        check = cloneDate(d);\n      check.setHours(9); // set to middle of day\n      check.setDate(dd);\n      d.setDate(dd);\n      if (!keepTime) {\n        clearTime(d);\n      }\n      fixDate(d, check);\n    }\n    return d;\n  }\n  \n  \n  function fixDate(d, check) { // force d to be on check's YMD, for daylight savings purposes\n    if (+d) { // prevent infinite looping on invalid dates\n      while (d.getDate() != check.getDate()) {\n        d.setTime(+d + (d < check ? 1 : -1) * HOUR_MS);\n      }\n    }\n  }\n  \n  \n  function addMinutes(d, n) {\n    d.setMinutes(d.getMinutes() + n);\n    return d;\n  }\n  \n  \n  function clearTime(d) {\n    d.setHours(0);\n    d.setMinutes(0);\n    d.setSeconds(0); \n    d.setMilliseconds(0);\n    return d;\n  }\n  \n  \n  function cloneDate(d, dontKeepTime) {\n    if (dontKeepTime) {\n      return clearTime(new Date(+d));\n    }\n    return new Date(+d);\n  }\n  \n  \n  function zeroDate() { // returns a Date with time 00:00:00 and dateOfMonth=1\n    var i=0, d;\n    do {\n      d = new Date(1970, i++, 1);\n    } while (d.getHours()); // != 0\n    return d;\n  }\n  \n  \n  function dayDiff(d1, d2) { // d1 - d2\n    return Math.round((cloneDate(d1, true) - cloneDate(d2, true)) / DAY_MS);\n  }\n  \n  \n  function setYMD(date, y, m, d) {\n    if (y !== undefined && y != date.getFullYear()) {\n      date.setDate(1);\n      date.setMonth(0);\n      date.setFullYear(y);\n    }\n    if (m !== undefined && m != date.getMonth()) {\n      date.setDate(1);\n      date.setMonth(m);\n    }\n    if (d !== undefined) {\n      date.setDate(d);\n    }\n  }\n  \n  \n  \n  /* Date Parsing\n  -----------------------------------------------------------------------------*/\n  \n  \n  function parseDate(s, ignoreTimezone) { // ignoreTimezone defaults to true\n    if (typeof s == 'object') { // already a Date object\n      return s;\n    }\n    if (typeof s == 'number') { // a UNIX timestamp\n      return new Date(s * 1000);\n    }\n    if (typeof s == 'string') {\n      if (s.match(/^\\d+(\\.\\d+)?$/)) { // a UNIX timestamp\n        return new Date(parseFloat(s) * 1000);\n      }\n      if (ignoreTimezone === undefined) {\n        ignoreTimezone = true;\n      }\n      return parseISO8601(s, ignoreTimezone) || (s ? new Date(s) : null);\n    }\n    // TODO: never return invalid dates (like from new Date(<string>)), return null instead\n    return null;\n  }\n  \n  \n  function parseISO8601(s, ignoreTimezone) { // ignoreTimezone defaults to false\n    // derived from http://delete.me.uk/2005/03/iso8601.html\n    // TODO: for a know glitch/feature, read tests/issue_206_parseDate_dst.html\n    var m = s.match(/^([0-9]{4})(-([0-9]{2})(-([0-9]{2})([T ]([0-9]{2}):([0-9]{2})(:([0-9]{2})(\\.([0-9]+))?)?(Z|(([-+])([0-9]{2})(:?([0-9]{2}))?))?)?)?)?$/);\n    if (!m) {\n      return null;\n    }\n    var date = new Date(m[1], 0, 1);\n    if (ignoreTimezone || !m[13]) {\n      var check = new Date(m[1], 0, 1, 9, 0);\n      if (m[3]) {\n        date.setMonth(m[3] - 1);\n        check.setMonth(m[3] - 1);\n      }\n      if (m[5]) {\n        date.setDate(m[5]);\n        check.setDate(m[5]);\n      }\n      fixDate(date, check);\n      if (m[7]) {\n        date.setHours(m[7]);\n      }\n      if (m[8]) {\n        date.setMinutes(m[8]);\n      }\n      if (m[10]) {\n        date.setSeconds(m[10]);\n      }\n      if (m[12]) {\n        date.setMilliseconds(Number(\"0.\" + m[12]) * 1000);\n      }\n      fixDate(date, check);\n    }else{\n      date.setUTCFullYear(\n        m[1],\n        m[3] ? m[3] - 1 : 0,\n        m[5] || 1\n      );\n      date.setUTCHours(\n        m[7] || 0,\n        m[8] || 0,\n        m[10] || 0,\n        m[12] ? Number(\"0.\" + m[12]) * 1000 : 0\n      );\n      if (m[14]) {\n        var offset = Number(m[16]) * 60 + (m[18] ? Number(m[18]) : 0);\n        offset *= m[15] == '-' ? 1 : -1;\n        date = new Date(+date + (offset * 60 * 1000));\n      }\n    }\n    return date;\n  }\n  \n  \n  function parseTime(s) { // returns minutes since start of day\n    if (typeof s == 'number') { // an hour\n      return s * 60;\n    }\n    if (typeof s == 'object') { // a Date object\n      return s.getHours() * 60 + s.getMinutes();\n    }\n    var m = s.match(/(\\d+)(?::(\\d+))?\\s*(\\w+)?/);\n    if (m) {\n      var h = parseInt(m[1], 10);\n      if (m[3]) {\n        h %= 12;\n        if (m[3].toLowerCase().charAt(0) == 'p') {\n          h += 12;\n        }\n      }\n      return h * 60 + (m[2] ? parseInt(m[2], 10) : 0);\n    }\n  }\n  \n  \n  \n  /* Date Formatting\n  -----------------------------------------------------------------------------*/\n  // TODO: use same function formatDate(date, [date2], format, [options])\n  \n  \n  function formatDate(date, format, options) {\n    return formatDates(date, null, format, options);\n  }\n  \n  \n  function formatDates(date1, date2, format, options) {\n    options = options || defaults;\n    var date = date1,\n      otherDate = date2,\n      i, len = format.length, c,\n      i2, formatter,\n      res = '';\n    for (i=0; i<len; i++) {\n      c = format.charAt(i);\n      if (c == \"'\") {\n        for (i2=i+1; i2<len; i2++) {\n          if (format.charAt(i2) == \"'\") {\n            if (date) {\n              if (i2 == i+1) {\n                res += \"'\";\n              }else{\n                res += format.substring(i+1, i2);\n              }\n              i = i2;\n            }\n            break;\n          }\n        }\n      }\n      else if (c == '(') {\n        for (i2=i+1; i2<len; i2++) {\n          if (format.charAt(i2) == ')') {\n            var subres = formatDate(date, format.substring(i+1, i2), options);\n            if (parseInt(subres.replace(/\\D/, ''), 10)) {\n              res += subres;\n            }\n            i = i2;\n            break;\n          }\n        }\n      }\n      else if (c == '[') {\n        for (i2=i+1; i2<len; i2++) {\n          if (format.charAt(i2) == ']') {\n            var subformat = format.substring(i+1, i2);\n            var subres = formatDate(date, subformat, options);\n            if (subres != formatDate(otherDate, subformat, options)) {\n              res += subres;\n            }\n            i = i2;\n            break;\n          }\n        }\n      }\n      else if (c == '{') {\n        date = date2;\n        otherDate = date1;\n      }\n      else if (c == '}') {\n        date = date1;\n        otherDate = date2;\n      }\n      else {\n        for (i2=len; i2>i; i2--) {\n          if (formatter = dateFormatters[format.substring(i, i2)]) {\n            if (date) {\n              res += formatter(date, options);\n            }\n            i = i2 - 1;\n            break;\n          }\n        }\n        if (i2 == i) {\n          if (date) {\n            res += c;\n          }\n        }\n      }\n    }\n    return res;\n  };\n  \n  \n  var dateFormatters = {\n    s\t: function(d)\t{ return d.getSeconds() },\n    ss\t: function(d)\t{ return zeroPad(d.getSeconds()) },\n    m\t: function(d)\t{ return d.getMinutes() },\n    mm\t: function(d)\t{ return zeroPad(d.getMinutes()) },\n    h\t: function(d)\t{ return d.getHours() % 12 || 12 },\n    hh\t: function(d)\t{ return zeroPad(d.getHours() % 12 || 12) },\n    H\t: function(d)\t{ return d.getHours() },\n    HH\t: function(d)\t{ return zeroPad(d.getHours()) },\n    d\t: function(d)\t{ return d.getDate() },\n    dd\t: function(d)\t{ return zeroPad(d.getDate()) },\n    ddd\t: function(d,o)\t{ return o.dayNamesShort[d.getDay()] },\n    dddd: function(d,o)\t{ return o.dayNames[d.getDay()] },\n    M\t: function(d)\t{ return d.getMonth() + 1 },\n    MM\t: function(d)\t{ return zeroPad(d.getMonth() + 1) },\n    MMM\t: function(d,o)\t{ return o.monthNamesShort[d.getMonth()] },\n    MMMM: function(d,o)\t{ return o.monthNames[d.getMonth()] },\n    yy\t: function(d)\t{ return (d.getFullYear()+'').substring(2) },\n    yyyy: function(d)\t{ return d.getFullYear() },\n    t\t: function(d)\t{ return d.getHours() < 12 ? 'a' : 'p' },\n    tt\t: function(d)\t{ return d.getHours() < 12 ? 'am' : 'pm' },\n    T\t: function(d)\t{ return d.getHours() < 12 ? 'A' : 'P' },\n    TT\t: function(d)\t{ return d.getHours() < 12 ? 'AM' : 'PM' },\n    u\t: function(d)\t{ return formatDate(d, \"yyyy-MM-dd'T'HH:mm:ss'Z'\") },\n    S\t: function(d)\t{\n      var date = d.getDate();\n      if (date > 10 && date < 20) {\n        return 'th';\n      }\n      return ['st', 'nd', 'rd'][date%10-1] || 'th';\n    },\n    w   : function(d, o) { // local\n      return o.weekNumberCalculation(d);\n    },\n    W   : function(d) { // ISO\n      return iso8601Week(d);\n    }\n  };\n  fc.dateFormatters = dateFormatters;\n  \n  \n  /* thanks jQuery UI (https://github.com/jquery/jquery-ui/blob/master/ui/jquery.ui.datepicker.js)\n   * \n   * Set as calculateWeek to determine the week of the year based on the ISO 8601 definition.\n   * `date` - the date to get the week for\n   * `number` - the number of the week within the year that contains this date\n   */\n  function iso8601Week(date) {\n    var time;\n    var checkDate = new Date(date.getTime());\n  \n    // Find Thursday of this week starting on Monday\n    checkDate.setDate(checkDate.getDate() + 4 - (checkDate.getDay() || 7));\n  \n    time = checkDate.getTime();\n    checkDate.setMonth(0); // Compare with Jan 1\n    checkDate.setDate(1);\n    return Math.floor(Math.round((time - checkDate) / 86400000) / 7) + 1;\n  }\n  \n  \n  ;;\n  \n  fc.applyAll = applyAll;\n  \n  \n  /* Event Date Math\n  -----------------------------------------------------------------------------*/\n  \n  \n  function exclEndDay(event) {\n    if (event.end) {\n      return _exclEndDay(event.end, event.allDay);\n    }else{\n      return addDays(cloneDate(event.start), 1);\n    }\n  }\n  \n  \n  function _exclEndDay(end, allDay) {\n    end = cloneDate(end);\n    return allDay || end.getHours() || end.getMinutes() ? addDays(end, 1) : clearTime(end);\n    // why don't we check for seconds/ms too?\n  }\n  \n  \n  \n  /* Event Element Binding\n  -----------------------------------------------------------------------------*/\n  \n  \n  function lazySegBind(container, segs, bindHandlers) {\n    container.unbind('mouseover').mouseover(function(ev) {\n      var parent=ev.target, e,\n        i, seg;\n      while (parent != this) {\n        e = parent;\n        parent = parent.parentNode;\n      }\n      if ((i = e._fci) !== undefined) {\n        e._fci = undefined;\n        seg = segs[i];\n        bindHandlers(seg.event, seg.element, seg);\n        $(ev.target).trigger(ev);\n      }\n      ev.stopPropagation();\n    });\n  }\n  \n  \n  \n  /* Element Dimensions\n  -----------------------------------------------------------------------------*/\n  \n  \n  function setOuterWidth(element, width, includeMargins) {\n    for (var i=0, e; i<element.length; i++) {\n      e = $(element[i]);\n      e.width(Math.max(0, width - hsides(e, includeMargins)));\n    }\n  }\n  \n  \n  function setOuterHeight(element, height, includeMargins) {\n    for (var i=0, e; i<element.length; i++) {\n      e = $(element[i]);\n      e.height(Math.max(0, height - vsides(e, includeMargins)));\n    }\n  }\n  \n  \n  function hsides(element, includeMargins) {\n    return hpadding(element) + hborders(element) + (includeMargins ? hmargins(element) : 0);\n  }\n  \n  \n  function hpadding(element) {\n    return (parseFloat($.css(element[0], 'paddingLeft', true)) || 0) +\n           (parseFloat($.css(element[0], 'paddingRight', true)) || 0);\n  }\n  \n  \n  function hmargins(element) {\n    return (parseFloat($.css(element[0], 'marginLeft', true)) || 0) +\n           (parseFloat($.css(element[0], 'marginRight', true)) || 0);\n  }\n  \n  \n  function hborders(element) {\n    return (parseFloat($.css(element[0], 'borderLeftWidth', true)) || 0) +\n           (parseFloat($.css(element[0], 'borderRightWidth', true)) || 0);\n  }\n  \n  \n  function vsides(element, includeMargins) {\n    return vpadding(element) +  vborders(element) + (includeMargins ? vmargins(element) : 0);\n  }\n  \n  \n  function vpadding(element) {\n    return (parseFloat($.css(element[0], 'paddingTop', true)) || 0) +\n           (parseFloat($.css(element[0], 'paddingBottom', true)) || 0);\n  }\n  \n  \n  function vmargins(element) {\n    return (parseFloat($.css(element[0], 'marginTop', true)) || 0) +\n           (parseFloat($.css(element[0], 'marginBottom', true)) || 0);\n  }\n  \n  \n  function vborders(element) {\n    return (parseFloat($.css(element[0], 'borderTopWidth', true)) || 0) +\n           (parseFloat($.css(element[0], 'borderBottomWidth', true)) || 0);\n  }\n  \n  \n  \n  /* Misc Utils\n  -----------------------------------------------------------------------------*/\n  \n  \n  //TODO: arraySlice\n  //TODO: isFunction, grep ?\n  \n  \n  function noop() { }\n  \n  \n  function dateCompare(a, b) {\n    return a - b;\n  }\n  \n  \n  function arrayMax(a) {\n    return Math.max.apply(Math, a);\n  }\n  \n  \n  function zeroPad(n) {\n    return (n < 10 ? '0' : '') + n;\n  }\n  \n  \n  function smartProperty(obj, name) { // get a camel-cased/namespaced property of an object\n    if (obj[name] !== undefined) {\n      return obj[name];\n    }\n    var parts = name.split(/(?=[A-Z])/),\n      i=parts.length-1, res;\n    for (; i>=0; i--) {\n      res = obj[parts[i].toLowerCase()];\n      if (res !== undefined) {\n        return res;\n      }\n    }\n    return obj[''];\n  }\n  \n  \n  function htmlEscape(s) {\n    return s.replace(/&/g, '&')\n      .replace(/</g, '<')\n      .replace(/>/g, '>')\n      .replace(/'/g, '\\'')\n      .replace(/\"/g, '\"')\n      .replace(/\\n/g, '<br />');\n  }\n  \n  \n  function disableTextSelection(element) {\n    element\n      .attr('unselectable', 'on')\n      .css('MozUserSelect', 'none')\n      .bind('selectstart.ui', function() { return false; });\n  }\n  \n  \n  /*\n  function enableTextSelection(element) {\n    element\n      .attr('unselectable', 'off')\n      .css('MozUserSelect', '')\n      .unbind('selectstart.ui');\n  }\n  */\n  \n  \n  function markFirstLast(e) {\n    e.children()\n      .removeClass('fc-first fc-last')\n      .filter(':first-child')\n        .addClass('fc-first')\n      .end()\n      .filter(':last-child')\n        .addClass('fc-last');\n  }\n  \n  \n  function setDayID(cell, date) {\n    cell.each(function(i, _cell) {\n      _cell.className = _cell.className.replace(/^fc-\\w*/, 'fc-' + dayIDs[date.getDay()]);\n      // TODO: make a way that doesn't rely on order of classes\n    });\n  }\n  \n  \n  function getSkinCss(event, opt) {\n    var source = event.source || {};\n    var eventColor = event.color;\n    var sourceColor = source.color;\n    var optionColor = opt('eventColor');\n    var backgroundColor =\n      event.backgroundColor ||\n      eventColor ||\n      source.backgroundColor ||\n      sourceColor ||\n      opt('eventBackgroundColor') ||\n      optionColor;\n    var borderColor =\n      event.borderColor ||\n      eventColor ||\n      source.borderColor ||\n      sourceColor ||\n      opt('eventBorderColor') ||\n      optionColor;\n    var textColor =\n      event.textColor ||\n      source.textColor ||\n      opt('eventTextColor');\n    var statements = [];\n    if (backgroundColor) {\n      statements.push('background-color:' + backgroundColor);\n    }\n    if (borderColor) {\n      statements.push('border-color:' + borderColor);\n    }\n    if (textColor) {\n      statements.push('color:' + textColor);\n    }\n    return statements.join(';');\n  }\n  \n  \n  function applyAll(functions, thisObj, args) {\n    if ($.isFunction(functions)) {\n      functions = [ functions ];\n    }\n    if (functions) {\n      var i;\n      var ret;\n      for (i=0; i<functions.length; i++) {\n        ret = functions[i].apply(thisObj, args) || ret;\n      }\n      return ret;\n    }\n  }\n  \n  \n  function firstDefined() {\n    for (var i=0; i<arguments.length; i++) {\n      if (arguments[i] !== undefined) {\n        return arguments[i];\n      }\n    }\n  }\n  \n  \n  ;;\n  \n  fcViews.month = MonthView;\n  \n  function MonthView(element, calendar) {\n    var t = this;\n    \n    \n    // exports\n    t.render = render;\n    \n    \n    // imports\n    BasicView.call(t, element, calendar, 'month');\n    var opt = t.opt;\n    var renderBasic = t.renderBasic;\n    var skipHiddenDays = t.skipHiddenDays;\n    var getCellsPerWeek = t.getCellsPerWeek;\n    var formatDate = calendar.formatDate;\n    \n    \n    function render(date, delta) {\n  \n      if (delta) {\n        addMonths(date, delta);\n        date.setDate(1);\n      }\n  \n      var firstDay = opt('firstDay');\n  \n      var start = cloneDate(date, true);\n      start.setDate(1);\n  \n      var end = addMonths(cloneDate(start), 1);\n  \n      var visStart = cloneDate(start);\n      addDays(visStart, -((visStart.getDay() - firstDay + 7) % 7));\n      skipHiddenDays(visStart);\n  \n      var visEnd = cloneDate(end);\n      addDays(visEnd, (7 - visEnd.getDay() + firstDay) % 7);\n      skipHiddenDays(visEnd, -1, true);\n  \n      var colCnt = getCellsPerWeek();\n      var rowCnt = Math.round(dayDiff(visEnd, visStart) / 7); // should be no need for Math.round\n  \n      if (opt('weekMode') == 'fixed') {\n        addDays(visEnd, (6 - rowCnt) * 7); // add weeks to make up for it\n        rowCnt = 6;\n      }\n  \n      t.title = formatDate(start, opt('titleFormat'));\n  \n      t.start = start;\n      t.end = end;\n      t.visStart = visStart;\n      t.visEnd = visEnd;\n  \n      renderBasic(rowCnt, colCnt, true);\n    }\n    \n    \n  }\n  \n  ;;\n  \n  fcViews.basicWeek = BasicWeekView;\n  \n  function BasicWeekView(element, calendar) {\n    var t = this;\n    \n    \n    // exports\n    t.render = render;\n    \n    \n    // imports\n    BasicView.call(t, element, calendar, 'basicWeek');\n    var opt = t.opt;\n    var renderBasic = t.renderBasic;\n    var skipHiddenDays = t.skipHiddenDays;\n    var getCellsPerWeek = t.getCellsPerWeek;\n    var formatDates = calendar.formatDates;\n    \n    \n    function render(date, delta) {\n  \n      if (delta) {\n        addDays(date, delta * 7);\n      }\n  \n      var start = addDays(cloneDate(date), -((date.getDay() - opt('firstDay') + 7) % 7));\n      var end = addDays(cloneDate(start), 7);\n  \n      var visStart = cloneDate(start);\n      skipHiddenDays(visStart);\n  \n      var visEnd = cloneDate(end);\n      skipHiddenDays(visEnd, -1, true);\n  \n      var colCnt = getCellsPerWeek();\n  \n      t.start = start;\n      t.end = end;\n      t.visStart = visStart;\n      t.visEnd = visEnd;\n  \n      t.title = formatDates(\n        visStart,\n        addDays(cloneDate(visEnd), -1),\n        opt('titleFormat')\n      );\n  \n      renderBasic(1, colCnt, false);\n    }\n    \n    \n  }\n  \n  ;;\n  \n  fcViews.basicDay = BasicDayView;\n  \n  \n  function BasicDayView(element, calendar) {\n    var t = this;\n    \n    \n    // exports\n    t.render = render;\n    \n    \n    // imports\n    BasicView.call(t, element, calendar, 'basicDay');\n    var opt = t.opt;\n    var renderBasic = t.renderBasic;\n    var skipHiddenDays = t.skipHiddenDays;\n    var formatDate = calendar.formatDate;\n    \n    \n    function render(date, delta) {\n  \n      if (delta) {\n        addDays(date, delta);\n      }\n      skipHiddenDays(date, delta < 0 ? -1 : 1);\n  \n      var start = cloneDate(date, true);\n      var end = addDays(cloneDate(start), 1);\n  \n      t.title = formatDate(date, opt('titleFormat'));\n  \n      t.start = t.visStart = start;\n      t.end = t.visEnd = end;\n  \n      renderBasic(1, 1, false);\n    }\n    \n    \n  }\n  \n  ;;\n  \n  setDefaults({\n    weekMode: 'fixed'\n  });\n  \n  \n  function BasicView(element, calendar, viewName) {\n    var t = this;\n    \n    \n    // exports\n    t.renderBasic = renderBasic;\n    t.setHeight = setHeight;\n    t.setWidth = setWidth;\n    t.renderDayOverlay = renderDayOverlay;\n    t.defaultSelectionEnd = defaultSelectionEnd;\n    t.renderSelection = renderSelection;\n    t.clearSelection = clearSelection;\n    t.reportDayClick = reportDayClick; // for selection (kinda hacky)\n    t.dragStart = dragStart;\n    t.dragStop = dragStop;\n    t.defaultEventEnd = defaultEventEnd;\n    t.getHoverListener = function() { return hoverListener };\n    t.colLeft = colLeft;\n    t.colRight = colRight;\n    t.colContentLeft = colContentLeft;\n    t.colContentRight = colContentRight;\n    t.getIsCellAllDay = function() { return true };\n    t.allDayRow = allDayRow;\n    t.getRowCnt = function() { return rowCnt };\n    t.getColCnt = function() { return colCnt };\n    t.getColWidth = function() { return colWidth };\n    t.getDaySegmentContainer = function() { return daySegmentContainer };\n    \n    \n    // imports\n    View.call(t, element, calendar, viewName);\n    OverlayManager.call(t);\n    SelectionManager.call(t);\n    BasicEventRenderer.call(t);\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var renderOverlay = t.renderOverlay;\n    var clearOverlays = t.clearOverlays;\n    var daySelectionMousedown = t.daySelectionMousedown;\n    var cellToDate = t.cellToDate;\n    var dateToCell = t.dateToCell;\n    var rangeToSegments = t.rangeToSegments;\n    var formatDate = calendar.formatDate;\n    \n    \n    // locals\n    \n    var table;\n    var head;\n    var headCells;\n    var body;\n    var bodyRows;\n    var bodyCells;\n    var bodyFirstCells;\n    var firstRowCellInners;\n    var firstRowCellContentInners;\n    var daySegmentContainer;\n    \n    var viewWidth;\n    var viewHeight;\n    var colWidth;\n    var weekNumberWidth;\n    \n    var rowCnt, colCnt;\n    var showNumbers;\n    var coordinateGrid;\n    var hoverListener;\n    var colPositions;\n    var colContentPositions;\n    \n    var tm;\n    var colFormat;\n    var showWeekNumbers;\n    var weekNumberTitle;\n    var weekNumberFormat;\n    \n    \n    \n    /* Rendering\n    ------------------------------------------------------------*/\n    \n    \n    disableTextSelection(element.addClass('fc-grid'));\n    \n    \n    function renderBasic(_rowCnt, _colCnt, _showNumbers) {\n      rowCnt = _rowCnt;\n      colCnt = _colCnt;\n      showNumbers = _showNumbers;\n      updateOptions();\n  \n      if (!body) {\n        buildEventContainer();\n      }\n  \n      buildTable();\n    }\n    \n    \n    function updateOptions() {\n      tm = opt('theme') ? 'ui' : 'fc';\n      colFormat = opt('columnFormat');\n  \n      // week # options. (TODO: bad, logic also in other views)\n      showWeekNumbers = opt('weekNumbers');\n      weekNumberTitle = opt('weekNumberTitle');\n      if (opt('weekNumberCalculation') != 'iso') {\n        weekNumberFormat = \"w\";\n      }\n      else {\n        weekNumberFormat = \"W\";\n      }\n    }\n    \n    \n    function buildEventContainer() {\n      daySegmentContainer =\n        $(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\")\n          .appendTo(element);\n    }\n    \n    \n    function buildTable() {\n      var html = buildTableHTML();\n  \n      if (table) {\n        table.remove();\n      }\n      table = $(html).appendTo(element);\n  \n      head = table.find('thead');\n      headCells = head.find('.fc-day-header');\n      body = table.find('tbody');\n      bodyRows = body.find('tr');\n      bodyCells = body.find('.fc-day');\n      bodyFirstCells = bodyRows.find('td:first-child');\n  \n      firstRowCellInners = bodyRows.eq(0).find('.fc-day > div');\n      firstRowCellContentInners = bodyRows.eq(0).find('.fc-day-content > div');\n      \n      markFirstLast(head.add(head.find('tr'))); // marks first+last tr/th's\n      markFirstLast(bodyRows); // marks first+last td's\n      bodyRows.eq(0).addClass('fc-first');\n      bodyRows.filter(':last').addClass('fc-last');\n  \n      bodyCells.each(function(i, _cell) {\n        var date = cellToDate(\n          Math.floor(i / colCnt),\n          i % colCnt\n        );\n        trigger('dayRender', t, date, $(_cell));\n      });\n  \n      dayBind(bodyCells);\n    }\n  \n  \n  \n    /* HTML Building\n    -----------------------------------------------------------*/\n  \n  \n    function buildTableHTML() {\n      var html =\n        \"<table class='fc-border-separate' style='width:100%' cellspacing='0'>\" +\n        buildHeadHTML() +\n        buildBodyHTML() +\n        \"</table>\";\n  \n      return html;\n    }\n  \n  \n    function buildHeadHTML() {\n      var headerClass = tm + \"-widget-header\";\n      var html = '';\n      var col;\n      var date;\n  \n      html += \"<thead><tr>\";\n  \n      if (showWeekNumbers) {\n        html +=\n          \"<th class='fc-week-number \" + headerClass + \"'>\" +\n          htmlEscape(weekNumberTitle) +\n          \"</th>\";\n      }\n  \n      for (col=0; col<colCnt; col++) {\n        date = cellToDate(0, col);\n        html +=\n          \"<th class='fc-day-header fc-\" + dayIDs[date.getDay()] + \" \" + headerClass + \"'>\" +\n          htmlEscape(formatDate(date, colFormat)) +\n          \"</th>\";\n      }\n  \n      html += \"</tr></thead>\";\n  \n      return html;\n    }\n  \n  \n    function buildBodyHTML() {\n      var contentClass = tm + \"-widget-content\";\n      var html = '';\n      var row;\n      var col;\n      var date;\n  \n      html += \"<tbody>\";\n  \n      for (row=0; row<rowCnt; row++) {\n  \n        html += \"<tr class='fc-week'>\";\n  \n        if (showWeekNumbers) {\n          date = cellToDate(row, 0);\n          html +=\n            \"<td class='fc-week-number \" + contentClass + \"'>\" +\n            \"<div>\" +\n            htmlEscape(formatDate(date, weekNumberFormat)) +\n            \"</div>\" +\n            \"</td>\";\n        }\n  \n        for (col=0; col<colCnt; col++) {\n          date = cellToDate(row, col);\n          html += buildCellHTML(date);\n        }\n  \n        html += \"</tr>\";\n      }\n  \n      html += \"</tbody>\";\n  \n      return html;\n    }\n  \n  \n    function buildCellHTML(date) {\n      var contentClass = tm + \"-widget-content\";\n      var month = t.start.getMonth();\n      var today = clearTime(new Date());\n      var html = '';\n      var classNames = [\n        'fc-day',\n        'fc-' + dayIDs[date.getDay()],\n        contentClass\n      ];\n  \n      if (date.getMonth() != month) {\n        classNames.push('fc-other-month');\n      }\n      if (+date == +today) {\n        classNames.push(\n          'fc-today',\n          tm + '-state-highlight'\n        );\n      }\n      else if (date < today) {\n        classNames.push('fc-past');\n      }\n      else {\n        classNames.push('fc-future');\n      }\n  \n      html +=\n        \"<td\" +\n        \" class='\" + classNames.join(' ') + \"'\" +\n        \" data-date='\" + formatDate(date, 'yyyy-MM-dd') + \"'\" +\n        \">\" +\n        \"<div>\";\n  \n      if (showNumbers) {\n        html += \"<div class='fc-day-number'>\" + date.getDate() + \"</div>\";\n      }\n  \n      html +=\n        \"<div class='fc-day-content'>\" +\n        \"<div style='position:relative'>Â </div>\" +\n        \"</div>\" +\n        \"</div>\" +\n        \"</td>\";\n  \n      return html;\n    }\n  \n  \n  \n    /* Dimensions\n    -----------------------------------------------------------*/\n    \n    \n    function setHeight(height) {\n      viewHeight = height;\n      \n      var bodyHeight = viewHeight - head.height();\n      var rowHeight;\n      var rowHeightLast;\n      var cell;\n        \n      if (opt('weekMode') == 'variable') {\n        rowHeight = rowHeightLast = Math.floor(bodyHeight / (rowCnt==1 ? 2 : 6));\n      }else{\n        rowHeight = Math.floor(bodyHeight / rowCnt);\n        rowHeightLast = bodyHeight - rowHeight * (rowCnt-1);\n      }\n      \n      bodyFirstCells.each(function(i, _cell) {\n        if (i < rowCnt) {\n          cell = $(_cell);\n          cell.find('> div').css(\n            'min-height',\n            (i==rowCnt-1 ? rowHeightLast : rowHeight) - vsides(cell)\n          );\n        }\n      });\n      \n    }\n    \n    \n    function setWidth(width) {\n      viewWidth = width;\n      colPositions.clear();\n      colContentPositions.clear();\n  \n      weekNumberWidth = 0;\n      if (showWeekNumbers) {\n        weekNumberWidth = head.find('th.fc-week-number').outerWidth();\n      }\n  \n      colWidth = Math.floor((viewWidth - weekNumberWidth) / colCnt);\n      setOuterWidth(headCells.slice(0, -1), colWidth);\n    }\n    \n    \n    \n    /* Day clicking and binding\n    -----------------------------------------------------------*/\n    \n    \n    function dayBind(days) {\n      days.click(dayClick)\n        .mousedown(daySelectionMousedown);\n    }\n    \n    \n    function dayClick(ev) {\n      if (!opt('selectable')) { // if selectable, SelectionManager will worry about dayClick\n        var date = parseISO8601($(this).data('date'));\n        trigger('dayClick', this, date, true, ev);\n      }\n    }\n    \n    \n    \n    /* Semi-transparent Overlay Helpers\n    ------------------------------------------------------*/\n    // TODO: should be consolidated with AgendaView's methods\n  \n  \n    function renderDayOverlay(overlayStart, overlayEnd, refreshCoordinateGrid) { // overlayEnd is exclusive\n  \n      if (refreshCoordinateGrid) {\n        coordinateGrid.build();\n      }\n  \n      var segments = rangeToSegments(overlayStart, overlayEnd);\n  \n      for (var i=0; i<segments.length; i++) {\n        var segment = segments[i];\n        dayBind(\n          renderCellOverlay(\n            segment.row,\n            segment.leftCol,\n            segment.row,\n            segment.rightCol\n          )\n        );\n      }\n    }\n  \n    \n    function renderCellOverlay(row0, col0, row1, col1) { // row1,col1 is inclusive\n      var rect = coordinateGrid.rect(row0, col0, row1, col1, element);\n      return renderOverlay(rect, element);\n    }\n    \n    \n    \n    /* Selection\n    -----------------------------------------------------------------------*/\n    \n    \n    function defaultSelectionEnd(startDate, allDay) {\n      return cloneDate(startDate);\n    }\n    \n    \n    function renderSelection(startDate, endDate, allDay) {\n      renderDayOverlay(startDate, addDays(cloneDate(endDate), 1), true); // rebuild every time???\n    }\n    \n    \n    function clearSelection() {\n      clearOverlays();\n    }\n    \n    \n    function reportDayClick(date, allDay, ev) {\n      var cell = dateToCell(date);\n      var _element = bodyCells[cell.row*colCnt + cell.col];\n      trigger('dayClick', _element, date, allDay, ev);\n    }\n    \n    \n    \n    /* External Dragging\n    -----------------------------------------------------------------------*/\n    \n    \n    function dragStart(_dragElement, ev, ui) {\n      hoverListener.start(function(cell) {\n        clearOverlays();\n        if (cell) {\n          renderCellOverlay(cell.row, cell.col, cell.row, cell.col);\n        }\n      }, ev);\n    }\n    \n    \n    function dragStop(_dragElement, ev, ui) {\n      var cell = hoverListener.stop();\n      clearOverlays();\n      if (cell) {\n        var d = cellToDate(cell);\n        trigger('drop', _dragElement, d, true, ev, ui);\n      }\n    }\n    \n    \n    \n    /* Utilities\n    --------------------------------------------------------*/\n    \n    \n    function defaultEventEnd(event) {\n      return cloneDate(event.start);\n    }\n    \n    \n    coordinateGrid = new CoordinateGrid(function(rows, cols) {\n      var e, n, p;\n      headCells.each(function(i, _e) {\n        e = $(_e);\n        n = e.offset().left;\n        if (i) {\n          p[1] = n;\n        }\n        p = [n];\n        cols[i] = p;\n      });\n      p[1] = n + e.outerWidth();\n      bodyRows.each(function(i, _e) {\n        if (i < rowCnt) {\n          e = $(_e);\n          n = e.offset().top;\n          if (i) {\n            p[1] = n;\n          }\n          p = [n];\n          rows[i] = p;\n        }\n      });\n      p[1] = n + e.outerHeight();\n    });\n    \n    \n    hoverListener = new HoverListener(coordinateGrid);\n    \n    colPositions = new HorizontalPositionCache(function(col) {\n      return firstRowCellInners.eq(col);\n    });\n  \n    colContentPositions = new HorizontalPositionCache(function(col) {\n      return firstRowCellContentInners.eq(col);\n    });\n  \n  \n    function colLeft(col) {\n      return colPositions.left(col);\n    }\n  \n  \n    function colRight(col) {\n      return colPositions.right(col);\n    }\n    \n    \n    function colContentLeft(col) {\n      return colContentPositions.left(col);\n    }\n    \n    \n    function colContentRight(col) {\n      return colContentPositions.right(col);\n    }\n    \n    \n    function allDayRow(i) {\n      return bodyRows.eq(i);\n    }\n    \n  }\n  \n  ;;\n  \n  function BasicEventRenderer() {\n    var t = this;\n    \n    \n    // exports\n    t.renderEvents = renderEvents;\n    t.clearEvents = clearEvents;\n    \n  \n    // imports\n    DayEventRenderer.call(t);\n  \n    \n    function renderEvents(events, modifiedEventId) {\n      t.renderDayEvents(events, modifiedEventId);\n    }\n    \n    \n    function clearEvents() {\n      t.getDaySegmentContainer().empty();\n    }\n  \n  \n    // TODO: have this class (and AgendaEventRenderer) be responsible for creating the event container div\n  \n  }\n  \n  ;;\n  \n  fcViews.agendaWeek = AgendaWeekView;\n  \n  function AgendaWeekView(element, calendar) {\n    var t = this;\n    \n    \n    // exports\n    t.render = render;\n    \n    \n    // imports\n    AgendaView.call(t, element, calendar, 'agendaWeek');\n    var opt = t.opt;\n    var renderAgenda = t.renderAgenda;\n    var skipHiddenDays = t.skipHiddenDays;\n    var getCellsPerWeek = t.getCellsPerWeek;\n    var formatDates = calendar.formatDates;\n  \n    \n    function render(date, delta) {\n  \n      if (delta) {\n        addDays(date, delta * 7);\n      }\n  \n      var start = addDays(cloneDate(date), -((date.getDay() - opt('firstDay') + 7) % 7));\n      var end = addDays(cloneDate(start), 7);\n  \n      var visStart = cloneDate(start);\n      skipHiddenDays(visStart);\n  \n      var visEnd = cloneDate(end);\n      skipHiddenDays(visEnd, -1, true);\n  \n      var colCnt = getCellsPerWeek();\n  \n      t.title = formatDates(\n        visStart,\n        addDays(cloneDate(visEnd), -1),\n        opt('titleFormat')\n      );\n  \n      t.start = start;\n      t.end = end;\n      t.visStart = visStart;\n      t.visEnd = visEnd;\n  \n      renderAgenda(colCnt);\n    }\n  \n  }\n  \n  ;;\n  \n  fcViews.agendaDay = AgendaDayView;\n  \n  \n  function AgendaDayView(element, calendar) {\n    var t = this;\n    \n    \n    // exports\n    t.render = render;\n    \n    \n    // imports\n    AgendaView.call(t, element, calendar, 'agendaDay');\n    var opt = t.opt;\n    var renderAgenda = t.renderAgenda;\n    var skipHiddenDays = t.skipHiddenDays;\n    var formatDate = calendar.formatDate;\n    \n    \n    function render(date, delta) {\n  \n      if (delta) {\n        addDays(date, delta);\n      }\n      skipHiddenDays(date, delta < 0 ? -1 : 1);\n  \n      var start = cloneDate(date, true);\n      var end = addDays(cloneDate(start), 1);\n  \n      t.title = formatDate(date, opt('titleFormat'));\n  \n      t.start = t.visStart = start;\n      t.end = t.visEnd = end;\n  \n      renderAgenda(1);\n    }\n    \n  \n  }\n  \n  ;;\n  \n  setDefaults({\n    allDaySlot: true,\n    allDayText: 'all-day',\n    firstHour: 6,\n    slotMinutes: 30,\n    defaultEventMinutes: 120,\n    axisFormat: 'h(:mm)tt',\n    timeFormat: {\n      agenda: 'h:mm{ - h:mm}'\n    },\n    dragOpacity: {\n      agenda: .5\n    },\n    minTime: 0,\n    maxTime: 24,\n    slotEventOverlap: true\n  });\n  \n  \n  // TODO: make it work in quirks mode (event corners, all-day height)\n  // TODO: test liquid width, especially in IE6\n  \n  \n  function AgendaView(element, calendar, viewName) {\n    var t = this;\n    \n    \n    // exports\n    t.renderAgenda = renderAgenda;\n    t.setWidth = setWidth;\n    t.setHeight = setHeight;\n    t.afterRender = afterRender;\n    t.defaultEventEnd = defaultEventEnd;\n    t.timePosition = timePosition;\n    t.getIsCellAllDay = getIsCellAllDay;\n    t.allDayRow = getAllDayRow;\n    t.getCoordinateGrid = function() { return coordinateGrid }; // specifically for AgendaEventRenderer\n    t.getHoverListener = function() { return hoverListener };\n    t.colLeft = colLeft;\n    t.colRight = colRight;\n    t.colContentLeft = colContentLeft;\n    t.colContentRight = colContentRight;\n    t.getDaySegmentContainer = function() { return daySegmentContainer };\n    t.getSlotSegmentContainer = function() { return slotSegmentContainer };\n    t.getMinMinute = function() { return minMinute };\n    t.getMaxMinute = function() { return maxMinute };\n    t.getSlotContainer = function() { return slotContainer };\n    t.getRowCnt = function() { return 1 };\n    t.getColCnt = function() { return colCnt };\n    t.getColWidth = function() { return colWidth };\n    t.getSnapHeight = function() { return snapHeight };\n    t.getSnapMinutes = function() { return snapMinutes };\n    t.defaultSelectionEnd = defaultSelectionEnd;\n    t.renderDayOverlay = renderDayOverlay;\n    t.renderSelection = renderSelection;\n    t.clearSelection = clearSelection;\n    t.reportDayClick = reportDayClick; // selection mousedown hack\n    t.dragStart = dragStart;\n    t.dragStop = dragStop;\n    \n    \n    // imports\n    View.call(t, element, calendar, viewName);\n    OverlayManager.call(t);\n    SelectionManager.call(t);\n    AgendaEventRenderer.call(t);\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var renderOverlay = t.renderOverlay;\n    var clearOverlays = t.clearOverlays;\n    var reportSelection = t.reportSelection;\n    var unselect = t.unselect;\n    var daySelectionMousedown = t.daySelectionMousedown;\n    var slotSegHtml = t.slotSegHtml;\n    var cellToDate = t.cellToDate;\n    var dateToCell = t.dateToCell;\n    var rangeToSegments = t.rangeToSegments;\n    var formatDate = calendar.formatDate;\n    \n    \n    // locals\n    \n    var dayTable;\n    var dayHead;\n    var dayHeadCells;\n    var dayBody;\n    var dayBodyCells;\n    var dayBodyCellInners;\n    var dayBodyCellContentInners;\n    var dayBodyFirstCell;\n    var dayBodyFirstCellStretcher;\n    var slotLayer;\n    var daySegmentContainer;\n    var allDayTable;\n    var allDayRow;\n    var slotScroller;\n    var slotContainer;\n    var slotSegmentContainer;\n    var slotTable;\n    var selectionHelper;\n    \n    var viewWidth;\n    var viewHeight;\n    var axisWidth;\n    var colWidth;\n    var gutterWidth;\n    var slotHeight; // TODO: what if slotHeight changes? (see issue 650)\n  \n    var snapMinutes;\n    var snapRatio; // ratio of number of \"selection\" slots to normal slots. (ex: 1, 2, 4)\n    var snapHeight; // holds the pixel hight of a \"selection\" slot\n    \n    var colCnt;\n    var slotCnt;\n    var coordinateGrid;\n    var hoverListener;\n    var colPositions;\n    var colContentPositions;\n    var slotTopCache = {};\n    \n    var tm;\n    var rtl;\n    var minMinute, maxMinute;\n    var colFormat;\n    var showWeekNumbers;\n    var weekNumberTitle;\n    var weekNumberFormat;\n    \n  \n    \n    /* Rendering\n    -----------------------------------------------------------------------------*/\n    \n    \n    disableTextSelection(element.addClass('fc-agenda'));\n    \n    \n    function renderAgenda(c) {\n      colCnt = c;\n      updateOptions();\n  \n      if (!dayTable) { // first time rendering?\n        buildSkeleton(); // builds day table, slot area, events containers\n      }\n      else {\n        buildDayTable(); // rebuilds day table\n      }\n    }\n    \n    \n    function updateOptions() {\n  \n      tm = opt('theme') ? 'ui' : 'fc';\n      rtl = opt('isRTL')\n      minMinute = parseTime(opt('minTime'));\n      maxMinute = parseTime(opt('maxTime'));\n      colFormat = opt('columnFormat');\n  \n      // week # options. (TODO: bad, logic also in other views)\n      showWeekNumbers = opt('weekNumbers');\n      weekNumberTitle = opt('weekNumberTitle');\n      if (opt('weekNumberCalculation') != 'iso') {\n        weekNumberFormat = \"w\";\n      }\n      else {\n        weekNumberFormat = \"W\";\n      }\n  \n      snapMinutes = opt('snapMinutes') || opt('slotMinutes');\n    }\n  \n  \n  \n    /* Build DOM\n    -----------------------------------------------------------------------*/\n  \n  \n    function buildSkeleton() {\n      var headerClass = tm + \"-widget-header\";\n      var contentClass = tm + \"-widget-content\";\n      var s;\n      var d;\n      var i;\n      var maxd;\n      var minutes;\n      var slotNormal = opt('slotMinutes') % 15 == 0;\n      \n      buildDayTable();\n      \n      slotLayer =\n        $(\"<div style='position:absolute;z-index:2;left:0;width:100%'/>\")\n          .appendTo(element);\n          \n      if (opt('allDaySlot')) {\n      \n        daySegmentContainer =\n          $(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\")\n            .appendTo(slotLayer);\n      \n        s =\n          \"<table style='width:100%' class='fc-agenda-allday' cellspacing='0'>\" +\n          \"<tr>\" +\n          \"<th class='\" + headerClass + \" fc-agenda-axis'>\" + opt('allDayText') + \"</th>\" +\n          \"<td>\" +\n          \"<div class='fc-day-content'><div style='position:relative'/></div>\" +\n          \"</td>\" +\n          \"<th class='\" + headerClass + \" fc-agenda-gutter'>Â </th>\" +\n          \"</tr>\" +\n          \"</table>\";\n        allDayTable = $(s).appendTo(slotLayer);\n        allDayRow = allDayTable.find('tr');\n        \n        dayBind(allDayRow.find('td'));\n        \n        slotLayer.append(\n          \"<div class='fc-agenda-divider \" + headerClass + \"'>\" +\n          \"<div class='fc-agenda-divider-inner'/>\" +\n          \"</div>\"\n        );\n        \n      }else{\n      \n        daySegmentContainer = $([]); // in jQuery 1.4, we can just do $()\n      \n      }\n      \n      slotScroller =\n        $(\"<div style='position:absolute;width:100%;overflow-x:hidden;overflow-y:auto'/>\")\n          .appendTo(slotLayer);\n          \n      slotContainer =\n        $(\"<div style='position:relative;width:100%;overflow:hidden'/>\")\n          .appendTo(slotScroller);\n          \n      slotSegmentContainer =\n        $(\"<div class='fc-event-container' style='position:absolute;z-index:8;top:0;left:0'/>\")\n          .appendTo(slotContainer);\n      \n      s =\n        \"<table class='fc-agenda-slots' style='width:100%' cellspacing='0'>\" +\n        \"<tbody>\";\n      d = zeroDate();\n      maxd = addMinutes(cloneDate(d), maxMinute);\n      addMinutes(d, minMinute);\n      slotCnt = 0;\n      for (i=0; d < maxd; i++) {\n        minutes = d.getMinutes();\n        s +=\n          \"<tr class='fc-slot\" + i + ' ' + (!minutes ? '' : 'fc-minor') + \"'>\" +\n          \"<th class='fc-agenda-axis \" + headerClass + \"'>\" +\n          ((!slotNormal || !minutes) ? formatDate(d, opt('axisFormat')) : 'Â ') +\n          \"</th>\" +\n          \"<td class='\" + contentClass + \"'>\" +\n          \"<div style='position:relative'>Â </div>\" +\n          \"</td>\" +\n          \"</tr>\";\n        addMinutes(d, opt('slotMinutes'));\n        slotCnt++;\n      }\n      s +=\n        \"</tbody>\" +\n        \"</table>\";\n      slotTable = $(s).appendTo(slotContainer);\n      \n      slotBind(slotTable.find('td'));\n    }\n  \n  \n  \n    /* Build Day Table\n    -----------------------------------------------------------------------*/\n  \n  \n    function buildDayTable() {\n      var html = buildDayTableHTML();\n  \n      if (dayTable) {\n        dayTable.remove();\n      }\n      dayTable = $(html).appendTo(element);\n  \n      dayHead = dayTable.find('thead');\n      dayHeadCells = dayHead.find('th').slice(1, -1); // exclude gutter\n      dayBody = dayTable.find('tbody');\n      dayBodyCells = dayBody.find('td').slice(0, -1); // exclude gutter\n      dayBodyCellInners = dayBodyCells.find('> div');\n      dayBodyCellContentInners = dayBodyCells.find('.fc-day-content > div');\n  \n      dayBodyFirstCell = dayBodyCells.eq(0);\n      dayBodyFirstCellStretcher = dayBodyCellInners.eq(0);\n      \n      markFirstLast(dayHead.add(dayHead.find('tr')));\n      markFirstLast(dayBody.add(dayBody.find('tr')));\n  \n      // TODO: now that we rebuild the cells every time, we should call dayRender\n    }\n  \n  \n    function buildDayTableHTML() {\n      var html =\n        \"<table style='width:100%' class='fc-agenda-days fc-border-separate' cellspacing='0'>\" +\n        buildDayTableHeadHTML() +\n        buildDayTableBodyHTML() +\n        \"</table>\";\n  \n      return html;\n    }\n  \n  \n    function buildDayTableHeadHTML() {\n      var headerClass = tm + \"-widget-header\";\n      var date;\n      var html = '';\n      var weekText;\n      var col;\n  \n      html +=\n        \"<thead>\" +\n        \"<tr>\";\n  \n      if (showWeekNumbers) {\n        date = cellToDate(0, 0);\n        weekText = formatDate(date, weekNumberFormat);\n        if (rtl) {\n          weekText += weekNumberTitle;\n        }\n        else {\n          weekText = weekNumberTitle + weekText;\n        }\n        html +=\n          \"<th class='fc-agenda-axis fc-week-number \" + headerClass + \"'>\" +\n          htmlEscape(weekText) +\n          \"</th>\";\n      }\n      else {\n        html += \"<th class='fc-agenda-axis \" + headerClass + \"'>Â </th>\";\n      }\n  \n      for (col=0; col<colCnt; col++) {\n        date = cellToDate(0, col);\n        html +=\n          \"<th class='fc-\" + dayIDs[date.getDay()] + \" fc-col\" + col + ' ' + headerClass + \"'>\" +\n          htmlEscape(formatDate(date, colFormat)) +\n          \"</th>\";\n      }\n  \n      html +=\n        \"<th class='fc-agenda-gutter \" + headerClass + \"'>Â </th>\" +\n        \"</tr>\" +\n        \"</thead>\";\n  \n      return html;\n    }\n  \n  \n    function buildDayTableBodyHTML() {\n      var headerClass = tm + \"-widget-header\"; // TODO: make these when updateOptions() called\n      var contentClass = tm + \"-widget-content\";\n      var date;\n      var today = clearTime(new Date());\n      var col;\n      var cellsHTML;\n      var cellHTML;\n      var classNames;\n      var html = '';\n  \n      html +=\n        \"<tbody>\" +\n        \"<tr>\" +\n        \"<th class='fc-agenda-axis \" + headerClass + \"'>Â </th>\";\n  \n      cellsHTML = '';\n  \n      for (col=0; col<colCnt; col++) {\n  \n        date = cellToDate(0, col);\n  \n        classNames = [\n          'fc-col' + col,\n          'fc-' + dayIDs[date.getDay()],\n          contentClass\n        ];\n        if (+date == +today) {\n          classNames.push(\n            tm + '-state-highlight',\n            'fc-today'\n          );\n        }\n        else if (date < today) {\n          classNames.push('fc-past');\n        }\n        else {\n          classNames.push('fc-future');\n        }\n  \n        cellHTML =\n          \"<td class='\" + classNames.join(' ') + \"'>\" +\n          \"<div>\" +\n          \"<div class='fc-day-content'>\" +\n          \"<div style='position:relative'>Â </div>\" +\n          \"</div>\" +\n          \"</div>\" +\n          \"</td>\";\n  \n        cellsHTML += cellHTML;\n      }\n  \n      html += cellsHTML;\n      html +=\n        \"<td class='fc-agenda-gutter \" + contentClass + \"'>Â </td>\" +\n        \"</tr>\" +\n        \"</tbody>\";\n  \n      return html;\n    }\n  \n  \n    // TODO: data-date on the cells\n  \n    \n    \n    /* Dimensions\n    -----------------------------------------------------------------------*/\n  \n    \n    function setHeight(height) {\n      if (height === undefined) {\n        height = viewHeight;\n      }\n      viewHeight = height;\n      slotTopCache = {};\n    \n      var headHeight = dayBody.position().top;\n      var allDayHeight = slotScroller.position().top; // including divider\n      var bodyHeight = Math.min( // total body height, including borders\n        height - headHeight,   // when scrollbars\n        slotTable.height() + allDayHeight + 1 // when no scrollbars. +1 for bottom border\n      );\n  \n      dayBodyFirstCellStretcher\n        .height(bodyHeight - vsides(dayBodyFirstCell));\n      \n      slotLayer.css('top', headHeight);\n      \n      slotScroller.height(bodyHeight - allDayHeight - 1);\n      \n      // the stylesheet guarantees that the first row has no border.\n      // this allows .height() to work well cross-browser.\n      slotHeight = slotTable.find('tr:first').height() + 1; // +1 for bottom border\n  \n      snapRatio = opt('slotMinutes') / snapMinutes;\n      snapHeight = slotHeight / snapRatio;\n    }\n    \n    \n    function setWidth(width) {\n      viewWidth = width;\n      colPositions.clear();\n      colContentPositions.clear();\n  \n      var axisFirstCells = dayHead.find('th:first');\n      if (allDayTable) {\n        axisFirstCells = axisFirstCells.add(allDayTable.find('th:first'));\n      }\n      axisFirstCells = axisFirstCells.add(slotTable.find('th:first'));\n      \n      axisWidth = 0;\n      setOuterWidth(\n        axisFirstCells\n          .width('')\n          .each(function(i, _cell) {\n            axisWidth = Math.max(axisWidth, $(_cell).outerWidth());\n          }),\n        axisWidth\n      );\n      \n      var gutterCells = dayTable.find('.fc-agenda-gutter');\n      if (allDayTable) {\n        gutterCells = gutterCells.add(allDayTable.find('th.fc-agenda-gutter'));\n      }\n  \n      var slotTableWidth = slotScroller[0].clientWidth; // needs to be done after axisWidth (for IE7)\n      \n      gutterWidth = slotScroller.width() - slotTableWidth;\n      if (gutterWidth) {\n        setOuterWidth(gutterCells, gutterWidth);\n        gutterCells\n          .show()\n          .prev()\n          .removeClass('fc-last');\n      }else{\n        gutterCells\n          .hide()\n          .prev()\n          .addClass('fc-last');\n      }\n      \n      colWidth = Math.floor((slotTableWidth - axisWidth) / colCnt);\n      setOuterWidth(dayHeadCells.slice(0, -1), colWidth);\n    }\n    \n  \n  \n    /* Scrolling\n    -----------------------------------------------------------------------*/\n  \n  \n    function resetScroll() {\n      var d0 = zeroDate();\n      var scrollDate = cloneDate(d0);\n      scrollDate.setHours(opt('firstHour'));\n      var top = timePosition(d0, scrollDate) + 1; // +1 for the border\n      function scroll() {\n        slotScroller.scrollTop(top);\n      }\n      scroll();\n      setTimeout(scroll, 0); // overrides any previous scroll state made by the browser\n    }\n  \n  \n    function afterRender() { // after the view has been freshly rendered and sized\n      resetScroll();\n    }\n    \n    \n    \n    /* Slot/Day clicking and binding\n    -----------------------------------------------------------------------*/\n    \n  \n    function dayBind(cells) {\n      cells.click(slotClick)\n        .mousedown(daySelectionMousedown);\n    }\n  \n  \n    function slotBind(cells) {\n      cells.click(slotClick)\n        .mousedown(slotSelectionMousedown);\n    }\n    \n    \n    function slotClick(ev) {\n      if (!opt('selectable')) { // if selectable, SelectionManager will worry about dayClick\n        var col = Math.min(colCnt-1, Math.floor((ev.pageX - dayTable.offset().left - axisWidth) / colWidth));\n        var date = cellToDate(0, col);\n        var rowMatch = this.parentNode.className.match(/fc-slot(\\d+)/); // TODO: maybe use data\n        if (rowMatch) {\n          var mins = parseInt(rowMatch[1]) * opt('slotMinutes');\n          var hours = Math.floor(mins/60);\n          date.setHours(hours);\n          date.setMinutes(mins%60 + minMinute);\n          trigger('dayClick', dayBodyCells[col], date, false, ev);\n        }else{\n          trigger('dayClick', dayBodyCells[col], date, true, ev);\n        }\n      }\n    }\n    \n    \n    \n    /* Semi-transparent Overlay Helpers\n    -----------------------------------------------------*/\n    // TODO: should be consolidated with BasicView's methods\n  \n  \n    function renderDayOverlay(overlayStart, overlayEnd, refreshCoordinateGrid) { // overlayEnd is exclusive\n  \n      if (refreshCoordinateGrid) {\n        coordinateGrid.build();\n      }\n  \n      var segments = rangeToSegments(overlayStart, overlayEnd);\n  \n      for (var i=0; i<segments.length; i++) {\n        var segment = segments[i];\n        dayBind(\n          renderCellOverlay(\n            segment.row,\n            segment.leftCol,\n            segment.row,\n            segment.rightCol\n          )\n        );\n      }\n    }\n    \n    \n    function renderCellOverlay(row0, col0, row1, col1) { // only for all-day?\n      var rect = coordinateGrid.rect(row0, col0, row1, col1, slotLayer);\n      return renderOverlay(rect, slotLayer);\n    }\n    \n  \n    function renderSlotOverlay(overlayStart, overlayEnd) {\n      for (var i=0; i<colCnt; i++) {\n        var dayStart = cellToDate(0, i);\n        var dayEnd = addDays(cloneDate(dayStart), 1);\n        var stretchStart = new Date(Math.max(dayStart, overlayStart));\n        var stretchEnd = new Date(Math.min(dayEnd, overlayEnd));\n        if (stretchStart < stretchEnd) {\n          var rect = coordinateGrid.rect(0, i, 0, i, slotContainer); // only use it for horizontal coords\n          var top = timePosition(dayStart, stretchStart);\n          var bottom = timePosition(dayStart, stretchEnd);\n          rect.top = top;\n          rect.height = bottom - top;\n          slotBind(\n            renderOverlay(rect, slotContainer)\n          );\n        }\n      }\n    }\n    \n    \n    \n    /* Coordinate Utilities\n    -----------------------------------------------------------------------------*/\n    \n    \n    coordinateGrid = new CoordinateGrid(function(rows, cols) {\n      var e, n, p;\n      dayHeadCells.each(function(i, _e) {\n        e = $(_e);\n        n = e.offset().left;\n        if (i) {\n          p[1] = n;\n        }\n        p = [n];\n        cols[i] = p;\n      });\n      p[1] = n + e.outerWidth();\n      if (opt('allDaySlot')) {\n        e = allDayRow;\n        n = e.offset().top;\n        rows[0] = [n, n+e.outerHeight()];\n      }\n      var slotTableTop = slotContainer.offset().top;\n      var slotScrollerTop = slotScroller.offset().top;\n      var slotScrollerBottom = slotScrollerTop + slotScroller.outerHeight();\n      function constrain(n) {\n        return Math.max(slotScrollerTop, Math.min(slotScrollerBottom, n));\n      }\n      for (var i=0; i<slotCnt*snapRatio; i++) { // adapt slot count to increased/decreased selection slot count\n        rows.push([\n          constrain(slotTableTop + snapHeight*i),\n          constrain(slotTableTop + snapHeight*(i+1))\n        ]);\n      }\n    });\n    \n    \n    hoverListener = new HoverListener(coordinateGrid);\n    \n    colPositions = new HorizontalPositionCache(function(col) {\n      return dayBodyCellInners.eq(col);\n    });\n    \n    colContentPositions = new HorizontalPositionCache(function(col) {\n      return dayBodyCellContentInners.eq(col);\n    });\n    \n    \n    function colLeft(col) {\n      return colPositions.left(col);\n    }\n  \n  \n    function colContentLeft(col) {\n      return colContentPositions.left(col);\n    }\n  \n  \n    function colRight(col) {\n      return colPositions.right(col);\n    }\n    \n    \n    function colContentRight(col) {\n      return colContentPositions.right(col);\n    }\n  \n  \n    function getIsCellAllDay(cell) {\n      return opt('allDaySlot') && !cell.row;\n    }\n  \n  \n    function realCellToDate(cell) { // ugh \"real\" ... but blame it on our abuse of the \"cell\" system\n      var d = cellToDate(0, cell.col);\n      var slotIndex = cell.row;\n      if (opt('allDaySlot')) {\n        slotIndex--;\n      }\n      if (slotIndex >= 0) {\n        addMinutes(d, minMinute + slotIndex * snapMinutes);\n      }\n      return d;\n    }\n    \n    \n    // get the Y coordinate of the given time on the given day (both Date objects)\n    function timePosition(day, time) { // both date objects. day holds 00:00 of current day\n      day = cloneDate(day, true);\n      if (time < addMinutes(cloneDate(day), minMinute)) {\n        return 0;\n      }\n      if (time >= addMinutes(cloneDate(day), maxMinute)) {\n        return slotTable.height();\n      }\n      var slotMinutes = opt('slotMinutes'),\n        minutes = time.getHours()*60 + time.getMinutes() - minMinute,\n        slotI = Math.floor(minutes / slotMinutes),\n        slotTop = slotTopCache[slotI];\n      if (slotTop === undefined) {\n        slotTop = slotTopCache[slotI] =\n          slotTable.find('tr').eq(slotI).find('td div')[0].offsetTop;\n          // .eq() is faster than \":eq()\" selector\n          // [0].offsetTop is faster than .position().top (do we really need this optimization?)\n          // a better optimization would be to cache all these divs\n      }\n      return Math.max(0, Math.round(\n        slotTop - 1 + slotHeight * ((minutes % slotMinutes) / slotMinutes)\n      ));\n    }\n    \n    \n    function getAllDayRow(index) {\n      return allDayRow;\n    }\n    \n    \n    function defaultEventEnd(event) {\n      var start = cloneDate(event.start);\n      if (event.allDay) {\n        return start;\n      }\n      return addMinutes(start, opt('defaultEventMinutes'));\n    }\n    \n    \n    \n    /* Selection\n    ---------------------------------------------------------------------------------*/\n    \n    \n    function defaultSelectionEnd(startDate, allDay) {\n      if (allDay) {\n        return cloneDate(startDate);\n      }\n      return addMinutes(cloneDate(startDate), opt('slotMinutes'));\n    }\n    \n    \n    function renderSelection(startDate, endDate, allDay) { // only for all-day\n      if (allDay) {\n        if (opt('allDaySlot')) {\n          renderDayOverlay(startDate, addDays(cloneDate(endDate), 1), true);\n        }\n      }else{\n        renderSlotSelection(startDate, endDate);\n      }\n    }\n    \n    \n    function renderSlotSelection(startDate, endDate) {\n      var helperOption = opt('selectHelper');\n      coordinateGrid.build();\n      if (helperOption) {\n        var col = dateToCell(startDate).col;\n        if (col >= 0 && col < colCnt) { // only works when times are on same day\n          var rect = coordinateGrid.rect(0, col, 0, col, slotContainer); // only for horizontal coords\n          var top = timePosition(startDate, startDate);\n          var bottom = timePosition(startDate, endDate);\n          if (bottom > top) { // protect against selections that are entirely before or after visible range\n            rect.top = top;\n            rect.height = bottom - top;\n            rect.left += 2;\n            rect.width -= 5;\n            if ($.isFunction(helperOption)) {\n              var helperRes = helperOption(startDate, endDate);\n              if (helperRes) {\n                rect.position = 'absolute';\n                selectionHelper = $(helperRes)\n                  .css(rect)\n                  .appendTo(slotContainer);\n              }\n            }else{\n              rect.isStart = true; // conside rect a \"seg\" now\n              rect.isEnd = true;   //\n              selectionHelper = $(slotSegHtml(\n                {\n                  title: '',\n                  start: startDate,\n                  end: endDate,\n                  className: ['fc-select-helper'],\n                  editable: false\n                },\n                rect\n              ));\n              selectionHelper.css('opacity', opt('dragOpacity'));\n            }\n            if (selectionHelper) {\n              slotBind(selectionHelper);\n              slotContainer.append(selectionHelper);\n              setOuterWidth(selectionHelper, rect.width, true); // needs to be after appended\n              setOuterHeight(selectionHelper, rect.height, true);\n            }\n          }\n        }\n      }else{\n        renderSlotOverlay(startDate, endDate);\n      }\n    }\n    \n    \n    function clearSelection() {\n      clearOverlays();\n      if (selectionHelper) {\n        selectionHelper.remove();\n        selectionHelper = null;\n      }\n    }\n    \n    \n    function slotSelectionMousedown(ev) {\n      if (ev.which == 1 && opt('selectable')) { // ev.which==1 means left mouse button\n        unselect(ev);\n        var dates;\n        hoverListener.start(function(cell, origCell) {\n          clearSelection();\n          if (cell && cell.col == origCell.col && !getIsCellAllDay(cell)) {\n            var d1 = realCellToDate(origCell);\n            var d2 = realCellToDate(cell);\n            dates = [\n              d1,\n              addMinutes(cloneDate(d1), snapMinutes), // calculate minutes depending on selection slot minutes \n              d2,\n              addMinutes(cloneDate(d2), snapMinutes)\n            ].sort(dateCompare);\n            renderSlotSelection(dates[0], dates[3]);\n          }else{\n            dates = null;\n          }\n        }, ev);\n        $(document).one('mouseup', function(ev) {\n          hoverListener.stop();\n          if (dates) {\n            if (+dates[0] == +dates[1]) {\n              reportDayClick(dates[0], false, ev);\n            }\n            reportSelection(dates[0], dates[3], false, ev);\n          }\n        });\n      }\n    }\n  \n  \n    function reportDayClick(date, allDay, ev) {\n      trigger('dayClick', dayBodyCells[dateToCell(date).col], date, allDay, ev);\n    }\n    \n    \n    \n    /* External Dragging\n    --------------------------------------------------------------------------------*/\n    \n    \n    function dragStart(_dragElement, ev, ui) {\n      hoverListener.start(function(cell) {\n        clearOverlays();\n        if (cell) {\n          if (getIsCellAllDay(cell)) {\n            renderCellOverlay(cell.row, cell.col, cell.row, cell.col);\n          }else{\n            var d1 = realCellToDate(cell);\n            var d2 = addMinutes(cloneDate(d1), opt('defaultEventMinutes'));\n            renderSlotOverlay(d1, d2);\n          }\n        }\n      }, ev);\n    }\n    \n    \n    function dragStop(_dragElement, ev, ui) {\n      var cell = hoverListener.stop();\n      clearOverlays();\n      if (cell) {\n        trigger('drop', _dragElement, realCellToDate(cell), getIsCellAllDay(cell), ev, ui);\n      }\n    }\n    \n  \n  }\n  \n  ;;\n  \n  function AgendaEventRenderer() {\n    var t = this;\n    \n    \n    // exports\n    t.renderEvents = renderEvents;\n    t.clearEvents = clearEvents;\n    t.slotSegHtml = slotSegHtml;\n    \n    \n    // imports\n    DayEventRenderer.call(t);\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var isEventDraggable = t.isEventDraggable;\n    var isEventResizable = t.isEventResizable;\n    var eventEnd = t.eventEnd;\n    var eventElementHandlers = t.eventElementHandlers;\n    var setHeight = t.setHeight;\n    var getDaySegmentContainer = t.getDaySegmentContainer;\n    var getSlotSegmentContainer = t.getSlotSegmentContainer;\n    var getHoverListener = t.getHoverListener;\n    var getMaxMinute = t.getMaxMinute;\n    var getMinMinute = t.getMinMinute;\n    var timePosition = t.timePosition;\n    var getIsCellAllDay = t.getIsCellAllDay;\n    var colContentLeft = t.colContentLeft;\n    var colContentRight = t.colContentRight;\n    var cellToDate = t.cellToDate;\n    var getColCnt = t.getColCnt;\n    var getColWidth = t.getColWidth;\n    var getSnapHeight = t.getSnapHeight;\n    var getSnapMinutes = t.getSnapMinutes;\n    var getSlotContainer = t.getSlotContainer;\n    var reportEventElement = t.reportEventElement;\n    var showEvents = t.showEvents;\n    var hideEvents = t.hideEvents;\n    var eventDrop = t.eventDrop;\n    var eventResize = t.eventResize;\n    var renderDayOverlay = t.renderDayOverlay;\n    var clearOverlays = t.clearOverlays;\n    var renderDayEvents = t.renderDayEvents;\n    var calendar = t.calendar;\n    var formatDate = calendar.formatDate;\n    var formatDates = calendar.formatDates;\n  \n  \n    // overrides\n    t.draggableDayEvent = draggableDayEvent;\n  \n    \n    \n    /* Rendering\n    ----------------------------------------------------------------------------*/\n    \n  \n    function renderEvents(events, modifiedEventId) {\n      var i, len=events.length,\n        dayEvents=[],\n        slotEvents=[];\n      for (i=0; i<len; i++) {\n        if (events[i].allDay) {\n          dayEvents.push(events[i]);\n        }else{\n          slotEvents.push(events[i]);\n        }\n      }\n  \n      if (opt('allDaySlot')) {\n        renderDayEvents(dayEvents, modifiedEventId);\n        setHeight(); // no params means set to viewHeight\n      }\n  \n      renderSlotSegs(compileSlotSegs(slotEvents), modifiedEventId);\n    }\n    \n    \n    function clearEvents() {\n      getDaySegmentContainer().empty();\n      getSlotSegmentContainer().empty();\n    }\n  \n    \n    function compileSlotSegs(events) {\n      var colCnt = getColCnt(),\n        minMinute = getMinMinute(),\n        maxMinute = getMaxMinute(),\n        d,\n        visEventEnds = $.map(events, slotEventEnd),\n        i,\n        j, seg,\n        colSegs,\n        segs = [];\n  \n      for (i=0; i<colCnt; i++) {\n  \n        d = cellToDate(0, i);\n        addMinutes(d, minMinute);\n  \n        colSegs = sliceSegs(\n          events,\n          visEventEnds,\n          d,\n          addMinutes(cloneDate(d), maxMinute-minMinute)\n        );\n  \n        colSegs = placeSlotSegs(colSegs); // returns a new order\n  \n        for (j=0; j<colSegs.length; j++) {\n          seg = colSegs[j];\n          seg.col = i;\n          segs.push(seg);\n        }\n      }\n  \n      return segs;\n    }\n  \n  \n    function sliceSegs(events, visEventEnds, start, end) {\n      var segs = [],\n        i, len=events.length, event,\n        eventStart, eventEnd,\n        segStart, segEnd,\n        isStart, isEnd;\n      for (i=0; i<len; i++) {\n        event = events[i];\n        eventStart = event.start;\n        eventEnd = visEventEnds[i];\n        if (eventEnd > start && eventStart < end) {\n          if (eventStart < start) {\n            segStart = cloneDate(start);\n            isStart = false;\n          }else{\n            segStart = eventStart;\n            isStart = true;\n          }\n          if (eventEnd > end) {\n            segEnd = cloneDate(end);\n            isEnd = false;\n          }else{\n            segEnd = eventEnd;\n            isEnd = true;\n          }\n          segs.push({\n            event: event,\n            start: segStart,\n            end: segEnd,\n            isStart: isStart,\n            isEnd: isEnd\n          });\n        }\n      }\n      return segs.sort(compareSlotSegs);\n    }\n  \n  \n    function slotEventEnd(event) {\n      if (event.end) {\n        return cloneDate(event.end);\n      }else{\n        return addMinutes(cloneDate(event.start), opt('defaultEventMinutes'));\n      }\n    }\n    \n    \n    // renders events in the 'time slots' at the bottom\n    // TODO: when we refactor this, when user returns `false` eventRender, don't have empty space\n    // TODO: refactor will include using pixels to detect collisions instead of dates (handy for seg cmp)\n    \n    function renderSlotSegs(segs, modifiedEventId) {\n    \n      var i, segCnt=segs.length, seg,\n        event,\n        top,\n        bottom,\n        columnLeft,\n        columnRight,\n        columnWidth,\n        width,\n        left,\n        right,\n        html = '',\n        eventElements,\n        eventElement,\n        triggerRes,\n        titleElement,\n        height,\n        slotSegmentContainer = getSlotSegmentContainer(),\n        isRTL = opt('isRTL');\n        \n      // calculate position/dimensions, create html\n      for (i=0; i<segCnt; i++) {\n        seg = segs[i];\n        event = seg.event;\n        top = timePosition(seg.start, seg.start);\n        bottom = timePosition(seg.start, seg.end);\n        columnLeft = colContentLeft(seg.col);\n        columnRight = colContentRight(seg.col);\n        columnWidth = columnRight - columnLeft;\n  \n        // shave off space on right near scrollbars (2.5%)\n        // TODO: move this to CSS somehow\n        columnRight -= columnWidth * .025;\n        columnWidth = columnRight - columnLeft;\n  \n        width = columnWidth * (seg.forwardCoord - seg.backwardCoord);\n  \n        if (opt('slotEventOverlap')) {\n          // double the width while making sure resize handle is visible\n          // (assumed to be 20px wide)\n          width = Math.max(\n            (width - (20/2)) * 2,\n            width // narrow columns will want to make the segment smaller than\n              // the natural width. don't allow it\n          );\n        }\n  \n        if (isRTL) {\n          right = columnRight - seg.backwardCoord * columnWidth;\n          left = right - width;\n        }\n        else {\n          left = columnLeft + seg.backwardCoord * columnWidth;\n          right = left + width;\n        }\n  \n        // make sure horizontal coordinates are in bounds\n        left = Math.max(left, columnLeft);\n        right = Math.min(right, columnRight);\n        width = right - left;\n  \n        seg.top = top;\n        seg.left = left;\n        seg.outerWidth = width;\n        seg.outerHeight = bottom - top;\n        html += slotSegHtml(event, seg);\n      }\n  \n      slotSegmentContainer[0].innerHTML = html; // faster than html()\n      eventElements = slotSegmentContainer.children();\n      \n      // retrieve elements, run through eventRender callback, bind event handlers\n      for (i=0; i<segCnt; i++) {\n        seg = segs[i];\n        event = seg.event;\n        eventElement = $(eventElements[i]); // faster than eq()\n        triggerRes = trigger('eventRender', event, event, eventElement);\n        if (triggerRes === false) {\n          eventElement.remove();\n        }else{\n          if (triggerRes && triggerRes !== true) {\n            eventElement.remove();\n            eventElement = $(triggerRes)\n              .css({\n                position: 'absolute',\n                top: seg.top,\n                left: seg.left\n              })\n              .appendTo(slotSegmentContainer);\n          }\n          seg.element = eventElement;\n          if (event._id === modifiedEventId) {\n            bindSlotSeg(event, eventElement, seg);\n          }else{\n            eventElement[0]._fci = i; // for lazySegBind\n          }\n          reportEventElement(event, eventElement);\n        }\n      }\n      \n      lazySegBind(slotSegmentContainer, segs, bindSlotSeg);\n      \n      // record event sides and title positions\n      for (i=0; i<segCnt; i++) {\n        seg = segs[i];\n        if (eventElement = seg.element) {\n          seg.vsides = vsides(eventElement, true);\n          seg.hsides = hsides(eventElement, true);\n          titleElement = eventElement.find('.fc-event-title');\n          if (titleElement.length) {\n            seg.contentTop = titleElement[0].offsetTop;\n          }\n        }\n      }\n      \n      // set all positions/dimensions at once\n      for (i=0; i<segCnt; i++) {\n        seg = segs[i];\n        if (eventElement = seg.element) {\n          eventElement[0].style.width = Math.max(0, seg.outerWidth - seg.hsides) + 'px';\n          height = Math.max(0, seg.outerHeight - seg.vsides);\n          eventElement[0].style.height = height + 'px';\n          event = seg.event;\n          if (seg.contentTop !== undefined && height - seg.contentTop < 10) {\n            // not enough room for title, put it in the time (TODO: maybe make both display:inline instead)\n            eventElement.find('div.fc-event-time')\n              .text(formatDate(event.start, opt('timeFormat')) + ' - ' + event.title);\n            eventElement.find('div.fc-event-title')\n              .remove();\n          }\n          trigger('eventAfterRender', event, event, eventElement);\n        }\n      }\n            \n    }\n    \n    \n    function slotSegHtml(event, seg) {\n      var html = \"<\";\n      var url = event.url;\n      var skinCss = getSkinCss(event, opt);\n      var classes = ['fc-event', 'fc-event-vert'];\n      if (isEventDraggable(event)) {\n        classes.push('fc-event-draggable');\n      }\n      if (seg.isStart) {\n        classes.push('fc-event-start');\n      }\n      if (seg.isEnd) {\n        classes.push('fc-event-end');\n      }\n      classes = classes.concat(event.className);\n      if (event.source) {\n        classes = classes.concat(event.source.className || []);\n      }\n      if (url) {\n        html += \"a href='\" + htmlEscape(event.url) + \"'\";\n      }else{\n        html += \"div\";\n      }\n      html +=\n        \" class='\" + classes.join(' ') + \"'\" +\n        \" style=\" +\n          \"'\" +\n          \"position:absolute;\" +\n          \"top:\" + seg.top + \"px;\" +\n          \"left:\" + seg.left + \"px;\" +\n          skinCss +\n          \"'\" +\n        \">\" +\n        \"<div class='fc-event-inner'>\" +\n        \"<div class='fc-event-time'>\" +\n        htmlEscape(formatDates(event.start, event.end, opt('timeFormat'))) +\n        \"</div>\" +\n        \"<div class='fc-event-title'>\" +\n        htmlEscape(event.title || '') +\n        \"</div>\" +\n        \"</div>\" +\n        \"<div class='fc-event-bg'></div>\";\n      if (seg.isEnd && isEventResizable(event)) {\n        html +=\n          \"<div class='ui-resizable-handle ui-resizable-s'>=</div>\";\n      }\n      html +=\n        \"</\" + (url ? \"a\" : \"div\") + \">\";\n      return html;\n    }\n    \n    \n    function bindSlotSeg(event, eventElement, seg) {\n      var timeElement = eventElement.find('div.fc-event-time');\n      if (isEventDraggable(event)) {\n        draggableSlotEvent(event, eventElement, timeElement);\n      }\n      if (seg.isEnd && isEventResizable(event)) {\n        resizableSlotEvent(event, eventElement, timeElement);\n      }\n      eventElementHandlers(event, eventElement);\n    }\n    \n    \n    \n    /* Dragging\n    -----------------------------------------------------------------------------------*/\n    \n    \n    // when event starts out FULL-DAY\n    // overrides DayEventRenderer's version because it needs to account for dragging elements\n    // to and from the slot area.\n    \n    function draggableDayEvent(event, eventElement, seg) {\n      var isStart = seg.isStart;\n      var origWidth;\n      var revert;\n      var allDay = true;\n      var dayDelta;\n      var hoverListener = getHoverListener();\n      var colWidth = getColWidth();\n      var snapHeight = getSnapHeight();\n      var snapMinutes = getSnapMinutes();\n      var minMinute = getMinMinute();\n      eventElement.draggable({\n        opacity: opt('dragOpacity', 'month'), // use whatever the month view was using\n        revertDuration: opt('dragRevertDuration'),\n        start: function(ev, ui) {\n          trigger('eventDragStart', eventElement, event, ev, ui);\n          hideEvents(event, eventElement);\n          origWidth = eventElement.width();\n          hoverListener.start(function(cell, origCell) {\n            clearOverlays();\n            if (cell) {\n              revert = false;\n              var origDate = cellToDate(0, origCell.col);\n              var date = cellToDate(0, cell.col);\n              dayDelta = dayDiff(date, origDate);\n              if (!cell.row) {\n                // on full-days\n                renderDayOverlay(\n                  addDays(cloneDate(event.start), dayDelta),\n                  addDays(exclEndDay(event), dayDelta)\n                );\n                resetElement();\n              }else{\n                // mouse is over bottom slots\n                if (isStart) {\n                  if (allDay) {\n                    // convert event to temporary slot-event\n                    eventElement.width(colWidth - 10); // don't use entire width\n                    setOuterHeight(\n                      eventElement,\n                      snapHeight * Math.round(\n                        (event.end ? ((event.end - event.start) / MINUTE_MS) : opt('defaultEventMinutes')) /\n                          snapMinutes\n                      )\n                    );\n                    eventElement.draggable('option', 'grid', [colWidth, 1]);\n                    allDay = false;\n                  }\n                }else{\n                  revert = true;\n                }\n              }\n              revert = revert || (allDay && !dayDelta);\n            }else{\n              resetElement();\n              revert = true;\n            }\n            eventElement.draggable('option', 'revert', revert);\n          }, ev, 'drag');\n        },\n        stop: function(ev, ui) {\n          hoverListener.stop();\n          clearOverlays();\n          trigger('eventDragStop', eventElement, event, ev, ui);\n          if (revert) {\n            // hasn't moved or is out of bounds (draggable has already reverted)\n            resetElement();\n            eventElement.css('filter', ''); // clear IE opacity side-effects\n            showEvents(event, eventElement);\n          }else{\n            // changed!\n            var minuteDelta = 0;\n            if (!allDay) {\n              minuteDelta = Math.round((eventElement.offset().top - getSlotContainer().offset().top) / snapHeight)\n                * snapMinutes\n                + minMinute\n                - (event.start.getHours() * 60 + event.start.getMinutes());\n            }\n            eventDrop(this, event, dayDelta, minuteDelta, allDay, ev, ui);\n          }\n        }\n      });\n      function resetElement() {\n        if (!allDay) {\n          eventElement\n            .width(origWidth)\n            .height('')\n            .draggable('option', 'grid', null);\n          allDay = true;\n        }\n      }\n    }\n    \n    \n    // when event starts out IN TIMESLOTS\n    \n    function draggableSlotEvent(event, eventElement, timeElement) {\n      var coordinateGrid = t.getCoordinateGrid();\n      var colCnt = getColCnt();\n      var colWidth = getColWidth();\n      var snapHeight = getSnapHeight();\n      var snapMinutes = getSnapMinutes();\n  \n      // states\n      var origPosition; // original position of the element, not the mouse\n      var origCell;\n      var isInBounds, prevIsInBounds;\n      var isAllDay, prevIsAllDay;\n      var colDelta, prevColDelta;\n      var dayDelta; // derived from colDelta\n      var minuteDelta, prevMinuteDelta;\n  \n      eventElement.draggable({\n        scroll: false,\n        grid: [ colWidth, snapHeight ],\n        axis: colCnt==1 ? 'y' : false,\n        opacity: opt('dragOpacity'),\n        revertDuration: opt('dragRevertDuration'),\n        start: function(ev, ui) {\n  \n          trigger('eventDragStart', eventElement, event, ev, ui);\n          hideEvents(event, eventElement);\n  \n          coordinateGrid.build();\n  \n          // initialize states\n          origPosition = eventElement.position();\n          origCell = coordinateGrid.cell(ev.pageX, ev.pageY);\n          isInBounds = prevIsInBounds = true;\n          isAllDay = prevIsAllDay = getIsCellAllDay(origCell);\n          colDelta = prevColDelta = 0;\n          dayDelta = 0;\n          minuteDelta = prevMinuteDelta = 0;\n  \n        },\n        drag: function(ev, ui) {\n  \n          // NOTE: this `cell` value is only useful for determining in-bounds and all-day.\n          // Bad for anything else due to the discrepancy between the mouse position and the\n          // element position while snapping. (problem revealed in PR #55)\n          //\n          // PS- the problem exists for draggableDayEvent() when dragging an all-day event to a slot event.\n          // We should overhaul the dragging system and stop relying on jQuery UI.\n          var cell = coordinateGrid.cell(ev.pageX, ev.pageY);\n  \n          // update states\n          isInBounds = !!cell;\n          if (isInBounds) {\n            isAllDay = getIsCellAllDay(cell);\n  \n            // calculate column delta\n            colDelta = Math.round((ui.position.left - origPosition.left) / colWidth);\n            if (colDelta != prevColDelta) {\n              // calculate the day delta based off of the original clicked column and the column delta\n              var origDate = cellToDate(0, origCell.col);\n              var col = origCell.col + colDelta;\n              col = Math.max(0, col);\n              col = Math.min(colCnt-1, col);\n              var date = cellToDate(0, col);\n              dayDelta = dayDiff(date, origDate);\n            }\n  \n            // calculate minute delta (only if over slots)\n            if (!isAllDay) {\n              minuteDelta = Math.round((ui.position.top - origPosition.top) / snapHeight) * snapMinutes;\n            }\n          }\n  \n          // any state changes?\n          if (\n            isInBounds != prevIsInBounds ||\n            isAllDay != prevIsAllDay ||\n            colDelta != prevColDelta ||\n            minuteDelta != prevMinuteDelta\n          ) {\n  \n            updateUI();\n  \n            // update previous states for next time\n            prevIsInBounds = isInBounds;\n            prevIsAllDay = isAllDay;\n            prevColDelta = colDelta;\n            prevMinuteDelta = minuteDelta;\n          }\n  \n          // if out-of-bounds, revert when done, and vice versa.\n          eventElement.draggable('option', 'revert', !isInBounds);\n  \n        },\n        stop: function(ev, ui) {\n  \n          clearOverlays();\n          trigger('eventDragStop', eventElement, event, ev, ui);\n  \n          if (isInBounds && (isAllDay || dayDelta || minuteDelta)) { // changed!\n            eventDrop(this, event, dayDelta, isAllDay ? 0 : minuteDelta, isAllDay, ev, ui);\n          }\n          else { // either no change or out-of-bounds (draggable has already reverted)\n  \n            // reset states for next time, and for updateUI()\n            isInBounds = true;\n            isAllDay = false;\n            colDelta = 0;\n            dayDelta = 0;\n            minuteDelta = 0;\n  \n            updateUI();\n            eventElement.css('filter', ''); // clear IE opacity side-effects\n  \n            // sometimes fast drags make event revert to wrong position, so reset.\n            // also, if we dragged the element out of the area because of snapping,\n            // but the *mouse* is still in bounds, we need to reset the position.\n            eventElement.css(origPosition);\n  \n            showEvents(event, eventElement);\n          }\n        }\n      });\n  \n      function updateUI() {\n        clearOverlays();\n        if (isInBounds) {\n          if (isAllDay) {\n            timeElement.hide();\n            eventElement.draggable('option', 'grid', null); // disable grid snapping\n            renderDayOverlay(\n              addDays(cloneDate(event.start), dayDelta),\n              addDays(exclEndDay(event), dayDelta)\n            );\n          }\n          else {\n            updateTimeText(minuteDelta);\n            timeElement.css('display', ''); // show() was causing display=inline\n            eventElement.draggable('option', 'grid', [colWidth, snapHeight]); // re-enable grid snapping\n          }\n        }\n      }\n  \n      function updateTimeText(minuteDelta) {\n        var newStart = addMinutes(cloneDate(event.start), minuteDelta);\n        var newEnd;\n        if (event.end) {\n          newEnd = addMinutes(cloneDate(event.end), minuteDelta);\n        }\n        timeElement.text(formatDates(newStart, newEnd, opt('timeFormat')));\n      }\n  \n    }\n    \n    \n    \n    /* Resizing\n    --------------------------------------------------------------------------------------*/\n    \n    \n    function resizableSlotEvent(event, eventElement, timeElement) {\n      var snapDelta, prevSnapDelta;\n      var snapHeight = getSnapHeight();\n      var snapMinutes = getSnapMinutes();\n      eventElement.resizable({\n        handles: {\n          s: '.ui-resizable-handle'\n        },\n        grid: snapHeight,\n        start: function(ev, ui) {\n          snapDelta = prevSnapDelta = 0;\n          hideEvents(event, eventElement);\n          trigger('eventResizeStart', this, event, ev, ui);\n        },\n        resize: function(ev, ui) {\n          // don't rely on ui.size.height, doesn't take grid into account\n          snapDelta = Math.round((Math.max(snapHeight, eventElement.height()) - ui.originalSize.height) / snapHeight);\n          if (snapDelta != prevSnapDelta) {\n            timeElement.text(\n              formatDates(\n                event.start,\n                (!snapDelta && !event.end) ? null : // no change, so don't display time range\n                  addMinutes(eventEnd(event), snapMinutes*snapDelta),\n                opt('timeFormat')\n              )\n            );\n            prevSnapDelta = snapDelta;\n          }\n        },\n        stop: function(ev, ui) {\n          trigger('eventResizeStop', this, event, ev, ui);\n          if (snapDelta) {\n            eventResize(this, event, 0, snapMinutes*snapDelta, ev, ui);\n          }else{\n            showEvents(event, eventElement);\n            // BUG: if event was really short, need to put title back in span\n          }\n        }\n      });\n    }\n    \n  \n  }\n  \n  \n  \n  /* Agenda Event Segment Utilities\n  -----------------------------------------------------------------------------*/\n  \n  \n  // Sets the seg.backwardCoord and seg.forwardCoord on each segment and returns a new\n  // list in the order they should be placed into the DOM (an implicit z-index).\n  function placeSlotSegs(segs) {\n    var levels = buildSlotSegLevels(segs);\n    var level0 = levels[0];\n    var i;\n  \n    computeForwardSlotSegs(levels);\n  \n    if (level0) {\n  \n      for (i=0; i<level0.length; i++) {\n        computeSlotSegPressures(level0[i]);\n      }\n  \n      for (i=0; i<level0.length; i++) {\n        computeSlotSegCoords(level0[i], 0, 0);\n      }\n    }\n  \n    return flattenSlotSegLevels(levels);\n  }\n  \n  \n  // Builds an array of segments \"levels\". The first level will be the leftmost tier of segments\n  // if the calendar is left-to-right, or the rightmost if the calendar is right-to-left.\n  function buildSlotSegLevels(segs) {\n    var levels = [];\n    var i, seg;\n    var j;\n  \n    for (i=0; i<segs.length; i++) {\n      seg = segs[i];\n  \n      // go through all the levels and stop on the first level where there are no collisions\n      for (j=0; j<levels.length; j++) {\n        if (!computeSlotSegCollisions(seg, levels[j]).length) {\n          break;\n        }\n      }\n  \n      (levels[j] || (levels[j] = [])).push(seg);\n    }\n  \n    return levels;\n  }\n  \n  \n  // For every segment, figure out the other segments that are in subsequent\n  // levels that also occupy the same vertical space. Accumulate in seg.forwardSegs\n  function computeForwardSlotSegs(levels) {\n    var i, level;\n    var j, seg;\n    var k;\n  \n    for (i=0; i<levels.length; i++) {\n      level = levels[i];\n  \n      for (j=0; j<level.length; j++) {\n        seg = level[j];\n  \n        seg.forwardSegs = [];\n        for (k=i+1; k<levels.length; k++) {\n          computeSlotSegCollisions(seg, levels[k], seg.forwardSegs);\n        }\n      }\n    }\n  }\n  \n  \n  // Figure out which path forward (via seg.forwardSegs) results in the longest path until\n  // the furthest edge is reached. The number of segments in this path will be seg.forwardPressure\n  function computeSlotSegPressures(seg) {\n    var forwardSegs = seg.forwardSegs;\n    var forwardPressure = 0;\n    var i, forwardSeg;\n  \n    if (seg.forwardPressure === undefined) { // not already computed\n  \n      for (i=0; i<forwardSegs.length; i++) {\n        forwardSeg = forwardSegs[i];\n  \n        // figure out the child's maximum forward path\n        computeSlotSegPressures(forwardSeg);\n  \n        // either use the existing maximum, or use the child's forward pressure\n        // plus one (for the forwardSeg itself)\n        forwardPressure = Math.max(\n          forwardPressure,\n          1 + forwardSeg.forwardPressure\n        );\n      }\n  \n      seg.forwardPressure = forwardPressure;\n    }\n  }\n  \n  \n  // Calculate seg.forwardCoord and seg.backwardCoord for the segment, where both values range\n  // from 0 to 1. If the calendar is left-to-right, the seg.backwardCoord maps to \"left\" and\n  // seg.forwardCoord maps to \"right\" (via percentage). Vice-versa if the calendar is right-to-left.\n  //\n  // The segment might be part of a \"series\", which means consecutive segments with the same pressure\n  // who's width is unknown until an edge has been hit. `seriesBackwardPressure` is the number of\n  // segments behind this one in the current series, and `seriesBackwardCoord` is the starting\n  // coordinate of the first segment in the series.\n  function computeSlotSegCoords(seg, seriesBackwardPressure, seriesBackwardCoord) {\n    var forwardSegs = seg.forwardSegs;\n    var i;\n  \n    if (seg.forwardCoord === undefined) { // not already computed\n  \n      if (!forwardSegs.length) {\n  \n        // if there are no forward segments, this segment should butt up against the edge\n        seg.forwardCoord = 1;\n      }\n      else {\n  \n        // sort highest pressure first\n        forwardSegs.sort(compareForwardSlotSegs);\n  \n        // this segment's forwardCoord will be calculated from the backwardCoord of the\n        // highest-pressure forward segment.\n        computeSlotSegCoords(forwardSegs[0], seriesBackwardPressure + 1, seriesBackwardCoord);\n        seg.forwardCoord = forwardSegs[0].backwardCoord;\n      }\n  \n      // calculate the backwardCoord from the forwardCoord. consider the series\n      seg.backwardCoord = seg.forwardCoord -\n        (seg.forwardCoord - seriesBackwardCoord) / // available width for series\n        (seriesBackwardPressure + 1); // # of segments in the series\n  \n      // use this segment's coordinates to computed the coordinates of the less-pressurized\n      // forward segments\n      for (i=0; i<forwardSegs.length; i++) {\n        computeSlotSegCoords(forwardSegs[i], 0, seg.forwardCoord);\n      }\n    }\n  }\n  \n  \n  // Outputs a flat array of segments, from lowest to highest level\n  function flattenSlotSegLevels(levels) {\n    var segs = [];\n    var i, level;\n    var j;\n  \n    for (i=0; i<levels.length; i++) {\n      level = levels[i];\n  \n      for (j=0; j<level.length; j++) {\n        segs.push(level[j]);\n      }\n    }\n  \n    return segs;\n  }\n  \n  \n  // Find all the segments in `otherSegs` that vertically collide with `seg`.\n  // Append into an optionally-supplied `results` array and return.\n  function computeSlotSegCollisions(seg, otherSegs, results) {\n    results = results || [];\n  \n    for (var i=0; i<otherSegs.length; i++) {\n      if (isSlotSegCollision(seg, otherSegs[i])) {\n        results.push(otherSegs[i]);\n      }\n    }\n  \n    return results;\n  }\n  \n  \n  // Do these segments occupy the same vertical space?\n  function isSlotSegCollision(seg1, seg2) {\n    return seg1.end > seg2.start && seg1.start < seg2.end;\n  }\n  \n  \n  // A cmp function for determining which forward segment to rely on more when computing coordinates.\n  function compareForwardSlotSegs(seg1, seg2) {\n    // put higher-pressure first\n    return seg2.forwardPressure - seg1.forwardPressure ||\n      // put segments that are closer to initial edge first (and favor ones with no coords yet)\n      (seg1.backwardCoord || 0) - (seg2.backwardCoord || 0) ||\n      // do normal sorting...\n      compareSlotSegs(seg1, seg2);\n  }\n  \n  \n  // A cmp function for determining which segment should be closer to the initial edge\n  // (the left edge on a left-to-right calendar).\n  function compareSlotSegs(seg1, seg2) {\n    return seg1.start - seg2.start || // earlier start time goes first\n      (seg2.end - seg2.start) - (seg1.end - seg1.start) || // tie? longer-duration goes first\n      (seg1.event.title || '').localeCompare(seg2.event.title); // tie? alphabetically by title\n  }\n  \n  \n  ;;\n  \n  \n  function View(element, calendar, viewName) {\n    var t = this;\n    \n    \n    // exports\n    t.element = element;\n    t.calendar = calendar;\n    t.name = viewName;\n    t.opt = opt;\n    t.trigger = trigger;\n    t.isEventDraggable = isEventDraggable;\n    t.isEventResizable = isEventResizable;\n    t.setEventData = setEventData;\n    t.clearEventData = clearEventData;\n    t.eventEnd = eventEnd;\n    t.reportEventElement = reportEventElement;\n    t.triggerEventDestroy = triggerEventDestroy;\n    t.eventElementHandlers = eventElementHandlers;\n    t.showEvents = showEvents;\n    t.hideEvents = hideEvents;\n    t.eventDrop = eventDrop;\n    t.eventResize = eventResize;\n    // t.title\n    // t.start, t.end\n    // t.visStart, t.visEnd\n    \n    \n    // imports\n    var defaultEventEnd = t.defaultEventEnd;\n    var normalizeEvent = calendar.normalizeEvent; // in EventManager\n    var reportEventChange = calendar.reportEventChange;\n    \n    \n    // locals\n    var eventsByID = {}; // eventID mapped to array of events (there can be multiple b/c of repeating events)\n    var eventElementsByID = {}; // eventID mapped to array of jQuery elements\n    var eventElementCouples = []; // array of objects, { event, element } // TODO: unify with segment system\n    var options = calendar.options;\n    \n    \n    \n    function opt(name, viewNameOverride) {\n      var v = options[name];\n      if ($.isPlainObject(v)) {\n        return smartProperty(v, viewNameOverride || viewName);\n      }\n      return v;\n    }\n  \n    \n    function trigger(name, thisObj) {\n      return calendar.trigger.apply(\n        calendar,\n        [name, thisObj || t].concat(Array.prototype.slice.call(arguments, 2), [t])\n      );\n    }\n    \n  \n  \n    /* Event Editable Boolean Calculations\n    ------------------------------------------------------------------------------*/\n  \n    \n    function isEventDraggable(event) {\n      var source = event.source || {};\n      return firstDefined(\n          event.startEditable,\n          source.startEditable,\n          opt('eventStartEditable'),\n          event.editable,\n          source.editable,\n          opt('editable')\n        )\n        && !opt('disableDragging'); // deprecated\n    }\n    \n    \n    function isEventResizable(event) { // but also need to make sure the seg.isEnd == true\n      var source = event.source || {};\n      return firstDefined(\n          event.durationEditable,\n          source.durationEditable,\n          opt('eventDurationEditable'),\n          event.editable,\n          source.editable,\n          opt('editable')\n        )\n        && !opt('disableResizing'); // deprecated\n    }\n    \n    \n    \n    /* Event Data\n    ------------------------------------------------------------------------------*/\n    \n    \n    function setEventData(events) { // events are already normalized at this point\n      eventsByID = {};\n      var i, len=events.length, event;\n      for (i=0; i<len; i++) {\n        event = events[i];\n        if (eventsByID[event._id]) {\n          eventsByID[event._id].push(event);\n        }else{\n          eventsByID[event._id] = [event];\n        }\n      }\n    }\n  \n  \n    function clearEventData() {\n      eventsByID = {};\n      eventElementsByID = {};\n      eventElementCouples = [];\n    }\n    \n    \n    // returns a Date object for an event's end\n    function eventEnd(event) {\n      return event.end ? cloneDate(event.end) : defaultEventEnd(event);\n    }\n    \n    \n    \n    /* Event Elements\n    ------------------------------------------------------------------------------*/\n    \n    \n    // report when view creates an element for an event\n    function reportEventElement(event, element) {\n      eventElementCouples.push({ event: event, element: element });\n      if (eventElementsByID[event._id]) {\n        eventElementsByID[event._id].push(element);\n      }else{\n        eventElementsByID[event._id] = [element];\n      }\n    }\n  \n  \n    function triggerEventDestroy() {\n      $.each(eventElementCouples, function(i, couple) {\n        t.trigger('eventDestroy', couple.event, couple.event, couple.element);\n      });\n    }\n    \n    \n    // attaches eventClick, eventMouseover, eventMouseout\n    function eventElementHandlers(event, eventElement) {\n      eventElement\n        .click(function(ev) {\n          if (!eventElement.hasClass('ui-draggable-dragging') &&\n            !eventElement.hasClass('ui-resizable-resizing')) {\n              return trigger('eventClick', this, event, ev);\n            }\n        })\n        .hover(\n          function(ev) {\n            trigger('eventMouseover', this, event, ev);\n          },\n          function(ev) {\n            trigger('eventMouseout', this, event, ev);\n          }\n        );\n      // TODO: don't fire eventMouseover/eventMouseout *while* dragging is occuring (on subject element)\n      // TODO: same for resizing\n    }\n    \n    \n    function showEvents(event, exceptElement) {\n      eachEventElement(event, exceptElement, 'show');\n    }\n    \n    \n    function hideEvents(event, exceptElement) {\n      eachEventElement(event, exceptElement, 'hide');\n    }\n    \n    \n    function eachEventElement(event, exceptElement, funcName) {\n      // NOTE: there may be multiple events per ID (repeating events)\n      // and multiple segments per event\n      var elements = eventElementsByID[event._id],\n        i, len = elements.length;\n      for (i=0; i<len; i++) {\n        if (!exceptElement || elements[i][0] != exceptElement[0]) {\n          elements[i][funcName]();\n        }\n      }\n    }\n    \n    \n    \n    /* Event Modification Reporting\n    ---------------------------------------------------------------------------------*/\n    \n    \n    function eventDrop(e, event, dayDelta, minuteDelta, allDay, ev, ui) {\n      var oldAllDay = event.allDay;\n      var eventId = event._id;\n      moveEvents(eventsByID[eventId], dayDelta, minuteDelta, allDay);\n      trigger(\n        'eventDrop',\n        e,\n        event,\n        dayDelta,\n        minuteDelta,\n        allDay,\n        function() {\n          // TODO: investigate cases where this inverse technique might not work\n          moveEvents(eventsByID[eventId], -dayDelta, -minuteDelta, oldAllDay);\n          reportEventChange(eventId);\n        },\n        ev,\n        ui\n      );\n      reportEventChange(eventId);\n    }\n    \n    \n    function eventResize(e, event, dayDelta, minuteDelta, ev, ui) {\n      var eventId = event._id;\n      elongateEvents(eventsByID[eventId], dayDelta, minuteDelta);\n      trigger(\n        'eventResize',\n        e,\n        event,\n        dayDelta,\n        minuteDelta,\n        function() {\n          // TODO: investigate cases where this inverse technique might not work\n          elongateEvents(eventsByID[eventId], -dayDelta, -minuteDelta);\n          reportEventChange(eventId);\n        },\n        ev,\n        ui\n      );\n      reportEventChange(eventId);\n    }\n    \n    \n    \n    /* Event Modification Math\n    ---------------------------------------------------------------------------------*/\n    \n    \n    function moveEvents(events, dayDelta, minuteDelta, allDay) {\n      minuteDelta = minuteDelta || 0;\n      for (var e, len=events.length, i=0; i<len; i++) {\n        e = events[i];\n        if (allDay !== undefined) {\n          e.allDay = allDay;\n        }\n        addMinutes(addDays(e.start, dayDelta, true), minuteDelta);\n        if (e.end) {\n          e.end = addMinutes(addDays(e.end, dayDelta, true), minuteDelta);\n        }\n        normalizeEvent(e, options);\n      }\n    }\n    \n    \n    function elongateEvents(events, dayDelta, minuteDelta) {\n      minuteDelta = minuteDelta || 0;\n      for (var e, len=events.length, i=0; i<len; i++) {\n        e = events[i];\n        e.end = addMinutes(addDays(eventEnd(e), dayDelta, true), minuteDelta);\n        normalizeEvent(e, options);\n      }\n    }\n  \n  \n  \n    // ====================================================================================================\n    // Utilities for day \"cells\"\n    // ====================================================================================================\n    // The \"basic\" views are completely made up of day cells.\n    // The \"agenda\" views have day cells at the top \"all day\" slot.\n    // This was the obvious common place to put these utilities, but they should be abstracted out into\n    // a more meaningful class (like DayEventRenderer).\n    // ====================================================================================================\n  \n  \n    // For determining how a given \"cell\" translates into a \"date\":\n    //\n    // 1. Convert the \"cell\" (row and column) into a \"cell offset\" (the # of the cell, cronologically from the first).\n    //    Keep in mind that column indices are inverted with isRTL. This is taken into account.\n    //\n    // 2. Convert the \"cell offset\" to a \"day offset\" (the # of days since the first visible day in the view).\n    //\n    // 3. Convert the \"day offset\" into a \"date\" (a JavaScript Date object).\n    //\n    // The reverse transformation happens when transforming a date into a cell.\n  \n  \n    // exports\n    t.isHiddenDay = isHiddenDay;\n    t.skipHiddenDays = skipHiddenDays;\n    t.getCellsPerWeek = getCellsPerWeek;\n    t.dateToCell = dateToCell;\n    t.dateToDayOffset = dateToDayOffset;\n    t.dayOffsetToCellOffset = dayOffsetToCellOffset;\n    t.cellOffsetToCell = cellOffsetToCell;\n    t.cellToDate = cellToDate;\n    t.cellToCellOffset = cellToCellOffset;\n    t.cellOffsetToDayOffset = cellOffsetToDayOffset;\n    t.dayOffsetToDate = dayOffsetToDate;\n    t.rangeToSegments = rangeToSegments;\n  \n  \n    // internals\n    var hiddenDays = opt('hiddenDays') || []; // array of day-of-week indices that are hidden\n    var isHiddenDayHash = []; // is the day-of-week hidden? (hash with day-of-week-index -> bool)\n    var cellsPerWeek;\n    var dayToCellMap = []; // hash from dayIndex -> cellIndex, for one week\n    var cellToDayMap = []; // hash from cellIndex -> dayIndex, for one week\n    var isRTL = opt('isRTL');\n  \n  \n    // initialize important internal variables\n    (function() {\n  \n      if (opt('weekends') === false) {\n        hiddenDays.push(0, 6); // 0=sunday, 6=saturday\n      }\n  \n      // Loop through a hypothetical week and determine which\n      // days-of-week are hidden. Record in both hashes (one is the reverse of the other).\n      for (var dayIndex=0, cellIndex=0; dayIndex<7; dayIndex++) {\n        dayToCellMap[dayIndex] = cellIndex;\n        isHiddenDayHash[dayIndex] = $.inArray(dayIndex, hiddenDays) != -1;\n        if (!isHiddenDayHash[dayIndex]) {\n          cellToDayMap[cellIndex] = dayIndex;\n          cellIndex++;\n        }\n      }\n  \n      cellsPerWeek = cellIndex;\n      if (!cellsPerWeek) {\n        throw 'invalid hiddenDays'; // all days were hidden? bad.\n      }\n  \n    })();\n  \n  \n    // Is the current day hidden?\n    // `day` is a day-of-week index (0-6), or a Date object\n    function isHiddenDay(day) {\n      if (typeof day == 'object') {\n        day = day.getDay();\n      }\n      return isHiddenDayHash[day];\n    }\n  \n  \n    function getCellsPerWeek() {\n      return cellsPerWeek;\n    }\n  \n  \n    // Keep incrementing the current day until it is no longer a hidden day.\n    // If the initial value of `date` is not a hidden day, don't do anything.\n    // Pass `isExclusive` as `true` if you are dealing with an end date.\n    // `inc` defaults to `1` (increment one day forward each time)\n    function skipHiddenDays(date, inc, isExclusive) {\n      inc = inc || 1;\n      while (\n        isHiddenDayHash[ ( date.getDay() + (isExclusive ? inc : 0) + 7 ) % 7 ]\n      ) {\n        addDays(date, inc);\n      }\n    }\n  \n  \n    //\n    // TRANSFORMATIONS: cell -> cell offset -> day offset -> date\n    //\n  \n    // cell -> date (combines all transformations)\n    // Possible arguments:\n    // - row, col\n    // - { row:#, col: # }\n    function cellToDate() {\n      var cellOffset = cellToCellOffset.apply(null, arguments);\n      var dayOffset = cellOffsetToDayOffset(cellOffset);\n      var date = dayOffsetToDate(dayOffset);\n      return date;\n    }\n  \n    // cell -> cell offset\n    // Possible arguments:\n    // - row, col\n    // - { row:#, col:# }\n    function cellToCellOffset(row, col) {\n      var colCnt = t.getColCnt();\n  \n      // rtl variables. wish we could pre-populate these. but where?\n      var dis = isRTL ? -1 : 1;\n      var dit = isRTL ? colCnt - 1 : 0;\n  \n      if (typeof row == 'object') {\n        col = row.col;\n        row = row.row;\n      }\n      var cellOffset = row * colCnt + (col * dis + dit); // column, adjusted for RTL (dis & dit)\n  \n      return cellOffset;\n    }\n  \n    // cell offset -> day offset\n    function cellOffsetToDayOffset(cellOffset) {\n      var day0 = t.visStart.getDay(); // first date's day of week\n      cellOffset += dayToCellMap[day0]; // normlize cellOffset to beginning-of-week\n      return Math.floor(cellOffset / cellsPerWeek) * 7 // # of days from full weeks\n        + cellToDayMap[ // # of days from partial last week\n          (cellOffset % cellsPerWeek + cellsPerWeek) % cellsPerWeek // crazy math to handle negative cellOffsets\n        ]\n        - day0; // adjustment for beginning-of-week normalization\n    }\n  \n    // day offset -> date (JavaScript Date object)\n    function dayOffsetToDate(dayOffset) {\n      var date = cloneDate(t.visStart);\n      addDays(date, dayOffset);\n      return date;\n    }\n  \n  \n    //\n    // TRANSFORMATIONS: date -> day offset -> cell offset -> cell\n    //\n  \n    // date -> cell (combines all transformations)\n    function dateToCell(date) {\n      var dayOffset = dateToDayOffset(date);\n      var cellOffset = dayOffsetToCellOffset(dayOffset);\n      var cell = cellOffsetToCell(cellOffset);\n      return cell;\n    }\n  \n    // date -> day offset\n    function dateToDayOffset(date) {\n      return dayDiff(date, t.visStart);\n    }\n  \n    // day offset -> cell offset\n    function dayOffsetToCellOffset(dayOffset) {\n      var day0 = t.visStart.getDay(); // first date's day of week\n      dayOffset += day0; // normalize dayOffset to beginning-of-week\n      return Math.floor(dayOffset / 7) * cellsPerWeek // # of cells from full weeks\n        + dayToCellMap[ // # of cells from partial last week\n          (dayOffset % 7 + 7) % 7 // crazy math to handle negative dayOffsets\n        ]\n        - dayToCellMap[day0]; // adjustment for beginning-of-week normalization\n    }\n  \n    // cell offset -> cell (object with row & col keys)\n    function cellOffsetToCell(cellOffset) {\n      var colCnt = t.getColCnt();\n  \n      // rtl variables. wish we could pre-populate these. but where?\n      var dis = isRTL ? -1 : 1;\n      var dit = isRTL ? colCnt - 1 : 0;\n  \n      var row = Math.floor(cellOffset / colCnt);\n      var col = ((cellOffset % colCnt + colCnt) % colCnt) * dis + dit; // column, adjusted for RTL (dis & dit)\n      return {\n        row: row,\n        col: col\n      };\n    }\n  \n  \n    //\n    // Converts a date range into an array of segment objects.\n    // \"Segments\" are horizontal stretches of time, sliced up by row.\n    // A segment object has the following properties:\n    // - row\n    // - cols\n    // - isStart\n    // - isEnd\n    //\n    function rangeToSegments(startDate, endDate) {\n      var rowCnt = t.getRowCnt();\n      var colCnt = t.getColCnt();\n      var segments = []; // array of segments to return\n  \n      // day offset for given date range\n      var rangeDayOffsetStart = dateToDayOffset(startDate);\n      var rangeDayOffsetEnd = dateToDayOffset(endDate); // exclusive\n  \n      // first and last cell offset for the given date range\n      // \"last\" implies inclusivity\n      var rangeCellOffsetFirst = dayOffsetToCellOffset(rangeDayOffsetStart);\n      var rangeCellOffsetLast = dayOffsetToCellOffset(rangeDayOffsetEnd) - 1;\n  \n      // loop through all the rows in the view\n      for (var row=0; row<rowCnt; row++) {\n  \n        // first and last cell offset for the row\n        var rowCellOffsetFirst = row * colCnt;\n        var rowCellOffsetLast = rowCellOffsetFirst + colCnt - 1;\n  \n        // get the segment's cell offsets by constraining the range's cell offsets to the bounds of the row\n        var segmentCellOffsetFirst = Math.max(rangeCellOffsetFirst, rowCellOffsetFirst);\n        var segmentCellOffsetLast = Math.min(rangeCellOffsetLast, rowCellOffsetLast);\n  \n        // make sure segment's offsets are valid and in view\n        if (segmentCellOffsetFirst <= segmentCellOffsetLast) {\n  \n          // translate to cells\n          var segmentCellFirst = cellOffsetToCell(segmentCellOffsetFirst);\n          var segmentCellLast = cellOffsetToCell(segmentCellOffsetLast);\n  \n          // view might be RTL, so order by leftmost column\n          var cols = [ segmentCellFirst.col, segmentCellLast.col ].sort();\n  \n          // Determine if segment's first/last cell is the beginning/end of the date range.\n          // We need to compare \"day offset\" because \"cell offsets\" are often ambiguous and\n          // can translate to multiple days, and an edge case reveals itself when we the\n          // range's first cell is hidden (we don't want isStart to be true).\n          var isStart = cellOffsetToDayOffset(segmentCellOffsetFirst) == rangeDayOffsetStart;\n          var isEnd = cellOffsetToDayOffset(segmentCellOffsetLast) + 1 == rangeDayOffsetEnd; // +1 for comparing exclusively\n  \n          segments.push({\n            row: row,\n            leftCol: cols[0],\n            rightCol: cols[1],\n            isStart: isStart,\n            isEnd: isEnd\n          });\n        }\n      }\n  \n      return segments;\n    }\n    \n  \n  }\n  \n  ;;\n  \n  function DayEventRenderer() {\n    var t = this;\n  \n    \n    // exports\n    t.renderDayEvents = renderDayEvents;\n    t.draggableDayEvent = draggableDayEvent; // made public so that subclasses can override\n    t.resizableDayEvent = resizableDayEvent; // \"\n    \n    \n    // imports\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var isEventDraggable = t.isEventDraggable;\n    var isEventResizable = t.isEventResizable;\n    var eventEnd = t.eventEnd;\n    var reportEventElement = t.reportEventElement;\n    var eventElementHandlers = t.eventElementHandlers;\n    var showEvents = t.showEvents;\n    var hideEvents = t.hideEvents;\n    var eventDrop = t.eventDrop;\n    var eventResize = t.eventResize;\n    var getRowCnt = t.getRowCnt;\n    var getColCnt = t.getColCnt;\n    var getColWidth = t.getColWidth;\n    var allDayRow = t.allDayRow; // TODO: rename\n    var colLeft = t.colLeft;\n    var colRight = t.colRight;\n    var colContentLeft = t.colContentLeft;\n    var colContentRight = t.colContentRight;\n    var dateToCell = t.dateToCell;\n    var getDaySegmentContainer = t.getDaySegmentContainer;\n    var formatDates = t.calendar.formatDates;\n    var renderDayOverlay = t.renderDayOverlay;\n    var clearOverlays = t.clearOverlays;\n    var clearSelection = t.clearSelection;\n    var getHoverListener = t.getHoverListener;\n    var rangeToSegments = t.rangeToSegments;\n    var cellToDate = t.cellToDate;\n    var cellToCellOffset = t.cellToCellOffset;\n    var cellOffsetToDayOffset = t.cellOffsetToDayOffset;\n    var dateToDayOffset = t.dateToDayOffset;\n    var dayOffsetToCellOffset = t.dayOffsetToCellOffset;\n  \n  \n    // Render `events` onto the calendar, attach mouse event handlers, and call the `eventAfterRender` callback for each.\n    // Mouse event will be lazily applied, except if the event has an ID of `modifiedEventId`.\n    // Can only be called when the event container is empty (because it wipes out all innerHTML).\n    function renderDayEvents(events, modifiedEventId) {\n  \n      // do the actual rendering. Receive the intermediate \"segment\" data structures.\n      var segments = _renderDayEvents(\n        events,\n        false, // don't append event elements\n        true // set the heights of the rows\n      );\n  \n      // report the elements to the View, for general drag/resize utilities\n      segmentElementEach(segments, function(segment, element) {\n        reportEventElement(segment.event, element);\n      });\n  \n      // attach mouse handlers\n      attachHandlers(segments, modifiedEventId);\n  \n      // call `eventAfterRender` callback for each event\n      segmentElementEach(segments, function(segment, element) {\n        trigger('eventAfterRender', segment.event, segment.event, element);\n      });\n    }\n  \n  \n    // Render an event on the calendar, but don't report them anywhere, and don't attach mouse handlers.\n    // Append this event element to the event container, which might already be populated with events.\n    // If an event's segment will have row equal to `adjustRow`, then explicitly set its top coordinate to `adjustTop`.\n    // This hack is used to maintain continuity when user is manually resizing an event.\n    // Returns an array of DOM elements for the event.\n    function renderTempDayEvent(event, adjustRow, adjustTop) {\n  \n      // actually render the event. `true` for appending element to container.\n      // Recieve the intermediate \"segment\" data structures.\n      var segments = _renderDayEvents(\n        [ event ],\n        true, // append event elements\n        false // don't set the heights of the rows\n      );\n  \n      var elements = [];\n  \n      // Adjust certain elements' top coordinates\n      segmentElementEach(segments, function(segment, element) {\n        if (segment.row === adjustRow) {\n          element.css('top', adjustTop);\n        }\n        elements.push(element[0]); // accumulate DOM nodes\n      });\n  \n      return elements;\n    }\n  \n  \n    // Render events onto the calendar. Only responsible for the VISUAL aspect.\n    // Not responsible for attaching handlers or calling callbacks.\n    // Set `doAppend` to `true` for rendering elements without clearing the existing container.\n    // Set `doRowHeights` to allow setting the height of each row, to compensate for vertical event overflow.\n    function _renderDayEvents(events, doAppend, doRowHeights) {\n  \n      // where the DOM nodes will eventually end up\n      var finalContainer = getDaySegmentContainer();\n  \n      // the container where the initial HTML will be rendered.\n      // If `doAppend`==true, uses a temporary container.\n      var renderContainer = doAppend ? $(\"<div/>\") : finalContainer;\n  \n      var segments = buildSegments(events);\n      var html;\n      var elements;\n  \n      // calculate the desired `left` and `width` properties on each segment object\n      calculateHorizontals(segments);\n  \n      // build the HTML string. relies on `left` property\n      html = buildHTML(segments);\n  \n      // render the HTML. innerHTML is considerably faster than jQuery's .html()\n      renderContainer[0].innerHTML = html;\n  \n      // retrieve the individual elements\n      elements = renderContainer.children();\n  \n      // if we were appending, and thus using a temporary container,\n      // re-attach elements to the real container.\n      if (doAppend) {\n        finalContainer.append(elements);\n      }\n  \n      // assigns each element to `segment.event`, after filtering them through user callbacks\n      resolveElements(segments, elements);\n  \n      // Calculate the left and right padding+margin for each element.\n      // We need this for setting each element's desired outer width, because of the W3C box model.\n      // It's important we do this in a separate pass from acually setting the width on the DOM elements\n      // because alternating reading/writing dimensions causes reflow for every iteration.\n      segmentElementEach(segments, function(segment, element) {\n        segment.hsides = hsides(element, true); // include margins = `true`\n      });\n  \n      // Set the width of each element\n      segmentElementEach(segments, function(segment, element) {\n        element.width(\n          Math.max(0, segment.outerWidth - segment.hsides)\n        );\n      });\n  \n      // Grab each element's outerHeight (setVerticals uses this).\n      // To get an accurate reading, it's important to have each element's width explicitly set already.\n      segmentElementEach(segments, function(segment, element) {\n        segment.outerHeight = element.outerHeight(true); // include margins = `true`\n      });\n  \n      // Set the top coordinate on each element (requires segment.outerHeight)\n      setVerticals(segments, doRowHeights);\n  \n      return segments;\n    }\n  \n  \n    // Generate an array of \"segments\" for all events.\n    function buildSegments(events) {\n      var segments = [];\n      for (var i=0; i<events.length; i++) {\n        var eventSegments = buildSegmentsForEvent(events[i]);\n        segments.push.apply(segments, eventSegments); // append an array to an array\n      }\n      return segments;\n    }\n  \n  \n    // Generate an array of segments for a single event.\n    // A \"segment\" is the same data structure that View.rangeToSegments produces,\n    // with the addition of the `event` property being set to reference the original event.\n    function buildSegmentsForEvent(event) {\n      var startDate = event.start;\n      var endDate = exclEndDay(event);\n      var segments = rangeToSegments(startDate, endDate);\n      for (var i=0; i<segments.length; i++) {\n        segments[i].event = event;\n      }\n      return segments;\n    }\n  \n  \n    // Sets the `left` and `outerWidth` property of each segment.\n    // These values are the desired dimensions for the eventual DOM elements.\n    function calculateHorizontals(segments) {\n      var isRTL = opt('isRTL');\n      for (var i=0; i<segments.length; i++) {\n        var segment = segments[i];\n  \n        // Determine functions used for calulating the elements left/right coordinates,\n        // depending on whether the view is RTL or not.\n        // NOTE:\n        // colLeft/colRight returns the coordinate butting up the edge of the cell.\n        // colContentLeft/colContentRight is indented a little bit from the edge.\n        var leftFunc = (isRTL ? segment.isEnd : segment.isStart) ? colContentLeft : colLeft;\n        var rightFunc = (isRTL ? segment.isStart : segment.isEnd) ? colContentRight : colRight;\n  \n        var left = leftFunc(segment.leftCol);\n        var right = rightFunc(segment.rightCol);\n        segment.left = left;\n        segment.outerWidth = right - left;\n      }\n    }\n  \n  \n    // Build a concatenated HTML string for an array of segments\n    function buildHTML(segments) {\n      var html = '';\n      for (var i=0; i<segments.length; i++) {\n        html += buildHTMLForSegment(segments[i]);\n      }\n      return html;\n    }\n  \n  \n    // Build an HTML string for a single segment.\n    // Relies on the following properties:\n    // - `segment.event` (from `buildSegmentsForEvent`)\n    // - `segment.left` (from `calculateHorizontals`)\n    function buildHTMLForSegment(segment) {\n      var html = '';\n      var isRTL = opt('isRTL');\n      var event = segment.event;\n      var url = event.url;\n  \n      // generate the list of CSS classNames\n      var classNames = [ 'fc-event', 'fc-event-hori' ];\n      if (isEventDraggable(event)) {\n        classNames.push('fc-event-draggable');\n      }\n      if (segment.isStart) {\n        classNames.push('fc-event-start');\n      }\n      if (segment.isEnd) {\n        classNames.push('fc-event-end');\n      }\n      // use the event's configured classNames\n      // guaranteed to be an array via `normalizeEvent`\n      classNames = classNames.concat(event.className);\n      if (event.source) {\n        // use the event's source's classNames, if specified\n        classNames = classNames.concat(event.source.className || []);\n      }\n  \n      // generate a semicolon delimited CSS string for any of the \"skin\" properties\n      // of the event object (`backgroundColor`, `borderColor` and such)\n      var skinCss = getSkinCss(event, opt);\n  \n      if (url) {\n        html += \"<a href='\" + htmlEscape(url) + \"'\";\n      }else{\n        html += \"<div\";\n      }\n      html +=\n        \" class='\" + classNames.join(' ') + \"'\" +\n        \" style=\" +\n          \"'\" +\n          \"position:absolute;\" +\n          \"left:\" + segment.left + \"px;\" +\n          skinCss +\n          \"'\" +\n        \">\" +\n        \"<div class='fc-event-inner'>\";\n      if (!event.allDay && segment.isStart) {\n        html +=\n          \"<span class='fc-event-time'>\" +\n          htmlEscape(\n            formatDates(event.start, event.end, opt('timeFormat'))\n          ) +\n          \"</span>\";\n      }\n      html +=\n        \"<span class='fc-event-title'>\" +\n        htmlEscape(event.title || '') +\n        \"</span>\" +\n        \"</div>\";\n      if (segment.isEnd && isEventResizable(event)) {\n        html +=\n          \"<div class='ui-resizable-handle ui-resizable-\" + (isRTL ? 'w' : 'e') + \"'>\" +\n          \"Â Â Â \" + // makes hit area a lot better for IE6/7\n          \"</div>\";\n      }\n      html += \"</\" + (url ? \"a\" : \"div\") + \">\";\n  \n      // TODO:\n      // When these elements are initially rendered, they will be briefly visibile on the screen,\n      // even though their widths/heights are not set.\n      // SOLUTION: initially set them as visibility:hidden ?\n  \n      return html;\n    }\n  \n  \n    // Associate each segment (an object) with an element (a jQuery object),\n    // by setting each `segment.element`.\n    // Run each element through the `eventRender` filter, which allows developers to\n    // modify an existing element, supply a new one, or cancel rendering.\n    function resolveElements(segments, elements) {\n      for (var i=0; i<segments.length; i++) {\n        var segment = segments[i];\n        var event = segment.event;\n        var element = elements.eq(i);\n  \n        // call the trigger with the original element\n        var triggerRes = trigger('eventRender', event, event, element);\n  \n        if (triggerRes === false) {\n          // if `false`, remove the event from the DOM and don't assign it to `segment.event`\n          element.remove();\n        }\n        else {\n          if (triggerRes && triggerRes !== true) {\n            // the trigger returned a new element, but not `true` (which means keep the existing element)\n  \n            // re-assign the important CSS dimension properties that were already assigned in `buildHTMLForSegment`\n            triggerRes = $(triggerRes)\n              .css({\n                position: 'absolute',\n                left: segment.left\n              });\n  \n            element.replaceWith(triggerRes);\n            element = triggerRes;\n          }\n  \n          segment.element = element;\n        }\n      }\n    }\n  \n  \n  \n    /* Top-coordinate Methods\n    -------------------------------------------------------------------------------------------------*/\n  \n  \n    // Sets the \"top\" CSS property for each element.\n    // If `doRowHeights` is `true`, also sets each row's first cell to an explicit height,\n    // so that if elements vertically overflow, the cell expands vertically to compensate.\n    function setVerticals(segments, doRowHeights) {\n      var rowContentHeights = calculateVerticals(segments); // also sets segment.top\n      var rowContentElements = getRowContentElements(); // returns 1 inner div per row\n      var rowContentTops = [];\n  \n      // Set each row's height by setting height of first inner div\n      if (doRowHeights) {\n        for (var i=0; i<rowContentElements.length; i++) {\n          rowContentElements[i].height(rowContentHeights[i]);\n        }\n      }\n  \n      // Get each row's top, relative to the views's origin.\n      // Important to do this after setting each row's height.\n      for (var i=0; i<rowContentElements.length; i++) {\n        rowContentTops.push(\n          rowContentElements[i].position().top\n        );\n      }\n  \n      // Set each segment element's CSS \"top\" property.\n      // Each segment object has a \"top\" property, which is relative to the row's top, but...\n      segmentElementEach(segments, function(segment, element) {\n        element.css(\n          'top',\n          rowContentTops[segment.row] + segment.top // ...now, relative to views's origin\n        );\n      });\n    }\n  \n  \n    // Calculate the \"top\" coordinate for each segment, relative to the \"top\" of the row.\n    // Also, return an array that contains the \"content\" height for each row\n    // (the height displaced by the vertically stacked events in the row).\n    // Requires segments to have their `outerHeight` property already set.\n    function calculateVerticals(segments) {\n      var rowCnt = getRowCnt();\n      var colCnt = getColCnt();\n      var rowContentHeights = []; // content height for each row\n      var segmentRows = buildSegmentRows(segments); // an array of segment arrays, one for each row\n  \n      for (var rowI=0; rowI<rowCnt; rowI++) {\n        var segmentRow = segmentRows[rowI];\n  \n        // an array of running total heights for each column.\n        // initialize with all zeros.\n        var colHeights = [];\n        for (var colI=0; colI<colCnt; colI++) {\n          colHeights.push(0);\n        }\n  \n        // loop through every segment\n        for (var segmentI=0; segmentI<segmentRow.length; segmentI++) {\n          var segment = segmentRow[segmentI];\n  \n          // find the segment's top coordinate by looking at the max height\n          // of all the columns the segment will be in.\n          segment.top = arrayMax(\n            colHeights.slice(\n              segment.leftCol,\n              segment.rightCol + 1 // make exclusive for slice\n            )\n          );\n  \n          // adjust the columns to account for the segment's height\n          for (var colI=segment.leftCol; colI<=segment.rightCol; colI++) {\n            colHeights[colI] = segment.top + segment.outerHeight;\n          }\n        }\n  \n        // the tallest column in the row should be the \"content height\"\n        rowContentHeights.push(arrayMax(colHeights));\n      }\n  \n      return rowContentHeights;\n    }\n  \n  \n    // Build an array of segment arrays, each representing the segments that will\n    // be in a row of the grid, sorted by which event should be closest to the top.\n    function buildSegmentRows(segments) {\n      var rowCnt = getRowCnt();\n      var segmentRows = [];\n      var segmentI;\n      var segment;\n      var rowI;\n  \n      // group segments by row\n      for (segmentI=0; segmentI<segments.length; segmentI++) {\n        segment = segments[segmentI];\n        rowI = segment.row;\n        if (segment.element) { // was rendered?\n          if (segmentRows[rowI]) {\n            // already other segments. append to array\n            segmentRows[rowI].push(segment);\n          }\n          else {\n            // first segment in row. create new array\n            segmentRows[rowI] = [ segment ];\n          }\n        }\n      }\n  \n      // sort each row\n      for (rowI=0; rowI<rowCnt; rowI++) {\n        segmentRows[rowI] = sortSegmentRow(\n          segmentRows[rowI] || [] // guarantee an array, even if no segments\n        );\n      }\n  \n      return segmentRows;\n    }\n  \n  \n    // Sort an array of segments according to which segment should appear closest to the top\n    function sortSegmentRow(segments) {\n      var sortedSegments = [];\n  \n      // build the subrow array\n      var subrows = buildSegmentSubrows(segments);\n  \n      // flatten it\n      for (var i=0; i<subrows.length; i++) {\n        sortedSegments.push.apply(sortedSegments, subrows[i]); // append an array to an array\n      }\n  \n      return sortedSegments;\n    }\n  \n  \n    // Take an array of segments, which are all assumed to be in the same row,\n    // and sort into subrows.\n    function buildSegmentSubrows(segments) {\n  \n      // Give preference to elements with certain criteria, so they have\n      // a chance to be closer to the top.\n      segments.sort(compareDaySegments);\n  \n      var subrows = [];\n      for (var i=0; i<segments.length; i++) {\n        var segment = segments[i];\n  \n        // loop through subrows, starting with the topmost, until the segment\n        // doesn't collide with other segments.\n        for (var j=0; j<subrows.length; j++) {\n          if (!isDaySegmentCollision(segment, subrows[j])) {\n            break;\n          }\n        }\n        // `j` now holds the desired subrow index\n        if (subrows[j]) {\n          subrows[j].push(segment);\n        }\n        else {\n          subrows[j] = [ segment ];\n        }\n      }\n  \n      return subrows;\n    }\n  \n  \n    // Return an array of jQuery objects for the placeholder content containers of each row.\n    // The content containers don't actually contain anything, but their dimensions should match\n    // the events that are overlaid on top.\n    function getRowContentElements() {\n      var i;\n      var rowCnt = getRowCnt();\n      var rowDivs = [];\n      for (i=0; i<rowCnt; i++) {\n        rowDivs[i] = allDayRow(i)\n          .find('div.fc-day-content > div');\n      }\n      return rowDivs;\n    }\n  \n  \n  \n    /* Mouse Handlers\n    ---------------------------------------------------------------------------------------------------*/\n    // TODO: better documentation!\n  \n  \n    function attachHandlers(segments, modifiedEventId) {\n      var segmentContainer = getDaySegmentContainer();\n  \n      segmentElementEach(segments, function(segment, element, i) {\n        var event = segment.event;\n        if (event._id === modifiedEventId) {\n          bindDaySeg(event, element, segment);\n        }else{\n          element[0]._fci = i; // for lazySegBind\n        }\n      });\n  \n      lazySegBind(segmentContainer, segments, bindDaySeg);\n    }\n  \n  \n    function bindDaySeg(event, eventElement, segment) {\n  \n      if (isEventDraggable(event)) {\n        t.draggableDayEvent(event, eventElement, segment); // use `t` so subclasses can override\n      }\n  \n      if (\n        segment.isEnd && // only allow resizing on the final segment for an event\n        isEventResizable(event)\n      ) {\n        t.resizableDayEvent(event, eventElement, segment); // use `t` so subclasses can override\n      }\n  \n      // attach all other handlers.\n      // needs to be after, because resizableDayEvent might stopImmediatePropagation on click\n      eventElementHandlers(event, eventElement);\n    }\n  \n    \n    function draggableDayEvent(event, eventElement) {\n      var hoverListener = getHoverListener();\n      var dayDelta;\n      eventElement.draggable({\n        delay: 50,\n        opacity: opt('dragOpacity'),\n        revertDuration: opt('dragRevertDuration'),\n        start: function(ev, ui) {\n          trigger('eventDragStart', eventElement, event, ev, ui);\n          hideEvents(event, eventElement);\n          hoverListener.start(function(cell, origCell, rowDelta, colDelta) {\n            eventElement.draggable('option', 'revert', !cell || !rowDelta && !colDelta);\n            clearOverlays();\n            if (cell) {\n              var origDate = cellToDate(origCell);\n              var date = cellToDate(cell);\n              dayDelta = dayDiff(date, origDate);\n              renderDayOverlay(\n                addDays(cloneDate(event.start), dayDelta),\n                addDays(exclEndDay(event), dayDelta)\n              );\n            }else{\n              dayDelta = 0;\n            }\n          }, ev, 'drag');\n        },\n        stop: function(ev, ui) {\n          hoverListener.stop();\n          clearOverlays();\n          trigger('eventDragStop', eventElement, event, ev, ui);\n          if (dayDelta) {\n            eventDrop(this, event, dayDelta, 0, event.allDay, ev, ui);\n          }else{\n            eventElement.css('filter', ''); // clear IE opacity side-effects\n            showEvents(event, eventElement);\n          }\n        }\n      });\n    }\n  \n    \n    function resizableDayEvent(event, element, segment) {\n      var isRTL = opt('isRTL');\n      var direction = isRTL ? 'w' : 'e';\n      var handle = element.find('.ui-resizable-' + direction); // TODO: stop using this class because we aren't using jqui for this\n      var isResizing = false;\n      \n      // TODO: look into using jquery-ui mouse widget for this stuff\n      disableTextSelection(element); // prevent native <a> selection for IE\n      element\n        .mousedown(function(ev) { // prevent native <a> selection for others\n          ev.preventDefault();\n        })\n        .click(function(ev) {\n          if (isResizing) {\n            ev.preventDefault(); // prevent link from being visited (only method that worked in IE6)\n            ev.stopImmediatePropagation(); // prevent fullcalendar eventClick handler from being called\n                                           // (eventElementHandlers needs to be bound after resizableDayEvent)\n          }\n        });\n      \n      handle.mousedown(function(ev) {\n        if (ev.which != 1) {\n          return; // needs to be left mouse button\n        }\n        isResizing = true;\n        var hoverListener = getHoverListener();\n        var rowCnt = getRowCnt();\n        var colCnt = getColCnt();\n        var elementTop = element.css('top');\n        var dayDelta;\n        var helpers;\n        var eventCopy = $.extend({}, event);\n        var minCellOffset = dayOffsetToCellOffset( dateToDayOffset(event.start) );\n        clearSelection();\n        $('body')\n          .css('cursor', direction + '-resize')\n          .one('mouseup', mouseup);\n        trigger('eventResizeStart', this, event, ev);\n        hoverListener.start(function(cell, origCell) {\n          if (cell) {\n  \n            var origCellOffset = cellToCellOffset(origCell);\n            var cellOffset = cellToCellOffset(cell);\n  \n            // don't let resizing move earlier than start date cell\n            cellOffset = Math.max(cellOffset, minCellOffset);\n  \n            dayDelta =\n              cellOffsetToDayOffset(cellOffset) -\n              cellOffsetToDayOffset(origCellOffset);\n  \n            if (dayDelta) {\n              eventCopy.end = addDays(eventEnd(event), dayDelta, true);\n              var oldHelpers = helpers;\n  \n              helpers = renderTempDayEvent(eventCopy, segment.row, elementTop);\n              helpers = $(helpers); // turn array into a jQuery object\n  \n              helpers.find('*').css('cursor', direction + '-resize');\n              if (oldHelpers) {\n                oldHelpers.remove();\n              }\n  \n              hideEvents(event);\n            }\n            else {\n              if (helpers) {\n                showEvents(event);\n                helpers.remove();\n                helpers = null;\n              }\n            }\n            clearOverlays();\n            renderDayOverlay( // coordinate grid already rebuilt with hoverListener.start()\n              event.start,\n              addDays( exclEndDay(event), dayDelta )\n              // TODO: instead of calling renderDayOverlay() with dates,\n              // call _renderDayOverlay (or whatever) with cell offsets.\n            );\n          }\n        }, ev);\n        \n        function mouseup(ev) {\n          trigger('eventResizeStop', this, event, ev);\n          $('body').css('cursor', '');\n          hoverListener.stop();\n          clearOverlays();\n          if (dayDelta) {\n            eventResize(this, event, dayDelta, 0, ev);\n            // event redraw will clear helpers\n          }\n          // otherwise, the drag handler already restored the old events\n          \n          setTimeout(function() { // make this happen after the element's click event\n            isResizing = false;\n          },0);\n        }\n      });\n    }\n    \n  \n  }\n  \n  \n  \n  /* Generalized Segment Utilities\n  -------------------------------------------------------------------------------------------------*/\n  \n  \n  function isDaySegmentCollision(segment, otherSegments) {\n    for (var i=0; i<otherSegments.length; i++) {\n      var otherSegment = otherSegments[i];\n      if (\n        otherSegment.leftCol <= segment.rightCol &&\n        otherSegment.rightCol >= segment.leftCol\n      ) {\n        return true;\n      }\n    }\n    return false;\n  }\n  \n  \n  function segmentElementEach(segments, callback) { // TODO: use in AgendaView?\n    for (var i=0; i<segments.length; i++) {\n      var segment = segments[i];\n      var element = segment.element;\n      if (element) {\n        callback(segment, element, i);\n      }\n    }\n  }\n  \n  \n  // A cmp function for determining which segments should appear higher up\n  function compareDaySegments(a, b) {\n    return (b.rightCol - b.leftCol) - (a.rightCol - a.leftCol) || // put wider events first\n      b.event.allDay - a.event.allDay || // if tie, put all-day events first (booleans cast to 0/1)\n      a.event.start - b.event.start || // if a tie, sort by event start date\n      (a.event.title || '').localeCompare(b.event.title) // if a tie, sort by event title\n  }\n  \n  \n  ;;\n  \n  //BUG: unselect needs to be triggered when events are dragged+dropped\n  \n  function SelectionManager() {\n    var t = this;\n    \n    \n    // exports\n    t.select = select;\n    t.unselect = unselect;\n    t.reportSelection = reportSelection;\n    t.daySelectionMousedown = daySelectionMousedown;\n    \n    \n    // imports\n    var opt = t.opt;\n    var trigger = t.trigger;\n    var defaultSelectionEnd = t.defaultSelectionEnd;\n    var renderSelection = t.renderSelection;\n    var clearSelection = t.clearSelection;\n    \n    \n    // locals\n    var selected = false;\n  \n  \n  \n    // unselectAuto\n    if (opt('selectable') && opt('unselectAuto')) {\n      $(document).mousedown(function(ev) {\n        var ignore = opt('unselectCancel');\n        if (ignore) {\n          if ($(ev.target).parents(ignore).length) { // could be optimized to stop after first match\n            return;\n          }\n        }\n        unselect(ev);\n      });\n    }\n    \n  \n    function select(startDate, endDate, allDay) {\n      unselect();\n      if (!endDate) {\n        endDate = defaultSelectionEnd(startDate, allDay);\n      }\n      renderSelection(startDate, endDate, allDay);\n      reportSelection(startDate, endDate, allDay);\n    }\n    \n    \n    function unselect(ev) {\n      if (selected) {\n        selected = false;\n        clearSelection();\n        trigger('unselect', null, ev);\n      }\n    }\n    \n    \n    function reportSelection(startDate, endDate, allDay, ev) {\n      selected = true;\n      trigger('select', null, startDate, endDate, allDay, ev);\n    }\n    \n    \n    function daySelectionMousedown(ev) { // not really a generic manager method, oh well\n      var cellToDate = t.cellToDate;\n      var getIsCellAllDay = t.getIsCellAllDay;\n      var hoverListener = t.getHoverListener();\n      var reportDayClick = t.reportDayClick; // this is hacky and sort of weird\n      if (ev.which == 1 && opt('selectable')) { // which==1 means left mouse button\n        unselect(ev);\n        var _mousedownElement = this;\n        var dates;\n        hoverListener.start(function(cell, origCell) { // TODO: maybe put cellToDate/getIsCellAllDay info in cell\n          clearSelection();\n          if (cell && getIsCellAllDay(cell)) {\n            dates = [ cellToDate(origCell), cellToDate(cell) ].sort(dateCompare);\n            renderSelection(dates[0], dates[1], true);\n          }else{\n            dates = null;\n          }\n        }, ev);\n        $(document).one('mouseup', function(ev) {\n          hoverListener.stop();\n          if (dates) {\n            if (+dates[0] == +dates[1]) {\n              reportDayClick(dates[0], true, ev);\n            }\n            reportSelection(dates[0], dates[1], true, ev);\n          }\n        });\n      }\n    }\n  \n  \n  }\n  \n  ;;\n   \n  function OverlayManager() {\n    var t = this;\n    \n    \n    // exports\n    t.renderOverlay = renderOverlay;\n    t.clearOverlays = clearOverlays;\n    \n    \n    // locals\n    var usedOverlays = [];\n    var unusedOverlays = [];\n    \n    \n    function renderOverlay(rect, parent) {\n      var e = unusedOverlays.shift();\n      if (!e) {\n        e = $(\"<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>\");\n      }\n      if (e[0].parentNode != parent[0]) {\n        e.appendTo(parent);\n      }\n      usedOverlays.push(e.css(rect).show());\n      return e;\n    }\n    \n  \n    function clearOverlays() {\n      var e;\n      while (e = usedOverlays.shift()) {\n        unusedOverlays.push(e.hide().unbind());\n      }\n    }\n  \n  \n  }\n  \n  ;;\n  \n  function CoordinateGrid(buildFunc) {\n  \n    var t = this;\n    var rows;\n    var cols;\n    \n    \n    t.build = function() {\n      rows = [];\n      cols = [];\n      buildFunc(rows, cols);\n    };\n    \n    \n    t.cell = function(x, y) {\n      var rowCnt = rows.length;\n      var colCnt = cols.length;\n      var i, r=-1, c=-1;\n      for (i=0; i<rowCnt; i++) {\n        if (y >= rows[i][0] && y < rows[i][1]) {\n          r = i;\n          break;\n        }\n      }\n      for (i=0; i<colCnt; i++) {\n        if (x >= cols[i][0] && x < cols[i][1]) {\n          c = i;\n          break;\n        }\n      }\n      return (r>=0 && c>=0) ? { row:r, col:c } : null;\n    };\n    \n    \n    t.rect = function(row0, col0, row1, col1, originElement) { // row1,col1 is inclusive\n      var origin = originElement.offset();\n      return {\n        top: rows[row0][0] - origin.top,\n        left: cols[col0][0] - origin.left,\n        width: cols[col1][1] - cols[col0][0],\n        height: rows[row1][1] - rows[row0][0]\n      };\n    };\n  \n  }\n  \n  ;;\n  \n  function HoverListener(coordinateGrid) {\n  \n  \n    var t = this;\n    var bindType;\n    var change;\n    var firstCell;\n    var cell;\n    \n    \n    t.start = function(_change, ev, _bindType) {\n      change = _change;\n      firstCell = cell = null;\n      coordinateGrid.build();\n      mouse(ev);\n      bindType = _bindType || 'mousemove';\n      $(document).bind(bindType, mouse);\n    };\n    \n    \n    function mouse(ev) {\n      _fixUIEvent(ev); // see below\n      var newCell = coordinateGrid.cell(ev.pageX, ev.pageY);\n      if (!newCell != !cell || newCell && (newCell.row != cell.row || newCell.col != cell.col)) {\n        if (newCell) {\n          if (!firstCell) {\n            firstCell = newCell;\n          }\n          change(newCell, firstCell, newCell.row-firstCell.row, newCell.col-firstCell.col);\n        }else{\n          change(newCell, firstCell);\n        }\n        cell = newCell;\n      }\n    }\n    \n    \n    t.stop = function() {\n      $(document).unbind(bindType, mouse);\n      return cell;\n    };\n    \n    \n  }\n  \n  \n  \n  // this fix was only necessary for jQuery UI 1.8.16 (and jQuery 1.7 or 1.7.1)\n  // upgrading to jQuery UI 1.8.17 (and using either jQuery 1.7 or 1.7.1) fixed the problem\n  // but keep this in here for 1.8.16 users\n  // and maybe remove it down the line\n  \n  function _fixUIEvent(event) { // for issue 1168\n    if (event.pageX === undefined) {\n      event.pageX = event.originalEvent.pageX;\n      event.pageY = event.originalEvent.pageY;\n    }\n  }\n  ;;\n  \n  function HorizontalPositionCache(getElement) {\n  \n    var t = this,\n      elements = {},\n      lefts = {},\n      rights = {};\n      \n    function e(i) {\n      return elements[i] = elements[i] || getElement(i);\n    }\n    \n    t.left = function(i) {\n      return lefts[i] = lefts[i] === undefined ? e(i).position().left : lefts[i];\n    };\n    \n    t.right = function(i) {\n      return rights[i] = rights[i] === undefined ? t.left(i) + e(i).width() : rights[i];\n    };\n    \n    t.clear = function() {\n      elements = {};\n      lefts = {};\n      rights = {};\n    };\n    \n  }\n  \n  ;;\n  \n  })();\n\n\nexport default CadastroHorario;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}